Vault password (gpte_vault_0): 

PLAY [Step 0000 Set Action] ****************************************************

TASK [Set ACTION to provision] *************************************************
Monday 04 August 2025  09:59:47 +0000 (0:00:00.012)       0:00:00.012 ********* 
skipping: [localhost]

PLAY [Step 0000 Setup runtime] *************************************************

TASK [debug] *******************************************************************
Monday 04 August 2025  09:59:47 +0000 (0:00:00.028)       0:00:00.040 ********* 
skipping: [localhost]

TASK [Ensure cloud provider is supported] **************************************
Monday 04 August 2025  09:59:47 +0000 (0:00:00.016)       0:00:00.056 ********* 
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

PLAY [Step 0000 Setup Output Directory] ****************************************

TASK [Set output_dir if not defined] *******************************************
Monday 04 August 2025  09:59:47 +0000 (0:00:00.030)       0:00:00.087 ********* 
skipping: [localhost]

TASK [Create output_dir if it does not exists] *********************************
Monday 04 August 2025  09:59:47 +0000 (0:00:00.015)       0:00:00.103 ********* 
changed: [localhost]

TASK [Attempt to restore output_dir contents] **********************************
Monday 04 August 2025  09:59:48 +0000 (0:00:00.230)       0:00:00.333 ********* 

TASK [agnosticd_restore_output_dir : Restore output_dir from s3 bucket] ********
Monday 04 August 2025  09:59:48 +0000 (0:00:00.023)       0:00:00.357 ********* 
included: /runner/project/ansible/roles/agnosticd_restore_output_dir/tasks/restore-from-s3.yml for localhost

TASK [agnosticd_restore_output_dir : Get output_dir archive from s3] ***********
Monday 04 August 2025  09:59:48 +0000 (0:00:00.039)       0:00:00.397 ********* 
included: /runner/project/ansible/roles/agnosticd_restore_output_dir/tasks/fetch-from-s3-s3_object.yml for localhost

TASK [agnosticd_restore_output_dir : Get output_dir archive from s3] ***********
Monday 04 August 2025  09:59:48 +0000 (0:00:00.035)       0:00:00.432 ********* 
ok: [localhost]

TASK [agnosticd_restore_output_dir : Decrypt archive] **************************
Monday 04 August 2025  09:59:48 +0000 (0:00:00.770)       0:00:01.203 ********* 
skipping: [localhost]

TASK [agnosticd_restore_output_dir : Restore output_dir from archive] **********
Monday 04 August 2025  09:59:48 +0000 (0:00:00.015)       0:00:01.219 ********* 
skipping: [localhost]

TASK [agnosticd_restore_output_dir : Remove archive file from output_dir] ******
Monday 04 August 2025  09:59:48 +0000 (0:00:00.013)       0:00:01.232 ********* 
ok: [localhost]

TASK [agnosticd_restore_output_dir : Remove encrypted archive file from output_dir] ***
Monday 04 August 2025  09:59:49 +0000 (0:00:00.155)       0:00:01.388 ********* 
ok: [localhost]

TASK [Touch file provision-user-data.yaml and provision-user-info.yaml] ********
Monday 04 August 2025  09:59:49 +0000 (0:00:00.147)       0:00:01.536 ********* 
changed: [localhost] => (item=user-info.yaml)
changed: [localhost] => (item=user-data.yaml)

TASK [Create empty user-info.yaml and user-data.yaml in output dir] ************
Monday 04 August 2025  09:59:49 +0000 (0:00:00.307)       0:00:01.843 ********* 
changed: [localhost] => (item=user-info.yaml)
changed: [localhost] => (item=user-data.yaml)

TASK [Create symlink user-data.yaml -> provision-user-data.yaml] ***************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.706)       0:00:02.549 ********* 
changed: [localhost] => (item=user-info.yaml)
changed: [localhost] => (item=user-data.yaml)

PLAY [Step 0000 Include Vars] **************************************************

TASK [Set output_dir for all hosts] ********************************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.315)       0:00:02.865 ********* 
ok: [localhost]

TASK [Include variables files] *************************************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.021)       0:00:02.886 ********* 
skipping: [localhost] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yaml) 
skipping: [localhost] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yaml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yaml) 
ok: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yml)
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yaml) 
ok: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yml)
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yaml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yml) 

TASK [Include secret_file if passed as extra-var] ******************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.062)       0:00:02.948 ********* 
skipping: [localhost]

TASK [Set passthrough user data] ***********************************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.016)       0:00:02.964 ********* 
skipping: [localhost]

PLAY [Step 0000 Install Galaxy roles and collections] **************************

TASK [Use requirements_content] ************************************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.028)       0:00:02.993 ********* 
ok: [localhost]

TASK [Copy requirements content to output_dir] *********************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.014)       0:00:03.007 ********* 
changed: [localhost]

TASK [Use requirements_path from the config] ***********************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.287)       0:00:03.295 ********* 
skipping: [localhost]

TASK [Check if requirements.yml exists] ****************************************
Monday 04 August 2025  09:59:50 +0000 (0:00:00.014)       0:00:03.309 ********* 
ok: [localhost]

TASK [set_fact] ****************************************************************
Monday 04 August 2025  09:59:51 +0000 (0:00:00.160)       0:00:03.470 ********* 
ok: [localhost]

TASK [Install roles from requirements.yml] *************************************
Monday 04 August 2025  09:59:51 +0000 (0:00:00.016)       0:00:03.487 ********* 
changed: [localhost]

TASK [Install collections from requirements.yml (Not EE)] **********************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.965)       0:00:04.453 ********* 
skipping: [localhost]

TASK [Get installed collections (EE)] ******************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.022)       0:00:04.475 ********* 
skipping: [localhost]

TASK [Install dynamic sources] *************************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.018)       0:00:04.494 ********* 

TASK [agnosticd_dynamic : Create dynamic-cache and dynamic-roles directories] ***
Monday 04 August 2025  09:59:52 +0000 (0:00:00.017)       0:00:04.512 ********* 
changed: [localhost] => (item=/runner/project/ansible/dynamic-cache)
ok: [localhost] => (item=/runner/project/ansible/dynamic-roles)

TASK [agnosticd_dynamic : Install ansible-galaxy sources to dynamic roles dir] ***
Monday 04 August 2025  09:59:52 +0000 (0:00:00.302)       0:00:04.814 ********* 
skipping: [localhost]

TASK [agnosticd_dynamic : Install ansible-galaxy sources to cache] *************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.016)       0:00:04.831 ********* 
skipping: [localhost]

TASK [agnosticd_dynamic : Install git sources] *********************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.013)       0:00:04.845 ********* 
skipping: [localhost]

PLAY [Step 000 Pre Infrastructure] *********************************************

TASK [debug] *******************************************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.025)       0:00:04.870 ********* 
ok: [localhost] => {
    "msg": "Step 000 Pre Infrastructure"
}

PLAY [Install Pre Infra  workloads on localhost] *******************************

TASK [Deploying Pre Infra workloads  on localhost] *****************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.027)       0:00:04.898 ********* 
skipping: [localhost]
[WARNING]: Could not match supplied host pattern, ignoring: windows
[WARNING]: Could not match supplied host pattern, ignoring: network

PLAY [Install Pre Infra workloads on  all hosts] *******************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: bastions

PLAY [Install Pre Infra workloads on bastion] **********************************
skipping: no hosts matched

PLAY [Install Pre Infra workloads for windows] *********************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: gitlab

PLAY [Install Pre Infra workloads for gitlab] **********************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: controllers

PLAY [Install Pre Infra workloads for Automation Controller] *******************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: satellites

PLAY [Install Pre Infra workloads for Satelliltes] *****************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: capsules

PLAY [Install Pre Infra workloads for Satelllite Capsules] *********************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: servers

PLAY [Install Pre Infra workloads for Automation Server] ***********************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: nodes

PLAY [Install Pre Infra workloads for nodes] ***********************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: rhel7_nodes

PLAY [Install Pre Infra workloads for rhel7 nodes] *****************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: rhel8_nodes

PLAY [Install Pre Infra workloads for rhel8 nodes] *****************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: rhel9_nodes

PLAY [Install Pre Infra workloads for rhel9 nodes] *****************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: rhel10_nodes

PLAY [Install Pre Infra workloads for rhel10 nodes] ****************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: centos_nodes

PLAY [Install Pre Infra workloads for centos nodes] ****************************
skipping: no hosts matched
[WARNING]: Could not match supplied host pattern, ignoring: rhelai_nodes

PLAY [Install Pre Infra workloads for rhelai nodes] ****************************
skipping: no hosts matched

PLAY [Install Pre Infra workloads for network] *********************************
skipping: no hosts matched

PLAY [Step 001.0 Infrastructure Pre-Checks] ************************************

TASK [Test aws command] ********************************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.059)       0:00:04.957 ********* 
ok: [localhost]

TASK [Fail if AWS command CLI if not available] ********************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.166)       0:00:05.124 ********* 
skipping: [localhost]

PLAY [Step 001.1 Deploy Infrastructure] ****************************************

TASK [Run infra-images] ********************************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.028)       0:00:05.152 ********* 

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.018)       0:00:05.171 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2.yaml for localhost

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.030)       0:00:05.202 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'dns_loadbalancer': True, 'flavor': {'ec2': 't3a.large'}, 'floating_ip': True, 'image': 'RHEL95GOLD-latest', 'name': 'bastion', 'public_dns': True, 'rootfs_size': 50, 'security_groups': ['BastionSG', 'NodeSG', 'WebSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'bastions,automationcontroller'}, {'key': 'ostype', 'value': 'linux'}, {'key': 'instance_filter', 'value': 'ansible-bu-workshop-ansible-bu-workshop@opentlc.com'}], 'unique': True})
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'flavor': {'ec2': 't3a.large'}, 'floating_ip': True, 'image': {'name': 'aap2.5-2024-11-06'}, 'name': 'controller', 'public_dns': True, 'rootfs_size': 200, 'security_groups': ['NodeSG', 'WebSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'controllers'}, {'key': 'ostype', 'value': 'rhel'}, {'key': 'instance_filter', 'value': 'ansible-bu-workshop-ansible-bu-workshop@opentlc.com'}], 'unique': True})
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'flavor': {'ec2': 't3a.large'}, 'image': 'RHEL95GOLD-latest', 'name': 'node', 'public_dns': False, 'rootfs_size': '50', 'security_groups': ['DefaultSG', 'ServerSG', 'NodeSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'nodes'}, {'key': 'ostype', 'value': 'linux'}]})
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'flavor': {'ec2': 't3a.large'}, 'floating_ip': True, 'image': 'RHEL95GOLD-latest', 'name': 'server', 'public_dns': True, 'rootfs_size': '50', 'security_groups': ['DefaultSG', 'NodeSG', 'ServerSG', 'WebSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'centos_nodes'}, {'key': 'ostype', 'value': 'linux'}], 'unique': True})

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.053)       0:00:05.255 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'owner': 309956199498, 'name': 'RHEL-9.5.*_HVM_*Access*', 'architecture': 'x86_64', 'aws_filters': {'is-public': False}})

TASK [infra-images : Lookup image for bastion] *********************************
Monday 04 August 2025  09:59:52 +0000 (0:00:00.050)       0:00:05.306 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for bastion] ***********************
Monday 04 August 2025  09:59:53 +0000 (0:00:00.868)       0:00:06.174 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  09:59:53 +0000 (0:00:00.020)       0:00:06.194 ********* 
ok: [localhost]

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:53 +0000 (0:00:00.026)       0:00:06.220 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'name': 'aap2.5-2024-11-06'})

TASK [infra-images : Lookup image for controller] ******************************
Monday 04 August 2025  09:59:53 +0000 (0:00:00.048)       0:00:06.268 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for controller] ********************
Monday 04 August 2025  09:59:55 +0000 (0:00:01.098)       0:00:07.367 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  09:59:55 +0000 (0:00:00.019)       0:00:07.387 ********* 
ok: [localhost]

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:55 +0000 (0:00:00.026)       0:00:07.414 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'owner': 309956199498, 'name': 'RHEL-9.5.*_HVM_*Access*', 'architecture': 'x86_64', 'aws_filters': {'is-public': False}})

TASK [infra-images : Lookup image for node] ************************************
Monday 04 August 2025  09:59:55 +0000 (0:00:00.050)       0:00:07.464 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for node] **************************
Monday 04 August 2025  09:59:55 +0000 (0:00:00.723)       0:00:08.188 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  09:59:55 +0000 (0:00:00.019)       0:00:08.208 ********* 
ok: [localhost]

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:55 +0000 (0:00:00.026)       0:00:08.234 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'owner': 309956199498, 'name': 'RHEL-9.5.*_HVM_*Access*', 'architecture': 'x86_64', 'aws_filters': {'is-public': False}})

TASK [infra-images : Lookup image for server] **********************************
Monday 04 August 2025  09:59:55 +0000 (0:00:00.047)       0:00:08.281 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for server] ************************
Monday 04 August 2025  09:59:56 +0000 (0:00:00.685)       0:00:08.967 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  09:59:56 +0000 (0:00:00.020)       0:00:08.987 ********* 
ok: [localhost]

TASK [infra-images : debug agnosticd_image] ************************************
Monday 04 August 2025  09:59:56 +0000 (0:00:00.026)       0:00:09.014 ********* 
skipping: [localhost]

TASK [infra-images : Print images found for each instance] *********************
Monday 04 August 2025  09:59:56 +0000 (0:00:00.017)       0:00:09.032 ********* 
ok: [localhost] => (item=bastion) => {
    "msg": "bastion - RHEL-9.5.0_HVM_GA-20241029-x86_64-0-Access2-GP3 - ami-0e1686a22fb17852d - Red Hat BYOL Linux - us-east-2"
}
ok: [localhost] => (item=controller) => {
    "msg": "controller - aap2.5-2024-11-06 - ami-073ab2ff383abe44b - Red Hat BYOL Linux - us-east-2"
}
ok: [localhost] => (item=node) => {
    "msg": "node - RHEL-9.5.0_HVM_GA-20241029-x86_64-0-Access2-GP3 - ami-0e1686a22fb17852d - Red Hat BYOL Linux - us-east-2"
}
ok: [localhost] => (item=server) => {
    "msg": "server - RHEL-9.5.0_HVM_GA-20241029-x86_64-0-Access2-GP3 - ami-0e1686a22fb17852d - Red Hat BYOL Linux - us-east-2"
}

TASK [Run infra-aws-capacity-reservation] **************************************
Monday 04 August 2025  09:59:56 +0000 (0:00:00.053)       0:00:09.085 ********* 

TASK [infra-aws-capacity-reservation : include_tasks] **************************
Monday 04 August 2025  09:59:56 +0000 (0:00:00.025)       0:00:09.111 ********* 
included: /runner/project/ansible/roles-infra/infra-aws-capacity-reservation/tasks/pre_checks.yaml for localhost

TASK [infra-aws-capacity-reservation : Ensure mandatory variables are set] *****
Monday 04 August 2025  09:59:56 +0000 (0:00:00.036)       0:00:09.148 ********* 
ok: [localhost] => (item=agnosticd_aws_capacity_reservations dictionary is empty)
ok: [localhost] => (item=agnosticd_aws_capacity_reservation_regions list is empty)

TASK [infra-aws-capacity-reservation : include_tasks] **************************
Monday 04 August 2025  09:59:56 +0000 (0:00:00.080)       0:00:09.228 ********* 
included: /runner/project/ansible/roles-infra/infra-aws-capacity-reservation/tasks/create.yaml for localhost

TASK [infra-aws-capacity-reservation : Retrieve stack_deployed from provision-user-data.yaml] ***
Monday 04 August 2025  09:59:56 +0000 (0:00:00.035)       0:00:09.264 ********* 
ok: [localhost]

TASK [infra-aws-capacity-reservation : Retrieve the region from user-data.yaml] ***
Monday 04 August 2025  09:59:56 +0000 (0:00:00.033)       0:00:09.298 ********* 
skipping: [localhost]

TASK [infra-aws-capacity-reservation : Create on-demand capacity reservations and save result] ***
Monday 04 August 2025  09:59:57 +0000 (0:00:00.103)       0:00:09.401 ********* 
Reservation created: cr-0f1588f81e0a19d7c (us-east-2b)
Reservation created: cr-0547512c7dc4b044a (us-east-2b)
Reservation created: cr-072dae01ddba2847a (us-east-2b)
Reservation created: cr-01cc8c72d0f2bab0c (us-east-2b)
ok: [localhost]

TASK [infra-aws-capacity-reservation : Set AZ and region] **********************
Monday 04 August 2025  09:59:58 +0000 (0:00:01.178)       0:00:10.579 ********* 
ok: [localhost]

TASK [infra-aws-capacity-reservation : Ensure aws_region is not passed as extra vars and different] ***
Monday 04 August 2025  09:59:58 +0000 (0:00:00.032)       0:00:10.612 ********* 
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [infra-aws-capacity-reservation : Set default aws_availability_zone (single AZ)] ***
Monday 04 August 2025  09:59:58 +0000 (0:00:00.032)       0:00:10.644 ********* 
ok: [localhost]

TASK [infra-aws-capacity-reservation : Save region in user-data] ***************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.031)       0:00:10.675 ********* 
ok: [localhost] => {
    "changed": false,
    "data": {
        "aws_region": "us-east-2"
    }
}

TASK [infra-aws-capacity-reservation : Save AZ in user-data] *******************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.038)       0:00:10.713 ********* 
ok: [localhost] => {
    "changed": false,
    "data": {
        "aws_availability_zone": "us-east-2b"
    }
}

TASK [infra-aws-capacity-reservation : include_tasks] **************************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.038)       0:00:10.752 ********* 
skipping: [localhost]

TASK [Empty the agnosticd_images and run the detection again] ******************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.029)       0:00:10.781 ********* 
ok: [localhost]

TASK [Run infra-images again to use the proper region selected by the reservations] ***
Monday 04 August 2025  09:59:58 +0000 (0:00:00.016)       0:00:10.798 ********* 

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.023)       0:00:10.821 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2.yaml for localhost

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.038)       0:00:10.860 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'dns_loadbalancer': True, 'flavor': {'ec2': 't3a.large'}, 'floating_ip': True, 'image': 'RHEL95GOLD-latest', 'name': 'bastion', 'public_dns': True, 'rootfs_size': 50, 'security_groups': ['BastionSG', 'NodeSG', 'WebSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'bastions,automationcontroller'}, {'key': 'ostype', 'value': 'linux'}, {'key': 'instance_filter', 'value': 'ansible-bu-workshop-ansible-bu-workshop@opentlc.com'}], 'unique': True})
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'flavor': {'ec2': 't3a.large'}, 'floating_ip': True, 'image': {'name': 'aap2.5-2024-11-06'}, 'name': 'controller', 'public_dns': True, 'rootfs_size': 200, 'security_groups': ['NodeSG', 'WebSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'controllers'}, {'key': 'ostype', 'value': 'rhel'}, {'key': 'instance_filter', 'value': 'ansible-bu-workshop-ansible-bu-workshop@opentlc.com'}], 'unique': True})
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'flavor': {'ec2': 't3a.large'}, 'image': 'RHEL95GOLD-latest', 'name': 'node', 'public_dns': False, 'rootfs_size': '50', 'security_groups': ['DefaultSG', 'ServerSG', 'NodeSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'nodes'}, {'key': 'ostype', 'value': 'linux'}]})
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_images.yaml for localhost => (item={'count': 1, 'flavor': {'ec2': 't3a.large'}, 'floating_ip': True, 'image': 'RHEL95GOLD-latest', 'name': 'server', 'public_dns': True, 'rootfs_size': '50', 'security_groups': ['DefaultSG', 'NodeSG', 'ServerSG', 'WebSG'], 'tags': [{'key': 'AnsibleGroup', 'value': 'centos_nodes'}, {'key': 'ostype', 'value': 'linux'}], 'unique': True})

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.072)       0:00:10.933 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'owner': 309956199498, 'name': 'RHEL-9.5.*_HVM_*Access*', 'architecture': 'x86_64', 'aws_filters': {'is-public': False}})

TASK [infra-images : Lookup image for bastion] *********************************
Monday 04 August 2025  09:59:58 +0000 (0:00:00.053)       0:00:10.987 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for bastion] ***********************
Monday 04 August 2025  09:59:59 +0000 (0:00:00.766)       0:00:11.753 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  09:59:59 +0000 (0:00:00.022)       0:00:11.776 ********* 
ok: [localhost]

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  09:59:59 +0000 (0:00:00.027)       0:00:11.804 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'name': 'aap2.5-2024-11-06'})

TASK [infra-images : Lookup image for controller] ******************************
Monday 04 August 2025  09:59:59 +0000 (0:00:00.060)       0:00:11.864 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for controller] ********************
Monday 04 August 2025  10:00:00 +0000 (0:00:00.838)       0:00:12.703 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  10:00:00 +0000 (0:00:00.022)       0:00:12.725 ********* 
ok: [localhost]

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  10:00:00 +0000 (0:00:00.028)       0:00:12.754 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'owner': 309956199498, 'name': 'RHEL-9.5.*_HVM_*Access*', 'architecture': 'x86_64', 'aws_filters': {'is-public': False}})

TASK [infra-images : Lookup image for node] ************************************
Monday 04 August 2025  10:00:00 +0000 (0:00:00.051)       0:00:12.805 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for node] **************************
Monday 04 August 2025  10:00:01 +0000 (0:00:00.668)       0:00:13.474 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  10:00:01 +0000 (0:00:00.022)       0:00:13.496 ********* 
ok: [localhost]

TASK [infra-images : include_tasks] ********************************************
Monday 04 August 2025  10:00:01 +0000 (0:00:00.028)       0:00:13.524 ********* 
included: /runner/project/ansible/roles-infra/infra-images/tasks/ec2_loop_image.yaml for localhost => (item={'owner': 309956199498, 'name': 'RHEL-9.5.*_HVM_*Access*', 'architecture': 'x86_64', 'aws_filters': {'is-public': False}})

TASK [infra-images : Lookup image for server] **********************************
Monday 04 August 2025  10:00:01 +0000 (0:00:00.052)       0:00:13.577 ********* 
ok: [localhost]

TASK [infra-images : Fail if no image found for server] ************************
Monday 04 August 2025  10:00:01 +0000 (0:00:00.618)       0:00:14.195 ********* 
skipping: [localhost]

TASK [infra-images : Save image in agnosticd_images, use latest if multiple found] ***
Monday 04 August 2025  10:00:01 +0000 (0:00:00.023)       0:00:14.218 ********* 
ok: [localhost]

TASK [infra-images : debug agnosticd_image] ************************************
Monday 04 August 2025  10:00:01 +0000 (0:00:00.029)       0:00:14.248 ********* 
skipping: [localhost]

TASK [infra-images : Print images found for each instance] *********************
Monday 04 August 2025  10:00:01 +0000 (0:00:00.021)       0:00:14.270 ********* 
ok: [localhost] => (item=bastion) => {
    "msg": "bastion - RHEL-9.5.0_HVM_GA-20241029-x86_64-0-Access2-GP3 - ami-0e1686a22fb17852d - Red Hat BYOL Linux - us-east-2"
}
ok: [localhost] => (item=controller) => {
    "msg": "controller - aap2.5-2024-11-06 - ami-073ab2ff383abe44b - Red Hat BYOL Linux - us-east-2"
}
ok: [localhost] => (item=node) => {
    "msg": "node - RHEL-9.5.0_HVM_GA-20241029-x86_64-0-Access2-GP3 - ami-0e1686a22fb17852d - Red Hat BYOL Linux - us-east-2"
}
ok: [localhost] => (item=server) => {
    "msg": "server - RHEL-9.5.0_HVM_GA-20241029-x86_64-0-Access2-GP3 - ami-0e1686a22fb17852d - Red Hat BYOL Linux - us-east-2"
}

TASK [Run infra-aws-open-environment Role] *************************************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.066)       0:00:14.336 ********* 
skipping: [localhost]

TASK [Create ssh provision key] ************************************************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.020)       0:00:14.357 ********* 

TASK [create_ssh_provision_key : include_tasks] ********************************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.042)       0:00:14.399 ********* 
included: /runner/project/ansible/roles-infra/create_ssh_provision_key/tasks/checks.yaml for localhost

TASK [create_ssh_provision_key : Ensure key_name is not defined] ***************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.017)       0:00:14.417 ********* 
skipping: [localhost]

TASK [create_ssh_provision_key : Generate SSH keys] ****************************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.017)       0:00:14.434 ********* 
changed: [localhost]

TASK [create_ssh_provision_key : Fix permission of ssh key] ********************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.252)       0:00:14.687 ********* 
changed: [localhost]

TASK [create_ssh_provision_key : Generate SSH pub key content] *****************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.152)       0:00:14.839 ********* 
ok: [localhost]

TASK [create_ssh_provision_key : Save all facts for SSH] ***********************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.161)       0:00:15.000 ********* 
ok: [localhost]

TASK [create_ssh_provision_key : Write SSH pub key] ****************************
Monday 04 August 2025  10:00:02 +0000 (0:00:00.018)       0:00:15.018 ********* 
changed: [localhost]

TASK [create_ssh_provision_key : Report user info for SSH provision key as user data] ***
Monday 04 August 2025  10:00:02 +0000 (0:00:00.293)       0:00:15.312 ********* 
skipping: [localhost]

TASK [include_role : agnosticd_save_output_dir] ********************************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.014)       0:00:15.326 ********* 

TASK [agnosticd_save_output_dir : Save output dir if archive file is defined] ***
Monday 04 August 2025  10:00:03 +0000 (0:00:00.031)       0:00:15.357 ********* 
included: /runner/project/ansible/roles/agnosticd_save_output_dir/tasks/save-output-dir.yml for localhost

TASK [agnosticd_save_output_dir : Create output_dir archive] *******************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.026)       0:00:15.384 ********* 
included: /runner/project/ansible/roles/agnosticd_save_output_dir/tasks/create-output-dir-archive.yml for localhost

TASK [agnosticd_save_output_dir : Create tempfile for archive] *****************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.021)       0:00:15.406 ********* 
changed: [localhost]

TASK [agnosticd_save_output_dir : Set agnosticd_save_output_dir_archive_tempfile] ***
Monday 04 August 2025  10:00:03 +0000 (0:00:00.252)       0:00:15.658 ********* 
ok: [localhost]

TASK [agnosticd_save_output_dir : Create output_dir archive] *******************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.016)       0:00:15.675 ********* 
changed: [localhost]

TASK [agnosticd_save_output_dir : Encrypt tarball using password] **************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.151)       0:00:15.827 ********* 
skipping: [localhost]

TASK [agnosticd_save_output_dir : Upload output_dir archive to S3] *************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.022)       0:00:15.849 ********* 
included: /runner/project/ansible/roles/agnosticd_save_output_dir/tasks/upload-archive-s3.yml for localhost

TASK [Run infra-cloud-tags role] ***********************************************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.038)       0:00:15.887 ********* 

TASK [infra-cloud-tags : Set cloud_tags_final (string)] ************************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.032)       0:00:15.920 ********* 
skipping: [localhost]

TASK [infra-cloud-tags : Set cloud_tags_final (dictionary)] ********************
Monday 04 August 2025  10:00:03 +0000 (0:00:00.024)       0:00:15.944 ********* 
ok: [localhost]

TASK [agnosticd_save_output_dir : Save output_dir archive to AWS S3] ***********
Monday 04 August 2025  10:00:03 +0000 (0:00:00.033)       0:00:15.978 ********* 
included: /runner/project/ansible/roles/agnosticd_save_output_dir/tasks/upload-archive-s3-s3_object.yml for localhost

TASK [agnosticd_save_output_dir : Save output_dir archive to AWS S3] ***********
Monday 04 August 2025  10:00:03 +0000 (0:00:00.036)       0:00:16.014 ********* 
changed: [localhost]

TASK [agnosticd_save_output_dir : Remove output_dir archive tempfile] **********
Monday 04 August 2025  10:00:04 +0000 (0:00:00.799)       0:00:16.813 ********* 
changed: [localhost]

TASK [agnosticd_save_output_dir : Remove output_dir encrypted archive tempfile] ***
Monday 04 August 2025  10:00:04 +0000 (0:00:00.169)       0:00:16.983 ********* 
skipping: [localhost]

TASK [agnosticd_save_output_dir : Save output dir if archive file is defined] ***
Monday 04 August 2025  10:00:04 +0000 (0:00:00.018)       0:00:17.001 ********* 
skipping: [localhost]

TASK [Locate environment SSH key] **********************************************
Monday 04 August 2025  10:00:04 +0000 (0:00:00.019)       0:00:17.021 ********* 

TASK [locate_env_authorized_key : Set env_authorized_key_path] *****************
Monday 04 August 2025  10:00:04 +0000 (0:00:00.034)       0:00:17.055 ********* 
ok: [localhost]

TASK [locate_env_authorized_key : Set env_authorized_key_path_pub] *************
Monday 04 August 2025  10:00:04 +0000 (0:00:00.024)       0:00:17.080 ********* 
ok: [localhost]

TASK [locate_env_authorized_key : Generate SSH pub key content if it doesn't exist] ***
Monday 04 August 2025  10:00:04 +0000 (0:00:00.031)       0:00:17.112 ********* 
ok: [localhost]

TASK [locate_env_authorized_key : Save SSH pub key content as fact] ************
Monday 04 August 2025  10:00:04 +0000 (0:00:00.154)       0:00:17.266 ********* 
ok: [localhost]

TASK [Create keypair in ec2] ***************************************************
Monday 04 August 2025  10:00:04 +0000 (0:00:00.023)       0:00:17.290 ********* 

TASK [infra-ec2-ssh-key : include_tasks] ***************************************
Monday 04 August 2025  10:00:05 +0000 (0:00:00.035)       0:00:17.326 ********* 
skipping: [localhost]

TASK [infra-ec2-ssh-key : include_tasks] ***************************************
Monday 04 August 2025  10:00:05 +0000 (0:00:00.013)       0:00:17.339 ********* 
included: /runner/project/ansible/roles-infra/infra-ec2-ssh-key/tasks/create.yaml for localhost

TASK [infra-ec2-ssh-key : Stat local infra key] ********************************
Monday 04 August 2025  10:00:05 +0000 (0:00:00.023)       0:00:17.362 ********* 
ok: [localhost]

TASK [infra-ec2-ssh-key : Generate SSH pub key content] ************************
Monday 04 August 2025  10:00:05 +0000 (0:00:00.155)       0:00:17.517 ********* 
skipping: [localhost]

TASK [infra-ec2-ssh-key : Save all facts for SSH] ******************************
Monday 04 August 2025  10:00:05 +0000 (0:00:00.017)       0:00:17.535 ********* 
skipping: [localhost]

TASK [infra-ec2-ssh-key : Create infra key] ************************************
Monday 04 August 2025  10:00:05 +0000 (0:00:00.017)       0:00:17.552 ********* 
changed: [localhost]

TASK [Run infra-ec2-template-generate Role] ************************************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.790)       0:00:18.343 ********* 

TASK [infra-ec2-template-generate : Detect all possible Availability Zones that can host all the instance types and pick one] ***
Monday 04 August 2025  10:00:06 +0000 (0:00:00.073)       0:00:18.416 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : Check if template exists for the environment] ***
Monday 04 August 2025  10:00:06 +0000 (0:00:00.029)       0:00:18.446 ********* 
ok: [localhost]

TASK [infra-ec2-template-generate : Use CloudFormation template from the environment] ***
Monday 04 August 2025  10:00:06 +0000 (0:00:00.146)       0:00:18.592 ********* 
ok: [localhost]

TASK [infra-ec2-template-generate : Use the default CloudFormation template] ***
Monday 04 August 2025  10:00:06 +0000 (0:00:00.019)       0:00:18.612 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : Print cloudformation_template_src] *********
Monday 04 August 2025  10:00:06 +0000 (0:00:00.015)       0:00:18.627 ********* 
ok: [localhost] => {
    "cloudformation_template_src": "../configs/ansible-bu-workshop/files/cloud_providers/ec2_cloud_template.j2"
}

TASK [infra-ec2-template-generate : Determine the security groups used in 'instances' dictionary] ***
Monday 04 August 2025  10:00:06 +0000 (0:00:00.015)       0:00:18.643 ********* 
ok: [localhost]

TASK [infra-ec2-template-generate : set_fact] **********************************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.053)       0:00:18.696 ********* 
ok: [localhost]

TASK [infra-ec2-template-generate : Print cloudformation_template] *************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.014)       0:00:18.711 ********* 
ok: [localhost] => {
    "cloudformation_template": "/tmp/output-b59c22c5-17f4-58af-ac8b-fd740c0f38e4/ansible-bu-workshop.v6mhs.ec2_cloud_template"
}

TASK [infra-ec2-template-generate : AWS Generate CloudFormation Template] ******
Monday 04 August 2025  10:00:06 +0000 (0:00:00.014)       0:00:18.726 ********* 
changed: [localhost]

TASK [infra-ec2-template-generate : Stop if debugging template] ****************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.393)       0:00:19.119 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : Stat CloudFormation template] **************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.015)       0:00:19.135 ********* 
ok: [localhost]

TASK [infra-ec2-template-generate : Get user name] *****************************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.150)       0:00:19.286 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : set_fact] **********************************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.012)       0:00:19.298 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : set_fact] **********************************
Monday 04 August 2025  10:00:06 +0000 (0:00:00.013)       0:00:19.312 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : Create bucket] *****************************
Monday 04 August 2025  10:00:07 +0000 (0:00:00.011)       0:00:19.323 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : Copy Template to S3] ***********************
Monday 04 August 2025  10:00:07 +0000 (0:00:00.012)       0:00:19.336 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : Check for !Ref in CF template] *************
Monday 04 August 2025  10:00:07 +0000 (0:00:00.018)       0:00:19.355 ********* 
ok: [localhost]

TASK [infra-ec2-template-generate : validation cloudformation template] ********
Monday 04 August 2025  10:00:07 +0000 (0:00:00.236)       0:00:19.591 ********* 
ok: [localhost] => {
    "changed": false,
    "msg": "Cloudformation template is syntactically valid"
}

TASK [infra-ec2-template-generate : Copy original !Ref CF template back in place] ***
Monday 04 August 2025  10:00:07 +0000 (0:00:00.034)       0:00:19.625 ********* 
skipping: [localhost]

TASK [infra-ec2-template-generate : validate cloudformation template with validate-template (local)] ***
Monday 04 August 2025  10:00:07 +0000 (0:00:00.014)       0:00:19.640 ********* 
ok: [localhost]

TASK [infra-ec2-template-generate : validate cloudformation template with validate-template (S3)] ***
Monday 04 August 2025  10:00:08 +0000 (0:00:00.800)       0:00:20.441 ********* 
skipping: [localhost]

TASK [Run infra-ec2-template-create Role] **************************************
Monday 04 August 2025  10:00:08 +0000 (0:00:00.015)       0:00:20.457 ********* 

TASK [infra-ec2-template-create : Retrieve stack_deployed from provision-user-data.yaml] ***
Monday 04 August 2025  10:00:08 +0000 (0:00:00.053)       0:00:20.510 ********* 
skipping: [localhost]

TASK [include_role : infra-cloud-tags] *****************************************
Monday 04 August 2025  10:00:08 +0000 (0:00:00.016)       0:00:20.526 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : set_fact] ************************************
Monday 04 August 2025  10:00:08 +0000 (0:00:00.018)       0:00:20.544 ********* 
ok: [localhost]

TASK [infra-ec2-template-create : Wait a bit for the previous stack and child resources to be deleted] ***
Monday 04 August 2025  10:00:08 +0000 (0:00:00.019)       0:00:20.564 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : include_tasks] *******************************
Monday 04 August 2025  10:00:08 +0000 (0:00:00.017)       0:00:20.581 ********* 
skipping: [localhost]

TASK [Regenerate the CloudFormation template because of custom images] *********
Monday 04 August 2025  10:00:08 +0000 (0:00:00.023)       0:00:20.604 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : Prepare for launch CloudFormation template from local] ***
Monday 04 August 2025  10:00:08 +0000 (0:00:00.027)       0:00:20.632 ********* 
ok: [localhost]

TASK [infra-ec2-template-create : Prepare for launch CloudFormation template from S3 bucket] ***
Monday 04 August 2025  10:00:08 +0000 (0:00:00.023)       0:00:20.655 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : Launch CloudFormation template (local)] ******
Monday 04 August 2025  10:00:08 +0000 (0:00:00.020)       0:00:20.676 ********* 
[WARNING]: Using a variable for a task's 'args' is unsafe in some situations
(see
https://docs.ansible.com/ansible/devel/reference_appendices/faq.html#argsplat-
unsafe)
[DEPRECATION WARNING]: Param 'template' is deprecated. See the module docs for 
more information. This feature will be removed from amazon.aws in a release 
after 2026-05-01. Deprecation warnings can be disabled by setting 
deprecation_warnings=False in ansible.cfg.
changed: [localhost]

TASK [infra-ec2-template-create : debug cloudformation] ************************
Monday 04 August 2025  10:03:07 +0000 (0:02:58.998)       0:03:19.674 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : debug cloudformation] ************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.018)       0:03:19.693 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : Delete S3 bucket if it exists] ***************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.021)       0:03:19.715 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : report s3 error] *****************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.023)       0:03:19.738 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : Destroy cloudformation template] *************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.021)       0:03:19.760 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : report Cloudformation Destroy error] *********
Monday 04 August 2025  10:03:07 +0000 (0:00:00.021)       0:03:19.782 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : report Cloudformation error] *****************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.018)       0:03:19.800 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : Save aws_region_loop into aws_region_final] ***
Monday 04 August 2025  10:03:07 +0000 (0:00:00.018)       0:03:19.819 ********* 
ok: [localhost]

TASK [infra-ec2-template-create : Output region] *******************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.029)       0:03:19.848 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : Output region] *******************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.018)       0:03:19.867 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : set_fact] ************************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.018)       0:03:19.885 ********* 
ok: [localhost]

TASK [infra-ec2-template-create : Save stack deployed for futur runs (idempotent)] ***
Monday 04 August 2025  10:03:07 +0000 (0:00:00.019)       0:03:19.905 ********* 
skipping: [localhost]

TASK [infra-ec2-template-create : set_fact] ************************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.016)       0:03:19.922 ********* 
skipping: [localhost]

TASK [Run infra-ec2-template-create Role into FallBack region] *****************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.018)       0:03:19.940 ********* 
skipping: [localhost]

TASK [report Cloudformation error] *********************************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.022)       0:03:19.962 ********* 
skipping: [localhost]

PLAY [Step 001.2 Create Inventory and SSH config setup] ************************

TASK [include_tasks] ***********************************************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.039)       0:03:20.002 ********* 
skipping: [localhost]

TASK [Run infra-ec2-create-inventory Role] *************************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.024)       0:03:20.027 ********* 

TASK [infra-ec2-create-inventory : Report aws region] **************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.030)       0:03:20.057 ********* 
skipping: [localhost]

TASK [infra-ec2-create-inventory : Gather EC2 info] ****************************
Monday 04 August 2025  10:03:07 +0000 (0:00:00.018)       0:03:20.075 ********* 
ok: [localhost]

TASK [infra-ec2-create-inventory : debug ec2_info] *****************************
Monday 04 August 2025  10:03:08 +0000 (0:00:00.822)       0:03:20.897 ********* 
skipping: [localhost]

TASK [infra-ec2-create-inventory : windows ostype workaround] ******************
Monday 04 August 2025  10:03:08 +0000 (0:00:00.017)       0:03:20.914 ********* 
ok: [localhost]

TASK [infra-ec2-create-inventory : set_fact] ***********************************
Monday 04 August 2025  10:03:08 +0000 (0:00:00.017)       0:03:20.932 ********* 
ok: [localhost]

TASK [infra-ec2-create-inventory : Find the bastion in this batch of hosts] ****
Monday 04 August 2025  10:03:08 +0000 (0:00:00.017)       0:03:20.949 ********* 
ok: [localhost]

TASK [infra-ec2-create-inventory : Add hosts to the current inventory] *********
Monday 04 August 2025  10:03:08 +0000 (0:00:00.035)       0:03:20.984 ********* 
changed: [localhost] => (item=node1.example.com)
changed: [localhost] => (item=controller.example.com)
changed: [localhost] => (item=server.example.com)
changed: [localhost] => (item=bastion.example.com)

TASK [infra-ec2-create-inventory : Add hosts to groups indicated by AnsibleGroup tag] ***
Monday 04 August 2025  10:03:08 +0000 (0:00:00.142)       0:03:21.127 ********* 
changed: [localhost] => (item=node1.example.com)
changed: [localhost] => (item=controller.example.com)
changed: [localhost] => (item=server.example.com)
changed: [localhost] => (item=bastion.example.com)

TASK [infra-ec2-create-inventory : debug hostvars] *****************************
Monday 04 August 2025  10:03:08 +0000 (0:00:00.061)       0:03:21.189 ********* 
skipping: [localhost]

TASK [infra-ec2-create-inventory : debug groups] *******************************
Monday 04 August 2025  10:03:08 +0000 (0:00:00.017)       0:03:21.207 ********* 
skipping: [localhost]

TASK [Run Common SSH Config Generator Role] ************************************
Monday 04 August 2025  10:03:08 +0000 (0:00:00.023)       0:03:21.230 ********* 

TASK [infra-common-ssh-config-generate : Store bastion hostname as a fact] *****
Monday 04 August 2025  10:03:08 +0000 (0:00:00.041)       0:03:21.272 ********* 
ok: [localhost]

TASK [infra-common-ssh-config-generate : Delete dedicated known_host if it exists (new deployment)] ***
Monday 04 August 2025  10:03:08 +0000 (0:00:00.023)       0:03:21.296 ********* 
ok: [localhost]

TASK [infra-common-ssh-config-generate : delete local ssh config, start fresh] ***
Monday 04 August 2025  10:03:09 +0000 (0:00:00.155)       0:03:21.452 ********* 
ok: [localhost]

TASK [infra-common-ssh-config-generate : Create empty local ssh config] ********
Monday 04 August 2025  10:03:09 +0000 (0:00:00.176)       0:03:21.628 ********* 
changed: [localhost]

TASK [infra-common-ssh-config-generate : Add bastion proxy config to workdir ssh config file] ***
Monday 04 August 2025  10:03:09 +0000 (0:00:00.169)       0:03:21.797 ********* 
changed: [localhost]

TASK [infra-common-ssh-config-generate : Add all hosts to workdir ssh config file] ***
Monday 04 August 2025  10:03:09 +0000 (0:00:00.274)       0:03:22.072 ********* 
changed: [localhost] => (item=node1.example.com)
changed: [localhost] => (item=controller.example.com)
changed: [localhost] => (item=server.example.com)
skipping: [localhost] => (item=bastion.example.com) 

PLAY [Step 0000 Include Vars] **************************************************

TASK [Set output_dir for all hosts] ********************************************
Monday 04 August 2025  10:03:10 +0000 (0:00:00.577)       0:03:22.650 ********* 
ok: [localhost]
ok: [node1.example.com]
ok: [controller.example.com]
ok: [server.example.com]
ok: [bastion.example.com]

TASK [Include variables files] *************************************************
Monday 04 August 2025  10:03:10 +0000 (0:00:00.049)       0:03:22.700 ********* 
skipping: [localhost] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yaml) 
skipping: [localhost] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yaml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yaml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yml) 
skipping: [controller.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yaml) 
skipping: [server.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yaml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yaml) 
skipping: [controller.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yml) 
skipping: [bastion.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yaml) 
skipping: [server.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yaml) 
ok: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yml)
skipping: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yaml) 
skipping: [bastion.example.com] => (item=/runner/project/ansible/cloud_providers/ec2_default_vars.yml) 
skipping: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yaml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yaml) 
skipping: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yml) 
skipping: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yaml) 
skipping: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yml) 
skipping: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yaml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yaml) 
skipping: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yaml) 
skipping: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_vars.yml) 
ok: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yml)
ok: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yml)
skipping: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yaml) 
ok: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yml)
ok: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yml)
skipping: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yaml) 
skipping: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yaml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yaml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yaml) 
skipping: [localhost] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yml) 
ok: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars.yml)
ok: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yml)
ok: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yml)
ok: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yml)
skipping: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yaml) 
skipping: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yaml) 
skipping: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yaml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yaml) 
skipping: [server.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yml) 
ok: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/default_vars_ec2.yml)
skipping: [controller.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yml) 
skipping: [node1.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yml) 
skipping: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yaml) 
skipping: [bastion.example.com] => (item=/runner/project/ansible/configs/ansible-bu-workshop/env_secret_vars.yml) 

TASK [Include secret_file if passed as extra-var] ******************************
Monday 04 August 2025  10:03:10 +0000 (0:00:00.142)       0:03:22.842 ********* 
skipping: [localhost]
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [Set passthrough user data] ***********************************************
Monday 04 August 2025  10:03:10 +0000 (0:00:00.044)       0:03:22.887 ********* 
skipping: [localhost]

PLAY [Step 001.3 Configure Linux Hosts and Wait for Connection] ****************

TASK [set facts for remote access] *********************************************
Monday 04 August 2025  10:03:10 +0000 (0:00:00.076)       0:03:22.963 ********* 
ok: [node1.example.com]
ok: [controller.example.com]
ok: [server.example.com]
ok: [bastion.example.com]

TASK [Run infra-ec2-wait_for_linux_hosts Role] *********************************
Monday 04 August 2025  10:03:10 +0000 (0:00:00.050)       0:03:23.014 ********* 

TASK [infra-ec2-wait_for_linux_hosts : wait for linux host to be available] ****
Monday 04 August 2025  10:03:10 +0000 (0:00:00.053)       0:03:23.067 ********* 
ok: [bastion.example.com]
ok: [node1.example.com]
ok: [server.example.com]
ok: [controller.example.com]

TASK [infra-ec2-wait_for_linux_hosts : restart instance if wait_for_connection failed] ***
Monday 04 August 2025  10:03:19 +0000 (0:00:08.435)       0:03:31.503 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [infra-ec2-wait_for_linux_hosts : wait for linux host to be available (retry)] ***
Monday 04 August 2025  10:03:19 +0000 (0:00:00.037)       0:03:31.540 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [infra-ec2-wait_for_linux_hosts : ping] ***********************************
Monday 04 August 2025  10:03:19 +0000 (0:00:00.035)       0:03:31.576 ********* 
ok: [bastion.example.com]
ok: [server.example.com]
ok: [node1.example.com]
ok: [controller.example.com]

TASK [Run infra-ec2-linux-set-hostname Role] ***********************************
Monday 04 August 2025  10:03:23 +0000 (0:00:04.701)       0:03:36.277 ********* 

TASK [infra-ec2-linux-set-hostname : Set hostname based on tag_internaldns] ****
Monday 04 August 2025  10:03:24 +0000 (0:00:00.055)       0:03:36.333 ********* 
changed: [bastion.example.com]
changed: [server.example.com]
changed: [node1.example.com]
ok: [controller.example.com]

TASK [infra-ec2-linux-set-hostname : stat] *************************************
Monday 04 August 2025  10:03:29 +0000 (0:00:05.410)       0:03:41.743 ********* 
ok: [bastion.example.com]
ok: [server.example.com]
ok: [node1.example.com]
ok: [controller.example.com]

TASK [infra-ec2-linux-set-hostname : disable updating hostname in /etc/cloud/cloud.cfg] ***
Monday 04 August 2025  10:03:31 +0000 (0:00:02.075)       0:03:43.818 ********* 
changed: [node1.example.com]
changed: [bastion.example.com]
changed: [server.example.com]
ok: [controller.example.com]

TASK [infra-ec2-linux-set-hostname : Add preserve_hostname to /etc/cloud/cloud.cfg] ***
Monday 04 August 2025  10:03:33 +0000 (0:00:02.471)       0:03:46.290 ********* 
changed: [bastion.example.com]
changed: [node1.example.com]
changed: [server.example.com]
ok: [controller.example.com]

TASK [Add authorized_keys] *****************************************************
Monday 04 August 2025  10:03:36 +0000 (0:00:02.077)       0:03:48.367 ********* 

TASK [ssh_authorized_keys : Add all authorized keys] ***************************
Monday 04 August 2025  10:03:36 +0000 (0:00:00.070)       0:03:48.438 ********* 
changed: [bastion.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvZvn+GL0wTOsAdh1ikIQoqj2Fw/RA6F14O347rgKdpkgOQpGQk1k2gM8wcla2Y1o0bPIzwlNy1oh5o9uNjZDMeDcEXWuXbu0cRBy4pVRhh8a8zAZfssnqoXHHLyPyHWpdTmgIhr0UIGYrzHrnySAnUcDp3gJuE46UEBtrlyv94cVvZf+EZUTaZ+2KjTRLoNryCn7vKoGHQBooYg1DeHLcLSRWEADUo+bP0y64+X/XTMZOAXbf8kTXocqAgfl/usbYdfLOgwU6zWuj8vxzAKuMEXS1AJSp5aeqRKlbbw40IkTmLoQIgJdb2Zt98BH/xHDe9xxhscUCfWeS37XLp75J opentlc_admin_backdoor'})
changed: [server.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvZvn+GL0wTOsAdh1ikIQoqj2Fw/RA6F14O347rgKdpkgOQpGQk1k2gM8wcla2Y1o0bPIzwlNy1oh5o9uNjZDMeDcEXWuXbu0cRBy4pVRhh8a8zAZfssnqoXHHLyPyHWpdTmgIhr0UIGYrzHrnySAnUcDp3gJuE46UEBtrlyv94cVvZf+EZUTaZ+2KjTRLoNryCn7vKoGHQBooYg1DeHLcLSRWEADUo+bP0y64+X/XTMZOAXbf8kTXocqAgfl/usbYdfLOgwU6zWuj8vxzAKuMEXS1AJSp5aeqRKlbbw40IkTmLoQIgJdb2Zt98BH/xHDe9xxhscUCfWeS37XLp75J opentlc_admin_backdoor'})
changed: [node1.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvZvn+GL0wTOsAdh1ikIQoqj2Fw/RA6F14O347rgKdpkgOQpGQk1k2gM8wcla2Y1o0bPIzwlNy1oh5o9uNjZDMeDcEXWuXbu0cRBy4pVRhh8a8zAZfssnqoXHHLyPyHWpdTmgIhr0UIGYrzHrnySAnUcDp3gJuE46UEBtrlyv94cVvZf+EZUTaZ+2KjTRLoNryCn7vKoGHQBooYg1DeHLcLSRWEADUo+bP0y64+X/XTMZOAXbf8kTXocqAgfl/usbYdfLOgwU6zWuj8vxzAKuMEXS1AJSp5aeqRKlbbw40IkTmLoQIgJdb2Zt98BH/xHDe9xxhscUCfWeS37XLp75J opentlc_admin_backdoor'})
changed: [bastion.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCg5PJgwAB8U2NiXh4aRZAg09f3xjT3y1CP322StmT4ljiqhXoqOOZ++qDIKFmtHGmeEjvkCo11M2oVmJTeaibeS0E+Xsoi9wTcit47h2ka7WPdzhy/togFQOVAftbwi3RtHDOweIFL18FQ8inhu9W/oFibsZjQEWtHoHtLkmA5zOSQtWDmVfx3iWrKd4svkNbJ+SNZMnD0tCDoot3y0Knzyt+wpZtVd94YXpUDTCJ8Ie1nFSdm7H/QB9/bDXeOSSnHBq2xSmywodNoyA1gFZ1hhpPNEauQjzeKCMpNLPATg/jtQb1zojG6QnO/7I5euKOlDeJ1Odg35aTG31p8EbT3UL8NZssdn3YY3OEQ/2rN0PaQ+zxzmzfh1otx4Rsh1IbD5S99GuQD2ma7m0zOzrBb8Mil5TCaTaK8mIADq/lclj0sAMrH1EXyFvDiHEG+cV0iMyXOxEMTJs4YLr8DyqsTZ34TvVSJP9/0YwQuRYhg0MJmFbMvl/4yibTgyvTYLN0= instructor-key-2022'})
changed: [server.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCg5PJgwAB8U2NiXh4aRZAg09f3xjT3y1CP322StmT4ljiqhXoqOOZ++qDIKFmtHGmeEjvkCo11M2oVmJTeaibeS0E+Xsoi9wTcit47h2ka7WPdzhy/togFQOVAftbwi3RtHDOweIFL18FQ8inhu9W/oFibsZjQEWtHoHtLkmA5zOSQtWDmVfx3iWrKd4svkNbJ+SNZMnD0tCDoot3y0Knzyt+wpZtVd94YXpUDTCJ8Ie1nFSdm7H/QB9/bDXeOSSnHBq2xSmywodNoyA1gFZ1hhpPNEauQjzeKCMpNLPATg/jtQb1zojG6QnO/7I5euKOlDeJ1Odg35aTG31p8EbT3UL8NZssdn3YY3OEQ/2rN0PaQ+zxzmzfh1otx4Rsh1IbD5S99GuQD2ma7m0zOzrBb8Mil5TCaTaK8mIADq/lclj0sAMrH1EXyFvDiHEG+cV0iMyXOxEMTJs4YLr8DyqsTZ34TvVSJP9/0YwQuRYhg0MJmFbMvl/4yibTgyvTYLN0= instructor-key-2022'})
changed: [node1.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCg5PJgwAB8U2NiXh4aRZAg09f3xjT3y1CP322StmT4ljiqhXoqOOZ++qDIKFmtHGmeEjvkCo11M2oVmJTeaibeS0E+Xsoi9wTcit47h2ka7WPdzhy/togFQOVAftbwi3RtHDOweIFL18FQ8inhu9W/oFibsZjQEWtHoHtLkmA5zOSQtWDmVfx3iWrKd4svkNbJ+SNZMnD0tCDoot3y0Knzyt+wpZtVd94YXpUDTCJ8Ie1nFSdm7H/QB9/bDXeOSSnHBq2xSmywodNoyA1gFZ1hhpPNEauQjzeKCMpNLPATg/jtQb1zojG6QnO/7I5euKOlDeJ1Odg35aTG31p8EbT3UL8NZssdn3YY3OEQ/2rN0PaQ+zxzmzfh1otx4Rsh1IbD5S99GuQD2ma7m0zOzrBb8Mil5TCaTaK8mIADq/lclj0sAMrH1EXyFvDiHEG+cV0iMyXOxEMTJs4YLr8DyqsTZ34TvVSJP9/0YwQuRYhg0MJmFbMvl/4yibTgyvTYLN0= instructor-key-2022'})
changed: [bastion.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIIDDIOD4M5yYo3uCFDBDb6del+NG2fkboWh90kW/S6H elliptical_instructor_key_2024'})
changed: [server.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIIDDIOD4M5yYo3uCFDBDb6del+NG2fkboWh90kW/S6H elliptical_instructor_key_2024'})
changed: [node1.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIIDDIOD4M5yYo3uCFDBDb6del+NG2fkboWh90kW/S6H elliptical_instructor_key_2024'})
changed: [bastion.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOBfsRMLCEQt86EZnvQ/rK49wo1odLqpd1NEz3tDjUWY elliptical_admin_key_2023'})
changed: [server.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOBfsRMLCEQt86EZnvQ/rK49wo1odLqpd1NEz3tDjUWY elliptical_admin_key_2023'})
changed: [node1.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOBfsRMLCEQt86EZnvQ/rK49wo1odLqpd1NEz3tDjUWY elliptical_admin_key_2023'})
changed: [bastion.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC3nKRSIwWn7pjMf2i1TyXgjsauEIoDS8Xulad2ZAbsmZrWcKU5hPi23xq0g2AjRYiXml8zSX9jAQfmlKnrXGYo5WN39iXGRI3lFJmXwmEHne3Z0qtUgt9MBA4w0Tcunw7pXniKntvo2oiDYZlXHztRMHMeUkUjLgCGjn2cfi0uqd4pxLmneMziHMKDxcyy+9MaGnWr5Bs27r3b6rWNFqG2fAo1Z5ZWEA/r3MhdI9ZzMRJVTUhunpstwMX8MRxx/OGk0zynyHcSkh91sqZ3xhPpvRkmYLRa5I0aw88AMenWBfc586FyORL2e/UVoIoyMkBMnovaRIoiTj74RuPeZ6gGKbbfpt1ggDs4j9Z1Go51GlGPYcchvLQvx+Ucv5+tLZSqZBhPOXLRqFuQgRZz4R6j5O5UkfdjLJxBoHQZxT0Wdzd/XiGcAlyDOq8puNSxdF3w/8eGGSKDdUONv1tc1dcTFd6kR+jYaedjD1fldVrC+4fRUFkFqEovDPVI4159VSqJWz78WuqazNnCRMVDnS4Le+Er1pvTbk5rOdYUkF67vxVwD3cyJ3D1C49wVsIc3+kngZN2246OEMsbVugEPG4A8/UOlHIE5iBps+mM9GX6UFSj4aLFh15XeOGKs7aH2r1thfvFPSvk12t8QvNDhhhhAf5EzzypvNEbXQ6fk3YSUw== rsa_admin_key_2023'})
changed: [server.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC3nKRSIwWn7pjMf2i1TyXgjsauEIoDS8Xulad2ZAbsmZrWcKU5hPi23xq0g2AjRYiXml8zSX9jAQfmlKnrXGYo5WN39iXGRI3lFJmXwmEHne3Z0qtUgt9MBA4w0Tcunw7pXniKntvo2oiDYZlXHztRMHMeUkUjLgCGjn2cfi0uqd4pxLmneMziHMKDxcyy+9MaGnWr5Bs27r3b6rWNFqG2fAo1Z5ZWEA/r3MhdI9ZzMRJVTUhunpstwMX8MRxx/OGk0zynyHcSkh91sqZ3xhPpvRkmYLRa5I0aw88AMenWBfc586FyORL2e/UVoIoyMkBMnovaRIoiTj74RuPeZ6gGKbbfpt1ggDs4j9Z1Go51GlGPYcchvLQvx+Ucv5+tLZSqZBhPOXLRqFuQgRZz4R6j5O5UkfdjLJxBoHQZxT0Wdzd/XiGcAlyDOq8puNSxdF3w/8eGGSKDdUONv1tc1dcTFd6kR+jYaedjD1fldVrC+4fRUFkFqEovDPVI4159VSqJWz78WuqazNnCRMVDnS4Le+Er1pvTbk5rOdYUkF67vxVwD3cyJ3D1C49wVsIc3+kngZN2246OEMsbVugEPG4A8/UOlHIE5iBps+mM9GX6UFSj4aLFh15XeOGKs7aH2r1thfvFPSvk12t8QvNDhhhhAf5EzzypvNEbXQ6fk3YSUw== rsa_admin_key_2023'})
changed: [node1.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC3nKRSIwWn7pjMf2i1TyXgjsauEIoDS8Xulad2ZAbsmZrWcKU5hPi23xq0g2AjRYiXml8zSX9jAQfmlKnrXGYo5WN39iXGRI3lFJmXwmEHne3Z0qtUgt9MBA4w0Tcunw7pXniKntvo2oiDYZlXHztRMHMeUkUjLgCGjn2cfi0uqd4pxLmneMziHMKDxcyy+9MaGnWr5Bs27r3b6rWNFqG2fAo1Z5ZWEA/r3MhdI9ZzMRJVTUhunpstwMX8MRxx/OGk0zynyHcSkh91sqZ3xhPpvRkmYLRa5I0aw88AMenWBfc586FyORL2e/UVoIoyMkBMnovaRIoiTj74RuPeZ6gGKbbfpt1ggDs4j9Z1Go51GlGPYcchvLQvx+Ucv5+tLZSqZBhPOXLRqFuQgRZz4R6j5O5UkfdjLJxBoHQZxT0Wdzd/XiGcAlyDOq8puNSxdF3w/8eGGSKDdUONv1tc1dcTFd6kR+jYaedjD1fldVrC+4fRUFkFqEovDPVI4159VSqJWz78WuqazNnCRMVDnS4Le+Er1pvTbk5rOdYUkF67vxVwD3cyJ3D1C49wVsIc3+kngZN2246OEMsbVugEPG4A8/UOlHIE5iBps+mM9GX6UFSj4aLFh15XeOGKs7aH2r1thfvFPSvk12t8QvNDhhhhAf5EzzypvNEbXQ6fk3YSUw== rsa_admin_key_2023'})
ok: [controller.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvZvn+GL0wTOsAdh1ikIQoqj2Fw/RA6F14O347rgKdpkgOQpGQk1k2gM8wcla2Y1o0bPIzwlNy1oh5o9uNjZDMeDcEXWuXbu0cRBy4pVRhh8a8zAZfssnqoXHHLyPyHWpdTmgIhr0UIGYrzHrnySAnUcDp3gJuE46UEBtrlyv94cVvZf+EZUTaZ+2KjTRLoNryCn7vKoGHQBooYg1DeHLcLSRWEADUo+bP0y64+X/XTMZOAXbf8kTXocqAgfl/usbYdfLOgwU6zWuj8vxzAKuMEXS1AJSp5aeqRKlbbw40IkTmLoQIgJdb2Zt98BH/xHDe9xxhscUCfWeS37XLp75J opentlc_admin_backdoor'})
ok: [controller.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCg5PJgwAB8U2NiXh4aRZAg09f3xjT3y1CP322StmT4ljiqhXoqOOZ++qDIKFmtHGmeEjvkCo11M2oVmJTeaibeS0E+Xsoi9wTcit47h2ka7WPdzhy/togFQOVAftbwi3RtHDOweIFL18FQ8inhu9W/oFibsZjQEWtHoHtLkmA5zOSQtWDmVfx3iWrKd4svkNbJ+SNZMnD0tCDoot3y0Knzyt+wpZtVd94YXpUDTCJ8Ie1nFSdm7H/QB9/bDXeOSSnHBq2xSmywodNoyA1gFZ1hhpPNEauQjzeKCMpNLPATg/jtQb1zojG6QnO/7I5euKOlDeJ1Odg35aTG31p8EbT3UL8NZssdn3YY3OEQ/2rN0PaQ+zxzmzfh1otx4Rsh1IbD5S99GuQD2ma7m0zOzrBb8Mil5TCaTaK8mIADq/lclj0sAMrH1EXyFvDiHEG+cV0iMyXOxEMTJs4YLr8DyqsTZ34TvVSJP9/0YwQuRYhg0MJmFbMvl/4yibTgyvTYLN0= instructor-key-2022'})
ok: [controller.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIIDDIOD4M5yYo3uCFDBDb6del+NG2fkboWh90kW/S6H elliptical_instructor_key_2024'})
ok: [controller.example.com] => (item={'key': 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOBfsRMLCEQt86EZnvQ/rK49wo1odLqpd1NEz3tDjUWY elliptical_admin_key_2023'})
ok: [controller.example.com] => (item={'key': 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC3nKRSIwWn7pjMf2i1TyXgjsauEIoDS8Xulad2ZAbsmZrWcKU5hPi23xq0g2AjRYiXml8zSX9jAQfmlKnrXGYo5WN39iXGRI3lFJmXwmEHne3Z0qtUgt9MBA4w0Tcunw7pXniKntvo2oiDYZlXHztRMHMeUkUjLgCGjn2cfi0uqd4pxLmneMziHMKDxcyy+9MaGnWr5Bs27r3b6rWNFqG2fAo1Z5ZWEA/r3MhdI9ZzMRJVTUhunpstwMX8MRxx/OGk0zynyHcSkh91sqZ3xhPpvRkmYLRa5I0aw88AMenWBfc586FyORL2e/UVoIoyMkBMnovaRIoiTj74RuPeZ6gGKbbfpt1ggDs4j9Z1Go51GlGPYcchvLQvx+Ucv5+tLZSqZBhPOXLRqFuQgRZz4R6j5O5UkfdjLJxBoHQZxT0Wdzd/XiGcAlyDOq8puNSxdF3w/8eGGSKDdUONv1tc1dcTFd6kR+jYaedjD1fldVrC+4fRUFkFqEovDPVI4159VSqJWz78WuqazNnCRMVDnS4Le+Er1pvTbk5rOdYUkF67vxVwD3cyJ3D1C49wVsIc3+kngZN2246OEMsbVugEPG4A8/UOlHIE5iBps+mM9GX6UFSj4aLFh15XeOGKs7aH2r1thfvFPSvk12t8QvNDhhhhAf5EzzypvNEbXQ6fk3YSUw== rsa_admin_key_2023'})

TASK [ssh_authorized_keys : Add all authorized keys (legacy var all_ssh_authorized_keys)] ***
Monday 04 August 2025  10:03:56 +0000 (0:00:20.794)       0:04:09.232 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

PLAY [Step 001.4 Configure Windows Hosts and Wait for Connection] **************
skipping: no hosts matched

PLAY [Step 002 Post Infrastructure] ********************************************

TASK [ansible.builtin.debug] ***************************************************
Monday 04 August 2025  10:03:57 +0000 (0:00:00.084)       0:04:09.316 ********* 
ok: [localhost] => {
    "msg": "Step 002 Post Infrastructure"
}

PLAY [Step 002 Post Infrastructure regreSSHion Hotfix] *************************

TASK [Gathering Facts] *********************************************************
Monday 04 August 2025  10:03:57 +0000 (0:00:00.033)       0:04:09.350 ********* 
ok: [bastion.example.com]
ok: [node1.example.com]
ok: [server.example.com]
ok: [controller.example.com]

TASK [Have facts been gathered?] ***********************************************
Monday 04 August 2025  10:04:00 +0000 (0:00:03.478)       0:04:12.828 ********* 
ok: [bastion.example.com]
ok: [node1.example.com]
ok: [server.example.com]
ok: [controller.example.com]

TASK [Set sshd LoginGraceTime to 0 in /etc/ssh/sshd_config] ********************
Monday 04 August 2025  10:04:02 +0000 (0:00:02.191)       0:04:15.019 ********* 
changed: [bastion.example.com]
changed: [server.example.com]
changed: [node1.example.com]
ok: [controller.example.com]

TASK [Restart SSH service for regreSSHion fix] *********************************
Monday 04 August 2025  10:04:04 +0000 (0:00:01.957)       0:04:16.976 ********* 
changed: [server.example.com]
changed: [node1.example.com]
changed: [bastion.example.com]
changed: [controller.example.com]

PLAY [Install Post Infra  workloads on localhost] ******************************

TASK [Deploying Post Infra workloads  on localhost] ****************************
Monday 04 August 2025  10:04:07 +0000 (0:00:02.728)       0:04:19.705 ********* 
skipping: [localhost]

PLAY [Install Post Infra workloads on  all hosts] ******************************

TASK [Deploying Post Infra workloads on all hosts] *****************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.060)       0:04:19.766 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

PLAY [Install Post Infra workloads on bastion] *********************************

TASK [Deploying Post Infra workloads on bastion] *******************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.122)       0:04:19.888 ********* 
skipping: [bastion.example.com]

PLAY [Install Post Infra workloads for windows] ********************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for gitlab] *********************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for Automation Controller] ******************

TASK [Deploying Post Infra workloads on Automation Controller] *****************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.052)       0:04:19.941 ********* 
skipping: [controller.example.com]

PLAY [Install Post Infra workloads for Satelliltes] ****************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for Satelllite Capsules] ********************
skipping: no hosts matched

PLAY [Install Post Infra workloads for Automation Server] **********************
skipping: no hosts matched

PLAY [Install Post Infra workloads for nodes] **********************************

TASK [Deploying Post Infra workloads on nodes] *********************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.050)       0:04:19.991 ********* 
skipping: [node1.example.com]

PLAY [Install Post Infra workloads for rhel7 nodes] ****************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for rhel8 nodes] ****************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for rhel9 nodes] ****************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for rhel10 nodes] ***************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for centos nodes] ***************************

TASK [Deploying Post Infra workloads on centos nodes] **************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.050)       0:04:20.042 ********* 
skipping: [server.example.com]

PLAY [Install Post Infra workloads for rhelai nodes] ***************************
skipping: no hosts matched

PLAY [Install Post Infra workloads for network] ********************************
skipping: no hosts matched

PLAY [localhost] ***************************************************************

TASK [Export in-memory inventory to inventory file] ****************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.044)       0:04:20.086 ********* 
skipping: [localhost]

PLAY [Step 003 Pre Software] ***************************************************

TASK [debug] *******************************************************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.042)       0:04:20.129 ********* 
ok: [localhost] => {
    "msg": "Step 003 Pre Software"
}

TASK [Save user data] **********************************************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.015)       0:04:20.144 ********* 
ok: [localhost] => {
    "changed": false,
    "data": {
        "targethost": "bastion.v6mhs.sandbox2309.opentlc.com"
    }
}

PLAY [Install Pre Software  workloads on localhost] ****************************

TASK [Deploying Pre Software workloads  on localhost] **************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.041)       0:04:20.185 ********* 
skipping: [localhost]

PLAY [Install Pre Software workloads on  all hosts] ****************************

TASK [Deploying Pre Software workloads on all hosts] ***************************
Monday 04 August 2025  10:04:07 +0000 (0:00:00.061)       0:04:20.246 ********* 

TASK [set-repositories : Run setup if gather_facts hasn't been run] ************
Monday 04 August 2025  10:04:08 +0000 (0:00:00.122)       0:04:20.369 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : Configure satellite repositories] *********************
Monday 04 August 2025  10:04:08 +0000 (0:00:00.057)       0:04:20.426 ********* 
included: /runner/project/ansible/roles/set-repositories/tasks/satellite-repos.yml for node1.example.com, controller.example.com, server.example.com, bastion.example.com

TASK [set-repositories : sat | Check subscription-manager package existence] ***
Monday 04 August 2025  10:04:08 +0000 (0:00:00.129)       0:04:20.556 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Install subscription-manager package] ***********
Monday 04 August 2025  10:04:08 +0000 (0:00:00.061)       0:04:20.617 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Remove rh-amazon-rhui-client package] ***********
Monday 04 August 2025  10:04:08 +0000 (0:00:00.066)       0:04:20.683 ********* 
changed: [server.example.com]
changed: [node1.example.com]
changed: [bastion.example.com]
ok: [controller.example.com]

TASK [set-repositories : sat | Unregister the system just in case] *************
Monday 04 August 2025  10:04:15 +0000 (0:00:07.065)       0:04:27.749 ********* 
included: /runner/project/ansible/roles/set-repositories/tasks/unregister.yml for node1.example.com, controller.example.com, server.example.com, bastion.example.com

TASK [set-repositories : unreg | Unregister From Subscription Manager] *********
Monday 04 August 2025  10:04:15 +0000 (0:00:00.082)       0:04:27.832 ********* 
changed: [server.example.com]
changed: [bastion.example.com]
changed: [node1.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Install CA certificate from satellite server] ***
Monday 04 August 2025  10:04:18 +0000 (0:00:03.431)       0:04:31.263 ********* 
changed: [server.example.com]
changed: [node1.example.com]
changed: [bastion.example.com]
ok: [controller.example.com]

TASK [set-repositories : sat | Update CA Trust Bundle] *************************
Monday 04 August 2025  10:04:22 +0000 (0:00:03.326)       0:04:34.590 ********* 
changed: [server.example.com]
changed: [bastion.example.com]
changed: [node1.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Remove satellite Cert] **************************
Monday 04 August 2025  10:04:26 +0000 (0:00:04.395)       0:04:38.986 ********* 
ok: [server.example.com]
ok: [bastion.example.com]
ok: [node1.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Find current repository files] ******************
Monday 04 August 2025  10:04:31 +0000 (0:00:04.343)       0:04:43.329 ********* 
ok: [bastion.example.com]
ok: [server.example.com]
ok: [node1.example.com]
ok: [controller.example.com]

TASK [set-repositories : sat | Remove current repository files] ****************
Monday 04 August 2025  10:04:32 +0000 (0:00:01.463)       0:04:44.793 ********* 
skipping: [node1.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]
changed: [controller.example.com] => (item=/etc/yum.repos.d/redhat.repo)

TASK [set-repositories : sat | Install Satellite CA certificate package] *******
Monday 04 August 2025  10:04:33 +0000 (0:00:01.416)       0:04:46.209 ********* 
changed: [server.example.com]
changed: [node1.example.com]
changed: [bastion.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Disable Reporting Of Package Profile to Satellite] ***
Monday 04 August 2025  10:04:44 +0000 (0:00:10.517)       0:04:56.727 ********* 
changed: [bastion.example.com]
changed: [server.example.com]
changed: [node1.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Run setup if gather_facts hasn't been run] ******
Monday 04 August 2025  10:04:45 +0000 (0:00:01.517)       0:04:58.244 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : Generate UUID for dmi.system.uuid if cloud provider is Equinix Metal] ***
Monday 04 August 2025  10:04:45 +0000 (0:00:00.045)       0:04:58.290 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Set set_repositories_subscription_hostname with randomization] ***
Monday 04 August 2025  10:04:46 +0000 (0:00:00.041)       0:04:58.331 ********* 
ok: [node1.example.com]
ok: [controller.example.com]
ok: [server.example.com]
ok: [bastion.example.com]

TASK [set-repositories : sat | Set network.fqdn in /etc/rhsm/facts/katello.facts] ***
Monday 04 August 2025  10:04:46 +0000 (0:00:00.120)       0:04:58.451 ********* 
changed: [bastion.example.com]
changed: [server.example.com]
changed: [node1.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Register with activation-key] *******************
Monday 04 August 2025  10:04:49 +0000 (0:00:03.394)       0:05:01.846 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Register with activation-key with HA] ***********
Monday 04 August 2025  10:04:49 +0000 (0:00:00.051)       0:05:01.897 ********* 
changed: [node1.example.com]
changed: [server.example.com]
changed: [bastion.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Enable RHSM to manage repositories] *************
Monday 04 August 2025  10:04:58 +0000 (0:00:08.824)       0:05:10.721 ********* 
changed: [node1.example.com]
changed: [server.example.com]
changed: [bastion.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Lock RHEL 9 release to specific version] ********
Monday 04 August 2025  10:05:01 +0000 (0:00:03.143)       0:05:13.865 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Lock RHEL 8 release to specific version] ********
Monday 04 August 2025  10:05:01 +0000 (0:00:00.044)       0:05:13.910 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Lock RHEL 7 release to specific version] ********
Monday 04 August 2025  10:05:01 +0000 (0:00:00.055)       0:05:13.965 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Enable repos] ***********************************
Monday 04 August 2025  10:05:01 +0000 (0:00:00.059)       0:05:14.025 ********* 
changed: [server.example.com]
changed: [bastion.example.com]
changed: [node1.example.com]
changed: [controller.example.com]

TASK [set-repositories : sat | Purge existing repos] ***************************
Monday 04 August 2025  10:05:09 +0000 (0:00:07.637)       0:05:21.662 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Enable repos for RHEL] **************************
Monday 04 August 2025  10:05:09 +0000 (0:00:00.042)       0:05:21.705 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | Create the certificate and key files] ***********
Monday 04 August 2025  10:05:09 +0000 (0:00:00.053)       0:05:21.759 ********* 
skipping: [node1.example.com] => (item=/etc/pki/tls/Red_GPTE.key) 
skipping: [node1.example.com] => (item=/etc/pki/tls/Red_GPTE.pem) 
skipping: [node1.example.com]
skipping: [controller.example.com] => (item=/etc/pki/tls/Red_GPTE.key) 
skipping: [controller.example.com] => (item=/etc/pki/tls/Red_GPTE.pem) 
skipping: [controller.example.com]
skipping: [server.example.com] => (item=/etc/pki/tls/Red_GPTE.key) 
skipping: [server.example.com] => (item=/etc/pki/tls/Red_GPTE.pem) 
skipping: [server.example.com]
skipping: [bastion.example.com] => (item=/etc/pki/tls/Red_GPTE.key) 
skipping: [bastion.example.com] => (item=/etc/pki/tls/Red_GPTE.pem) 
skipping: [bastion.example.com]

TASK [set-repositories : sat | Add certificate and key content] ****************
Monday 04 August 2025  10:05:09 +0000 (0:00:00.058)       0:05:21.817 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | create open.repo template on host] **************
Monday 04 August 2025  10:05:09 +0000 (0:00:00.045)       0:05:21.862 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [set-repositories : sat | clean repositories] *****************************
Monday 04 August 2025  10:05:09 +0000 (0:00:00.045)       0:05:21.908 ********* 
changed: [bastion.example.com]
changed: [server.example.com]
changed: [node1.example.com]
changed: [controller.example.com]

TASK [set-repositories : Unregister from subscription manager] *****************
Monday 04 August 2025  10:05:13 +0000 (0:00:03.751)       0:05:25.659 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Deactivate DNS lookup in sshd] **********************************
Monday 04 August 2025  10:05:13 +0000 (0:00:00.061)       0:05:25.720 ********* 
changed: [node1.example.com]
changed: [bastion.example.com]
changed: [server.example.com]
ok: [controller.example.com]

TASK [common : Update all packages] ********************************************
Monday 04 August 2025  10:05:15 +0000 (0:00:01.715)       0:05:27.436 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Update all packages Legacy] *************************************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.047)       0:05:27.483 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Determine if reboot is needed] **********************************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.057)       0:05:27.541 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Reboot all VMs] *************************************************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.045)       0:05:27.587 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Update network facts after reboot] ******************************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.042)       0:05:27.629 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Run setup if gather_facts hasn't been run] **********************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.042)       0:05:27.672 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : install common packages for RHEL 7] *****************************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.046)       0:05:27.718 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : install common packages for RHEL 8] *****************************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.067)       0:05:27.785 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Set up python alternatives for convenience] *********************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.052)       0:05:27.837 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : install common packages for RHEL 9] *****************************
Monday 04 August 2025  10:05:15 +0000 (0:00:00.046)       0:05:27.885 ********* 
changed: [controller.example.com]
changed: [server.example.com]
changed: [bastion.example.com]
changed: [node1.example.com]

TASK [common : install extra packages] *****************************************
Monday 04 August 2025  10:08:12 +0000 (0:02:57.298)       0:08:25.183 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Update specified packages] **************************************
Monday 04 August 2025  10:08:12 +0000 (0:00:00.054)       0:08:25.238 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Determine if reboot is needed] **********************************
Monday 04 August 2025  10:08:12 +0000 (0:00:00.046)       0:08:25.285 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Reboot VMs] *****************************************************
Monday 04 August 2025  10:08:13 +0000 (0:00:00.045)       0:08:25.330 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

TASK [common : Refresh network facts post-reboot] ******************************
Monday 04 August 2025  10:08:13 +0000 (0:00:00.068)       0:08:25.398 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

RUNNING HANDLER [common : restart_sshd] ****************************************
Monday 04 August 2025  10:08:13 +0000 (0:00:00.095)       0:08:25.493 ********* 
changed: [bastion.example.com]
changed: [server.example.com]
changed: [node1.example.com]

PLAY [Install Pre Software workloads on bastion] *******************************

TASK [Deploying Pre Software workloads on bastion] *****************************
Monday 04 August 2025  10:08:14 +0000 (0:00:01.233)       0:08:26.726 ********* 

TASK [bastion-lite : Generate an SSH key on the Bastion and configure access on all the hosts] ***
Monday 04 August 2025  10:08:14 +0000 (0:00:00.051)       0:08:26.778 ********* 
included: /runner/project/ansible/roles/bastion-lite/tasks/./create_bastion_ssh_key_and_access.yml for bastion.example.com

TASK [bastion-lite : Generate SSH keys] ****************************************
Monday 04 August 2025  10:08:14 +0000 (0:00:00.022)       0:08:26.801 ********* 
changed: [bastion.example.com]

TASK [bastion-lite : Fix permission of ssh key] ********************************
Monday 04 August 2025  10:08:15 +0000 (0:00:00.964)       0:08:27.766 ********* 
changed: [bastion.example.com]

TASK [bastion-lite : Generate SSH pub key content] *****************************
Monday 04 August 2025  10:08:16 +0000 (0:00:00.720)       0:08:28.486 ********* 
ok: [bastion.example.com]

TASK [bastion-lite : Save all facts for SSH] ***********************************
Monday 04 August 2025  10:08:16 +0000 (0:00:00.738)       0:08:29.225 ********* 
ok: [bastion.example.com]

TASK [bastion-lite : Write SSH pub key] ****************************************
Monday 04 August 2025  10:08:16 +0000 (0:00:00.023)       0:08:29.249 ********* 
changed: [bastion.example.com]

TASK [bastion-lite : Add bastion access to all hosts] **************************
Monday 04 August 2025  10:08:18 +0000 (0:00:01.496)       0:08:30.745 ********* 
changed: [bastion.example.com -> node1.example.com] => (item=node1.example.com)
changed: [bastion.example.com -> controller.example.com] => (item=controller.example.com)
changed: [bastion.example.com -> server.example.com] => (item=server.example.com)
changed: [bastion.example.com] => (item=bastion.example.com)

TASK [bastion-lite : Add bastion access to all hosts] **************************
Monday 04 August 2025  10:08:21 +0000 (0:00:03.130)       0:08:33.876 ********* 
changed: [bastion.example.com -> node1.example.com] => (item=node1.example.com)
changed: [bastion.example.com -> controller.example.com] => (item=controller.example.com)
changed: [bastion.example.com -> server.example.com] => (item=server.example.com)
changed: [bastion.example.com] => (item=bastion.example.com)

TASK [bastion-lite : Generate .ssh/config] *************************************
Monday 04 August 2025  10:08:24 +0000 (0:00:03.147)       0:08:37.023 ********* 
changed: [bastion.example.com]

TASK [Install FTL] *************************************************************
Monday 04 August 2025  10:08:25 +0000 (0:00:01.215)       0:08:38.239 ********* 
skipping: [bastion.example.com]

TASK [bastion-lite : Ensure system Python3 has selinux library installed] ******
Monday 04 August 2025  10:08:25 +0000 (0:00:00.021)       0:08:38.260 ********* 
skipping: [bastion.example.com]

TASK [bastion-lite : Install OpenShift Helm 3] *********************************
Monday 04 August 2025  10:08:25 +0000 (0:00:00.018)       0:08:38.279 ********* 
skipping: [bastion.example.com]

TASK [bastion-lite : Add GUID to /etc/skel/.bashrc] ****************************
Monday 04 August 2025  10:08:25 +0000 (0:00:00.018)       0:08:38.297 ********* 
changed: [bastion.example.com]

TASK [bastion-lite : Add GUID to ~ec2-user/.bashrc] ****************************
Monday 04 August 2025  10:08:26 +0000 (0:00:00.625)       0:08:38.923 ********* 
changed: [bastion.example.com]

TASK [bastion-lite : Add CLOUDUSER to /etc/skel/.bashrc] ***********************
Monday 04 August 2025  10:08:27 +0000 (0:00:00.637)       0:08:39.560 ********* 
changed: [bastion.example.com]

TASK [bastion-lite : Add CLOUDUSER to ~ec2-user/.bashrc] ***********************
Monday 04 August 2025  10:08:27 +0000 (0:00:00.622)       0:08:40.183 ********* 
changed: [bastion.example.com]

TASK [control-user : Create user skel files] ***********************************
Monday 04 August 2025  10:08:28 +0000 (0:00:00.611)       0:08:40.795 ********* 
changed: [bastion.example.com] => (item=.vimrc)

TASK [control-user : Create user lab-user] *************************************
Monday 04 August 2025  10:08:29 +0000 (0:00:01.151)       0:08:41.946 ********* 
included: /runner/project/ansible/roles/control-user/tasks/create-user.yml for bastion.example.com

TASK [control-user : Create user lab-user] *************************************
Monday 04 August 2025  10:08:29 +0000 (0:00:00.027)       0:08:41.973 ********* 
[WARNING]: 'append' is set, but no 'groups' are specified. Use 'groups' for
appending new groups.This will change to an error in Ansible 2.14.
changed: [bastion.example.com]

TASK [control-user : Set ssh user lab-user password] ***************************
Monday 04 August 2025  10:08:30 +0000 (0:00:00.934)       0:08:42.908 ********* 
changed: [bastion.example.com]

TASK [control-user : Setup user's resource directory] **************************
Monday 04 August 2025  10:08:31 +0000 (0:00:00.965)       0:08:43.873 ********* 
included: /runner/project/ansible/roles/control-user/tasks/create-directory.yml for bastion.example.com

TASK [control-user : Create resource directory] ********************************
Monday 04 August 2025  10:08:31 +0000 (0:00:00.025)       0:08:43.899 ********* 
skipping: [bastion.example.com]

TASK [control-user : Create user's custom directory] ***************************
Monday 04 August 2025  10:08:31 +0000 (0:00:00.021)       0:08:43.920 ********* 
skipping: [bastion.example.com]

TASK [control-user : Enable sudoers] *******************************************
Monday 04 August 2025  10:08:31 +0000 (0:00:00.021)       0:08:43.941 ********* 
changed: [bastion.example.com]

TASK [control-user : SSH setup for user] ***************************************
Monday 04 August 2025  10:08:32 +0000 (0:00:01.139)       0:08:45.081 ********* 
included: /runner/project/ansible/roles/control-user/tasks/ssh-config.yml for bastion.example.com

TASK [control-user : create /home/lab-user/.ssh] *******************************
Monday 04 August 2025  10:08:32 +0000 (0:00:00.032)       0:08:45.114 ********* 
changed: [bastion.example.com]

TASK [control-user : copy the environment .pem key] ****************************
Monday 04 August 2025  10:08:33 +0000 (0:00:00.619)       0:08:45.733 ********* 
changed: [bastion.example.com]

TASK [control-user : copy the environment .pub key] ****************************
Monday 04 August 2025  10:08:34 +0000 (0:00:01.192)       0:08:46.926 ********* 
changed: [bastion.example.com]

TASK [control-user : Create authorized keys] ***********************************
Monday 04 August 2025  10:08:35 +0000 (0:00:01.173)       0:08:48.099 ********* 
changed: [bastion.example.com]

TASK [control-user : copy custom ssh key] **************************************
Monday 04 August 2025  10:08:36 +0000 (0:00:00.648)       0:08:48.748 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy ssh config template] *********************************
Monday 04 August 2025  10:08:36 +0000 (0:00:00.021)       0:08:48.769 ********* 
changed: [bastion.example.com]

TASK [control-user : Remove PasswordAuthentication line from 50-cloud-init.conf] ***
Monday 04 August 2025  10:08:37 +0000 (0:00:01.186)       0:08:49.956 ********* 
changed: [bastion.example.com]

TASK [control-user : Enable password ssh authentication] ***********************
Monday 04 August 2025  10:08:38 +0000 (0:00:00.632)       0:08:50.589 ********* 
changed: [bastion.example.com]

TASK [control-user : Disable root password ssh authentication] *****************
Monday 04 August 2025  10:08:38 +0000 (0:00:00.636)       0:08:51.225 ********* 
changed: [bastion.example.com]

TASK [control-user : Restart sshd to read conf changes] ************************
Monday 04 August 2025  10:08:39 +0000 (0:00:00.622)       0:08:51.848 ********* 
changed: [bastion.example.com]

TASK [control-user : Copy files] ***********************************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.946)       0:08:52.794 ********* 
included: /runner/project/ansible/roles/control-user/tasks/copy-files.yml for bastion.example.com

TASK [control-user : Copy user's file to resource dir] *************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.027)       0:08:52.822 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy user's template to resource dir] *********************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.019)       0:08:52.841 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy user's contentto resource dir] ***********************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.019)       0:08:52.861 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy templates] *******************************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.018)       0:08:52.879 ********* 
included: /runner/project/ansible/roles/control-user/tasks/copy-templates.yml for bastion.example.com

TASK [control-user : Copy user's template to resource dir] *********************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.031)       0:08:52.911 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy user's template to home dir] *************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.027)       0:08:52.938 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy user's template to path] *****************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.023)       0:08:52.962 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy contents] ********************************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.021)       0:08:52.984 ********* 
included: /runner/project/ansible/roles/control-user/tasks/copy-contents.yml for bastion.example.com

TASK [control-user : Copy user's content to resource dir] **********************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.029)       0:08:53.013 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy user's content to home dir] **************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.019)       0:08:53.033 ********* 
skipping: [bastion.example.com]

TASK [control-user : Copy user's content to path] ******************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.021)       0:08:53.054 ********* 
skipping: [bastion.example.com]

TASK [control-user : Report user data] *****************************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.019)       0:08:53.073 ********* 
included: /runner/project/ansible/roles/control-user/tasks/report-user-data.yml for bastion.example.com

TASK [control-user : Report user data] *****************************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.032)       0:08:53.106 ********* 
ok: [bastion.example.com] => {
    "changed": false,
    "data": {
        "password": "[REDACTED_Secret Keyword_SECRET]",
        "ssh_host": "ec2-3-136-191-18.us-east-2.compute.amazonaws.com",
        "user": "lab-user"
    }
}

TASK [control-user : Report user data ssh key] *********************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.033)       0:08:53.139 ********* 
skipping: [bastion.example.com]

PLAY [Install Pre Software workloads for windows] ******************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for gitlab] *******************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for Automation Controller] ****************

TASK [Deploying Pre Software workloads on Automation Controller] ***************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.066)       0:08:53.206 ********* 
skipping: [controller.example.com]

PLAY [Install Pre Software workloads for Satelliltes] **************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for Satelllite Capsules] ******************
skipping: no hosts matched

PLAY [Install Pre Software workloads for Automation Server] ********************
skipping: no hosts matched

PLAY [Install Pre Software workloads for nodes] ********************************

TASK [Deploying Pre Software workloads on nodes] *******************************
Monday 04 August 2025  10:08:40 +0000 (0:00:00.059)       0:08:53.265 ********* 
skipping: [node1.example.com]

PLAY [Install Pre Software workloads for rhel7 nodes] **************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for rhel8 nodes] **************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for rhel9 nodes] **************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for rhel10 nodes] *************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for centos nodes] *************************

TASK [Deploying Pre Software workloads on centos nodes] ************************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.054)       0:08:53.319 ********* 
skipping: [server.example.com]

PLAY [Install Pre Software workloads for rhelai nodes] *************************
skipping: no hosts matched

PLAY [Install Pre Software workloads for network] ******************************
skipping: no hosts matched

PLAY [PreSoftware flight-check] ************************************************

TASK [debug] *******************************************************************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.045)       0:08:53.365 ********* 
ok: [localhost] => {
    "msg": "Pre-Software checks completed successfully"
}

PLAY [Step 004 software] *******************************************************

TASK [debug] *******************************************************************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.025)       0:08:53.391 ********* 
ok: [localhost] => {
    "msg": "Software tasks Started"
}

PLAY [Install Software  workloads on localhost] ********************************

TASK [Deploying Software workloads  on localhost] ******************************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.035)       0:08:53.427 ********* 
skipping: [localhost]

PLAY [Install Software workloads on  all hosts] ********************************

TASK [Deploying Software workloads on all hosts] *******************************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.069)       0:08:53.496 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

PLAY [Install Software workloads on bastion] ***********************************

TASK [Deploying Software workloads on bastion] *********************************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.121)       0:08:53.618 ********* 
skipping: [bastion.example.com]

PLAY [Install Software workloads for windows] **********************************
skipping: no hosts matched

PLAY [Install Software workloads for gitlab] ***********************************
skipping: no hosts matched

PLAY [Install Software workloads for Automation Controller] ********************

TASK [Deploying Software workloads on Automation Controller] *******************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.055)       0:08:53.673 ********* 

TASK [nginx_with_cert : Set python interpreter for nginx_with_cert] ************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.099)       0:08:53.773 ********* 
skipping: [controller.example.com]

TASK [nginx_with_cert : Nginx | include correct tasks for OS] ******************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.022)       0:08:53.795 ********* 
included: /runner/project/ansible/roles/nginx_with_cert/tasks/nginx/RedHat9.yml for controller.example.com

TASK [nginx_with_cert : nginx/RedHat9 | enable EPEL] ***************************
Monday 04 August 2025  10:08:41 +0000 (0:00:00.027)       0:08:53.823 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : nginx/RedHat9 | install nginx and certbot packages] ****
Monday 04 August 2025  10:08:47 +0000 (0:00:05.891)       0:08:59.714 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : nginx/RedHat9 | remove EPEL after usage] ***************
Monday 04 August 2025  10:10:08 +0000 (0:01:21.294)       0:10:21.008 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | start nginx server] ****************************
Monday 04 August 2025  10:10:14 +0000 (0:00:06.272)       0:10:27.281 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | generate certbot certificate] ******************
Monday 04 August 2025  10:10:16 +0000 (0:00:01.297)       0:10:28.579 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | create nginx certificate directory] ************
Monday 04 August 2025  10:10:29 +0000 (0:00:13.172)       0:10:41.751 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | copy letsencrypt key] **************************
Monday 04 August 2025  10:10:30 +0000 (0:00:00.626)       0:10:42.377 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | copy letsencrypt certificate] ******************
Monday 04 August 2025  10:10:30 +0000 (0:00:00.605)       0:10:42.982 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | copy custom nginx_with_cert nginx configuration file] ***
Monday 04 August 2025  10:10:31 +0000 (0:00:00.614)       0:10:43.596 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | enable selinux boolean to connect with nginx_with_cert] ***
Monday 04 August 2025  10:10:32 +0000 (0:00:01.156)       0:10:44.753 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : Nginx | restart nginx server] **************************
Monday 04 August 2025  10:10:35 +0000 (0:00:03.357)       0:10:48.110 ********* 
changed: [controller.example.com]

TASK [nginx_with_cert : print out user.info] ***********************************
Monday 04 August 2025  10:10:36 +0000 (0:00:00.949)       0:10:49.060 ********* 
ok: [controller.example.com] => {
    "changed": false,
    "msg": "user.info: nginx_web_url: controller.v6mhs.sandbox2309.opentlc.com\\n"
}

TASK [nginx_with_cert : Save user data] ****************************************
Monday 04 August 2025  10:10:36 +0000 (0:00:00.027)       0:10:49.088 ********* 
ok: [controller.example.com] => {
    "changed": false,
    "data": {
        "nginx_web_url": "controller.v6mhs.sandbox2309.opentlc.com"
    }
}

TASK [ansible_automation_platform_configuration : Generate OCP bearer token for use in AAP as OCP credential] ***
Monday 04 August 2025  10:10:36 +0000 (0:00:00.033)       0:10:49.121 ********* 
skipping: [controller.example.com]

TASK [ansible_automation_platform_configuration : Generate SSH keypair for use in AAP as ssh machine credential] ***
Monday 04 August 2025  10:10:36 +0000 (0:00:00.019)       0:10:49.140 ********* 
skipping: [controller.example.com]

TASK [ansible_automation_platform_configuration : Generate SSH keypair for use in AAP as ssh machine credential] ***
Monday 04 August 2025  10:10:36 +0000 (0:00:00.020)       0:10:49.161 ********* 
included: /runner/project/ansible/roles/ansible_automation_platform_configuration/tasks/aap-configuration.yml for controller.example.com

TASK [ansible_automation_platform_configuration : Create AAP Auth token] *******
Monday 04 August 2025  10:10:36 +0000 (0:00:00.062)       0:10:49.224 ********* 
skipping: [controller.example.com]

TASK [ansible_automation_platform_configuration : Save token for agnosticd_user_info] ***
Monday 04 August 2025  10:10:36 +0000 (0:00:00.018)       0:10:49.242 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.dispatch : Validating arguments against arg spec 'main' - An Ansible Role to call other roles to create objects on Ansible Automation Platform.] ***
Monday 04 August 2025  10:10:36 +0000 (0:00:00.017)       0:10:49.260 ********* 
ok: [controller.example.com]

TASK [Run the following infra.aap_configuration roles: controller_license, gateway_settings, gateway_users, controller_credentials] ***
Monday 04 August 2025  10:10:36 +0000 (0:00:00.031)       0:10:49.292 ********* 
[WARNING]: Collection ansible.platform does not support Ansible version 2.15.13

TASK [infra.aap_configuration.meta_dependency_check : Print dependency check status] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.179)       0:10:49.471 ********* 
ok: [controller.example.com] => {
    "msg": "Dependency check is deactivated. Required collections presence will not be verified. This might cause failure in the next tasks."
}

TASK [infra.aap_configuration.meta_dependency_check : Check awx.awx is installed] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.024)       0:10:49.495 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.meta_dependency_check : Check ansible.controller is installed] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.016)       0:10:49.511 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.meta_dependency_check : Ensure one is installed] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.015)       0:10:49.527 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.controller_license : Validating arguments against arg spec 'main' - An Ansible Role to deploy a license on Ansible Controller.] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.020)       0:10:49.548 ********* 
ok: [controller.example.com]

TASK [infra.aap_configuration.controller_license : Use manifest file] **********
Monday 04 August 2025  10:10:37 +0000 (0:00:00.025)       0:10:49.573 ********* 
included: /usr/share/ansible/collections/ansible_collections/infra/aap_configuration/roles/controller_license/tasks/manifest.yml for controller.example.com

TASK [infra.aap_configuration.controller_license : manifest | Ensure manifest is set] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.034)       0:10:49.607 ********* 
ok: [controller.example.com] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [infra.aap_configuration.controller_license : manifest | Move manifest file to temporary location] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.029)       0:10:49.637 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.controller_license : manifest | Fetch manifest from URL] ***
Monday 04 August 2025  10:10:37 +0000 (0:00:00.035)       0:10:49.672 ********* 
changed: [controller.example.com]

TASK [infra.aap_configuration.controller_license : manifest | Create manifest file from base64 encoded content] ***
Monday 04 August 2025  10:10:38 +0000 (0:00:01.246)       0:10:50.918 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.controller_license : manifest | Install the Controller license] ***
Monday 04 August 2025  10:10:38 +0000 (0:00:00.020)       0:10:50.939 ********* 
ok: [controller.example.com]

TASK [infra.aap_configuration.controller_license : Use subscription pool id or subscription lookup] ***
Monday 04 August 2025  10:10:42 +0000 (0:00:03.680)       0:10:54.620 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.gateway_settings : Validating arguments against arg spec 'main' - An Ansible Role to create settings on automation platform gateway.] ***
Monday 04 August 2025  10:10:42 +0000 (0:00:00.033)       0:10:54.654 ********* 
ok: [controller.example.com]

TASK [infra.aap_configuration.gateway_settings : Update automation platform gateway Settings] ***
Monday 04 August 2025  10:10:42 +0000 (0:00:00.032)       0:10:54.687 ********* 
changed: [controller.example.com]

TASK [infra.aap_configuration.gateway_users : Validating arguments against arg spec 'main' - An Ansible Role to create users on automation platform gateway.] ***
Monday 04 August 2025  10:10:45 +0000 (0:00:02.928)       0:10:57.615 ********* 
ok: [controller.example.com]

TASK [infra.aap_configuration.gateway_users : Users | Configuration] ***********
Monday 04 August 2025  10:10:45 +0000 (0:00:00.034)       0:10:57.650 ********* 
ok: [controller.example.com] => (item=Create/Update the Gateway user lab-user)

TASK [infra.aap_configuration.gateway_users : Users | Wait for finish the configuration] ***
Monday 04 August 2025  10:10:46 +0000 (0:00:00.939)       0:10:58.589 ********* 
FAILED - RETRYING: [controller.example.com]: Users | Wait for finish the configuration (30 retries left).
FAILED - RETRYING: [controller.example.com]: Users | Wait for finish the configuration (29 retries left).
changed: [controller.example.com] => (item=Create/Update Gateway user lab-user | Wait for finish the Gateway user creation)

TASK [infra.aap_configuration.controller_credentials : Validating arguments against arg spec 'main' - An Ansible Role to create credentials on Ansible Controller.] ***
Monday 04 August 2025  10:10:50 +0000 (0:00:04.703)       0:11:03.293 ********* 
ok: [controller.example.com]

TASK [infra.aap_configuration.controller_credentials : Managing Credentials] ***
Monday 04 August 2025  10:10:51 +0000 (0:00:00.033)       0:11:03.326 ********* 
ok: [controller.example.com] => (item=None)
ok: [controller.example.com]

TASK [infra.aap_configuration.controller_credentials : Flag for errors (check mode only)] ***
Monday 04 August 2025  10:10:51 +0000 (0:00:00.868)       0:11:04.195 ********* 
skipping: [controller.example.com]

TASK [infra.aap_configuration.controller_credentials : Managing Controller Credentials | Wait for finish the credential management] ***
Monday 04 August 2025  10:10:51 +0000 (0:00:00.021)       0:11:04.216 ********* 
FAILED - RETRYING: [controller.example.com]: Managing Controller Credentials | Wait for finish the credential management (30 retries left).
FAILED - RETRYING: [controller.example.com]: Managing Controller Credentials | Wait for finish the credential management (29 retries left).
changed: [controller.example.com] => (item=None)
changed: [controller.example.com]

TASK [infra.aap_configuration.dispatch : Fail the playbook if there were errors (check mode only)] ***
Monday 04 August 2025  10:10:56 +0000 (0:00:04.332)       0:11:08.549 ********* 
skipping: [controller.example.com]

PLAY [Install Software workloads for Satelliltes] ******************************
skipping: no hosts matched

PLAY [Install Software workloads for Satelllite Capsules] **********************
skipping: no hosts matched

PLAY [Install Software workloads for Automation Server] ************************
skipping: no hosts matched

PLAY [Install Software workloads for nodes] ************************************

TASK [Deploying Software workloads on nodes] ***********************************
Monday 04 August 2025  10:10:56 +0000 (0:00:00.061)       0:11:08.611 ********* 
skipping: [node1.example.com]

PLAY [Install Software workloads for rhel7 nodes] ******************************
skipping: no hosts matched

PLAY [Install Software workloads for rhel8 nodes] ******************************
skipping: no hosts matched

PLAY [Install Software workloads for rhel9 nodes] ******************************
skipping: no hosts matched

PLAY [Install Software workloads for rhel10 nodes] *****************************
skipping: no hosts matched

PLAY [Install Software workloads for centos nodes] *****************************

TASK [Deploying Software workloads on centos nodes] ****************************
Monday 04 August 2025  10:10:56 +0000 (0:00:00.052)       0:11:08.664 ********* 

TASK [server_customization : Install EDA server packages and utilities] ********
Monday 04 August 2025  10:10:56 +0000 (0:00:00.050)       0:11:08.714 ********* 
changed: [server.example.com]

TASK [server_customization : Enable service postfix, and not touch the state] ***
Monday 04 August 2025  10:11:53 +0000 (0:00:57.384)       0:12:06.099 ********* 
changed: [server.example.com]

TASK [server_customization : Start service postfix, if not started] ************
Monday 04 August 2025  10:11:55 +0000 (0:00:01.216)       0:12:07.316 ********* 
changed: [server.example.com]

TASK [server_customization : Run shell curl configuration] *********************
Monday 04 August 2025  10:11:56 +0000 (0:00:01.427)       0:12:08.743 ********* 
changed: [server.example.com]

TASK [server_customization : Run shell dnf install -y gitlab-ee] ***************
Monday 04 August 2025  10:12:10 +0000 (0:00:13.863)       0:12:22.607 ********* 
changed: [server.example.com]

TASK [server_customization : Disable port 80] **********************************
Monday 04 August 2025  10:22:29 +0000 (0:10:18.970)       0:22:41.577 ********* 
changed: [server.example.com]

TASK [server_customization : Run shell gitlab-ctl reconfigure] *****************
Monday 04 August 2025  10:22:30 +0000 (0:00:01.725)       0:22:43.302 ********* 
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC POLL on server.example.com: jid=j936818595266.32477 started=1 finished=0
ASYNC FAILED on server.example.com: jid=j936818595266.32477
fatal: [server.example.com]: FAILED! => {"ansible_job_id": "j936818595266.32477", "changed": true, "cmd": "sudo gitlab-ctl reconfigure", "delta": "0:03:09.137294", "end": "2025-08-04 10:25:41.379416", "finished": 1, "msg": "non-zero return code", "rc": 1, "results_file": "/root/.ansible_async/j936818595266.32477", "start": "2025-08-04 10:22:32.242122", "started": 1, "stderr": "/opt/gitlab/embedded/lib/ruby/gems/3.2.0/gems/ffi-yajl-2.6.0/lib/ffi_yajl/encoder.rb:42: warning: undefining the allocator of T_DATA class FFI_Yajl::Ext::Encoder::YajlGen\\n/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:2: warning: already initialized constant SELinuxDistroHelper::REDHAT_RELEASE_FILE\\n/opt/gitlab/embedded/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:2: warning: previous definition of REDHAT_RELEASE_FILE was here\\n/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:3: warning: already initialized constant SELinuxDistroHelper::OS_RELEASE_FILE\\n/opt/gitlab/embedded/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:3: warning: previous definition of OS_RELEASE_FILE was here\\n/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/secrets_helper.rb:4: warning: already initialized constant SecretsHelper::SECRETS_FILE\\n/opt/gitlab/embedded/cookbooks/package/libraries/helpers/secrets_helper.rb:4: warning: previous definition of SECRETS_FILE was here\\n/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/secrets_helper.rb:5: warning: already initialized constant SecretsHelper::SECRETS_FILE_CHEF_ATTR\\n/opt/gitlab/embedded/cookbooks/package/libraries/helpers/secrets_helper.rb:5: warning: previous definition of SECRETS_FILE_CHEF_ATTR was here\\n/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/secrets_helper.rb:6: warning: already initialized constant SecretsHelper::SKIP_GENERATE_SECRETS_CHEF_ATTR\\n/opt/gitlab/embedded/cookbooks/package/libraries/helpers/secrets_helper.rb:6: warning: previous definition of SKIP_GENERATE_SECRETS_CHEF_ATTR was here\\n/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/gitlab_cluster.rb:16: warning: already initialized constant GitlabCluster::CONFIG_PATH\\n/opt/gitlab/embedded/cookbooks/package/libraries/gitlab_cluster.rb:16: warning: previous definition of CONFIG_PATH was here\\n/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/gitlab_cluster.rb:17: warning: already initialized constant GitlabCluster::JSON_FILE\\n/opt/gitlab/embedded/cookbooks/package/libraries/gitlab_cluster.rb:17: warning: previous definition of JSON_FILE was here\\nThere was an error running gitlab-ctl reconfigure:\\n\\nsidekiq_service[sidekiq] (gitlab::sidekiq line 23) had an error: Mixlib::ShellOut::ShellCommandFailed: runit_service[sidekiq] (gitlab::sidekiq line 67) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'\\n---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\nSTDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM\\nSTDERR: \\n---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\nRan /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1", "stderr_lines": ["/opt/gitlab/embedded/lib/ruby/gems/3.2.0/gems/ffi-yajl-2.6.0/lib/ffi_yajl/encoder.rb:42: warning: undefining the allocator of T_DATA class FFI_Yajl::Ext::Encoder::YajlGen", "/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:2: warning: already initialized constant SELinuxDistroHelper::REDHAT_RELEASE_FILE", "/opt/gitlab/embedded/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:2: warning: previous definition of REDHAT_RELEASE_FILE was here", "/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:3: warning: already initialized constant SELinuxDistroHelper::OS_RELEASE_FILE", "/opt/gitlab/embedded/cookbooks/package/libraries/helpers/selinux_distro_helper.rb:3: warning: previous definition of OS_RELEASE_FILE was here", "/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/secrets_helper.rb:4: warning: already initialized constant SecretsHelper::SECRETS_FILE", "/opt/gitlab/embedded/cookbooks/package/libraries/helpers/secrets_helper.rb:4: warning: previous definition of SECRETS_FILE was here", "/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/secrets_helper.rb:5: warning: already initialized constant SecretsHelper::SECRETS_FILE_CHEF_ATTR", "/opt/gitlab/embedded/cookbooks/package/libraries/helpers/secrets_helper.rb:5: warning: previous definition of SECRETS_FILE_CHEF_ATTR was here", "/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/helpers/secrets_helper.rb:6: warning: already initialized constant SecretsHelper::SKIP_GENERATE_SECRETS_CHEF_ATTR", "/opt/gitlab/embedded/cookbooks/package/libraries/helpers/secrets_helper.rb:6: warning: previous definition of SKIP_GENERATE_SECRETS_CHEF_ATTR was here", "/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/gitlab_cluster.rb:16: warning: already initialized constant GitlabCluster::CONFIG_PATH", "/opt/gitlab/embedded/cookbooks/package/libraries/gitlab_cluster.rb:16: warning: previous definition of CONFIG_PATH was here", "/opt/gitlab/embedded/cookbooks/cache/cookbooks/package/libraries/gitlab_cluster.rb:17: warning: already initialized constant GitlabCluster::JSON_FILE", "/opt/gitlab/embedded/cookbooks/package/libraries/gitlab_cluster.rb:17: warning: previous definition of JSON_FILE was here", "There was an error running gitlab-ctl reconfigure:", "", "sidekiq_service[sidekiq] (gitlab::sidekiq line 23) had an error: Mixlib::ShellOut::ShellCommandFailed: runit_service[sidekiq] (gitlab::sidekiq line 67) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'", "---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "STDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM", "STDERR: ", "---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "Ran /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1"], "stdout": "[2025-08-04T10:22:39+00:00] INFO: Started Cinc Zero at chefzero://localhost:1 with repository at /opt/gitlab/embedded (One version per cookbook)\\nCinc Client, version 18.3.0\\nPatents: https://www.chef.io/patents\\nInfra Phase starting\\n[2025-08-04T10:22:39+00:00] INFO: *** Cinc Client 18.3.0 ***\\n[2025-08-04T10:22:39+00:00] INFO: Platform: x86_64-linux\\n[2025-08-04T10:22:39+00:00] INFO: Cinc-client pid: 32489\\n[2025-08-04T10:22:42+00:00] INFO: Setting the run_list to [\\"recipe[gitlab-base]\\"] from CLI options\\n[2025-08-04T10:22:42+00:00] INFO: Run List is [recipe[gitlab-base]]\\n[2025-08-04T10:22:42+00:00] INFO: Run List expands to [gitlab-base]\\n[2025-08-04T10:22:42+00:00] INFO: Starting Cinc Client Run for server.example.com\\n[2025-08-04T10:22:42+00:00] INFO: Running start handlers\\n[2025-08-04T10:22:42+00:00] INFO: Start handlers complete.\\nResolving cookbooks for run list: [\\"gitlab-base\\"]\\n[2025-08-04T10:22:44+00:00] INFO: Loading cookbooks [gitlab-base@0.1.0, package@0.1.0, gitlab@0.0.1, gitlab-ee@0.0.1, runit@5.1.7, logrotate@0.1.0, postgresql@0.1.0, redis@0.1.0, monitoring@0.1.0, registry@0.1.0, mattermost@0.1.0, consul@0.1.0, gitaly@0.1.0, praefect@0.1.0, gitlab-kas@0.1.0, gitlab-pages@0.1.0, letsencrypt@0.1.0, nginx@0.1.0, patroni@0.1.0, pgbouncer@0.1.0, spamcheck@0.1.0, acme@4.1.6, crond@0.1.0]\\nSynchronizing cookbooks:\\n  - gitlab-base (0.1.0)\\n  - package (0.1.0)\\n  - gitlab (0.0.1)\\n  - gitlab-ee (0.0.1)\\n  - runit (5.1.7)\\n  - logrotate (0.1.0)\\n  - monitoring (0.1.0)\\n  - redis (0.1.0)\\n  - mattermost (0.1.0)\\n  - registry (0.1.0)\\n  - praefect (0.1.0)\\n  - consul (0.1.0)\\n  - gitaly (0.1.0)\\n  - postgresql (0.1.0)\\n  - gitlab-kas (0.1.0)\\n  - gitlab-pages (0.1.0)\\n  - patroni (0.1.0)\\n  - nginx (0.1.0)\\n  - letsencrypt (0.1.0)\\n  - pgbouncer (0.1.0)\\n  - spamcheck (0.1.0)\\n  - acme (4.1.6)\\n  - crond (0.1.0)\\nInstalling cookbook gem dependencies:\\nCompiling cookbooks...\\nLoading Cinc Auditor profile files:\\nLoading Cinc Auditor input files:\\nLoading Cinc Auditor waiver files:\\n[2025-08-04T10:22:47+00:00] INFO: Generating default secrets\\n[2025-08-04T10:22:50+00:00] INFO: Generating /etc/gitlab/gitlab-secrets.json file\\nRecipe: gitlab::default\\n  * directory[/etc/gitlab] action create (up to date)\\n[2025-08-04T10:22:50+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:50+00:00] WARN: Selected systemd because /run/systemd/system/ exists\\n[2025-08-04T10:22:50+00:00] WARN: gitlab-shell does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:50+00:00] WARN: gitlab-sshd does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: logrotate does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: logrotate does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: puma does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitlab-shell does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitlab-workhorse does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitlab-pages does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitlab-kas does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitaly does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: mailroom does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitaly does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: postgresql does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: postgresql does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitlab-kas does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: puma does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: sidekiq does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:51+00:00] WARN: gitlab-workhorse does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:52+00:00] WARN: node-exporter does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:52+00:00] WARN: gitlab-exporter does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:52+00:00] WARN: redis-exporter does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:52+00:00] WARN: prometheus does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:52+00:00] WARN: alertmanager does not have a log_group or default logdir mode defined. Setting to 0700.\\n[2025-08-04T10:22:52+00:00] WARN: postgres-exporter does not have a log_group or default logdir mode defined. Setting to 0700.\\n  Converging 303 resources\\n  * directory[/etc/gitlab] action create (up to date)\\n  * directory[Create /var/opt/gitlab] action create (up to date)\\n  * directory[Create /var/log/gitlab] action create (up to date)\\n  * directory[/opt/gitlab/embedded/etc] action create (up to date)\\nRecipe: gitlab::web-server\\n  * account[Webserver user and group] action create\\n    * group[Webserver user and group] action create (up to date)\\n    * linux_user[Webserver user and group] action create (up to date)\\n     (up to date)\\nRecipe: gitlab::users\\n  * directory[/var/opt/gitlab] action create (up to date)\\n  * account[GitLab user and group] action create\\n    * group[GitLab user and group] action create (up to date)\\n    * linux_user[GitLab user and group] action create (up to date)\\n     (up to date)\\n  * template[/var/opt/gitlab/.gitconfig] action create (up to date)\\n  * directory[/var/opt/gitlab/.bundle] action create (up to date)\\nRecipe: gitaly::git_data_dirs\\n  * storage_directory[/var/opt/gitlab/git-data/repositories] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/git-data/repositories] action run (skipped due to not_if)\\n     (up to date)\\nRecipe: gitlab::rails_pages_shared_path\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/pages] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/pages] action run (skipped due to not_if)\\n     (up to date)\\nRecipe: gitlab::gitlab-rails\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/artifacts] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/artifacts] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/external-diffs] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/external-diffs] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/lfs-objects] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/lfs-objects] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/packages] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/packages] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/dependency_proxy] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/dependency_proxy] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/terraform_state] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/terraform_state] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/ci_secure_files] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/ci_secure_files] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/encrypted_settings] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/encrypted_settings] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/uploads] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/uploads] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-ci/builds] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-ci/builds] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/cache] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/cache] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/tmp] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/tmp] action run (skipped due to not_if)\\n     (up to date)\\n  * storage_directory[/opt/gitlab/embedded/service/gitlab-rails/public] action create (skipped due to only_if)\\n  * directory[create /var/opt/gitlab/gitlab-rails/etc] action create (up to date)\\n  * directory[create /opt/gitlab/etc/gitlab-rails] action create (up to date)\\n  * directory[create /var/opt/gitlab/gitlab-rails/working] action create (up to date)\\n  * directory[create /var/opt/gitlab/gitlab-rails/tmp] action create (up to date)\\n  * directory[create /var/opt/gitlab/gitlab-rails/upgrade-status] action create (up to date)\\n  * directory[/var/log/gitlab/gitlab-rails] action create (up to date)\\n  * storage_directory[/var/opt/gitlab/backups] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/backups] action run (skipped due to not_if)\\n     (up to date)\\n  * directory[/var/opt/gitlab/gitlab-rails] action create (up to date)\\n  * directory[/var/opt/gitlab/gitlab-ci] action create (up to date)\\n  * file[/var/opt/gitlab/gitlab-rails/etc/gitlab-registry.key] action create (skipped due to only_if)\\n  * template[/opt/gitlab/etc/gitlab-rails-rc] action create[2025-08-04T10:22:55+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/opt/gitlab/etc/gitlab-rails-rc.chef-20250804102255.461108\\n[2025-08-04T10:22:55+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] updated file contents /opt/gitlab/etc/gitlab-rails-rc\\n\\n    - update content in file /opt/gitlab/etc/gitlab-rails-rc from 000a09 to 7b16c8\\n    --- /opt/gitlab/etc/gitlab-rails-rc\\t2025-08-04 10:15:49.951521260 +0000\\n    +++ /opt/gitlab/etc/.chef-gitlab-rails-rc20250804-32489-gruns2\\t2025-08-04 10:22:55.423275159 +0000\\n    @@ -1,6 +1,6 @@\\n     gitlab_user='git'\\n     gitlab_group='git'\\n    -registry_dir='/var/opt/gitlab/gitlab-rails/shared/registry'\\n    +registry_dir=''\\n     registry_user='registry'\\n     registry_group='registry'\\n    - restore selinux security context\\n  * file[/opt/gitlab/embedded/service/gitlab-rails/.secret] action delete (up to date)\\n  * file[/var/opt/gitlab/gitlab-rails/etc/secret] action delete (up to date)\\n  * templatesymlink[Create a database.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/database.yml to /var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a clickhouse.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/click_house.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/click_house.yml to /var/opt/gitlab/gitlab-rails/etc/click_house.yml] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a secrets.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml to /var/opt/gitlab/gitlab-rails/etc/secrets.yml] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a resque.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/resque.yml to /var/opt/gitlab/gitlab-rails/etc/resque.yml] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create an override redis.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/redis.yml to /var/opt/gitlab/gitlab-rails/etc/redis.yml] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a cable.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/cable.yml to /var/opt/gitlab/gitlab-rails/etc/cable.yml] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.cache.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.cache.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.cache.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.queues.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.queues.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.queues.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.shared_state.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.shared_state.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.shared_state.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.trace_chunks.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.trace_chunks.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.trace_chunks.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.rate_limiting.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.rate_limiting.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.rate_limiting.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.sessions.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.sessions.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.sessions.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.repository_cache.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.repository_cache.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.repository_cache.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.cluster_rate_limiting.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.cluster_rate_limiting.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.cluster_rate_limiting.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a redis.workhorse.yml and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/redis.workhorse.yml] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.workhorse.yml] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a session_store.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/session_store.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/session_store.yml to /var/opt/gitlab/gitlab-rails/etc/session_store.yml] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a smtp_settings.rb and create a symlink to Rails root] action delete\\n    * file[/var/opt/gitlab/gitlab-rails/etc/smtp_settings.rb] action delete (up to date)\\n    * link[/opt/gitlab/embedded/service/gitlab-rails/config/initializers/smtp_settings.rb] action delete (up to date)\\n     (up to date)\\n  * templatesymlink[Create a gitlab.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] action create[2025-08-04T10:22:55+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/gitlab-rails/etc/gitlab.yml.chef-20250804102255.882514\\n[2025-08-04T10:22:55+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab.yml\\n\\n      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab.yml from 24fdaa to 797266\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml to /var/opt/gitlab/gitlab-rails/etc/gitlab.yml] action create (up to date)\\n  \\n  * templatesymlink[Create a gitlab_workhorse_secret and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_workhorse_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a gitlab_shell_secret and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_shell_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a gitlab_incoming_email_secret and create a symlink to Rails root] action create (skipped due to only_if)\\n  * templatesymlink[Create a gitlab_service_desk_email_secret and create a symlink to Rails root] action create (skipped due to only_if)\\n  * templatesymlink[Create a gitlab_pages_secret and create a symlink to Rails root] action create[2025-08-04T10:22:55+00:00] WARN: only_if block for templatesymlink[Create a gitlab_pages_secret and create a symlink to Rails root] returned a string, did you mean to run a command?\\n\\n    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_pages_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] action create (up to date)\\n     (up to date)\\n  * templatesymlink[Create a gitlab_kas_secret and create a symlink to Rails root] action create[2025-08-04T10:22:55+00:00] WARN: only_if block for templatesymlink[Create a gitlab_kas_secret and create a symlink to Rails root] returned a string, did you mean to run a command?\\n\\n    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_kas_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] action create (up to date)\\n     (up to date)\\n  * link[/opt/gitlab/embedded/service/gitlab-rails/config/initializers/relative_url.rb] action delete (up to date)\\n  * file[/var/opt/gitlab/gitlab-rails/etc/relative_url.rb] action delete (up to date)\\n  * env_dir[/opt/gitlab/etc/gitlab-rails/env] action create\\n    * directory[/opt/gitlab/etc/gitlab-rails/env] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/HOME] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/RAILS_ENV] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/PATH] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/ICU_DATA] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/PYTHONPATH] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/TZ] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE] action create (up to date)\\n     (up to date)\\n  * link[/opt/gitlab/embedded/service/gitlab-rails/tmp] action create (up to date)\\n  * link[/opt/gitlab/embedded/service/gitlab-rails/public/uploads] action create (up to date)\\n  * link[/opt/gitlab/embedded/service/gitlab-rails/log] action create (up to date)\\n  * link[/var/log/gitlab/gitlab-rails/sidekiq.log] action delete (skipped due to only_if)\\n  * file[/opt/gitlab/embedded/service/gitlab-rails/db/structure.sql] action create (up to date)\\n  * remote_file[/var/opt/gitlab/gitlab-rails/VERSION] action create (up to date)\\n  * remote_file[/var/opt/gitlab/gitlab-rails/REVISION] action create (up to date)\\n  * version_file[Create version file for Rails] action create\\n    * file[/var/opt/gitlab/gitlab-rails/RUBY_VERSION] action create (up to date)\\n     (up to date)\\n  * execute[clear the gitlab-rails cache] action nothing (skipped due to action :nothing)\\n  * file[/var/opt/gitlab/gitlab-rails/config.ru] action delete (up to date)\\nRecipe: gitlab::selinux\\n  * execute[semodule -i /opt/gitlab/embedded/selinux/gitlab-7.2.0-ssh-keygen.pp] action run[2025-08-04T10:22:56+00:00] INFO: execute[Guard resource] ran successfully\\n (skipped due to not_if)\\n  * execute[semodule -i /opt/gitlab/embedded/selinux/gitlab-10.5.0-ssh-authorized-keys.pp] action run[2025-08-04T10:22:56+00:00] INFO: execute[Guard resource] ran successfully\\n (skipped due to not_if)\\n  * execute[semodule -i /opt/gitlab/embedded/selinux/gitlab-13.5.0-gitlab-shell.pp] action run[2025-08-04T10:22:56+00:00] INFO: execute[Guard resource] ran successfully\\n (skipped due to not_if)\\n  * execute[semodule -r gitlab] action run (skipped due to only_if)\\n  * bash[Set proper security context on ssh files for selinux] action nothing (skipped due to action :nothing)\\nRecipe: gitlab::add_trusted_certs\\n  * directory[/etc/gitlab/trusted-certs] action create (up to date)\\n  * directory[/opt/gitlab/embedded/ssl/certs] action create (up to date)\\n  * file[/opt/gitlab/embedded/ssl/certs/README] action create (up to date)\\n  * ruby_block[Move existing certs and link to /opt/gitlab/embedded/ssl/certs] action run (skipped due to only_if)\\nRecipe: gitlab::default\\n  * service[create a temporary puma service] action nothing (skipped due to action :nothing)\\n  * service[create a temporary sidekiq service] action nothing (skipped due to action :nothing)\\n  * service[create a temporary mailroom service] action nothing (skipped due to action :nothing)\\nRecipe: package::runit_systemd\\n  * directory[/usr/lib/systemd/system] action create (up to date)\\n  * template[/usr/lib/systemd/system/gitlab-runsvdir.service] action create (up to date)\\n  * file[/etc/systemd/system/default.target.wants/gitlab-runsvdir.service] action delete (up to date)\\n  * file[/etc/systemd/system/basic.target.wants/gitlab-runsvdir.service] action delete (up to date)\\n  * execute[systemctl daemon-reload] action nothing (skipped due to action :nothing)\\n  * execute[systemctl enable gitlab-runsvdir] action nothing (skipped due to action :nothing)\\n  * execute[systemctl start gitlab-runsvdir] action nothing (skipped due to action :nothing)\\nRecipe: gitlab::gitlab-shell\\n  * storage_directory[/var/opt/gitlab/.ssh] action create\\n    * ruby_block[directory resource: /var/opt/gitlab/.ssh] action run (skipped due to not_if)\\n     (up to date)\\n  * directory[/var/opt/gitlab/gitlab-shell] action create (up to date)\\n  * directory[/var/log/gitlab/gitlab-shell] action create (up to date)\\n  * bash[generate gitlab-sshd host keys] action run (skipped due to only_if)\\n  * templatesymlink[Create a config.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-shell/config.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-shell/config.yml to /var/opt/gitlab/gitlab-shell/config.yml] action create (up to date)\\n     (up to date)\\n  * link[/opt/gitlab/embedded/service/gitlab-shell/.gitlab_shell_secret] action create (up to date)\\n  * file[/var/opt/gitlab/.ssh/authorized_keys] action create_if_missing (up to date)\\n  * env_dir[/opt/gitlab/etc/gitlab-sshd/env] action nothing (skipped due to action :nothing)\\n  * service[gitlab-sshd] action nothing (skipped due to action :nothing)\\n  * runit_service[gitlab-sshd] action disable\\n    * ruby_block[disable gitlab-sshd] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: package::sysctl\\n  * execute[reload all sysctl conf] action nothing (skipped due to action :nothing)\\nRecipe: logrotate::folders_and_configs\\n  * directory[/var/opt/gitlab/logrotate] action create (up to date)\\n  * directory[/var/opt/gitlab/logrotate/logrotate.d] action create (up to date)\\n  * directory[/var/log/gitlab/logrotate] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.conf] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/nginx] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/puma] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-rails] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-shell] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-pages] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-kas] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/gitaly] action create (up to date)\\n  * template[/var/opt/gitlab/logrotate/logrotate.d/mailroom] action create (up to date)\\nRecipe: logrotate::enable\\n  * service[logrotate] action nothing (skipped due to action :nothing)\\n  * runit_service[logrotate] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/logrotate] action create (up to date)\\n    * template[/opt/gitlab/sv/logrotate/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/logrotate/log] action create (up to date)\\n    * directory[/opt/gitlab/sv/logrotate/log/main] action create (up to date)\\n    * template[/opt/gitlab/sv/logrotate/log/config] action create (up to date)\\n    * ruby_block[verify_chown_persisted_on_logrotate] action nothing (skipped due to action :nothing)\\n    * link[/var/log/gitlab/logrotate/config] action create (up to date)\\n    * template[/opt/gitlab/sv/logrotate/log/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/logrotate/env] action create (up to date)\\n    * ruby_block[Delete unmanaged env files for logrotate service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/logrotate/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/logrotate/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/logrotate/control] action create (up to date)\\n    * template[/opt/gitlab/sv/logrotate/control/t] action create (up to date)\\n    * link[/opt/gitlab/init/logrotate] action create (up to date)\\n    * file[/opt/gitlab/sv/logrotate/down] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/logrotate] action create (up to date)\\n    * ruby_block[wait for logrotate service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/logrotate/current] action touch (skipped due to only_if)\\n     (up to date)\\nRecipe: redis::enable\\n  * redis_service[redis] action create[2025-08-04T10:22:56+00:00] WARN: redis does not have a log_group or default logdir mode defined. Setting to 0700.\\n\\n    * account[user and group for redis] action create\\n      * group[user and group for redis] action create (up to date)\\n      * linux_user[user and group for redis] action create (up to date)\\n       (up to date)\\n    * group[Socket group] action create (up to date)\\n    * directory[/var/opt/gitlab/redis] action create (up to date)\\n    * directory[/var/log/gitlab/redis] action create (up to date)\\n    * template[/var/opt/gitlab/redis/redis.conf] action create (up to date)\\n    * service[redis] action nothing (skipped due to action :nothing)\\n    * runit_service[redis] action enable\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/redis] action create (up to date)\\n      * template[/opt/gitlab/sv/redis/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/redis/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_redis] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/redis/config] action create (up to date)\\n      * template[/opt/gitlab/sv/redis/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for redis service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/redis/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/redis/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/redis/control] action create (up to date)\\n      * link[/opt/gitlab/init/redis] action create (up to date)\\n      * file[/opt/gitlab/sv/redis/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/redis] action create (up to date)\\n      * ruby_block[wait for redis service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/redis/current] action touch (skipped due to only_if)\\n       (up to date)\\n    * ruby_block[warn pending redis restart] action run (skipped due to only_if)\\n     (up to date)\\n  * template[/opt/gitlab/etc/gitlab-redis-cli-rc] action create (up to date)\\nRecipe: gitaly::enable\\n  * directory[/var/opt/gitlab/gitaly] action create (up to date)\\n  * directory[/var/opt/gitlab/gitaly/run] action create (up to date)\\n  * directory[/var/log/gitlab/gitaly] action create (up to date)\\n  * directory[/var/opt/gitlab/gitaly/internal_sockets] action delete (up to date)\\n  * env_dir[/opt/gitlab/etc/gitaly/env] action create\\n    * directory[/opt/gitlab/etc/gitaly/env] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/HOME] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/PATH] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/TZ] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/PYTHONPATH] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/ICU_DATA] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/SSL_CERT_DIR] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/GITALY_PID_FILE] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING] action create (up to date)\\n    * file[/opt/gitlab/etc/gitaly/env/GODEBUG] action create (up to date)\\n     (up to date)\\n  * file[/var/opt/gitlab/gitaly/.gitlab_secret] action create (up to date)\\n  * template[Create Gitaly config.toml] action create (up to date)\\n  * service[gitaly] action nothing (skipped due to action :nothing)\\n  * runit_service[gitaly] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/gitaly] action create (up to date)\\n    * template[/opt/gitlab/sv/gitaly/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitaly/log] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitaly/log/main] action create (up to date)\\n    * template[/opt/gitlab/sv/gitaly/log/config] action create (up to date)\\n    * ruby_block[verify_chown_persisted_on_gitaly] action nothing (skipped due to action :nothing)\\n    * link[/var/log/gitlab/gitaly/config] action create (up to date)\\n    * template[/opt/gitlab/sv/gitaly/log/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitaly/env] action create (up to date)\\n    * ruby_block[Delete unmanaged env files for gitaly service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitaly/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitaly/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/gitaly/control] action create (up to date)\\n    * link[/opt/gitlab/init/gitaly] action create (up to date)\\n    * file[/opt/gitlab/sv/gitaly/down] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/gitaly] action create (up to date)\\n    * ruby_block[wait for gitaly service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/gitaly/current] action touch (skipped due to only_if)\\n     (up to date)\\n  * version_file[Create version file for Gitaly] action create\\n    * file[/var/opt/gitlab/gitaly/VERSION] action create (up to date)\\n     (up to date)\\n  * consul_service[gitaly] action delete\\n    * file[/var/opt/gitlab/consul/config.d/gitaly-service.json] action delete (up to date)\\n     (up to date)\\nRecipe: postgresql::bin\\n  * ruby_block[check_postgresql_version] action run (skipped due to not_if)\\n  * ruby_block[check_postgresql_version_is_deprecated] action run (skipped due to not_if)\\n  * ruby_block[Link postgresql bin files to the correct version] action run (skipped due to only_if)\\n  * template[/opt/gitlab/etc/gitlab-psql-rc] action create (up to date)\\nRecipe: postgresql::user\\n  * account[Postgresql user and group] action create\\n    * group[Postgresql user and group] action create (up to date)\\n    * linux_user[Postgresql user and group] action create (up to date)\\n     (up to date)\\n  * directory[/var/opt/gitlab/postgresql] action create (up to date)\\n  * file[/var/opt/gitlab/postgresql/.profile] action create (up to date)\\nRecipe: postgresql::sysctl\\n  * gitlab_sysctl[kernel.shmmax] action create\\n    * directory[create /etc/sysctl.d for kernel.shmmax] action create (up to date)\\n    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.shmmax.conf kernel.shmmax] action create (up to date)\\n    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.shmmax.conf] action create (up to date)\\n    * execute[load sysctl conf kernel.shmmax] action nothing (skipped due to action :nothing)\\n     (up to date)\\n  * gitlab_sysctl[kernel.shmall] action create\\n    * directory[create /etc/sysctl.d for kernel.shmall] action create (up to date)\\n    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.shmall.conf kernel.shmall] action create (up to date)\\n    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.shmall.conf] action create (up to date)\\n    * execute[load sysctl conf kernel.shmall] action nothing (skipped due to action :nothing)\\n     (up to date)\\n  * gitlab_sysctl[kernel.sem] action create\\n    * directory[create /etc/sysctl.d for kernel.sem] action create (up to date)\\n    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.sem.conf kernel.sem] action create (up to date)\\n    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.sem.conf] action create (up to date)\\n    * execute[load sysctl conf kernel.sem] action nothing (skipped due to action :nothing)\\n     (up to date)\\nRecipe: postgresql::enable\\n  * directory[/var/opt/gitlab/postgresql] action create (up to date)\\n  * directory[/var/opt/gitlab/postgresql/data] action create (up to date)\\n  * directory[/var/opt/gitlab/postgresql/data] action create (up to date)\\n  * directory[/var/log/gitlab/postgresql] action create (up to date)\\n  * execute[/opt/gitlab/embedded/bin/initdb -D /var/opt/gitlab/postgresql/data -E UTF8] action run (skipped due to not_if)\\n  * file[/var/opt/gitlab/postgresql/data/server.crt] action create (up to date)\\n  * file[/var/opt/gitlab/postgresql/data/server.key] action create (up to date)\\n  * postgresql_config[gitlab] action create\\n    * template[/var/opt/gitlab/postgresql/data/postgresql.conf] action create (up to date)\\n    * template[/var/opt/gitlab/postgresql/data/runtime.conf] action create (up to date)\\n    * template[/var/opt/gitlab/postgresql/data/pg_hba.conf] action create (up to date)\\n    * template[/var/opt/gitlab/postgresql/data/pg_ident.conf] action create (up to date)\\n     (up to date)\\nRecipe: postgresql::standalone\\n  * service[postgresql] action nothing (skipped due to action :nothing)\\n  * runit_service[postgresql] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/postgresql] action create (up to date)\\n    * template[/opt/gitlab/sv/postgresql/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/postgresql/log] action create (up to date)\\n    * directory[/opt/gitlab/sv/postgresql/log/main] action create (up to date)\\n    * template[/opt/gitlab/sv/postgresql/log/config] action create (up to date)\\n    * ruby_block[verify_chown_persisted_on_postgresql] action nothing (skipped due to action :nothing)\\n    * link[/var/log/gitlab/postgresql/config] action create (up to date)\\n    * template[/opt/gitlab/sv/postgresql/log/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/postgresql/env] action create (up to date)\\n    * ruby_block[Delete unmanaged env files for postgresql service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/postgresql/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/postgresql/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/postgresql/control] action create (up to date)\\n    * template[/opt/gitlab/sv/postgresql/control/t] action create (up to date)\\n    * link[/opt/gitlab/init/postgresql] action create (up to date)\\n    * file[/opt/gitlab/sv/postgresql/down] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/postgresql] action create (up to date)\\n    * ruby_block[wait for postgresql service socket] action run (skipped due to not_if)\\n    * directory[/opt/gitlab/service/postgresql/supervise] action create (up to date)\\n    * directory[/opt/gitlab/service/postgresql/log/supervise] action create (up to date)\\n    * file[/opt/gitlab/service/postgresql/supervise/ok] action touch (skipped due to only_if)\\n    * file[/opt/gitlab/service/postgresql/log/supervise/ok] action touch (skipped due to only_if)\\n    * file[/opt/gitlab/service/postgresql/supervise/status] action touch (skipped due to only_if)\\n    * file[/opt/gitlab/service/postgresql/log/supervise/status] action touch[2025-08-04T10:23:01+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] owner changed to 992\\n[2025-08-04T10:23:01+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] group changed to 987\\n\\n      - change owner from 'root' to 'gitlab-psql'\\n      - change group from 'root' to 'gitlab-psql'\\n      - restore selinux security context[2025-08-04T10:23:01+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] updated atime and mtime to 2025-08-04 10:23:01 +0000\\n\\n      - update utime on file /opt/gitlab/service/postgresql/log/supervise/status\\n    * file[/opt/gitlab/service/postgresql/supervise/control] action touch (skipped due to only_if)\\n    * file[/opt/gitlab/service/postgresql/log/supervise/control] action touch (skipped due to only_if)\\n    * file[/var/log/gitlab/postgresql/current] action touch (skipped due to only_if)\\n  \\n  * database_objects[postgresql] action create\\n    * postgresql_user[gitlab] action create\\n      * execute[create gitlab postgresql user] action run (skipped due to not_if)\\n       (up to date)\\n    * postgresql_user[gitlab_replicator] action create\\n      * execute[create gitlab_replicator postgresql user] action run (skipped due to not_if)\\n      * execute[set options for gitlab_replicator postgresql user] action run (skipped due to not_if)\\n       (up to date)\\n    * postgresql_database[gitlabhq_production] action create\\n      * execute[create database gitlabhq_production] action run (skipped due to not_if)\\n       (up to date)\\n    * postgresql_extension[pg_trgm] action enable\\n      * postgresql_query[enable pg_trgm extension] action run (skipped due to only_if)\\n       (up to date)\\n    * postgresql_extension[btree_gist] action enable\\n      * postgresql_query[enable btree_gist extension] action run (skipped due to only_if)\\n       (up to date)\\n    * postgresql_database[gitlabhq_production] action create\\n      * execute[create database gitlabhq_production] action run (skipped due to not_if)\\n       (up to date)\\n    * postgresql_extension[pg_trgm] action enable\\n      * postgresql_query[enable pg_trgm extension] action run (skipped due to only_if)\\n       (up to date)\\n    * postgresql_extension[btree_gist] action enable\\n      * postgresql_query[enable btree_gist extension] action run (skipped due to only_if)\\n       (up to date)\\n     (up to date)\\n  * version_file[Create version file for PostgreSQL] action create\\n    * file[/var/opt/gitlab/postgresql/VERSION] action create (up to date)\\n     (up to date)\\n  * ruby_block[warn pending postgresql restart] action run (skipped due to only_if)\\n  * execute[reload postgresql] action nothing (skipped due to action :nothing)\\n  * execute[start postgresql] action nothing (skipped due to action :nothing)\\nRecipe: praefect::disable\\n  * service[praefect] action nothing (skipped due to action :nothing)\\n  * runit_service[praefect] action disable\\n    * ruby_block[disable praefect] action run (skipped due to only_if)\\n     (up to date)\\n  * consul_service[praefect] action delete\\n    * file[/var/opt/gitlab/consul/config.d/praefect-service.json] action delete (up to date)\\n     (up to date)\\nRecipe: gitlab-kas::enable\\n  * directory[/var/opt/gitlab/gitlab-kas] action create (up to date)\\n  * directory[/opt/gitlab/etc/gitlab-kas] action create (up to date)\\n  * directory[/var/log/gitlab/gitlab-kas] action create (up to date)\\n  * version_file[Create version file for Gitlab KAS] action create\\n    * file[/var/opt/gitlab/gitlab-kas/VERSION] action create (up to date)\\n     (up to date)\\n  * file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] action create (up to date)\\n  * file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] action create (up to date)\\n  * file[/var/opt/gitlab/gitlab-kas/websocket_token_secret_file] action create (up to date)\\n  * file[/var/opt/gitlab/gitlab-kas/redis_password_file] action create (skipped due to only_if)\\n  * file[/var/opt/gitlab/gitlab-kas/redis_sentinels_password_file] action create (skipped due to only_if)\\n  * template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] action create (up to date)\\n  * env_dir[/opt/gitlab/etc/gitlab-kas/env] action create\\n    * directory[/opt/gitlab/etc/gitlab-kas/env] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-kas/env/GODEBUG] action create (up to date)\\n     (up to date)\\n  * service[gitlab-kas] action nothing (skipped due to action :nothing)\\n  * runit_service[gitlab-kas] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/gitlab-kas] action create (up to date)\\n    * template[/opt/gitlab/sv/gitlab-kas/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitlab-kas/log] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitlab-kas/log/main] action create (up to date)\\n    * template[/opt/gitlab/sv/gitlab-kas/log/config] action create (up to date)\\n    * ruby_block[verify_chown_persisted_on_gitlab-kas] action nothing (skipped due to action :nothing)\\n    * link[/var/log/gitlab/gitlab-kas/config] action create (up to date)\\n    * template[/opt/gitlab/sv/gitlab-kas/log/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitlab-kas/env] action create (up to date)\\n    * ruby_block[Delete unmanaged env files for gitlab-kas service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitlab-kas/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitlab-kas/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/gitlab-kas/control] action create (up to date)\\n    * link[/opt/gitlab/init/gitlab-kas] action create (up to date)\\n    * file[/opt/gitlab/sv/gitlab-kas/down] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/gitlab-kas] action create (up to date)\\n    * ruby_block[wait for gitlab-kas service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/gitlab-kas/current] action touch (skipped due to only_if)\\n     (up to date)\\nRecipe: gitlab::database_migrations\\n  * ruby_block[check remote PG version] action nothing (skipped due to action :nothing)\\n  * rails_migration[gitlab-rails] action run[2025-08-04T10:23:02+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.\\n\\n    * bash_hide_env[migrate gitlab-rails database] action run (skipped due to not_if)\\n     (up to date)\\nRecipe: crond::disable\\n  * service[crond] action nothing (skipped due to action :nothing)\\n  * runit_service[crond] action disable\\n    * ruby_block[disable crond] action run[2025-08-04T10:23:08+00:00] INFO: ruby_block[disable crond] called\\n\\n      - execute the ruby block disable crond\\n  \\nRecipe: gitlab::puma\\n  * directory[/opt/gitlab/var/puma] action create (up to date)\\n  * directory[/var/log/gitlab/puma] action create (up to date)\\n  * directory[/var/opt/gitlab/gitlab-rails/sockets] action create (up to date)\\n  * puma_config[/var/opt/gitlab/gitlab-rails/etc/puma.rb] action create\\n    * directory[/var/opt/gitlab/gitlab-rails/etc] action create (up to date)\\n    * template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] action create (up to date)\\n     (up to date)\\n  * service[puma] action nothing (skipped due to action :nothing)\\n  * runit_service[puma] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/puma] action create (up to date)\\n    * template[/opt/gitlab/sv/puma/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/puma/log] action create (up to date)\\n    * directory[/opt/gitlab/sv/puma/log/main] action create (up to date)\\n    * template[/opt/gitlab/sv/puma/log/config] action create (up to date)\\n    * ruby_block[verify_chown_persisted_on_puma] action nothing (skipped due to action :nothing)\\n    * link[/var/log/gitlab/puma/config] action create (up to date)\\n    * template[/opt/gitlab/sv/puma/log/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/puma/env] action create (up to date)\\n    * ruby_block[Delete unmanaged env files for puma service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/puma/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/puma/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/puma/control] action create (up to date)\\n    * template[/opt/gitlab/sv/puma/control/t] action create (up to date)\\n    * template[/opt/gitlab/sv/puma/control/h] action create (up to date)\\n    * link[/opt/gitlab/init/puma] action create (up to date)\\n    * file[/opt/gitlab/sv/puma/down] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/puma] action create (up to date)\\n    * ruby_block[wait for puma service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/puma/current] action touch (skipped due to only_if)\\n     (up to date)\\n  * consul_service[rails] action delete\\n    * file[/var/opt/gitlab/consul/config.d/rails-service.json] action delete (up to date)\\n     (up to date)\\n  * gitlab_sysctl[net.core.somaxconn] action create\\n    * directory[create /etc/sysctl.d for net.core.somaxconn] action create (up to date)\\n    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-net.core.somaxconn.conf net.core.somaxconn] action create (up to date)\\n    * link[/etc/sysctl.d/90-omnibus-gitlab-net.core.somaxconn.conf] action create (up to date)\\n    * execute[load sysctl conf net.core.somaxconn] action nothing (skipped due to action :nothing)\\n     (up to date)\\nRecipe: gitlab::sidekiq\\n  * sidekiq_service[sidekiq] action enable[2025-08-04T10:23:08+00:00] WARN: sidekiq does not have a log_group or default logdir mode defined. Setting to 0700.\\n\\n    * directory[/var/log/gitlab/sidekiq] action create (up to date)\\n    * service[sidekiq] action nothing (skipped due to action :nothing)\\n    * runit_service[sidekiq] action enable\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/sidekiq] action create (up to date)\\n      * template[/opt/gitlab/sv/sidekiq/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/sidekiq/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/sidekiq/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/sidekiq/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_sidekiq] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/sidekiq/config] action create (up to date)\\n      * template[/opt/gitlab/sv/sidekiq/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/sidekiq/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for sidekiq service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/sidekiq/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/sidekiq/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/sidekiq/control] action create (up to date)\\n      * link[/opt/gitlab/init/sidekiq] action create (up to date)\\n      * file[/opt/gitlab/sv/sidekiq/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/sidekiq] action create (up to date)\\n      * ruby_block[wait for sidekiq service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/sidekiq/current] action touch (skipped due to only_if)\\n       (up to date)\\n     (up to date)\\n  * consul_service[sidekiq] action delete\\n    * file[/var/opt/gitlab/consul/config.d/sidekiq-service.json] action delete (up to date)\\n     (up to date)\\nRecipe: gitlab::gitlab-workhorse\\n  * directory[/var/opt/gitlab/gitlab-workhorse] action create (up to date)\\n  * directory[/var/opt/gitlab/gitlab-workhorse/sockets] action create (up to date)\\n  * directory[/var/log/gitlab/gitlab-workhorse] action create (up to date)\\n  * directory[/opt/gitlab/etc/gitlab-workhorse] action create (up to date)\\n  * env_dir[/opt/gitlab/etc/gitlab-workhorse/env] action create\\n    * directory[/opt/gitlab/etc/gitlab-workhorse/env] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-workhorse/env/PATH] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-workhorse/env/HOME] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR] action create (up to date)\\n    * file[/opt/gitlab/etc/gitlab-workhorse/env/GODEBUG] action create (up to date)\\n     (up to date)\\n  * service[gitlab-workhorse] action nothing (skipped due to action :nothing)\\n  * runit_service[gitlab-workhorse] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/gitlab-workhorse] action create (up to date)\\n    * template[/opt/gitlab/sv/gitlab-workhorse/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitlab-workhorse/log] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitlab-workhorse/log/main] action create (up to date)\\n    * template[/opt/gitlab/sv/gitlab-workhorse/log/config] action create (up to date)\\n    * ruby_block[verify_chown_persisted_on_gitlab-workhorse] action nothing (skipped due to action :nothing)\\n    * link[/var/log/gitlab/gitlab-workhorse/config] action create (up to date)\\n    * template[/opt/gitlab/sv/gitlab-workhorse/log/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/gitlab-workhorse/env] action create (up to date)\\n    * ruby_block[Delete unmanaged env files for gitlab-workhorse service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitlab-workhorse/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitlab-workhorse/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/gitlab-workhorse/control] action create (up to date)\\n    * link[/opt/gitlab/init/gitlab-workhorse] action create (up to date)\\n    * file[/opt/gitlab/sv/gitlab-workhorse/down] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/gitlab-workhorse] action create (up to date)\\n    * ruby_block[wait for gitlab-workhorse service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/gitlab-workhorse/current] action touch (skipped due to only_if)\\n     (up to date)\\n  * consul_service[workhorse] action delete\\n    * file[/var/opt/gitlab/consul/config.d/workhorse-service.json] action delete (up to date)\\n     (up to date)\\n  * version_file[Create version file for Workhorse] action create\\n    * file[/var/opt/gitlab/gitlab-workhorse/VERSION] action create (up to date)\\n     (up to date)\\n  * template[/var/opt/gitlab/gitlab-workhorse/config.toml] action create (up to date)\\nRecipe: gitlab::mailroom_disable\\n  * service[mailroom] action nothing (skipped due to action :nothing)\\n  * runit_service[mailroom] action disable\\n    * ruby_block[disable mailroom] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: gitlab::nginx\\n  * directory[/var/opt/gitlab/nginx] action create (up to date)\\n  * directory[/var/opt/gitlab/nginx/conf] action create (up to date)\\n  * directory[/var/log/gitlab/nginx] action create (up to date)\\n  * link[/var/opt/gitlab/nginx/logs] action create (up to date)\\n  * template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] action create[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/nginx/conf/gitlab-http.conf.chef-20250804102309.238788\\n[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] updated file contents /var/opt/gitlab/nginx/conf/gitlab-http.conf\\n\\n    - update content in file /var/opt/gitlab/nginx/conf/gitlab-http.conf from d30136 to b8b24d\\n    --- /var/opt/gitlab/nginx/conf/gitlab-http.conf\\t2025-08-04 10:19:58.061533795 +0000\\n    +++ /var/opt/gitlab/nginx/conf/.chef-gitlab-http20250804-32489-iippqd.conf\\t2025-08-04 10:23:09.232330842 +0000\\n    @@ -30,38 +30,7 @@\\n     ##         configuration         ##\\n     ###################################\\n     \\n    -## Redirects all HTTP traffic to the HTTPS host\\n    -server { ## HTTPS redirect server\\n    -  listen *:80;\\n     \\n    -  server_name server.example.com;\\n    -  server_tokens off; ## Don't show the nginx version number, a security best practice\\n    -\\n    -  location /.well-known/acme-challenge/ {\\n    -    root /var/opt/gitlab/nginx/www/;\\n    -  }\\n    -\\n    -  location / {\\n    -    return 301 https://server.example.com:443$request_uri;\\n    -  }\\n    -\\n    -  # Pass headers because we are serving monitoring endpoints directly without\\n    -  # redirection\\n    -  proxy_set_header Host $http_host_with_default;\\n    -  proxy_set_header X-Real-IP $remote_addr;\\n    -  proxy_set_header X-Forwarded-For $remote_addr;\\n    -  proxy_set_header Upgrade $http_upgrade;\\n    -  proxy_set_header Connection $connection_upgrade;\\n    -  proxy_set_header X-Forwarded-Ssl on;\\n    -  proxy_set_header X-Forwarded-Proto https;\\n    -\\n    -  # health checks configuration\\n    -  include /var/opt/gitlab/nginx/conf/gitlab-health.conf;\\n    -\\n    -  access_log  /var/log/gitlab/nginx/gitlab_access.log gitlab_access;\\n    -  error_log   /var/log/gitlab/nginx/gitlab_error.log error;\\n    -} ## end HTTPS redirect server\\n    -\\n     server { ## HTTPS server\\n       listen *:443 ssl;\\n     \\n    @@ -164,9 +133,6 @@\\n       # health checks configuration\\n       include /var/opt/gitlab/nginx/conf/gitlab-health.conf;\\n     \\n    -  location /.well-known/acme-challenge/ {\\n    -    root /var/opt/gitlab/nginx/www/;\\n    -  }\\n     \\n       location / {\\n         proxy_cache off;\\n    - restore selinux security context\\n  * template[/var/opt/gitlab/nginx/conf/gitlab-smartcard-http.conf] action delete (up to date)\\n  * template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] action create (up to date)\\n  * template[/var/opt/gitlab/nginx/conf/gitlab-pages.conf] action delete (up to date)\\n  * template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] action delete[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/nginx/conf/gitlab-registry.conf.chef-20250804102309.286718\\n[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] deleted file at /var/opt/gitlab/nginx/conf/gitlab-registry.conf\\n\\n    - delete file /var/opt/gitlab/nginx/conf/gitlab-registry.conf\\n[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] not queuing delayed action restart on runit_service[nginx] (delayed), as it's already been queued\\n  * template[/var/opt/gitlab/nginx/conf/gitlab-mattermost-http.conf] action delete (up to date)\\n  * template[/var/opt/gitlab/nginx/conf/gitlab-kas.conf] action delete (up to date)\\n  * template[/var/opt/gitlab/nginx/conf/nginx-status.conf] action create (up to date)\\n  * consul_service[nginx] action delete\\n    * file[/var/opt/gitlab/consul/config.d/nginx-service.json] action delete (up to date)\\n     (up to date)\\n  * template[/var/opt/gitlab/nginx/conf/nginx.conf] action create[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/nginx/conf/nginx.conf.chef-20250804102309.307476\\n[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] updated file contents /var/opt/gitlab/nginx/conf/nginx.conf\\n\\n    - update content in file /var/opt/gitlab/nginx/conf/nginx.conf from 3d8674 to 39503d\\n    --- /var/opt/gitlab/nginx/conf/nginx.conf\\t2025-08-04 10:19:58.408535205 +0000\\n    +++ /var/opt/gitlab/nginx/conf/.chef-nginx20250804-32489-qc9uhi.conf\\t2025-08-04 10:23:09.304331144 +0000\\n    @@ -94,7 +94,6 @@\\n     \\n     \\n     \\n    -  include /var/opt/gitlab/nginx/conf/gitlab-registry.conf;\\n     \\n     \\n       include /var/opt/gitlab/nginx/conf/nginx-status.conf;\\n    - restore selinux security context\\n[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] not queuing delayed action restart on runit_service[nginx] (delayed), as it's already been queued\\nRecipe: nginx::enable\\n  * service[nginx] action nothing (skipped due to action :nothing)\\n  * runit_service[nginx] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/nginx] action create (up to date)\\n    * template[/opt/gitlab/sv/nginx/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/nginx/log] action create (up to date)\\n    * directory[/opt/gitlab/sv/nginx/log/main] action create (up to date)\\n    * template[/opt/gitlab/sv/nginx/log/config] action create (up to date)\\n    * ruby_block[verify_chown_persisted_on_nginx] action nothing (skipped due to action :nothing)\\n    * link[/var/log/gitlab/nginx/config] action create (up to date)\\n    * template[/opt/gitlab/sv/nginx/log/run] action create (up to date)\\n    * directory[/opt/gitlab/sv/nginx/env] action create (up to date)\\n    * ruby_block[Delete unmanaged env files for nginx service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/nginx/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/nginx/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/nginx/control] action create (up to date)\\n    * link[/opt/gitlab/init/nginx] action create (up to date)\\n    * file[/opt/gitlab/sv/nginx/down] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/nginx] action create (up to date)\\n    * ruby_block[wait for nginx service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/nginx/current] action touch (skipped due to only_if)\\n     (up to date)\\n  * version_file[Create version file for NGINX] action create\\n    * file[/var/opt/gitlab/nginx/VERSION] action create (up to date)\\n     (up to date)\\n  * execute[reload nginx] action nothing (skipped due to action :nothing)\\nRecipe: gitlab::remote-syslog_disable\\n  * service[remote-syslog] action nothing (skipped due to action :nothing)\\n  * runit_service[remote-syslog] action disable\\n    * ruby_block[disable remote-syslog] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: gitlab::storage-check_disable\\n  * service[storage-check] action nothing (skipped due to action :nothing)\\n  * runit_service[storage-check] action disable\\n    * ruby_block[disable storage-check] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: gitlab-pages::disable\\n  * service[gitlab-pages] action nothing (skipped due to action :nothing)\\n  * runit_service[gitlab-pages] action disable\\n    * ruby_block[disable gitlab-pages] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: registry::disable\\n  * service[registry] action nothing (skipped due to action :nothing)\\n  * runit_service[registry] action disable\\n    * ruby_block[disable registry] action run[2025-08-04T10:23:15+00:00] INFO: ruby_block[disable registry] called\\n\\n      - execute the ruby block disable registry\\n  \\nRecipe: mattermost::disable\\n  * service[mattermost] action nothing (skipped due to action :nothing)\\n  * runit_service[mattermost] action disable\\n    * ruby_block[disable mattermost] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: letsencrypt::disable\\n  * crond_job[letsencrypt-renew] action delete\\n    * file[/var/opt/gitlab/crond/letsencrypt-renew] action delete (up to date)\\n     (up to date)\\nRecipe: gitlab::gitlab-healthcheck\\n  * template[/opt/gitlab/etc/gitlab-healthcheck-rc] action create[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] created file /opt/gitlab/etc/gitlab-healthcheck-rc\\n\\n    - create new file /opt/gitlab/etc/gitlab-healthcheck-rc[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] updated file contents /opt/gitlab/etc/gitlab-healthcheck-rc\\n\\n    - update content in file /opt/gitlab/etc/gitlab-healthcheck-rc from none to 39c4ee\\n    --- /opt/gitlab/etc/gitlab-healthcheck-rc\\t2025-08-04 10:23:15.619357587 +0000\\n    +++ /opt/gitlab/etc/.chef-gitlab-healthcheck-rc20250804-32489-hr6a9e\\t2025-08-04 10:23:15.618357583 +0000\\n    @@ -1,2 +1,4 @@\\n    +url='https://localhost:443/help'\\n    +flags=(--insecure)[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] owner changed to 0\\n[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] group changed to 0\\n\\n    - change owner from '' to 'root'\\n    - change group from '' to 'root'\\n    - restore selinux security context\\nRecipe: monitoring::pgbouncer-exporter_disable\\n  * service[pgbouncer-exporter] action nothing (skipped due to action :nothing)\\n  * runit_service[pgbouncer-exporter] action disable\\n    * ruby_block[disable pgbouncer-exporter] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: monitoring::user\\n  * account[Prometheus user and group] action create\\n    * group[Prometheus user and group] action create[2025-08-04T10:23:15+00:00] INFO: group[Prometheus user and group] created\\n\\n      - create group gitlab-prometheus\\n    * linux_user[Prometheus user and group] action create[2025-08-04T10:23:16+00:00] INFO: linux_user[Prometheus user and group] created\\n\\n      - create user gitlab-prometheus\\n  \\nRecipe: monitoring::node-exporter\\n  * directory[/var/log/gitlab/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: directory[/var/log/gitlab/node-exporter] created directory /var/log/gitlab/node-exporter\\n\\n    - create new directory /var/log/gitlab/node-exporter[2025-08-04T10:23:16+00:00] INFO: directory[/var/log/gitlab/node-exporter] owner changed to 990\\n[2025-08-04T10:23:16+00:00] INFO: directory[/var/log/gitlab/node-exporter] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * directory[/opt/gitlab/etc/node-exporter/env] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/etc/node-exporter/env] created directory /opt/gitlab/etc/node-exporter/env\\n\\n    - create new directory /opt/gitlab/etc/node-exporter/env[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/etc/node-exporter/env] owner changed to 990\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/etc/node-exporter/env] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * env_dir[/opt/gitlab/etc/node-exporter/env] action create\\n    * directory[/opt/gitlab/etc/node-exporter/env] action create (up to date)\\n    * file[/opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR\\n\\n      - create new file /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR\\n\\n      - update content in file /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR from none to 4f45cf\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/node-exporter/env/GODEBUG] action create[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/GODEBUG] created file /opt/gitlab/etc/node-exporter/env/GODEBUG\\n\\n      - create new file /opt/gitlab/etc/node-exporter/env/GODEBUG[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/GODEBUG] updated file contents /opt/gitlab/etc/node-exporter/env/GODEBUG\\n\\n      - update content in file /opt/gitlab/etc/node-exporter/env/GODEBUG from none to e6ab3f\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n  \\n  * directory[/var/opt/gitlab/node-exporter/textfile_collector] action create[2025-08-04T10:23:16+00:00] INFO: directory[/var/opt/gitlab/node-exporter/textfile_collector] created directory /var/opt/gitlab/node-exporter/textfile_collector\\n\\n    - create new directory /var/opt/gitlab/node-exporter/textfile_collector[2025-08-04T10:23:16+00:00] INFO: directory[/var/opt/gitlab/node-exporter/textfile_collector] owner changed to 990\\n[2025-08-04T10:23:16+00:00] INFO: directory[/var/opt/gitlab/node-exporter/textfile_collector] mode changed to 755\\n\\n    - change mode from '' to '0755'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * service[node-exporter] action nothing (skipped due to action :nothing)\\n  * runit_service[node-exporter] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] created directory /opt/gitlab/sv/node-exporter\\n\\n      - create new directory /opt/gitlab/sv/node-exporter[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/node-exporter/run] action create[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] created file /opt/gitlab/sv/node-exporter/run\\n\\n      - create new file /opt/gitlab/sv/node-exporter/run[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] updated file contents /opt/gitlab/sv/node-exporter/run\\n\\n      - update content in file /opt/gitlab/sv/node-exporter/run from none to 744544\\n      --- /opt/gitlab/sv/node-exporter/run\\t2025-08-04 10:23:16.327360551 +0000\\n      +++ /opt/gitlab/sv/node-exporter/.chef-run20250804-32489-g6s8s6\\t2025-08-04 10:23:16.326360547 +0000\\n      @@ -1,8 +1,16 @@\\n      +#!/bin/sh\\n      +exec 2>&1\\n      +\\n      +umask 077\\n      +exec chpst  /opt/gitlab/etc/node-exporter/env \\\\\\n      +  -U gitlab-prometheus:gitlab-prometheus \\\\\\n      +  -u gitlab-prometheus:gitlab-prometheus \\\\\\n      +  /opt/gitlab/embedded/bin/node_exporter --web.listen-address=localhost:9100 --collector.mountstats --collector.runit --collector.runit.servicedir=/opt/gitlab/sv --collector.textfile.directory=/var/opt/gitlab/node-exporter/textfile_collector[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/node-exporter/log] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] created directory /opt/gitlab/sv/node-exporter/log\\n\\n      - create new directory /opt/gitlab/sv/node-exporter/log[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/node-exporter/log/main] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] created directory /opt/gitlab/sv/node-exporter/log/main\\n\\n      - create new directory /opt/gitlab/sv/node-exporter/log/main[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/node-exporter/log/config] action create[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] created file /opt/gitlab/sv/node-exporter/log/config\\n\\n      - create new file /opt/gitlab/sv/node-exporter/log/config[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] updated file contents /opt/gitlab/sv/node-exporter/log/config\\n\\n      - update content in file /opt/gitlab/sv/node-exporter/log/config from none to 623c00\\n      --- /opt/gitlab/sv/node-exporter/log/config\\t2025-08-04 10:23:16.420360941 +0000\\n      +++ /opt/gitlab/sv/node-exporter/log/.chef-config20250804-32489-wvfage\\t2025-08-04 10:23:16.420360941 +0000\\n      @@ -1,6 +1,12 @@\\n      +s209715200\\n      +n30\\n      +t86400\\n      +!gzip\\n      +\\n      +[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] mode changed to 644\\n\\n      - change mode from '' to '0644'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[verify_chown_persisted_on_node-exporter] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:16+00:00] INFO: ruby_block[verify_chown_persisted_on_node-exporter] sent create action to ruby_block[verify_chown_persisted_on_node-exporter] (immediate at declaration time)\\n    * ruby_block[verify_chown_persisted_on_node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: ruby_block[verify_chown_persisted_on_node-exporter] called\\n\\n      - execute the ruby block verify_chown_persisted_on_node-exporter\\n    * link[/var/log/gitlab/node-exporter/config] action create[2025-08-04T10:23:16+00:00] INFO: link[/var/log/gitlab/node-exporter/config] created\\n\\n      - create symlink at /var/log/gitlab/node-exporter/config to /opt/gitlab/sv/node-exporter/log/config\\n    * template[/opt/gitlab/sv/node-exporter/log/run] action create[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] created file /opt/gitlab/sv/node-exporter/log/run\\n\\n      - create new file /opt/gitlab/sv/node-exporter/log/run[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] updated file contents /opt/gitlab/sv/node-exporter/log/run\\n\\n      - update content in file /opt/gitlab/sv/node-exporter/log/run from none to ed81f2\\n      --- /opt/gitlab/sv/node-exporter/log/run\\t2025-08-04 10:23:16.458361100 +0000\\n      +++ /opt/gitlab/sv/node-exporter/log/.chef-run20250804-32489-214c5o\\t2025-08-04 10:23:16.458361100 +0000\\n      @@ -1,5 +1,10 @@\\n      +#!/bin/sh\\n      +exec chpst       +  -U root:root \\\\\\n      +  -u root:root \\\\\\n      +  svlogd -tt /var/log/gitlab/node-exporter[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/node-exporter/env] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] created directory /opt/gitlab/sv/node-exporter/env\\n\\n      - create new directory /opt/gitlab/sv/node-exporter/env[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[Delete unmanaged env files for node-exporter service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/node-exporter/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/node-exporter/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/node-exporter/control] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] created directory /opt/gitlab/sv/node-exporter/control\\n\\n      - create new directory /opt/gitlab/sv/node-exporter/control[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] owner changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] group changed to 0\\n[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * link[/opt/gitlab/init/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: link[/opt/gitlab/init/node-exporter] created\\n\\n      - create symlink at /opt/gitlab/init/node-exporter to /opt/gitlab/embedded/bin/sv\\n    * file[/opt/gitlab/sv/node-exporter/down] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] sending run action to ruby_block[restart_service] (delayed)\\n    * ruby_block[restart_service] action run (skipped due to only_if)\\n[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)\\n    * ruby_block[reload_log_service] action create\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/node-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/node-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/node-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/node-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/node-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_node-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/node-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/node-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/node-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for node-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/node-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/node-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/node-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/node-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/node-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: link[/opt/gitlab/service/node-exporter] created\\n\\n        - create symlink at /opt/gitlab/service/node-exporter to /opt/gitlab/sv/node-exporter\\n      * ruby_block[wait for node-exporter service socket] action run[2025-08-04T10:23:17+00:00] INFO: ruby_block[wait for node-exporter service socket] called\\n\\n        - execute the ruby block wait for node-exporter service socket\\n      * file[/var/log/gitlab/node-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:17+00:00] INFO: ruby_block[reload_log_service] called\\n      - execute the ruby block reload_log_service\\n[2025-08-04T10:23:17+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)\\n    * ruby_block[restart_log_service] action run\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/node-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/node-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/node-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/node-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/node-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_node-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/node-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/node-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/node-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for node-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/node-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/node-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/node-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/node-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/node-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/node-exporter] action create (up to date)\\n      * ruby_block[wait for node-exporter service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/node-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:19+00:00] INFO: ruby_block[restart_log_service] called\\n      - execute the ruby block restart_log_service\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/node-exporter] action create (up to date)\\n    * ruby_block[wait for node-exporter service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/node-exporter/current] action touch (skipped due to only_if)\\n  \\n  * consul_service[node-exporter] action delete\\n    * file[/var/opt/gitlab/consul/config.d/node-exporter-service.json] action delete (up to date)\\n     (up to date)\\nRecipe: monitoring::gitlab-exporter\\n  * directory[/var/opt/gitlab/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] created directory /var/opt/gitlab/gitlab-exporter\\n\\n    - create new directory /var/opt/gitlab/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] owner changed to 994\\n[2025-08-04T10:23:19+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] mode changed to 755\\n\\n    - change mode from '' to '0755'\\n    - change owner from '' to 'git'\\n    - restore selinux security context\\n  * directory[/var/log/gitlab/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] created directory /var/log/gitlab/gitlab-exporter\\n\\n    - create new directory /var/log/gitlab/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] owner changed to 994\\n[2025-08-04T10:23:19+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'git'\\n    - restore selinux security context\\n  * env_dir[/opt/gitlab/etc/gitlab-exporter/env] action create\\n    * directory[/opt/gitlab/etc/gitlab-exporter/env] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/etc/gitlab-exporter/env] created directory /opt/gitlab/etc/gitlab-exporter/env\\n\\n      - create new directory /opt/gitlab/etc/gitlab-exporter/env\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] created file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF\\n\\n      - create new file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] updated file contents /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF\\n\\n      - update content in file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF from none to 2ea29b\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS\\n\\n      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS\\n\\n      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS from none to 47b250\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO\\n\\n      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO\\n\\n      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO from none to c945fb\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO\\n\\n      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO\\n\\n      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO from none to 8a60e9\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR\\n\\n      - create new file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR\\n\\n      - update content in file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR from none to 4f45cf\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] created file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE\\n\\n      - create new file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] updated file contents /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE\\n\\n      - update content in file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE from none to f7ce84\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n  \\n  * template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] action create[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] created file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml\\n\\n    - create new file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] updated file contents /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml\\n\\n    - update content in file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml from none to 167fe6\\n    - suppressed sensitive resource[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] owner changed to 994\\n[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] mode changed to 600\\n\\n    - change mode from '' to '0600'\\n    - change owner from '' to 'git'\\n    - restore selinux security context\\n[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] not queuing delayed action restart on runit_service[gitlab-exporter] (delayed), as it's already been queued\\n  * version_file[Create version file for GitLab-Exporter] action create\\n    * file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] action create[2025-08-04T10:23:19+00:00] INFO: file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] created file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION\\n\\n      - create new file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION[2025-08-04T10:23:19+00:00] INFO: file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] updated file contents /var/opt/gitlab/gitlab-exporter/RUBY_VERSION\\n\\n      - update content in file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION from none to a57ad3\\n      --- /var/opt/gitlab/gitlab-exporter/RUBY_VERSION\\t2025-08-04 10:23:19.520373922 +0000\\n      +++ /var/opt/gitlab/gitlab-exporter/.chef-RUBY_VERSION20250804-32489-7mrydf\\t2025-08-04 10:23:19.520373922 +0000\\n      @@ -1 +1,2 @@\\n      +ruby 3.2.5 (2024-07-26 revision 31d0f1a2e7) [x86_64-linux]\\n      - restore selinux security context\\n  \\n[2025-08-04T10:23:19+00:00] INFO: version_file[Create version file for GitLab-Exporter] not queuing delayed action restart on runit_service[gitlab-exporter] (delayed), as it's already been queued\\n  * service[gitlab-exporter] action nothing (skipped due to action :nothing)\\n  * runit_service[gitlab-exporter] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] created directory /opt/gitlab/sv/gitlab-exporter\\n\\n      - create new directory /opt/gitlab/sv/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/gitlab-exporter/run] action create[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] created file /opt/gitlab/sv/gitlab-exporter/run\\n\\n      - create new file /opt/gitlab/sv/gitlab-exporter/run[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] updated file contents /opt/gitlab/sv/gitlab-exporter/run\\n\\n      - update content in file /opt/gitlab/sv/gitlab-exporter/run from none to d78ca8\\n      --- /opt/gitlab/sv/gitlab-exporter/run\\t2025-08-04 10:23:19.593374228 +0000\\n      +++ /opt/gitlab/sv/gitlab-exporter/.chef-run20250804-32489-gn0fns\\t2025-08-04 10:23:19.592374224 +0000\\n      @@ -1,9 +1,18 @@\\n      +#!/bin/sh\\n      +exec 2>&1\\n      +\\n      +umask 077\\n      +exec chpst  /opt/gitlab/etc/gitlab-exporter/env \\\\\\n      +  -U git:git \\\\\\n      +  -u git:git \\\\\\n      +  /opt/gitlab/embedded/bin/gitlab-exporter web \\\\\\n      +  -c /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/gitlab-exporter/log] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] created directory /opt/gitlab/sv/gitlab-exporter/log\\n\\n      - create new directory /opt/gitlab/sv/gitlab-exporter/log[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] created directory /opt/gitlab/sv/gitlab-exporter/log/main\\n\\n      - create new directory /opt/gitlab/sv/gitlab-exporter/log/main[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] created file /opt/gitlab/sv/gitlab-exporter/log/config\\n\\n      - create new file /opt/gitlab/sv/gitlab-exporter/log/config[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] updated file contents /opt/gitlab/sv/gitlab-exporter/log/config\\n\\n      - update content in file /opt/gitlab/sv/gitlab-exporter/log/config from none to 623c00\\n      --- /opt/gitlab/sv/gitlab-exporter/log/config\\t2025-08-04 10:23:19.689374630 +0000\\n      +++ /opt/gitlab/sv/gitlab-exporter/log/.chef-config20250804-32489-fc6b11\\t2025-08-04 10:23:19.688374626 +0000\\n      @@ -1,6 +1,12 @@\\n      +s209715200\\n      +n30\\n      +t86400\\n      +!gzip\\n      +\\n      +[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] mode changed to 644\\n\\n      - change mode from '' to '0644'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:19+00:00] INFO: ruby_block[verify_chown_persisted_on_gitlab-exporter] sent create action to ruby_block[verify_chown_persisted_on_gitlab-exporter] (immediate at declaration time)\\n    * ruby_block[verify_chown_persisted_on_gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: ruby_block[verify_chown_persisted_on_gitlab-exporter] called\\n\\n      - execute the ruby block verify_chown_persisted_on_gitlab-exporter\\n    * link[/var/log/gitlab/gitlab-exporter/config] action create[2025-08-04T10:23:19+00:00] INFO: link[/var/log/gitlab/gitlab-exporter/config] created\\n\\n      - create symlink at /var/log/gitlab/gitlab-exporter/config to /opt/gitlab/sv/gitlab-exporter/log/config\\n    * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] created file /opt/gitlab/sv/gitlab-exporter/log/run\\n\\n      - create new file /opt/gitlab/sv/gitlab-exporter/log/run[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] updated file contents /opt/gitlab/sv/gitlab-exporter/log/run\\n\\n      - update content in file /opt/gitlab/sv/gitlab-exporter/log/run from none to 0b0a31\\n      --- /opt/gitlab/sv/gitlab-exporter/log/run\\t2025-08-04 10:23:19.728374793 +0000\\n      +++ /opt/gitlab/sv/gitlab-exporter/log/.chef-run20250804-32489-ss11ak\\t2025-08-04 10:23:19.728374793 +0000\\n      @@ -1,5 +1,10 @@\\n      +#!/bin/sh\\n      +exec chpst       +  -U root:root \\\\\\n      +  -u root:root \\\\\\n      +  svlogd -tt /var/log/gitlab/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/gitlab-exporter/env] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] created directory /opt/gitlab/sv/gitlab-exporter/env\\n\\n      - create new directory /opt/gitlab/sv/gitlab-exporter/env[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/gitlab-exporter/control] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] created directory /opt/gitlab/sv/gitlab-exporter/control\\n\\n      - create new directory /opt/gitlab/sv/gitlab-exporter/control[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] owner changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] group changed to 0\\n[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * link[/opt/gitlab/init/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: link[/opt/gitlab/init/gitlab-exporter] created\\n\\n      - create symlink at /opt/gitlab/init/gitlab-exporter to /opt/gitlab/embedded/bin/sv\\n    * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] sending run action to ruby_block[restart_service] (delayed)\\n    * ruby_block[restart_service] action run (skipped due to only_if)\\n[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)\\n    * ruby_block[reload_log_service] action create\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/gitlab-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/gitlab-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/gitlab-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/gitlab-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: link[/opt/gitlab/service/gitlab-exporter] created\\n\\n        - create symlink at /opt/gitlab/service/gitlab-exporter to /opt/gitlab/sv/gitlab-exporter\\n      * ruby_block[wait for gitlab-exporter service socket] action run[2025-08-04T10:23:23+00:00] INFO: ruby_block[wait for gitlab-exporter service socket] called\\n\\n        - execute the ruby block wait for gitlab-exporter service socket\\n      * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:23+00:00] INFO: ruby_block[reload_log_service] called\\n      - execute the ruby block reload_log_service\\n[2025-08-04T10:23:23+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)\\n    * ruby_block[restart_log_service] action run\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/gitlab-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/gitlab-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/gitlab-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/gitlab-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/gitlab-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/gitlab-exporter] action create (up to date)\\n      * ruby_block[wait for gitlab-exporter service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:25+00:00] INFO: ruby_block[restart_log_service] called\\n      - execute the ruby block restart_log_service\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/gitlab-exporter] action create (up to date)\\n    * ruby_block[wait for gitlab-exporter service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)\\n  \\n  * consul_service[gitlab-exporter] action delete\\n    * file[/var/opt/gitlab/consul/config.d/gitlab-exporter-service.json] action delete (up to date)\\n     (up to date)\\nRecipe: monitoring::redis-exporter\\n  * directory[/var/log/gitlab/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: directory[/var/log/gitlab/redis-exporter] created directory /var/log/gitlab/redis-exporter\\n\\n    - create new directory /var/log/gitlab/redis-exporter[2025-08-04T10:23:25+00:00] INFO: directory[/var/log/gitlab/redis-exporter] owner changed to 993\\n[2025-08-04T10:23:25+00:00] INFO: directory[/var/log/gitlab/redis-exporter] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-redis'\\n    - restore selinux security context\\n  * directory[/opt/gitlab/etc/redis-exporter/env] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] created directory /opt/gitlab/etc/redis-exporter/env\\n\\n    - create new directory /opt/gitlab/etc/redis-exporter/env[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] owner changed to 993\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-redis'\\n    - restore selinux security context\\n  * env_dir[/opt/gitlab/etc/redis-exporter/env] action create\\n    * directory[/opt/gitlab/etc/redis-exporter/env] action create (up to date)\\n    * file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR\\n\\n      - create new file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR\\n\\n      - update content in file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR from none to 4f45cf\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/redis-exporter/env/GODEBUG] action create[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/GODEBUG] created file /opt/gitlab/etc/redis-exporter/env/GODEBUG\\n\\n      - create new file /opt/gitlab/etc/redis-exporter/env/GODEBUG[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/GODEBUG] updated file contents /opt/gitlab/etc/redis-exporter/env/GODEBUG\\n\\n      - update content in file /opt/gitlab/etc/redis-exporter/env/GODEBUG from none to e6ab3f\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n  \\n  * service[redis-exporter] action nothing (skipped due to action :nothing)\\n  * runit_service[redis-exporter] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] created directory /opt/gitlab/sv/redis-exporter\\n\\n      - create new directory /opt/gitlab/sv/redis-exporter[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/redis-exporter/run] action create[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] created file /opt/gitlab/sv/redis-exporter/run\\n\\n      - create new file /opt/gitlab/sv/redis-exporter/run[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] updated file contents /opt/gitlab/sv/redis-exporter/run\\n\\n      - update content in file /opt/gitlab/sv/redis-exporter/run from none to a21d3f\\n      --- /opt/gitlab/sv/redis-exporter/run\\t2025-08-04 10:23:25.554400255 +0000\\n      +++ /opt/gitlab/sv/redis-exporter/.chef-run20250804-32489-46zoyf\\t2025-08-04 10:23:25.553400250 +0000\\n      @@ -1,8 +1,16 @@\\n      +#!/bin/sh\\n      +exec 2>&1\\n      +\\n      +umask 077\\n      +exec chpst  /opt/gitlab/etc/redis-exporter/env \\\\\\n      +  -U gitlab-redis:git \\\\\\n      +  -u gitlab-redis:git \\\\\\n      +  /opt/gitlab/embedded/bin/redis_exporter --web.listen-address=localhost:9121 --redis.addr=unix:///var/opt/gitlab/redis/redis.socket[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/redis-exporter/log] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] created directory /opt/gitlab/sv/redis-exporter/log\\n\\n      - create new directory /opt/gitlab/sv/redis-exporter/log[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/redis-exporter/log/main] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] created directory /opt/gitlab/sv/redis-exporter/log/main\\n\\n      - create new directory /opt/gitlab/sv/redis-exporter/log/main[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/redis-exporter/log/config] action create[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] created file /opt/gitlab/sv/redis-exporter/log/config\\n\\n      - create new file /opt/gitlab/sv/redis-exporter/log/config[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] updated file contents /opt/gitlab/sv/redis-exporter/log/config\\n\\n      - update content in file /opt/gitlab/sv/redis-exporter/log/config from none to 623c00\\n      --- /opt/gitlab/sv/redis-exporter/log/config\\t2025-08-04 10:23:25.651400683 +0000\\n      +++ /opt/gitlab/sv/redis-exporter/log/.chef-config20250804-32489-jmycua\\t2025-08-04 10:23:25.650400679 +0000\\n      @@ -1,6 +1,12 @@\\n      +s209715200\\n      +n30\\n      +t86400\\n      +!gzip\\n      +\\n      +[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] mode changed to 644\\n\\n      - change mode from '' to '0644'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:25+00:00] INFO: ruby_block[verify_chown_persisted_on_redis-exporter] sent create action to ruby_block[verify_chown_persisted_on_redis-exporter] (immediate at declaration time)\\n    * ruby_block[verify_chown_persisted_on_redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: ruby_block[verify_chown_persisted_on_redis-exporter] called\\n\\n      - execute the ruby block verify_chown_persisted_on_redis-exporter\\n    * link[/var/log/gitlab/redis-exporter/config] action create[2025-08-04T10:23:25+00:00] INFO: link[/var/log/gitlab/redis-exporter/config] created\\n\\n      - create symlink at /var/log/gitlab/redis-exporter/config to /opt/gitlab/sv/redis-exporter/log/config\\n    * template[/opt/gitlab/sv/redis-exporter/log/run] action create[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] created file /opt/gitlab/sv/redis-exporter/log/run\\n\\n      - create new file /opt/gitlab/sv/redis-exporter/log/run[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] updated file contents /opt/gitlab/sv/redis-exporter/log/run\\n\\n      - update content in file /opt/gitlab/sv/redis-exporter/log/run from none to 2dc23f\\n      --- /opt/gitlab/sv/redis-exporter/log/run\\t2025-08-04 10:23:25.690400856 +0000\\n      +++ /opt/gitlab/sv/redis-exporter/log/.chef-run20250804-32489-lehtsz\\t2025-08-04 10:23:25.689400851 +0000\\n      @@ -1,5 +1,10 @@\\n      +#!/bin/sh\\n      +exec chpst       +  -U root:root \\\\\\n      +  -u root:root \\\\\\n      +  svlogd -tt /var/log/gitlab/redis-exporter[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/redis-exporter/env] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] created directory /opt/gitlab/sv/redis-exporter/env\\n\\n      - create new directory /opt/gitlab/sv/redis-exporter/env[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/redis-exporter/control] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] created directory /opt/gitlab/sv/redis-exporter/control\\n\\n      - create new directory /opt/gitlab/sv/redis-exporter/control[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] owner changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] group changed to 0\\n[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * link[/opt/gitlab/init/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: link[/opt/gitlab/init/redis-exporter] created\\n\\n      - create symlink at /opt/gitlab/init/redis-exporter to /opt/gitlab/embedded/bin/sv\\n    * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] sending run action to ruby_block[restart_service] (delayed)\\n    * ruby_block[restart_service] action run (skipped due to only_if)\\n[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)\\n    * ruby_block[reload_log_service] action create\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/redis-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/redis-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/redis-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/redis-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/redis-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/redis-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/redis-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: link[/opt/gitlab/service/redis-exporter] created\\n\\n        - create symlink at /opt/gitlab/service/redis-exporter to /opt/gitlab/sv/redis-exporter\\n      * ruby_block[wait for redis-exporter service socket] action run[2025-08-04T10:23:29+00:00] INFO: ruby_block[wait for redis-exporter service socket] called\\n\\n        - execute the ruby block wait for redis-exporter service socket\\n      * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:29+00:00] INFO: ruby_block[reload_log_service] called\\n      - execute the ruby block reload_log_service\\n[2025-08-04T10:23:29+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)\\n    * ruby_block[restart_log_service] action run\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/redis-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/redis-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/redis-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/redis-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/redis-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/redis-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/redis-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/redis-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/redis-exporter] action create (up to date)\\n      * ruby_block[wait for redis-exporter service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:31+00:00] INFO: ruby_block[restart_log_service] called\\n      - execute the ruby block restart_log_service\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/redis-exporter] action create (up to date)\\n    * ruby_block[wait for redis-exporter service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)\\n  \\n  * consul_service[redis-exporter] action delete\\n    * file[/var/opt/gitlab/consul/config.d/redis-exporter-service.json] action delete (up to date)\\n     (up to date)\\nRecipe: monitoring::prometheus\\n  * directory[/var/opt/gitlab/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus] created directory /var/opt/gitlab/prometheus\\n\\n    - create new directory /var/opt/gitlab/prometheus[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus] owner changed to 990\\n[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus] mode changed to 750\\n\\n    - change mode from '' to '0750'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * directory[/var/opt/gitlab/prometheus/rules] action create[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] created directory /var/opt/gitlab/prometheus/rules\\n\\n    - create new directory /var/opt/gitlab/prometheus/rules[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] owner changed to 990\\n[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] mode changed to 750\\n\\n    - change mode from '' to '0750'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * directory[/var/log/gitlab/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: directory[/var/log/gitlab/prometheus] created directory /var/log/gitlab/prometheus\\n\\n    - create new directory /var/log/gitlab/prometheus[2025-08-04T10:23:31+00:00] INFO: directory[/var/log/gitlab/prometheus] owner changed to 990\\n[2025-08-04T10:23:31+00:00] INFO: directory[/var/log/gitlab/prometheus] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * directory[/opt/gitlab/etc/prometheus/env] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] created directory /opt/gitlab/etc/prometheus/env\\n\\n    - create new directory /opt/gitlab/etc/prometheus/env[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] owner changed to 990\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * env_dir[/opt/gitlab/etc/prometheus/env] action create\\n    * directory[/opt/gitlab/etc/prometheus/env] action create (up to date)\\n    * file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] action create[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] created file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR\\n\\n      - create new file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR\\n\\n      - update content in file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR from none to 4f45cf\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/prometheus/env/GODEBUG] action create[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/GODEBUG] created file /opt/gitlab/etc/prometheus/env/GODEBUG\\n\\n      - create new file /opt/gitlab/etc/prometheus/env/GODEBUG[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/GODEBUG] updated file contents /opt/gitlab/etc/prometheus/env/GODEBUG\\n\\n      - update content in file /opt/gitlab/etc/prometheus/env/GODEBUG from none to e6ab3f\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n  \\n  * execute[reload prometheus] action nothing (skipped due to action :nothing)\\n  * file[Prometheus config] action create[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] created file /var/opt/gitlab/prometheus/prometheus.yml\\n\\n    - create new file /var/opt/gitlab/prometheus/prometheus.yml[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] updated file contents /var/opt/gitlab/prometheus/prometheus.yml\\n\\n    - update content in file /var/opt/gitlab/prometheus/prometheus.yml from none to 0fbf9e\\n    --- /var/opt/gitlab/prometheus/prometheus.yml\\t2025-08-04 10:23:31.504426537 +0000\\n    +++ /var/opt/gitlab/prometheus/.chef-prometheus20250804-32489-vpjgps.yml\\t2025-08-04 10:23:31.504426537 +0000\\n    @@ -1,171 +1,342 @@\\n    +---\\n    +global:\\n    +  scrape_interval: 15s\\n    +  scrape_timeout: 15s\\n    +  external_labels: {}\\n    +remote_read: []\\n    +remote_write: []\\n    +rule_files:\\n    +- \\"/var/opt/gitlab/prometheus/rules/*.rules\\"\\n    +scrape_configs:\\n    +- job_name: prometheus\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9090\\n    +- job_name: nginx\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:8060\\n    +- job_name: redis\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9121\\n    +- job_name: postgres\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9187\\n    +- job_name: node\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9100\\n    +- job_name: gitlab-workhorse\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9229\\n    +- job_name: gitlab-rails\\n    +  metrics_path: \\"/-/metrics\\"\\n    +  static_configs:\\n    +  - targets:\\n    +    - 127.0.0.1:8080\\n    +  relabel_configs:\\n    +  - source_labels:\\n    +    - __address__\\n    +    regex: 127.0.0.1:(.*)\\n    +    replacement: localhost:$1\\n    +    target_label: instance\\n    +- job_name: gitlab-sidekiq\\n    +  static_configs:\\n    +  - targets:\\n    +    - 127.0.0.1:8082\\n    +  relabel_configs:\\n    +  - source_labels:\\n    +    - __address__\\n    +    regex: 127.0.0.1:(.*)\\n    +    replacement: localhost:$1\\n    +    target_label: instance\\n    +- job_name: gitlab_exporter_database\\n    +  metrics_path: \\"/database\\"\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9168\\n    +- job_name: gitlab_exporter_sidekiq\\n    +  metrics_path: \\"/sidekiq\\"\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9168\\n    +- job_name: gitlab_exporter_ruby\\n    +  metrics_path: \\"/ruby\\"\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9168\\n    +- job_name: gitaly\\n    +  static_configs:\\n    +  - targets:\\n    +    - localhost:9236\\n    +- job_name: kubernetes-cadvisor\\n    +  scheme: https\\n    +  tls_config:\\n    +    ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"\\n    +    insecure_skip_verify: true\\n    +  bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"\\n    +  kubernetes_sd_configs:\\n    +  - role: node\\n    +    api_server: https://kubernetes.default.svc:443\\n    +    tls_config:\\n    +      ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"\\n    +    bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"\\n    +  relabel_configs:\\n    +  - action: labelmap\\n    +    regex: __meta_kubernetes_node_label_(.+)\\n    +  - target_label: __address__\\n    +    replacement: kubernetes.default.svc:443\\n    +  - source_labels:\\n    +    - __meta_kubernetes_node_name\\n    +    regex: \\"(.+)\\"\\n    +    target_label: __metrics_path__\\n    +    replacement: \\"/api/v1/nodes/${1}/proxy/metrics/cadvisor\\"\\n    +  metric_relabel_configs:\\n    +  - source_labels:\\n    +    - pod_name\\n    +    target_label: environment\\n    +    regex: \\"(.+)-.+-.+\\"\\n    +- job_name: kubernetes-nodes\\n    +  scheme: https\\n    +  tls_config:\\n    +    ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"\\n    +    insecure_skip_verify: true\\n    +  bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"\\n    +  kubernetes_sd_configs:\\n    +  - role: node\\n    +    api_server: https://kubernetes.default.svc:443\\n    +    tls_config:\\n    +      ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"\\n    +    bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"\\n    +  relabel_configs:\\n    +  - action: labelmap\\n    +    regex: __meta_kubernetes_node_label_(.+)\\n    +  - target_label: __address__\\n    +    replacement: kubernetes.default.svc:443\\n    +  - source_labels:\\n    +    - __meta_kubernetes_node_name\\n    +    regex: \\"(.+)\\"\\n    +    target_label: __metrics_path__\\n    +    replacement: \\"/api/v1/nodes/${1}/proxy/metrics\\"\\n    +  metric_relabel_configs:\\n    +  - source_labels:\\n    +    - pod_name\\n    +    target_label: environment\\n    +    regex: \\"(.+)-.+-.+\\"\\n    +- job_name: kubernetes-pods\\n    +  tls_config:\\n    +    ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"\\n    +    insecure_skip_verify: true\\n    +  bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"\\n    +  kubernetes_sd_configs:\\n    +  - role: pod\\n    +    api_server: https://kubernetes.default.svc:443\\n    +    tls_config:\\n    +      ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"\\n    +    bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"\\n    +  relabel_configs:\\n    +  - source_labels:\\n    +    - __meta_kubernetes_pod_annotation_prometheus_io_scrape\\n    +    action: keep\\n    +    regex: 'true'\\n    +  - source_labels:\\n    +    - __meta_kubernetes_pod_annotation_prometheus_io_path\\n    +    action: replace\\n    +    target_label: __metrics_path__\\n    +    regex: \\"(.+)\\"\\n    +  - source_labels:\\n    +    - __address__\\n    +    - __meta_kubernetes_pod_annotation_prometheus_io_port\\n    +    action: replace\\n    +    regex: \\"([^:]+)(?::[0-9]+)?;([0-9]+)\\"\\n    +    replacement: \\"$1:$2\\"\\n    +    target_label: __address__\\n    +  - action: labelmap\\n    +    regex: __meta_kubernetes_pod_label_(.+)\\n    +  - source_labels:\\n    +    - __meta_kubernetes_namespace\\n    +    action: replace\\n    +    target_label: kubernetes_namespace\\n    +  - source_labels:\\n    +    - __meta_kubernetes_pod_name\\n    +    action: replace\\n    +    target_label: kubernetes_pod_name\\n    +alerting:\\n    +  alertmanagers:\\n    +  - static_configs:\\n    +    - targets:\\n    +      - localhost:9093[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] owner changed to 990\\n[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] mode changed to 644\\n\\n    - change mode from '' to '0644'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * service[prometheus] action nothing (skipped due to action :nothing)\\n  * runit_service[prometheus] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] created directory /opt/gitlab/sv/prometheus\\n\\n      - create new directory /opt/gitlab/sv/prometheus[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/prometheus/run] action create[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] created file /opt/gitlab/sv/prometheus/run\\n\\n      - create new file /opt/gitlab/sv/prometheus/run[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] updated file contents /opt/gitlab/sv/prometheus/run\\n\\n      - update content in file /opt/gitlab/sv/prometheus/run from none to 60f91b\\n      --- /opt/gitlab/sv/prometheus/run\\t2025-08-04 10:23:31.582426882 +0000\\n      +++ /opt/gitlab/sv/prometheus/.chef-run20250804-32489-gukat7\\t2025-08-04 10:23:31.582426882 +0000\\n      @@ -1,8 +1,16 @@\\n      +#!/bin/sh\\n      +exec 2>&1\\n      +\\n      +umask 077\\n      +exec chpst  /opt/gitlab/etc/prometheus/env \\\\\\n      +  -U gitlab-prometheus:gitlab-prometheus \\\\\\n      +  -u gitlab-prometheus:gitlab-prometheus \\\\\\n      +  /opt/gitlab/embedded/bin/prometheus --web.listen-address=localhost:9090 --storage.tsdb.path=/var/opt/gitlab/prometheus/data --config.file=/var/opt/gitlab/prometheus/prometheus.yml[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/prometheus/log] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] created directory /opt/gitlab/sv/prometheus/log\\n\\n      - create new directory /opt/gitlab/sv/prometheus/log[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/prometheus/log/main] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] created directory /opt/gitlab/sv/prometheus/log/main\\n\\n      - create new directory /opt/gitlab/sv/prometheus/log/main[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/prometheus/log/config] action create[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] created file /opt/gitlab/sv/prometheus/log/config\\n\\n      - create new file /opt/gitlab/sv/prometheus/log/config[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] updated file contents /opt/gitlab/sv/prometheus/log/config\\n\\n      - update content in file /opt/gitlab/sv/prometheus/log/config from none to 623c00\\n      --- /opt/gitlab/sv/prometheus/log/config\\t2025-08-04 10:23:31.677427301 +0000\\n      +++ /opt/gitlab/sv/prometheus/log/.chef-config20250804-32489-nv28cb\\t2025-08-04 10:23:31.676427297 +0000\\n      @@ -1,6 +1,12 @@\\n      +s209715200\\n      +n30\\n      +t86400\\n      +!gzip\\n      +\\n      +[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] mode changed to 644\\n\\n      - change mode from '' to '0644'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:31+00:00] INFO: ruby_block[verify_chown_persisted_on_prometheus] sent create action to ruby_block[verify_chown_persisted_on_prometheus] (immediate at declaration time)\\n    * ruby_block[verify_chown_persisted_on_prometheus] action create[2025-08-04T10:23:31+00:00] INFO: ruby_block[verify_chown_persisted_on_prometheus] called\\n\\n      - execute the ruby block verify_chown_persisted_on_prometheus\\n    * link[/var/log/gitlab/prometheus/config] action create[2025-08-04T10:23:31+00:00] INFO: link[/var/log/gitlab/prometheus/config] created\\n\\n      - create symlink at /var/log/gitlab/prometheus/config to /opt/gitlab/sv/prometheus/log/config\\n    * template[/opt/gitlab/sv/prometheus/log/run] action create[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] created file /opt/gitlab/sv/prometheus/log/run\\n\\n      - create new file /opt/gitlab/sv/prometheus/log/run[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] updated file contents /opt/gitlab/sv/prometheus/log/run\\n\\n      - update content in file /opt/gitlab/sv/prometheus/log/run from none to 8afdb7\\n      --- /opt/gitlab/sv/prometheus/log/run\\t2025-08-04 10:23:31.715427469 +0000\\n      +++ /opt/gitlab/sv/prometheus/log/.chef-run20250804-32489-dlluuf\\t2025-08-04 10:23:31.715427469 +0000\\n      @@ -1,5 +1,10 @@\\n      +#!/bin/sh\\n      +exec chpst       +  -U root:root \\\\\\n      +  -u root:root \\\\\\n      +  svlogd -tt /var/log/gitlab/prometheus[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/prometheus/env] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] created directory /opt/gitlab/sv/prometheus/env\\n\\n      - create new directory /opt/gitlab/sv/prometheus/env[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/prometheus/control] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] created directory /opt/gitlab/sv/prometheus/control\\n\\n      - create new directory /opt/gitlab/sv/prometheus/control[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] owner changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] group changed to 0\\n[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * link[/opt/gitlab/init/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: link[/opt/gitlab/init/prometheus] created\\n\\n      - create symlink at /opt/gitlab/init/prometheus to /opt/gitlab/embedded/bin/sv\\n    * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] sending run action to ruby_block[restart_service] (delayed)\\n    * ruby_block[restart_service] action run (skipped due to only_if)\\n[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] sending create action to ruby_block[reload_log_service] (delayed)\\n    * ruby_block[reload_log_service] action create\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/prometheus] action create (up to date)\\n      * template[/opt/gitlab/sv/prometheus/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/prometheus/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/prometheus/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/prometheus/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/prometheus/config] action create (up to date)\\n      * template[/opt/gitlab/sv/prometheus/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/prometheus/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/prometheus/control] action create (up to date)\\n      * link[/opt/gitlab/init/prometheus] action create (up to date)\\n      * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: link[/opt/gitlab/service/prometheus] created\\n\\n        - create symlink at /opt/gitlab/service/prometheus to /opt/gitlab/sv/prometheus\\n      * ruby_block[wait for prometheus service socket] action run[2025-08-04T10:23:35+00:00] INFO: ruby_block[wait for prometheus service socket] called\\n\\n        - execute the ruby block wait for prometheus service socket\\n      * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:35+00:00] INFO: ruby_block[reload_log_service] called\\n      - execute the ruby block reload_log_service\\n[2025-08-04T10:23:35+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] sending run action to ruby_block[restart_log_service] (delayed)\\n    * ruby_block[restart_log_service] action run\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/prometheus] action create (up to date)\\n      * template[/opt/gitlab/sv/prometheus/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/prometheus/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/prometheus/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/prometheus/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/prometheus/config] action create (up to date)\\n      * template[/opt/gitlab/sv/prometheus/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/prometheus/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/prometheus/control] action create (up to date)\\n      * link[/opt/gitlab/init/prometheus] action create (up to date)\\n      * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/prometheus] action create (up to date)\\n      * ruby_block[wait for prometheus service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:37+00:00] INFO: ruby_block[restart_log_service] called\\n      - execute the ruby block restart_log_service\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/prometheus] action create (up to date)\\n    * ruby_block[wait for prometheus service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)\\n  \\n  * consul_service[prometheus] action delete\\n    * file[/var/opt/gitlab/consul/config.d/prometheus-service.json] action delete (up to date)\\n     (up to date)\\n  * template[/var/opt/gitlab/prometheus/rules/gitlab.rules] action create[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] created file /var/opt/gitlab/prometheus/rules/gitlab.rules\\n\\n    - create new file /var/opt/gitlab/prometheus/rules/gitlab.rules[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] updated file contents /var/opt/gitlab/prometheus/rules/gitlab.rules\\n\\n    - update content in file /var/opt/gitlab/prometheus/rules/gitlab.rules from none to a55956\\n    --- /var/opt/gitlab/prometheus/rules/gitlab.rules\\t2025-08-04 10:23:37.289452011 +0000\\n    +++ /var/opt/gitlab/prometheus/rules/.chef-gitlab20250804-32489-xolssl.rules\\t2025-08-04 10:23:37.288452007 +0000\\n    @@ -1,492 +1,984 @@\\n    +---\\n    +groups:\\n    +- name: GitLab\\n    +  rules:\\n    +  - record: instance:puma_utilization:ratio\\n    +    expr: >\\n    +      sum by (instance) (\\n    +        puma_active_connections\\n    +      ) /\\n    +      sum by (instance) (\\n    +        puma_max_threads\\n    +      )\\n    +  - record: job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m\\n    +    expr: >\\n    +      sum by (job, route, method, code) (\\n    +        rate(gitlab_workhorse_http_request_duration_seconds_count[5m])\\n    +      )\\n    +\\n    +  - alert: ServiceDown\\n    +    expr: avg_over_time(up[5m]) * 100 < 50\\n    +    annotations:\\n    +      description: The service {{ $labels.job }} instance {{ $labels.instance }} is\\n    +        not responding for more than 50% of the time for 5 minutes.\\n    +      summary: The service {{ $labels.job }} is not responding\\n    +  - alert: RedisDown\\n    +    expr: avg_over_time(redis_up[5m]) * 100 < 50\\n    +    annotations:\\n    +      description: The Redis service {{ $labels.job }} instance {{ $labels.instance\\n    +        }} is not responding for more than 50% of the time for 5 minutes.\\n    +      summary: The Redis service {{ $labels.job }} is not responding\\n    +  - alert: PostgresDown\\n    +    expr: avg_over_time(pg_up[5m]) * 100 < 50\\n    +    annotations:\\n    +      description: The Postgres service {{ $labels.job }} instance {{ $labels.instance\\n    +        }} is not responding for more than 50% of the time for 5 minutes.\\n    +      summary: The Postgres service {{ $labels.job }} is not responding\\n    +  - alert: PumaQueueing\\n    +    expr: avg_over_time(puma_queued_connections[30m]) > 1\\n    +    annotations:\\n    +      description: Puma instance {{ $labels.instance }} is queueing requests with\\n    +        an average of {{ $value | printf \\"%.1f\\" }} over the last 30 minutes.\\n    +      summary: Puma is queueing requests\\n    +  - alert: HighPumaUtilization\\n    +    expr: instance:puma_utilization:ratio * 100 > 90\\n    +    for: 60m\\n    +    annotations:\\n    +      description: Puma instance {{ $labels.instance }} has more than 90% thread utilization ({{ $value | printf \\"%.1f\\" }}%) over the last 60 minutes.\\n    +      summary: Puma is has high utilization\\n    +  - alert: SidekiqJobsQueuing\\n    +    expr: sum by (name) (sidekiq_queue_size) > 0\\n    +    for: 60m\\n    +    annotations:\\n    +      summary: Sidekiq has jobs queued\\n    +      description: Sidekiq queue {{ $labels.name }} has {{ $value }} jobs queued for 60 minutes.\\n    +  - alert: HighgRPCResourceExhaustedRate\\n    +    expr: >\\n    +      sum without (grpc_code, grpc_method, grpc_service, grpc_type) (\\n    +        rate(grpc_server_handled_total{grpc_code=\\"ResourceExhausted\\"}[5m])\\n    +      ) /\\n    +      sum without (grpc_code, grpc_method, grpc_service, grpc_type) (\\n    +        rate(grpc_server_handled_total[5m])\\n    +      ) * 100 > 1\\n    +    for: 60m\\n    +    annotations:\\n    +      summary: High gRPC ResourceExhausted error rate\\n    +      description: Job {{ $labels.job }} instance {{ $labels.instance }} gRPC is returning more than 1% ({{ $value | printf \\"%.1f\\" }}%) ResourceExhausted errors over the last 60 minutes.\\n    +  - alert: PostgresDatabaseDeadlocks\\n    +    expr: increase(pg_stat_database_deadlocks[5m]) > 0\\n    +    annotations:\\n    +      summary: Postgres database has deadlocks\\n    +      description: Postgres database {{ $labels.instance }} had {{ $value | printf \\"%d\\" }} deadlocks in the last 5 minutes.\\n    +  - alert: PostgresDatabaseDeadlockCancels\\n    +    expr: increase(pg_stat_database_deadlocks[5m]) > 0\\n    +    annotations:\\n    +      summary: Postgres database has queries canceled due to deadlocks\\n    +      description: Postgres database {{ $labels.instance }} had {{ $value | printf \\"%d\\" }} queries canceled due to deadlocks in the last 5 minutes.\\n    +  # Low-traffic - < 10 QPS (600 RPM)\\n    +  - alert: WorkhorseHighErrorRate\\n    +    expr: >\\n    +      (\\n    +        sum without (job, code) (\\n    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m{code=~\\"5..\\"}\\n    +        ) /\\n    +        sum without (job,code) (\\n    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m\\n    +        ) < 10\\n    +      ) * 100 > 50\\n    +    annotations:\\n    +      summary: Workhorse has high error rates\\n    +      description: Workhorse route {{ $labels.route }} method {{ $labels.method }} has more than 50% errors ({{ $value | printf \\"%.1f\\" }}%) for the last 60 minutes.\\n    +  # High-traffic - >= 10 QPS (600 RPM)\\n    +  - alert: WorkhorseHighErrorRate\\n    +    expr: >\\n    +      (\\n    +        sum without (job, code) (\\n    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m{code=~\\"5..\\"}\\n    +        ) /\\n    +        sum without (job,code) (\\n    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m\\n    +        ) > 10\\n    +      ) * 100 > 10\\n    +    annotations:\\n    +      summary: Workhorse has high error rates\\n    +      description: Workhorse route {{ $labels.route }} method {{ $labels.method }} has more than 10% errors ({{ $value | printf \\"%.1f\\" }}%) for the last 60 minutes.\\n    +\\n    +###\\n    +# These metrics are top-level GitLab Service Level Indicators (SLIs). They can\\n    +# be used to monitor the overall health of a GitLab instance.\\n    +- name: Service Level Indicators\\n    +  interval: 30s\\n    +  rules:\\n    +  # Service availability.\\n    +  - record: gitlab_sli:job:availability:ratio\\n    +    expr: >\\n    +      avg by (job) (\\n    +        avg_over_time(up[30s])\\n    +      )\\n    +  # Rails worker/thread capacity.\\n    +  - record: gitlab_sli:rails_active_connections:avg30s\\n    +    expr: >\\n    +      sum(avg_over_time(puma_active_connections[30s]))\\n    +  - record: gitlab_sli:rails_queued_connections:avg30s\\n    +    expr: >\\n    +      sum(avg_over_time(puma_queued_connections[30s]))\\n    +  - record: gitlab_sli:rails_active_connections:max30s\\n    +    expr: >\\n    +      sum(max_over_time(puma_active_connections[30s]))\\n    +  - record: gitlab_sli:rails_queued_connections:max30s\\n    +    expr: >\\n    +      sum(max_over_time(puma_queued_connections[30s]))\\n    +  - record: gitlab_sli:rails_workers:avg30s\\n    +    expr: >\\n    +      count(avg_over_time(ruby_memory_bytes[30s])) or\\n    +      sum(avg_over_time(puma_max_threads[30s]))\\n    +  # Redis CPU use.\\n    +  - record: gitlab_sli:redis_cpu_seconds:rate1m\\n    +    expr: >\\n    +      (sum(rate(redis_used_cpu_sys[1m])) + sum(rate(redis_used_cpu_user[1m]))) or\\n    +      (sum(rate(redis_cpu_sys_seconds_total[1m])) + sum(rate(redis_cpu_user_seconds_total[1m])))\\n    +  # Workhorse traffic.\\n    +  - record: gitlab_sli:code_method_route:workhorse_http_request_count:rate1m\\n    +    expr: >\\n    +      sum by (code,method,route) (\\n    +        rate(gitlab_workhorse_http_request_duration_seconds_count[1m])\\n    +      )\\n    +  - record: gitlab_sli:code_method_route:workhorse_http_request_duration_seconds:rate1m\\n    +    expr: >\\n    +      sum by (code,method,route) (\\n    +        rate(gitlab_workhorse_http_request_duration_seconds_sum[1m])\\n    +      )\\n    +# SLI - Apdex\\n    +- name: Service Level Indicators - Apdex\\n    +  interval: 1m\\n    +  rules:\\n    +  # Gitaly goserver\\n    +  # Satisfied -> 0.5 seconds\\n    +  # Acceptable -> 1 seconds\\n    +  - record: gitlab_sli:gitlab_component_apdex:ratio\\n    +    labels:\\n    +      job: gitaly\\n    +    expr: >\\n    +      (\\n    +        sum(rate(grpc_server_handling_seconds_bucket{job=\\"gitaly\\",grpc_type=\\"unary\\",le=\\"0.5\\",grpc_method!~\\"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef\\"}[1m]))\\n    +        +\\n    +        sum(rate(grpc_server_handling_seconds_bucket{job=\\"gitaly\\",grpc_type=\\"unary\\",le=\\"1\\",grpc_method!~\\"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef\\"}[1m]))\\n    +      )\\n    +      /\\n    +      2 / sum(rate(grpc_server_handling_seconds_count{job=\\"gitaly\\",grpc_type=\\"unary\\",grpc_method!~\\"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef\\"}[1m]))\\n    +  # Sidekiq TODO: https://gitlab.com/gitlab-org/gitlab-foss/issues/56752\\n    +  # - record: gitlab_sli:gitlab_component_apdex:ratio\\n    +  #   labels:\\n    +  #     job: gitlab-sidekiq\\n    +  #   expr: >\\n    +  #     (\\n    +  #       sum(rate(sidekiq_jobs_completion_time_seconds_bucket{le=\\"25\\"}[1m]))\\n    +  #       +\\n    +  #       sum(rate(sidekiq_jobs_completion_time_seconds_bucket{le=\\"50\\"}[1m]))\\n    +  #     )\\n    +  #     / 2\\n    +  #     /\\n    +  #     sum(rate(sidekiq_jobs_completion_time_seconds_count[1m]))\\n    +\\n    +  # Workhorse\\n    +  # Satisfied -> 1 seconds\\n    +  # Acceptable -> 10 seconds\\n    +  - record: gitlab_sli:gitlab_component_apdex:ratio\\n    +    labels:\\n    +      job: gitlab-workhorse\\n    +    expr: >\\n    +      (\\n    +        sum(rate(gitlab_workhorse_http_request_duration_seconds_bucket{le=\\"1\\",route!=\\"^/([^/]+/){1,}[^/]+/uploads\\\\\\\\z\\",route!=\\"^/api/v4/jobs/request\\\\\\\\z\\"}[1m]))\\n    +      +\\n    +        sum(rate(gitlab_workhorse_http_request_duration_seconds_bucket{le=\\"10\\",route!=\\"^/([^/]+/){1,}[^/]+/uploads\\\\\\\\z\\",route!=\\"^/api/v4/jobs/request\\\\\\\\z\\"}[1m]))\\n    +      )\\n    +      /\\n    +      2 / sum(rate(gitlab_workhorse_http_request_duration_seconds_count{route!=\\"^/([^/]+/){1,}[^/]+/uploads\\\\\\\\z\\",route!=\\"^/api/v4/jobs/request\\\\\\\\z\\"}[1m]))\\n    +\\n    +# SLI - Errors\\n    +- name: Service Level Indicators - Errors\\n    +  interval: 1m\\n    +  rules:\\n    +  # PostgreSQL\\n    +  - record: gitlab_sli:gitlab_component_ops:rate\\n    +    labels:\\n    +      job: postgres\\n    +    expr: >\\n    +      sum(rate(pg_stat_database_xact_commit[1m])) +\\n    +      sum(rate(pg_stat_database_xact_rollback[1m]))\\n    +  - record: gitlab_sli:gitlab_component_errors:rate\\n    +    labels:\\n    +      job: postgres\\n    +    expr: sum(rate(pg_stat_database_xact_rollback[1m]))\\n    +  # Rails (Puma)\\n    +  - record: gitlab_sli:gitlab_component_ops:rate\\n    +    labels:\\n    +      job: gitlab-rails\\n    +    expr: >\\n    +      sum(\\n    +        rate(http_request_duration_seconds_count{job=\\"gitlab-rails\\"}[1m])\\n    +      )\\n    +  - record: gitlab_sli:gitlab_component_errors:rate\\n    +    labels:\\n    +      job: gitlab-rails\\n    +    expr: >\\n    +      sum(\\n    +        rate(http_request_duration_seconds_count{job=\\"gitlab-rails\\",status=~\\"5..\\"}[1m])\\n    +      )\\n    +  # Sidekiq TODO: https://gitlab.com/gitlab-org/gitlab-foss/issues/56752\\n    +  # - record: gitlab_sli:gitlab_component_ops:rate\\n    +  #   labels:\\n    +  #     job: gitlab-sidekiq\\n    +  #   expr: >\\n    +  #     sum (\\n    +  #       rate(sidekiq_jobs_started_total{job=\\"gitlab-sidekiq\\"}[1m])\\n    +  #     )\\n    +  # - record: gitlab_sli:gitlab_component_errors:rate\\n    +  #   labels:\\n    +  #     job: gitlab-sidekiq\\n    +  #   expr: >\\n    +  #     sum (\\n    +  #       rate(sidekiq_jobs_failed_total{job=\\"gitlab-sidekiq\\"}[1m])\\n    +  #     )\\n    +  # Workhorse\\n    +  - record: gitlab_sli:gitlab_component_ops:rate\\n    +    labels:\\n    +      job: gitlab-workhorse\\n    +    expr: >\\n    +      sum(\\n    +        rate(gitlab_workhorse_http_requests_total{job=\\"gitlab-workhorse\\"}[1m])\\n    +      )\\n    +  - record: gitlab_sli:gitlab_component_errors:rate\\n    +    labels:\\n    +      job: gitlab-workhorse\\n    +    expr: >\\n    +      sum(\\n    +        rate(gitlab_workhorse_http_requests_total{job=\\"gitlab-workhorse\\",code=~\\"5..\\"}[1m])\\n    +      )\\n    +  ###\\n    +  # Calculate service error ratios\\n    +  - record: gitlab_sli:gitlab_component_errors:ratio\\n    +    expr: >\\n    +      gitlab_sli:gitlab_component_errors:rate /\\n    +      gitlab_sli:gitlab_component_ops:rate\\n    +\\n    +- name: GitLab Saturation Ratios\\n    +  interval: 1m\\n    +  rules:\\n    +  # type: *, component: cpu\\n    +  # this measures average CPU across all the cores for the entire fleet for the given service\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'cpu'\\n    +    expr: >\\n    +      avg(1 - rate(node_cpu_seconds_total{mode=\\"idle\\"}[1m]))\\n    +\\n    +  # type: *, component: single_node_cpu\\n    +  # this measures the maximum cpu availability across all the codes on a single server\\n    +  # this can be helpful if CPU is not even distributed across the fleet.\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'single_node_cpu'\\n    +    expr: >\\n    +      max(\\n    +        avg(1 - rate(node_cpu_seconds_total{mode=\\"idle\\"}[1m]))\\n    +      )\\n    +\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'disk_space'\\n    +    expr: >\\n    +      max(\\n    +        (\\n    +          (\\n    +            node_filesystem_size_bytes{fstype=~\\"ext.|xfs|nfs.?\\"}\\n    +            -\\n    +            node_filesystem_free_bytes{fstype=~\\"ext.|xfs|nfs.?\\"}\\n    +          )\\n    +          /\\n    +          node_filesystem_size_bytes{fstype=~\\"ext.|xfs|nfs.?\\"}\\n    +        )\\n    +      )\\n    +\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'memory'\\n    +    expr: max (instance:node_memory_utilization:ratio)\\n    +\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'single_threaded_cpu'\\n    +    expr: >\\n    +      clamp_max(\\n    +        max (\\n    +         (rate(redis_cpu_user_seconds_total[1m]) + rate(redis_cpu_sys_seconds_total[1m])) or\\n    +         (rate(redis_used_cpu_user[1m]) + rate(redis_used_cpu_sys[1m]))\\n    +        ),\\n    +        1\\n    +      )\\n    +\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'connection_pool'\\n    +    expr: >\\n    +      clamp_max(\\n    +        max(\\n    +          max_over_time(pgbouncer_pools_server_active_connections{user=\\"gitlab\\"}[1m]) /\\n    +          (\\n    +            (\\n    +              pgbouncer_pools_server_idle_connections{user=\\"gitlab\\"} +\\n    +              pgbouncer_pools_server_active_connections{user=\\"gitlab\\"} +\\n    +              pgbouncer_pools_server_testing_connections{user=\\"gitlab\\"} +\\n    +              pgbouncer_pools_server_used_connections{user=\\"gitlab\\"} +\\n    +              pgbouncer_pools_server_login_connections{user=\\"gitlab\\"}\\n    +            )\\n    +            > 0\\n    +          )\\n    +      ), 1)\\n    +\\n    +  # type: postgres-delayed, postgres-archive, patroni\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'active_db_connections'\\n    +    expr: >\\n    +      clamp_max(\\n    +        max(\\n    +          sum without(state) (pg_stat_activity_count{datname=\\"gitlabhq_production\\", state!=\\"idle\\"})\\n    +          /\\n    +          (sum without(state) (pg_stat_activity_count{datname=\\"gitlabhq_production\\"}) > 0)\\n    +      ), 1)\\n    +\\n    +  # type: redis, redis-cache, component: redis_clients\\n    +  # Records the saturation of redis client connections against a redis fleet\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'redis_clients'\\n    +    expr: >\\n    +      max(\\n    +        max_over_time(redis_connected_clients[1m])\\n    +        /\\n    +        redis_config_maxclients\\n    +      )\\n    +\\n    +  # Aggregate over all components within a service using max\\n    +  - record: gitlab_sli:gitlab_service_saturation:ratio\\n    +    expr: >\\n    +      max by (component) (gitlab_sli:gitlab_component_saturation:ratio)\\n    +\\n    +  # Calculate the \\"sapdex\\" - the saturation apdex for the metric. 1 < less then soft limit, 0.5 < hard limit, else 0\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex\\n    +    expr: >\\n    +      clamp_min(gitlab_sli:gitlab_component_saturation:ratio <= on(component) group_left slo:max:soft:gitlab_sli:gitlab_component_saturation:ratio, 1)\\n    +      or\\n    +      clamp_min(clamp_max(gitlab_sli:gitlab_component_saturation:ratio > on(component) group_left slo:max:soft:gitlab_sli:gitlab_component_saturation:ratio, 0.5), 0.5)\\n    +      or\\n    +      clamp_max(gitlab_sli:gitlab_component_saturation:ratio > on(component) group_left slo:max:hard:gitlab_sli:gitlab_component_saturation:ratio, 0)\\n    +\\n    +  # Open file descriptors\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'open_fds'\\n    +    expr: >\\n    +      max(\\n    +        max_over_time(process_open_fds[1m])\\n    +        /\\n    +        max_over_time(process_max_fds[1m])\\n    +      )\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio\\n    +    labels:\\n    +      component: 'open_ruby_fds'\\n    +    expr: >\\n    +      max(\\n    +        max_over_time(ruby_file_descriptors[1m])\\n    +        /\\n    +        max_over_time(ruby_process_max_fds[1m])\\n    +      )\\n    +\\n    +# Unlike other service metrics, we record the stats for each component independently\\n    +- name: GitLab Saturation Ratios Stats\\n    +  interval: 5m\\n    +  rules:\\n    +  # Average values for each service, over a week\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w\\n    +    expr: >\\n    +      avg_over_time(gitlab_sli:gitlab_component_saturation:ratio[1w])\\n    +\\n    +  # Using linear week-on-week growth, what prediction to we have for 2w from now?\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio:predict_linear_2w\\n    +    expr: >\\n    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w[1w], 86400 * 14)\\n    +\\n    +  # Using linear week-on-week growth, what prediction to we have for 30d from now?\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio:predict_linear_30d\\n    +    expr: >\\n    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w[1w], 86400 * 30)\\n    +\\n    +  # Sapdex, average for week\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w\\n    +    expr: >\\n    +      avg_over_time(gitlab_sli:gitlab_component_saturation:ratio:sapdex[1w])\\n    +\\n    +  # Sapdex long term trend forecasting\\n    +  # Using linear week-on-week growth, what prediction to we have for 30d from now?\\n    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w:predict_linear_30d\\n    +    expr: >\\n    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w[1w], 86400 * 30)\\n    +\\n    +###\\n    +# Metrics used by Usage Ping reports. These are primarily for self-managed installations.\\n    +# See https://docs.gitlab.com/ee/development/telemetry/usage_ping.html#prometheus-queries\\n    +#\\n    +- name: GitLab Usage Ping\\n    +  interval: 5m\\n    +  rules:\\n    +  ###\\n    +  # Application wide metrics\\n    +  #\\n    +  - record: gitlab_usage_ping:ops:rate5m\\n    +    labels:\\n    +      service: workhorse\\n    +      component: http_requests\\n    +    expr: sum (rate (gitlab_workhorse_http_requests_total[5m]))\\n    +\\n    +  # Database Primary Performance Indicator: Query apdex\\n    +  # Target -> 100ms\\n    +  # Tolerable -> 250ms\\n    +  - record: gitlab_usage_ping:sql_duration_apdex:ratio_rate5m\\n    +    expr: >\\n    +      (\\n    +        sum(rate(gitlab_sql_duration_seconds_bucket{le=\\"0.1\\"}[5m]))\\n    +        +\\n    +        sum(rate(gitlab_sql_duration_seconds_bucket{le=\\"0.25\\"}[5m]))\\n    +      )\\n    +      /\\n    +      2\\n    +      /\\n    +      (\\n    +        sum(rate(gitlab_sql_duration_seconds_count[5m])) > 0\\n    +      )\\n    +\\n    +  - record: gitlab_usage_ping:gitaly_apdex:ratio_avg_over_time_5m\\n    +    expr: avg_over_time(gitlab_sli:gitlab_component_apdex:ratio{job=\\"gitaly\\"}[5m])\\n    +\\n    +  ###\\n    +  # Node level metrics\\n    +  #\\n    +  - record: gitlab_usage_ping:node_cpus:count\\n    +    expr: max (instance:node_cpus:count) by (instance)\\n    +  - record: gitlab_usage_ping:node_memory_total_bytes:max\\n    +    expr: max (node_memory_MemTotal_bytes) by (instance)\\n    +  - record: gitlab_usage_ping:node_cpu_utilization:avg\\n    +    expr: avg (instance:node_cpu_utilization:ratio) by (instance)\\n    +  - record: gitlab_usage_ping:node_memory_utilization:avg\\n    +    expr: avg (instance:node_memory_utilization:ratio) by (instance)\\n    +\\n    +  ###\\n    +  # Service level metrics\\n    +  #\\n    +  - record: gitlab_usage_ping:node_service_process_resident_memory_bytes:avg\\n    +    expr: avg by (instance, job) ({__name__ =~ \\"(ruby_){0,1}process_resident_memory_bytes\\", job != \\"gitlab_exporter_process\\"})\\n    +  - record: gitlab_usage_ping:node_service_process_unique_memory_bytes:avg\\n    +    expr: avg by (instance, job) ({__name__ =~ \\"(ruby_){0,1}process_unique_memory_bytes\\", job != \\"gitlab_exporter_process\\"})\\n    +  - record: gitlab_usage_ping:node_service_process_proportional_memory_bytes:avg\\n    +    expr: avg by (instance, job) ({__name__ =~ \\"(ruby_){0,1}process_proportional_memory_bytes\\", job != \\"gitlab_exporter_process\\"})\\n    +  - record: gitlab_usage_ping:node_service_process:count\\n    +    expr: >\\n    +      count by (instance, job) (\\n    +        {__name__ =~ \\"(ruby_){0,1}process_start_time_seconds\\", job != \\"gitlab_exporter_process\\"}\\n    +      )\\n    +  - record: gitlab_usage_ping:node_service_app_server_workers:sum\\n    +    labels:\\n    +      server: puma\\n    +    expr: sum by (instance, job) (puma_workers)[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] owner changed to 990\\n[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] mode changed to 644\\n\\n    - change mode from '' to '0644'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] not queuing delayed action run on execute[reload prometheus] (delayed), as it's already been queued\\n  * template[/var/opt/gitlab/prometheus/rules/node.rules] action create[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] created file /var/opt/gitlab/prometheus/rules/node.rules\\n\\n    - create new file /var/opt/gitlab/prometheus/rules/node.rules[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] updated file contents /var/opt/gitlab/prometheus/rules/node.rules\\n\\n    - update content in file /var/opt/gitlab/prometheus/rules/node.rules from none to bea78d\\n    --- /var/opt/gitlab/prometheus/rules/node.rules\\t2025-08-04 10:23:37.399452471 +0000\\n    +++ /var/opt/gitlab/prometheus/rules/.chef-node20250804-32489-y3xjjw.rules\\t2025-08-04 10:23:37.399452471 +0000\\n    @@ -1,42 +1,84 @@\\n    +groups:\\n    +- name: Node\\n    +  rules:\\n    +  - record: instance:node_cpus:count\\n    +    expr: count without(cpu, mode) (node_cpu{mode=\\"idle\\"})\\n    +  - record: instance:node_cpus:count\\n    +    expr: count without(cpu, mode) (node_cpu_seconds_total{mode=\\"idle\\"})\\n    +  - record: instance_cpu:node_cpu_seconds_not_idle:rate5m\\n    +    expr: sum without(mode) (rate(node_cpu{mode!=\\"idle\\"}[5m]))\\n    +  - record: instance_cpu:node_cpu_seconds_not_idle:rate5m\\n    +    expr: sum without(mode) (rate(node_cpu_seconds_total{mode!=\\"idle\\"}[5m]))\\n    +  - record: instance_mode:node_cpu_seconds:rate5m\\n    +    expr: sum without(cpu) (rate(node_cpu[5m]))\\n    +  - record: instance_mode:node_cpu_seconds:rate5m\\n    +    expr: sum without(cpu) (rate(node_cpu_seconds_total[5m]))\\n    +  - record: instance:node_cpu_utilization:ratio\\n    +    expr: sum without(mode) (instance_mode:node_cpu_seconds:rate5m{mode!=\\"idle\\"})\\n    +      / instance:node_cpus:count\\n    +  - record: instance:node_memory_utilization:ratio\\n    +    expr: >\\n    +      1 - (\\n    +        node_memory_MemAvailable_bytes or\\n    +         (node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)\\n    +      ) / node_memory_MemTotal_bytes\\n    +  - record: instance:node_filesystem_avail:ratio\\n    +    expr: node_filesystem_avail_bytes / (node_filesystem_size_bytes > 0)\\n    +  - alert: FilesystemAlmostFull\\n    +    expr: instance:node_filesystem_avail:ratio * 100 < 5 and node_filesystem_avail_bytes < 10 * 1024 * 1024 * 1024\\n    +    for: 10m\\n    +    annotations:\\n    +      description: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} on\\n    +        {{ $labels.instance }} has {{ $value | printf \\"%.2f\\" }}% space available.\\n    +      summary: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} is almost\\n    +        full\\n    +  - alert: FilesystemFullIn1Day\\n    +    expr: predict_linear(node_filesystem_avail_bytes[6h], 24 * 3600) < 0\\n    +    for: 30m\\n    +    annotations:\\n    +      description: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} on\\n    +        {{ $labels.instance }} will be full in the next 24 hours.\\n    +      summary: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} will be\\n    +        full within 24 hours[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] owner changed to 990\\n[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] mode changed to 644\\n\\n    - change mode from '' to '0644'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] not queuing delayed action run on execute[reload prometheus] (delayed), as it's already been queued\\nRecipe: monitoring::alertmanager\\n  * directory[/var/opt/gitlab/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: directory[/var/opt/gitlab/alertmanager] created directory /var/opt/gitlab/alertmanager\\n\\n    - create new directory /var/opt/gitlab/alertmanager[2025-08-04T10:23:37+00:00] INFO: directory[/var/opt/gitlab/alertmanager] owner changed to 990\\n[2025-08-04T10:23:37+00:00] INFO: directory[/var/opt/gitlab/alertmanager] mode changed to 750\\n\\n    - change mode from '' to '0750'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * directory[/var/log/gitlab/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: directory[/var/log/gitlab/alertmanager] created directory /var/log/gitlab/alertmanager\\n\\n    - create new directory /var/log/gitlab/alertmanager[2025-08-04T10:23:37+00:00] INFO: directory[/var/log/gitlab/alertmanager] owner changed to 990\\n[2025-08-04T10:23:37+00:00] INFO: directory[/var/log/gitlab/alertmanager] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * directory[/opt/gitlab/etc/alertmanager/env] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] created directory /opt/gitlab/etc/alertmanager/env\\n\\n    - create new directory /opt/gitlab/etc/alertmanager/env[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] owner changed to 990\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n  * env_dir[/opt/gitlab/etc/alertmanager/env] action create\\n    * directory[/opt/gitlab/etc/alertmanager/env] action create (up to date)\\n    * file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] action create[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] created file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR\\n\\n      - create new file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR\\n\\n      - update content in file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR from none to 4f45cf\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/alertmanager/env/GODEBUG] action create[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/GODEBUG] created file /opt/gitlab/etc/alertmanager/env/GODEBUG\\n\\n      - create new file /opt/gitlab/etc/alertmanager/env/GODEBUG[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/GODEBUG] updated file contents /opt/gitlab/etc/alertmanager/env/GODEBUG\\n\\n      - update content in file /opt/gitlab/etc/alertmanager/env/GODEBUG from none to e6ab3f\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n  \\n  * file[Alertmanager config] action create[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] created file /var/opt/gitlab/alertmanager/alertmanager.yml\\n\\n    - create new file /var/opt/gitlab/alertmanager/alertmanager.yml[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] updated file contents /var/opt/gitlab/alertmanager/alertmanager.yml\\n\\n    - update content in file /var/opt/gitlab/alertmanager/alertmanager.yml from none to 21b7be\\n    - suppressed sensitive resource[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] owner changed to 990\\n[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] mode changed to 644\\n\\n    - change mode from '' to '0644'\\n    - change owner from '' to 'gitlab-prometheus'\\n    - restore selinux security context\\n[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] not queuing delayed action restart on runit_service[alertmanager] (delayed), as it's already been queued\\n  * service[alertmanager] action nothing (skipped due to action :nothing)\\n  * runit_service[alertmanager] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] created directory /opt/gitlab/sv/alertmanager\\n\\n      - create new directory /opt/gitlab/sv/alertmanager[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/alertmanager/run] action create[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] created file /opt/gitlab/sv/alertmanager/run\\n\\n      - create new file /opt/gitlab/sv/alertmanager/run[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] updated file contents /opt/gitlab/sv/alertmanager/run\\n\\n      - update content in file /opt/gitlab/sv/alertmanager/run from none to 36da8b\\n      --- /opt/gitlab/sv/alertmanager/run\\t2025-08-04 10:23:37.674453623 +0000\\n      +++ /opt/gitlab/sv/alertmanager/.chef-run20250804-32489-tkn1h\\t2025-08-04 10:23:37.674453623 +0000\\n      @@ -1,8 +1,16 @@\\n      +#!/bin/sh\\n      +exec 2>&1\\n      +\\n      +umask 077\\n      +exec chpst  /opt/gitlab/etc/alertmanager/env \\\\\\n      +  -U gitlab-prometheus:gitlab-prometheus \\\\\\n      +  -u gitlab-prometheus:gitlab-prometheus \\\\\\n      +  /opt/gitlab/embedded/bin/alertmanager --web.listen-address=localhost:9093 --storage.path=/var/opt/gitlab/alertmanager/data --config.file=/var/opt/gitlab/alertmanager/alertmanager.yml[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/alertmanager/log] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] created directory /opt/gitlab/sv/alertmanager/log\\n\\n      - create new directory /opt/gitlab/sv/alertmanager/log[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/alertmanager/log/main] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] created directory /opt/gitlab/sv/alertmanager/log/main\\n\\n      - create new directory /opt/gitlab/sv/alertmanager/log/main[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/alertmanager/log/config] action create[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] created file /opt/gitlab/sv/alertmanager/log/config\\n\\n      - create new file /opt/gitlab/sv/alertmanager/log/config[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] updated file contents /opt/gitlab/sv/alertmanager/log/config\\n\\n      - update content in file /opt/gitlab/sv/alertmanager/log/config from none to 623c00\\n      --- /opt/gitlab/sv/alertmanager/log/config\\t2025-08-04 10:23:37.773454037 +0000\\n      +++ /opt/gitlab/sv/alertmanager/log/.chef-config20250804-32489-hkke0c\\t2025-08-04 10:23:37.772454033 +0000\\n      @@ -1,6 +1,12 @@\\n      +s209715200\\n      +n30\\n      +t86400\\n      +!gzip\\n      +\\n      +[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] mode changed to 644\\n\\n      - change mode from '' to '0644'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:37+00:00] INFO: ruby_block[verify_chown_persisted_on_alertmanager] sent create action to ruby_block[verify_chown_persisted_on_alertmanager] (immediate at declaration time)\\n    * ruby_block[verify_chown_persisted_on_alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: ruby_block[verify_chown_persisted_on_alertmanager] called\\n\\n      - execute the ruby block verify_chown_persisted_on_alertmanager\\n    * link[/var/log/gitlab/alertmanager/config] action create[2025-08-04T10:23:37+00:00] INFO: link[/var/log/gitlab/alertmanager/config] created\\n\\n      - create symlink at /var/log/gitlab/alertmanager/config to /opt/gitlab/sv/alertmanager/log/config\\n    * template[/opt/gitlab/sv/alertmanager/log/run] action create[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] created file /opt/gitlab/sv/alertmanager/log/run\\n\\n      - create new file /opt/gitlab/sv/alertmanager/log/run[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] updated file contents /opt/gitlab/sv/alertmanager/log/run\\n\\n      - update content in file /opt/gitlab/sv/alertmanager/log/run from none to 9a4626\\n      --- /opt/gitlab/sv/alertmanager/log/run\\t2025-08-04 10:23:37.802454159 +0000\\n      +++ /opt/gitlab/sv/alertmanager/log/.chef-run20250804-32489-fwbbde\\t2025-08-04 10:23:37.801454155 +0000\\n      @@ -1,5 +1,10 @@\\n      +#!/bin/sh\\n      +exec chpst       +  -U root:root \\\\\\n      +  -u root:root \\\\\\n      +  svlogd -tt /var/log/gitlab/alertmanager[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/alertmanager/env] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] created directory /opt/gitlab/sv/alertmanager/env\\n\\n      - create new directory /opt/gitlab/sv/alertmanager/env[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/alertmanager/control] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] created directory /opt/gitlab/sv/alertmanager/control\\n\\n      - create new directory /opt/gitlab/sv/alertmanager/control[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] owner changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] group changed to 0\\n[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * link[/opt/gitlab/init/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: link[/opt/gitlab/init/alertmanager] created\\n\\n      - create symlink at /opt/gitlab/init/alertmanager to /opt/gitlab/embedded/bin/sv\\n    * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] sending run action to ruby_block[restart_service] (delayed)\\n    * ruby_block[restart_service] action run (skipped due to only_if)\\n[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] sending create action to ruby_block[reload_log_service] (delayed)\\n    * ruby_block[reload_log_service] action create\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/alertmanager] action create (up to date)\\n      * template[/opt/gitlab/sv/alertmanager/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/alertmanager/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/alertmanager/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/alertmanager/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/alertmanager/config] action create (up to date)\\n      * template[/opt/gitlab/sv/alertmanager/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/alertmanager/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/alertmanager/control] action create (up to date)\\n      * link[/opt/gitlab/init/alertmanager] action create (up to date)\\n      * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: link[/opt/gitlab/service/alertmanager] created\\n\\n        - create symlink at /opt/gitlab/service/alertmanager to /opt/gitlab/sv/alertmanager\\n      * ruby_block[wait for alertmanager service socket] action run[2025-08-04T10:23:41+00:00] INFO: ruby_block[wait for alertmanager service socket] called\\n\\n        - execute the ruby block wait for alertmanager service socket\\n      * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:43+00:00] INFO: ruby_block[reload_log_service] called\\n      - execute the ruby block reload_log_service\\n[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] sending run action to ruby_block[restart_log_service] (delayed)\\n    * ruby_block[restart_log_service] action run\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/alertmanager] action create (up to date)\\n      * template[/opt/gitlab/sv/alertmanager/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/alertmanager/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/alertmanager/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/alertmanager/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/alertmanager/config] action create (up to date)\\n      * template[/opt/gitlab/sv/alertmanager/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/alertmanager/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/alertmanager/control] action create (up to date)\\n      * link[/opt/gitlab/init/alertmanager] action create (up to date)\\n      * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/alertmanager] action create (up to date)\\n      * ruby_block[wait for alertmanager service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:43+00:00] INFO: ruby_block[restart_log_service] called\\n      - execute the ruby block restart_log_service\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/alertmanager] action create (up to date)\\n    * ruby_block[wait for alertmanager service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)\\n  \\nRecipe: monitoring::postgres-exporter\\n  * directory[/var/log/gitlab/postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] created directory /var/log/gitlab/postgres-exporter\\n\\n    - create new directory /var/log/gitlab/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] owner changed to 992\\n[2025-08-04T10:23:43+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-psql'\\n    - restore selinux security context\\n  * directory[/var/opt/gitlab/postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] created directory /var/opt/gitlab/postgres-exporter\\n\\n    - create new directory /var/opt/gitlab/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] owner changed to 992\\n[2025-08-04T10:23:43+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] mode changed to 700\\n\\n    - change mode from '' to '0700'\\n    - change owner from '' to 'gitlab-psql'\\n    - restore selinux security context\\n  * env_dir[/opt/gitlab/etc/postgres-exporter/env] action create\\n    * directory[/opt/gitlab/etc/postgres-exporter/env] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/etc/postgres-exporter/env] created directory /opt/gitlab/etc/postgres-exporter/env\\n\\n      - create new directory /opt/gitlab/etc/postgres-exporter/env\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR\\n\\n      - create new file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR\\n\\n      - update content in file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR from none to 4f45cf\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/postgres-exporter/env/GODEBUG] action create[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/GODEBUG] created file /opt/gitlab/etc/postgres-exporter/env/GODEBUG\\n\\n      - create new file /opt/gitlab/etc/postgres-exporter/env/GODEBUG[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/GODEBUG] updated file contents /opt/gitlab/etc/postgres-exporter/env/GODEBUG\\n\\n      - update content in file /opt/gitlab/etc/postgres-exporter/env/GODEBUG from none to e6ab3f\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n    * file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] action create[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] created file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME\\n\\n      - create new file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] updated file contents /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME\\n\\n      - update content in file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME from none to af4c92\\n      - suppressed sensitive resource\\n      - restore selinux security context\\n  \\n  * service[postgres-exporter] action nothing (skipped due to action :nothing)\\n  * runit_service[postgres-exporter] action enable\\n    * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n    * directory[/opt/gitlab/sv/postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] created directory /opt/gitlab/sv/postgres-exporter\\n\\n      - create new directory /opt/gitlab/sv/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] owner changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] group changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/postgres-exporter/run] action create[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] created file /opt/gitlab/sv/postgres-exporter/run\\n\\n      - create new file /opt/gitlab/sv/postgres-exporter/run[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] updated file contents /opt/gitlab/sv/postgres-exporter/run\\n\\n      - update content in file /opt/gitlab/sv/postgres-exporter/run from none to 6d0bb3\\n      --- /opt/gitlab/sv/postgres-exporter/run\\t2025-08-04 10:23:43.821479361 +0000\\n      +++ /opt/gitlab/sv/postgres-exporter/.chef-run20250804-32489-90lqb\\t2025-08-04 10:23:43.820479357 +0000\\n      @@ -1,6 +1,12 @@\\n      +#!/bin/sh\\n      +exec 2>&1\\n      +\\n      +umask 077\\n      +exec chpst -e /opt/gitlab/etc/postgres-exporter/env  gitlab-psql:git -u gitlab-psql:git /opt/gitlab/embedded/bin/postgres_exporter --no-collector.stat_user_tables --collector.postmaster --web.listen-address=localhost:9187 --extend.query-path=/var/opt/gitlab/postgres-exporter/queries.yaml\\n      +[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] owner changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] group changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/postgres-exporter/log] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] created directory /opt/gitlab/sv/postgres-exporter/log\\n\\n      - create new directory /opt/gitlab/sv/postgres-exporter/log[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] owner changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] group changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] created directory /opt/gitlab/sv/postgres-exporter/log/main\\n\\n      - create new directory /opt/gitlab/sv/postgres-exporter/log/main[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] owner changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] group changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * template[/opt/gitlab/sv/postgres-exporter/log/config] action create[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] created file /opt/gitlab/sv/postgres-exporter/log/config\\n\\n      - create new file /opt/gitlab/sv/postgres-exporter/log/config[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] updated file contents /opt/gitlab/sv/postgres-exporter/log/config\\n\\n      - update content in file /opt/gitlab/sv/postgres-exporter/log/config from none to 623c00\\n      --- /opt/gitlab/sv/postgres-exporter/log/config\\t2025-08-04 10:23:43.921479780 +0000\\n      +++ /opt/gitlab/sv/postgres-exporter/log/.chef-config20250804-32489-nb0jg\\t2025-08-04 10:23:43.920479776 +0000\\n      @@ -1,6 +1,12 @@\\n      +s209715200\\n      +n30\\n      +t86400\\n      +!gzip\\n      +\\n      +[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] owner changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] group changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] mode changed to 644\\n\\n      - change mode from '' to '0644'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:43+00:00] INFO: ruby_block[verify_chown_persisted_on_postgres-exporter] sent create action to ruby_block[verify_chown_persisted_on_postgres-exporter] (immediate at declaration time)\\n    * ruby_block[verify_chown_persisted_on_postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: ruby_block[verify_chown_persisted_on_postgres-exporter] called\\n\\n      - execute the ruby block verify_chown_persisted_on_postgres-exporter\\n    * link[/var/log/gitlab/postgres-exporter/config] action create[2025-08-04T10:23:43+00:00] INFO: link[/var/log/gitlab/postgres-exporter/config] created\\n\\n      - create symlink at /var/log/gitlab/postgres-exporter/config to /opt/gitlab/sv/postgres-exporter/log/config\\n    * template[/opt/gitlab/sv/postgres-exporter/log/run] action create[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] created file /opt/gitlab/sv/postgres-exporter/log/run\\n\\n      - create new file /opt/gitlab/sv/postgres-exporter/log/run[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] updated file contents /opt/gitlab/sv/postgres-exporter/log/run\\n\\n      - update content in file /opt/gitlab/sv/postgres-exporter/log/run from none to fd2977\\n      --- /opt/gitlab/sv/postgres-exporter/log/run\\t2025-08-04 10:23:43.960479943 +0000\\n      +++ /opt/gitlab/sv/postgres-exporter/log/.chef-run20250804-32489-povsfl\\t2025-08-04 10:23:43.960479943 +0000\\n      @@ -1,5 +1,10 @@\\n      +#!/bin/sh\\n      +exec chpst       +  -U root:root \\\\\\n      +  -u root:root \\\\\\n      +  svlogd -tt /var/log/gitlab/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] owner changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] group changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * directory[/opt/gitlab/sv/postgres-exporter/env] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] created directory /opt/gitlab/sv/postgres-exporter/env\\n\\n      - create new directory /opt/gitlab/sv/postgres-exporter/env[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] owner changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] group changed to 0\\n[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)\\n    * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)\\n    * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)\\n    * directory[/opt/gitlab/sv/postgres-exporter/control] action create[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] created directory /opt/gitlab/sv/postgres-exporter/control\\n\\n      - create new directory /opt/gitlab/sv/postgres-exporter/control[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] owner changed to 0\\n[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] group changed to 0\\n[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] mode changed to 755\\n\\n      - change mode from '' to '0755'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * link[/opt/gitlab/init/postgres-exporter] action create[2025-08-04T10:23:44+00:00] INFO: link[/opt/gitlab/init/postgres-exporter] created\\n\\n      - create symlink at /opt/gitlab/init/postgres-exporter to /opt/gitlab/embedded/bin/sv\\n    * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)\\n[2025-08-04T10:23:44+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] sending run action to ruby_block[restart_service] (delayed)\\n    * ruby_block[restart_service] action run (skipped due to only_if)\\n[2025-08-04T10:23:44+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)\\n    * ruby_block[reload_log_service] action create\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/postgres-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/postgres-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/postgres-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/postgres-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/postgres-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/postgres-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/postgres-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/postgres-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/postgres-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/postgres-exporter] action create[2025-08-04T10:23:44+00:00] INFO: link[/opt/gitlab/service/postgres-exporter] created\\n\\n        - create symlink at /opt/gitlab/service/postgres-exporter to /opt/gitlab/sv/postgres-exporter\\n      * ruby_block[wait for postgres-exporter service socket] action run[2025-08-04T10:23:48+00:00] INFO: ruby_block[wait for postgres-exporter service socket] called\\n\\n        - execute the ruby block wait for postgres-exporter service socket\\n      * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:49+00:00] INFO: ruby_block[reload_log_service] called\\n      - execute the ruby block reload_log_service\\n[2025-08-04T10:23:49+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)\\n    * ruby_block[restart_log_service] action run\\n      * ruby_block[restart_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)\\n      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/sv/postgres-exporter] action create (up to date)\\n      * template[/opt/gitlab/sv/postgres-exporter/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/postgres-exporter/log] action create (up to date)\\n      * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create (up to date)\\n      * template[/opt/gitlab/sv/postgres-exporter/log/config] action create (up to date)\\n      * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)\\n      * link[/var/log/gitlab/postgres-exporter/config] action create (up to date)\\n      * template[/opt/gitlab/sv/postgres-exporter/log/run] action create (up to date)\\n      * directory[/opt/gitlab/sv/postgres-exporter/env] action create (up to date)\\n      * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)\\n      * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)\\n      * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)\\n      * directory[/opt/gitlab/sv/postgres-exporter/control] action create (up to date)\\n      * link[/opt/gitlab/init/postgres-exporter] action create (up to date)\\n      * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)\\n      * directory[/opt/gitlab/service] action create (up to date)\\n      * link[/opt/gitlab/service/postgres-exporter] action create (up to date)\\n      * ruby_block[wait for postgres-exporter service socket] action run (skipped due to not_if)\\n      * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)\\n[2025-08-04T10:23:49+00:00] INFO: ruby_block[restart_log_service] called\\n      - execute the ruby block restart_log_service\\n    * directory[/opt/gitlab/service] action create (up to date)\\n    * link[/opt/gitlab/service/postgres-exporter] action create (up to date)\\n    * ruby_block[wait for postgres-exporter service socket] action run (skipped due to not_if)\\n    * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)\\n  \\n  * template[/var/opt/gitlab/postgres-exporter/queries.yaml] action create[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] created file /var/opt/gitlab/postgres-exporter/queries.yaml\\n\\n    - create new file /var/opt/gitlab/postgres-exporter/queries.yaml[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] updated file contents /var/opt/gitlab/postgres-exporter/queries.yaml\\n\\n    - update content in file /var/opt/gitlab/postgres-exporter/queries.yaml from none to 1fcf7b\\n    --- /var/opt/gitlab/postgres-exporter/queries.yaml\\t2025-08-04 10:23:49.549503344 +0000\\n    +++ /var/opt/gitlab/postgres-exporter/.chef-queries20250804-32489-7jcoxt.yaml\\t2025-08-04 10:23:49.548503340 +0000\\n    @@ -1,387 +1,774 @@\\n    +pg_total_relation_size:\\n    +  query: |\\n    +    SELECT relnamespace::regnamespace as schemaname,\\n    +           relname as relname,\\n    +           pg_total_relation_size(oid) bytes\\n    +      FROM pg_class\\n    +     WHERE relkind = 'r';\\n    +  metrics:\\n    +    - schemaname:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Name of the schema that this table is in\\"\\n    +    - relname:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Name of this table\\"\\n    +    - bytes:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"total disk space usage for the specified table and associated indexes\\"\\n    +\\n    +pg_blocked:\\n    +  query: |\\n    +    SELECT\\n    +      count(blocked.transactionid) AS queries,\\n    +      '__transaction__' AS table\\n    +    FROM pg_catalog.pg_locks blocked\\n    +    WHERE NOT blocked.granted AND locktype = 'transactionid'\\n    +    GROUP BY locktype\\n    +    UNION\\n    +    SELECT\\n    +      count(blocked.relation) AS queries,\\n    +      blocked.relation::regclass::text AS table\\n    +    FROM pg_catalog.pg_locks blocked\\n    +    WHERE NOT blocked.granted AND locktype != 'transactionid'\\n    +    GROUP BY relation\\n    +  metrics:\\n    +    - queries:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"The current number of blocked queries\\"\\n    +    - table:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"The table on which a query is blocked\\"\\n    +\\n    +pg_oldest_blocked:\\n    +  query: |\\n    +    SELECT coalesce(extract('epoch' from max(clock_timestamp() - state_change)), 0) age_seconds\\n    +      FROM pg_stat_activity\\n    +     WHERE wait_event_type = 'Lock'\\n    +       AND state='active'\\n    +  metrics:\\n    +    - age_seconds:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Largest number of seconds any transaction is currently waiting on a lock\\"\\n    +\\n    +pg_slow:\\n    +  query: |\\n    +    SELECT COUNT(*) AS queries\\n    +    FROM pg_stat_activity\\n    +    WHERE state = 'active' AND (now() - query_start) > '1 seconds'::interval\\n    +  metrics:\\n    +    - queries:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Current number of slow queries\\"\\n    +\\n    +pg_long_running_transactions:\\n    +  query: |\\n    +    SELECT COUNT(*) as transactions,\\n    +    coalesce(MAX(EXTRACT(EPOCH FROM (clock_timestamp() - xact_start))), 0) AS age_in_seconds\\n    +    FROM pg_stat_activity\\n    +    WHERE state is distinct from 'idle' AND (now() - xact_start) > '1 minutes'::interval AND query not like 'autovacuum:%'\\n    +  metrics:\\n    +    - transactions:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Current number of long running transactions\\"\\n    +    - age_in_seconds:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"The current maximum transaction age in seconds\\"\\n    +\\n    +pg_stuck_idle_in_transaction:\\n    +  query: |\\n    +    SELECT COUNT(*) AS queries\\n    +    FROM pg_stat_activity\\n    +    WHERE state = 'idle in transaction' AND (now() - query_start) > '10 minutes'::interval\\n    +  metrics:\\n    +    - queries:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Current number of queries that are stuck being idle in transactions\\"\\n    +\\n    +# All xid and lsn metrics here are reported mod 2^52 to ensure they\\n    +# fit within a float for Prometheus :( Really annoying that counters\\n    +# aren't stored in a 64-bit integer. Note that for queries that report\\n    +# floats this only works because postgres_exporter does know to set\\n    +# extra_float_digits (which it sets to 2). So they don't print in\\n    +# exponential notation and precision is maintained up to 2^53-1.\\n    +\\n    +pg_vacuum:\\n    +  query: |\\n    +    SELECT\\n    +      COUNT(*) AS queries,\\n    +      MAX(EXTRACT(EPOCH FROM (clock_timestamp() - query_start))) AS age_in_seconds\\n    +    FROM pg_catalog.pg_stat_activity\\n    +    WHERE state = 'active' AND trim(query) ~* '\\\\AVACUUM (?!ANALYZE)'\\n    +  metrics:\\n    +    - queries:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"The current number of VACUUM queries\\"\\n    +    - age_in_seconds:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"The current maximum VACUUM query age in seconds\\"\\n    +\\n    +pg_vacuum_analyze:\\n    +  query: |\\n    +    SELECT\\n    +      COUNT(*) AS queries,\\n    +      MAX(EXTRACT(EPOCH FROM (clock_timestamp() - query_start))) AS age_in_seconds\\n    +    FROM pg_catalog.pg_stat_activity\\n    +    WHERE state = 'active' AND trim(query) ~* '\\\\AVACUUM ANALYZE'\\n    +  metrics:\\n    +    - queries:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"The current number of VACUUM ANALYZE queries\\"\\n    +    - age_in_seconds:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"The current maximum VACUUM ANALYZE query age in seconds\\"\\n    +\\n    +pg_stuck_idle_in_transaction:\\n    +  query: |\\n    +    SELECT COUNT(*) AS queries\\n    +    FROM pg_stat_activity\\n    +    WHERE state = 'idle in transaction' AND (now() - query_start) > '10 minutes'::interval\\n    +  metrics:\\n    +    - queries:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Current number of queries that are stuck being idle in transactions\\"\\n    +\\n    +pg_vacuum_queue:\\n    +  #master: true \\n    +  # Until postgres_exporter is upgraded. See \\n    +  # https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4887\\n    +  query: |\\n    +    with table_opts_vs_statistic as (\\n    +      select\\n    +        pg_class.oid,\\n    +        pg_class.relname,\\n    +        coalesce(nspname, 'public') as schemaname,\\n    +        pg_class.relpages,\\n    +        pg_class.reltuples,\\n    +        case\\n    +          when array_to_string(reloptions, '') like '%autovacuum_vacuum_threshold%' then regexp_replace(array_to_string(reloptions, ''), '.*autovacuum_vacuum_threshold=([0-9.]+).*', E'\\\\\\\\1')::int8\\n    +          else current_setting('autovacuum_vacuum_threshold')::int8\\n    +        end as autovacuum_vacuum_threshold,\\n    +        case\\n    +          when array_to_string(reloptions, '') like '%autovacuum_vacuum_scale_factor%' then regexp_replace(array_to_string(reloptions, ''), '.*autovacuum_vacuum_scale_factor=([0-9.]+).*', E'\\\\\\\\1')::numeric\\n    +          else current_setting('autovacuum_vacuum_scale_factor')::numeric\\n    +        end as autovacuum_vacuum_scale_factor,\\n    +        case when array_to_string(reloptions, '') ~ 'autovacuum_enabled=(false|off)' then false else true end as autovacuum_enabled,\\n    +        n_dead_tup,\\n    +        last_autovacuum,\\n    +        last_vacuum\\n    +      from pg_class\\n    +      join pg_namespace ns on relnamespace = ns.oid \\n    +      join pg_stat_all_tables psat  on psat.relid  = pg_class.oid\\n    +      where relkind in ('r','m') \\n    +    ), p as (\\n    +      select pgspv.*,a.query,a.wait_event_type,a.wait_event,a.query_start\\n    +      from pg_stat_progress_vacuum pgspv\\n    +      left join pg_stat_activity a using (pid)\\n    +    ) \\n    +    select\\n    +      table_opts_vs_statistic.schemaname as schemaname,\\n    +      table_opts_vs_statistic.relname as relname,\\n    +      round((100 * table_opts_vs_statistic.n_dead_tup::numeric / nullif(table_opts_vs_statistic.reltuples, 0))::numeric, 2) as dead_tup_pct,\\n    +      table_opts_vs_statistic.reltuples::numeric as reltuples,\\n    +      table_opts_vs_statistic.n_dead_tup,\\n    +      (relpages::bigint*8*1024) AS table_size_bytes,\\n    +      'V. Threshold:' || table_opts_vs_statistic.autovacuum_vacuum_threshold\\n    +        || ', V. Scale Factor: ' || (table_opts_vs_statistic.autovacuum_vacuum_scale_factor)::numeric *100 ||' %'\\n    +        || case when not autovacuum_enabled then ', DISABLED' else ', enabled' end as \\"effective_settings\\",\\n    +      case\\n    +        when last_autovacuum > coalesce(last_vacuum, '0001-01-01') then last_autovacuum::timestamp(0)\\n    +        when last_vacuum is not null then last_vacuum::timestamp(0)\\n    +        else null\\n    +      end as \\"last_vacuumed\\",\\n    +      case\\n    +        when last_autovacuum > coalesce(last_vacuum, '0001-01-01') then 'auto'\\n    +        when last_vacuum is not null then 'manual'\\n    +        else null\\n    +      end as \\"type\\",\\n    +      coalesce(p.phase, 'in queue') as status,\\n    +      p.pid as pid,\\n    +      coalesce  (p.query,'')as  action,\\n    +      case when p.pid is null then null else coalesce(wait_event_type ||'.'|| wait_event, 'f') end as waiting,\\n    +      round(100.0 * p.heap_blks_scanned / nullif(p.heap_blks_total, 0), 1) AS scanned_pct,\\n    +      round(100.0 * p.heap_blks_vacuumed / nullif(p.heap_blks_total, 0), 1) AS vacuumed_pct,\\n    +      extract ('epoch' from  now()-query_start) elapsed_time\\n    +    from \\n    +    table_opts_vs_statistic\\n    +    full outer join p on p.relid = table_opts_vs_statistic.oid and p.datname = current_database()\\n    +    where\\n    +      table_opts_vs_statistic.relpages >= 8\\n    +      and  autovacuum_vacuum_threshold + (autovacuum_vacuum_scale_factor::numeric * table_opts_vs_statistic.reltuples) < table_opts_vs_statistic.n_dead_tup\\n    +  metrics:\\n    +    - schemaname:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Table Schema\\"\\n    +    - relname:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Table name\\"\\n    +    - dead_tup_pct:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Estimated dead tuples percent\\"\\n    +    - reltuples:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Number of tuples in table\\"\\n    +    - n_dead_tup:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Estimated number of dead tuples\\"\\n    +    - table_size_bytes:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Estimated table size\\"\\n    +    - effective_settings:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Autovacuums settings\\"\\n    +    - last_vacuumed:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Last time at which this table was vacuumed\\"\\n    +    - type:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Last vacuum type\\"\\n    +    - status:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Vacuum actual status\\"\\n    +    - pid:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Vacuum process id\\"\\n    +    - action:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Type of vacuum executed\\"\\n    +    - waiting:\\n    +        usage: \\"LABEL\\"\\n    +        description: \\"Vacuum queue status\\"\\n    +    - scanned_pct:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Estimated rows scanned percent\\"\\n    +    - vacuumed_pct:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Estimated vacuumed rows percent\\"\\n    +    - elapsed_time:\\n    +        usage: \\"GAUGE\\"\\n    +        description: \\"Elapsed time vacuuming (in seconds)\\"\\n    +\\n    +#\\n    +# This query extracts marginalia comments from pg_stat_activity and provides a sampled summary of the type of\\n    +# endpoints that are actively making calls\\n    +#\\n    +pg_stat_activity_marginalia_sampler:\\n    +  query: >\\n    +    SELECT\\n    +      usename AS usename,\\n    +      a.matches[1] AS application,\\n    +      a.matches[2] AS endpoint,\\n    +      a.matches[3] AS command,\\n    +      a.wait_event AS wait_event,\\n    +      a.state AS state,\\n    +      a.wait_event_type AS wait_event_type,\\n    +      COUNT(*) active_count,\\n    +     MAX(coalesce(age_in_seconds, 0)) AS max_tx_age_in_seconds\\n    +    FROM (\\n    +      SELECT\\n    +        usename,\\n    +        regexp_matches(query, '^\\\\s*(?:\\\\/\\\\*(?:application:(\\\\w+),?)?(?:correlation_id:\\\\w+,?)?(?:jid:\\\\w+,?)?(?:endpoint_id:([\\\\w/\\\\-\\\\.:\\\\#\\\\s]+),?)?.*?\\\\*\\\\/)?\\\\s*(\\\\w+)') AS matches,\\n    +        state,\\n    +        wait_event,\\n    +        wait_event_type,\\n    +        EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds\\n    +      FROM\\n    +        pg_stat_activity\\n    +      ) a\\n    +    GROUP BY usename, application, endpoint, command, state, wait_event, wait_event_type\\n    +    ORDER BY active_count DESC\\n    +  metrics:\\n    +    - usename:\\n    +        usage: LABEL\\n    +        description: The user running the command\\n    +    - application:\\n    +        usage: LABEL\\n    +        description: Name of the application as presented in marginalia comment\\n    +    - endpoint:\\n    +        usage: LABEL\\n    +        description: Name of the web endpoint or sidekiq job as presented in marginalia comment\\n    +    - command:\\n    +        usage: LABEL\\n    +        description: The first word for the running command\\n    +    - wait_event:\\n    +        usage: LABEL\\n    +        description: Wait event  of the activity as presented by pg_stat_activity.wait_event\\n    +    - state:\\n    +        usage: LABEL\\n    +        description: State of the activity as presented by pg_stat_activity.state\\n    +    - wait_event_type:\\n    +        usage: LABEL\\n    +        description: Wait event type of the activity as presented by pg_stat_activity.wait_event_type\\n    +    - active_count:\\n    +        usage: GAUGE\\n    +        description: Number of active queries at time of sample\\n    +    - max_tx_age_in_seconds:\\n    +        usage: GAUGE\\n    +        description: Number of active queries at time of sample\\n    +\\n    +# This records long running autovacuum processes. The reason we limit to\\n    +# long-running processes is to avoid cardinality problems in prometheus. Since\\n    +# we're only concerned about long running processes we limit the output only to\\n    +# those that take longer than 5 minutes.\\n    +pg_stat_activity_autovacuum:\\n    +  query: >\\n    +    SELECT\\n    +      SPLIT_PART(query, '.', 2) AS relname,\\n    +      EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds\\n    +    FROM\\n    +      pg_stat_activity\\n    +    WHERE\\n    +      query like 'autovacuum:%'\\n    +    AND\\n    +      EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) > 300\\n    +  metrics:\\n    +    - relname:\\n    +        usage: LABEL\\n    +        description: The table being vacuumed\\n    +    - age_in_seconds:\\n    +        usage: GAUGE\\n    +        description: The age of the vacuum process in seconds\\n    +\\n    +# Keep track of the number of the total number of autovacuum workers\\n    +# currently active\\n    +pg_stat_activity_autovacuum_active:\\n    +  query: >\\n    +    SELECT v.phase,\\n    +           CASE\\n    +             when a.query ~ '^autovacuum.*to prevent wraparound' then 'wraparound'\\n    +             when a.query ~* '^vacuum' then 'user'\\n    +             when a.pid is null then null\\n    +             ELSE 'regular'\\n    +           END as mode,\\n    +           count(1) as workers_count\\n    +      FROM pg_stat_progress_vacuum v\\n    +      LEFT JOIN pg_stat_activity a using (pid)\\n    +     GROUP BY 1,2\\n    +  metrics:\\n    +    - phase:\\n    +        usage: LABEL\\n    +        description: Vacuum phase\\n    +    - mode:\\n    +        usage: LABEL\\n    +        description: Vacuum mode\\n    +    - workers_count:\\n    +        usage: GAUGE\\n    +        description: The number of active autovacuum workers in this state\\n    +\\n    +#\\n    +# This query extracts marginalia metadata from pg_stat_activity and provides a sampled summary about the long running transactions.\\n    +#\\n    +pg_long_running_transactions_marginalia:\\n    +  query: >\\n    +    SELECT\\n    +      activity.matches[1] AS application,\\n    +      activity.matches[2] AS endpoint,\\n    +      MAX(age_in_seconds) AS max_age_in_seconds\\n    +    FROM (\\n    +      SELECT\\n    +        regexp_matches(query, '^\\\\s*(?:\\\\/\\\\*(?:application:(\\\\w+),?)?(?:correlation_id:\\\\w+,?)?(?:jid:\\\\w+,?)?(?:endpoint_id:([\\\\w/\\\\-\\\\.:\\\\#\\\\s]+),?)?.*?\\\\*\\\\/)?\\\\s*(\\\\w+)') AS matches,\\n    +        EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds\\n    +      FROM\\n    +        pg_stat_activity\\n    +      WHERE state <> 'idle'\\n    +        AND (clock_timestamp() - xact_start) > '30 seconds'::interval\\n    +        AND query NOT LIKE 'autovacuum:%'\\n    +      ) activity\\n    +    GROUP BY application, endpoint\\n    +    ORDER BY max_age_in_seconds DESC\\n    +  metrics:\\n    +    - application:\\n    +        usage: LABEL\\n    +        description: Name of the application as presented in marginalia comment\\n    +    - endpoint:\\n    +        usage: LABEL\\n    +        description: Name of the web endpoint or sidekiq job as presented in marginalia comment\\n    +    - max_age_in_seconds:\\n    +        usage: GAUGE\\n    +        description: The current maximum transaction age in seconds[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] owner changed to 992\\n[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] mode changed to 644\\n\\n    - change mode from '' to '0644'\\n    - change owner from '' to 'gitlab-psql'\\n    - restore selinux security context\\n[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] not queuing delayed action restart on runit_service[postgres-exporter] (delayed), as it's already been queued\\n  * consul_service[postgres-exporter] action delete\\n    * file[/var/opt/gitlab/consul/config.d/postgres-exporter-service.json] action delete (up to date)\\n     (up to date)\\nRecipe: gitlab::gitlab-backup-cli_disable\\n  * template[/opt/gitlab/etc/gitlab-backup-cli-config.yml] action delete (up to date)\\n  * account[GitLab Backup User] action remove\\n    * linux_user[gitlab-backup] action remove (up to date)\\n     (up to date)\\n  * group[git] action manage (up to date)\\n  * group[gitlab-psql] action manage (up to date)\\n  * group[registry] action manage (up to date)\\nRecipe: gitlab::database_reindexing_disable\\n  * crond_job[database-reindexing] action delete\\n    * file[/var/opt/gitlab/crond/database-reindexing] action delete (up to date)\\n     (up to date)\\nRecipe: gitlab-ee::sentinel_disable\\n  * sentinel_service[redis] action disable\\n    * service[sentinel] action nothing (skipped due to action :nothing)\\n    * runit_service[sentinel] action disable\\n      * ruby_block[disable sentinel] action run (skipped due to only_if)\\n       (up to date)\\n    * file[/var/opt/gitlab/sentinel/sentinel.conf] action delete (up to date)\\n    * directory[/var/opt/gitlab/sentinel] action delete (up to date)\\n     (up to date)\\nRecipe: gitlab-ee::geo-postgresql_disable\\n  * service[geo-postgresql] action nothing (skipped due to action :nothing)\\n  * runit_service[geo-postgresql] action disable\\n    * ruby_block[disable geo-postgresql] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: gitlab-ee::geo-logcursor_disable\\n  * service[geo-logcursor] action nothing (skipped due to action :nothing)\\n  * runit_service[geo-logcursor] action disable\\n    * ruby_block[disable geo-logcursor] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: consul::disable_daemon\\n  * service[consul] action nothing (skipped due to action :nothing)\\n  * runit_service[consul] action disable\\n    * ruby_block[disable consul] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: pgbouncer::disable\\n  * service[pgbouncer] action nothing (skipped due to action :nothing)\\n  * runit_service[pgbouncer] action disable\\n    * ruby_block[disable pgbouncer] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: patroni::disable\\n  * service[patroni] action nothing (skipped due to action :nothing)\\n  * runit_service[patroni] action disable\\n    * ruby_block[disable patroni] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: spamcheck::disable\\n  * service[spamcheck] action nothing (skipped due to action :nothing)\\n  * runit_service[spamcheck] action disable\\n    * ruby_block[disable spamcheck] action run (skipped due to only_if)\\n     (up to date)\\n  * service[spam-classifier] action nothing (skipped due to action :nothing)\\n  * runit_service[spam-classifier] action disable\\n    * ruby_block[disable spam-classifier] action run (skipped due to only_if)\\n     (up to date)\\nRecipe: gitlab-ee::geo-secondary_disable\\n  * templatesymlink[Removes the geo database settings from database.yml and create a symlink to Rails root] action create\\n    * template[/var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/database.yml to /var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)\\n     (up to date)\\nRecipe: gitlab-ee::suggested_reviewers\\n  * templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] action create[2025-08-04T10:23:49+00:00] WARN: only_if block for templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] returned a string, did you mean to run a command?\\n\\n    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] action create[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] created file /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret\\n\\n      - create new file /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret\\n\\n      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret from none to 2362fb\\n      - suppressed sensitive resource[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] owner changed to 0\\n[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] group changed to 0\\n[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] mode changed to 644\\n\\n      - change mode from '' to '0644'\\n      - change owner from '' to 'root'\\n      - change group from '' to 'root'\\n      - restore selinux security context\\n    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_suggested_reviewers_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] action create[2025-08-04T10:23:49+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_suggested_reviewers_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] created\\n\\n      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/.gitlab_suggested_reviewers_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret\\n  \\n[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] not queuing delayed action restart on runit_service[puma] (delayed), as it's already been queued\\n[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] not queuing delayed action restart on sidekiq_service[sidekiq] (delayed), as it's already been queued\\n[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending restart action to runit_service[puma] (delayed)\\nRecipe: gitlab::puma\\n  * runit_service[puma] action restart (up to date)\\n[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending restart action to sidekiq_service[sidekiq] (delayed)\\nRecipe: gitlab::sidekiq\\n  * sidekiq_service[sidekiq] action restart\\n    * service[sidekiq] action nothing (skipped due to action :nothing)\\n    * runit_service[sidekiq] action restart\\n      \\n      ================================================================================\\n      Error executing action `restart` on resource 'runit_service[sidekiq]'\\n      ================================================================================\\n      \\n      Mixlib::ShellOut::ShellCommandFailed\\n      ------------------------------------\\n      Expected process to exit with [0], but received '1'\\n      ---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\n      STDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM\\n      STDERR: \\n      ---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\n      Ran /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1\\n      \\n      Cookbook Trace: (most recent call first)\\n      ----------------------------------------\\n      /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:136:in `safe_sv_shellout!'\\n      /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:164:in `restart_service'\\n      /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/provider_runit_service.rb:368:in `block in <class:RunitService>'\\n      /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb:67:in `block in class_from_file'\\n      \\n      Resource Declaration:\\n      ---------------------\\n      # In /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb\\n      \\n       67:   runit_service new_resource.name do\\n       68:     action :restart\\n       69:   end\\n       70: end\\n      \\n      Compiled Resource:\\n      ------------------\\n      # Declared in /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb:67:in `block in class_from_file'\\n      \\n      runit_service(\\"sidekiq\\") do\\n        action [:restart]\\n        default_guard_interpreter :default\\n        declared_type :runit_service\\n        cookbook_name \\"gitlab\\"\\n        recipe_name \\"sidekiq\\"\\n        service_name \\"sidekiq\\"\\n        owner \\"root\\"\\n        group \\"root\\"\\n        supports {:restart=>nil, :reload=>nil, :status=>nil}\\n        start_command_name \\"start\\"\\n        stop_command_name \\"stop\\"\\n        restart_command_name \\"restart\\"\\n        status_command_name \\"status\\"\\n      end\\n      \\n      System Info:\\n      ------------\\n      chef_version=18.3.0\\n      platform=redhat\\n      platform_version=9.5\\n      ruby=ruby 3.2.5 (2024-07-26 revision 31d0f1a2e7) [x86_64-linux]\\n      program_name=/opt/gitlab/embedded/bin/cinc-client\\n      executable=/opt/gitlab/embedded/bin/cinc-client\\n      \\n    \\n    ================================================================================\\n    Error executing action `restart` on resource 'sidekiq_service[sidekiq]'\\n    ================================================================================\\n    \\n    Mixlib::ShellOut::ShellCommandFailed\\n    ------------------------------------\\n    runit_service[sidekiq] (gitlab::sidekiq line 67) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'\\n    ---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\n    STDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM\\n    STDERR: \\n    ---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\n    Ran /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1\\n    \\n    Cookbook Trace: (most recent call first)\\n    ----------------------------------------\\n    /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:136:in `safe_sv_shellout!'\\n    /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:164:in `restart_service'\\n    /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/provider_runit_service.rb:368:in `block in <class:RunitService>'\\n    /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb:67:in `block in class_from_file'\\n    \\n    Resource Declaration:\\n    ---------------------\\n    # In /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/recipes/sidekiq.rb\\n    \\n     23: sidekiq_service 'sidekiq' do\\n     24:   user account_helper.gitlab_user\\n     25:   group account_helper.gitlab_group\\n     26:   log_directory logging_settings[:log_directory]\\n     27:   log_directory_mode logging_settings[:log_directory_mode]\\n     28:   log_directory_owner logging_settings[:log_directory_owner]\\n     29:   log_directory_group logging_settings[:log_directory_group]\\n     30:   log_user logging_settings[:runit_owner]\\n     31:   log_group logging_settings[:runit_group]\\n     32: end\\n     33: \\n    \\n    Compiled Resource:\\n    ------------------\\n    # Declared in /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/recipes/sidekiq.rb:23:in `from_file'\\n    \\n    sidekiq_service(\\"sidekiq\\") do\\n      action [:enable]\\n      default_guard_interpreter :default\\n      declared_type :sidekiq_service\\n      cookbook_name \\"gitlab\\"\\n      recipe_name \\"sidekiq\\"\\n      user \\"git\\"\\n      group \\"git\\"\\n      log_directory \\"/var/log/gitlab/sidekiq\\"\\n      log_directory_mode \\"0700\\"\\n      log_directory_owner \\"git\\"\\n      log_user \\"root\\"\\n      logfiles_helper \\"*sensitive value suppressed*\\"\\n      template_name \\"sidekiq\\"\\n    end\\n    \\n    System Info:\\n    ------------\\n    chef_version=18.3.0\\n    platform=redhat\\n    platform_version=9.5\\n    ruby=ruby 3.2.5 (2024-07-26 revision 31d0f1a2e7) [x86_64-linux]\\n    program_name=/opt/gitlab/embedded/bin/cinc-client\\n    executable=/opt/gitlab/embedded/bin/cinc-client\\n    \\n[2025-08-04T10:24:20+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending run action to execute[clear the gitlab-rails cache] (delayed)\\nRecipe: gitlab::gitlab-rails\\n  * execute[clear the gitlab-rails cache] action run[2025-08-04T10:25:35+00:00] INFO: execute[clear the gitlab-rails cache] ran successfully\\n\\n    - execute /opt/gitlab/bin/gitlab-rake cache:clear\\n[2025-08-04T10:25:35+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] sending restart action to runit_service[nginx] (delayed)\\nRecipe: nginx::enable\\n  * runit_service[nginx] action restart (up to date)\\n[2025-08-04T10:25:35+00:00] INFO: env_dir[/opt/gitlab/etc/node-exporter/env] sending restart action to runit_service[node-exporter] (delayed)\\nRecipe: monitoring::node-exporter\\n  * runit_service[node-exporter] action restart (up to date)\\n[2025-08-04T10:25:35+00:00] INFO: env_dir[/opt/gitlab/etc/gitlab-exporter/env] sending restart action to runit_service[gitlab-exporter] (delayed)\\nRecipe: monitoring::gitlab-exporter\\n  * runit_service[gitlab-exporter] action restart (up to date)\\n[2025-08-04T10:25:36+00:00] INFO: env_dir[/opt/gitlab/etc/redis-exporter/env] sending restart action to runit_service[redis-exporter] (delayed)\\nRecipe: monitoring::redis-exporter\\n  * runit_service[redis-exporter] action restart (up to date)\\n[2025-08-04T10:25:36+00:00] INFO: env_dir[/opt/gitlab/etc/prometheus/env] sending restart action to runit_service[prometheus] (delayed)\\nRecipe: monitoring::prometheus\\n  * runit_service[prometheus] action restart (up to date)\\n[2025-08-04T10:25:37+00:00] INFO: file[Prometheus config] sending run action to execute[reload prometheus] (delayed)\\n  * execute[reload prometheus] action run[2025-08-04T10:25:40+00:00] INFO: execute[reload prometheus] ran successfully\\n\\n    - execute /opt/gitlab/bin/gitlab-ctl hup prometheus\\n[2025-08-04T10:25:40+00:00] INFO: env_dir[/opt/gitlab/etc/alertmanager/env] sending restart action to runit_service[alertmanager] (delayed)\\nRecipe: monitoring::alertmanager\\n  * runit_service[alertmanager] action restart (up to date)\\n[2025-08-04T10:25:40+00:00] INFO: env_dir[/opt/gitlab/etc/postgres-exporter/env] sending restart action to runit_service[postgres-exporter] (delayed)\\nRecipe: monitoring::postgres-exporter\\n  * runit_service[postgres-exporter] action restart (up to date)\\n\\nRunning handlers:\\n[2025-08-04T10:25:41+00:00] ERROR: Running exception handlers\\nRunning handlers complete\\n[2025-08-04T10:25:41+00:00] ERROR: Exception handlers complete\\nInfra Phase failed. 166 resources updated in 03 minutes 02 seconds\\n[2025-08-04T10:25:41+00:00] FATAL: Stacktrace dumped to /opt/gitlab/embedded/cookbooks/cache/cinc-stacktrace.out\\n[2025-08-04T10:25:41+00:00] FATAL: ---------------------------------------------------------------------------------------\\n[2025-08-04T10:25:41+00:00] FATAL: PLEASE PROVIDE THE CONTENTS OF THE stacktrace.out FILE (above) IF YOU FILE A BUG REPORT\\n[2025-08-04T10:25:41+00:00] FATAL: ---------------------------------------------------------------------------------------\\n[2025-08-04T10:25:41+00:00] FATAL: Mixlib::ShellOut::ShellCommandFailed: sidekiq_service[sidekiq] (gitlab::sidekiq line 23) had an error: Mixlib::ShellOut::ShellCommandFailed: runit_service[sidekiq] (gitlab::sidekiq line 67) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'\\n---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\nSTDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM\\nSTDERR: \\n---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----\\nRan /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1", "stdout_lines": ["[2025-08-04T10:22:39+00:00] INFO: Started Cinc Zero at chefzero://localhost:1 with repository at /opt/gitlab/embedded (One version per cookbook)", "Cinc Client, version 18.3.0", "Patents: https://www.chef.io/patents", "Infra Phase starting", "[2025-08-04T10:22:39+00:00] INFO: *** Cinc Client 18.3.0 ***", "[2025-08-04T10:22:39+00:00] INFO: Platform: x86_64-linux", "[2025-08-04T10:22:39+00:00] INFO: Cinc-client pid: 32489", "[2025-08-04T10:22:42+00:00] INFO: Setting the run_list to [\\"recipe[gitlab-base]\\"] from CLI options", "[2025-08-04T10:22:42+00:00] INFO: Run List is [recipe[gitlab-base]]", "[2025-08-04T10:22:42+00:00] INFO: Run List expands to [gitlab-base]", "[2025-08-04T10:22:42+00:00] INFO: Starting Cinc Client Run for server.example.com", "[2025-08-04T10:22:42+00:00] INFO: Running start handlers", "[2025-08-04T10:22:42+00:00] INFO: Start handlers complete.", "Resolving cookbooks for run list: [\\"gitlab-base\\"]", "[2025-08-04T10:22:44+00:00] INFO: Loading cookbooks [gitlab-base@0.1.0, package@0.1.0, gitlab@0.0.1, gitlab-ee@0.0.1, runit@5.1.7, logrotate@0.1.0, postgresql@0.1.0, redis@0.1.0, monitoring@0.1.0, registry@0.1.0, mattermost@0.1.0, consul@0.1.0, gitaly@0.1.0, praefect@0.1.0, gitlab-kas@0.1.0, gitlab-pages@0.1.0, letsencrypt@0.1.0, nginx@0.1.0, patroni@0.1.0, pgbouncer@0.1.0, spamcheck@0.1.0, acme@4.1.6, crond@0.1.0]", "Synchronizing cookbooks:", "  - gitlab-base (0.1.0)", "  - package (0.1.0)", "  - gitlab (0.0.1)", "  - gitlab-ee (0.0.1)", "  - runit (5.1.7)", "  - logrotate (0.1.0)", "  - monitoring (0.1.0)", "  - redis (0.1.0)", "  - mattermost (0.1.0)", "  - registry (0.1.0)", "  - praefect (0.1.0)", "  - consul (0.1.0)", "  - gitaly (0.1.0)", "  - postgresql (0.1.0)", "  - gitlab-kas (0.1.0)", "  - gitlab-pages (0.1.0)", "  - patroni (0.1.0)", "  - nginx (0.1.0)", "  - letsencrypt (0.1.0)", "  - pgbouncer (0.1.0)", "  - spamcheck (0.1.0)", "  - acme (4.1.6)", "  - crond (0.1.0)", "Installing cookbook gem dependencies:", "Compiling cookbooks...", "Loading Cinc Auditor profile files:", "Loading Cinc Auditor input files:", "Loading Cinc Auditor waiver files:", "[2025-08-04T10:22:47+00:00] INFO: Generating default secrets", "[2025-08-04T10:22:50+00:00] INFO: Generating /etc/gitlab/gitlab-secrets.json file", "Recipe: gitlab::default", "  * directory[/etc/gitlab] action create (up to date)", "[2025-08-04T10:22:50+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:50+00:00] WARN: Selected systemd because /run/systemd/system/ exists", "[2025-08-04T10:22:50+00:00] WARN: gitlab-shell does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:50+00:00] WARN: gitlab-sshd does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: logrotate does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: logrotate does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: puma does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitlab-shell does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitlab-workhorse does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitlab-pages does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitlab-kas does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitaly does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: mailroom does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitaly does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: postgresql does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: postgresql does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitlab-kas does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: puma does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: sidekiq does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:51+00:00] WARN: gitlab-workhorse does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:52+00:00] WARN: node-exporter does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:52+00:00] WARN: gitlab-exporter does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:52+00:00] WARN: redis-exporter does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:52+00:00] WARN: prometheus does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:52+00:00] WARN: alertmanager does not have a log_group or default logdir mode defined. Setting to 0700.", "[2025-08-04T10:22:52+00:00] WARN: postgres-exporter does not have a log_group or default logdir mode defined. Setting to 0700.", "  Converging 303 resources", "  * directory[/etc/gitlab] action create (up to date)", "  * directory[Create /var/opt/gitlab] action create (up to date)", "  * directory[Create /var/log/gitlab] action create (up to date)", "  * directory[/opt/gitlab/embedded/etc] action create (up to date)", "Recipe: gitlab::web-server", "  * account[Webserver user and group] action create", "    * group[Webserver user and group] action create (up to date)", "    * linux_user[Webserver user and group] action create (up to date)", "     (up to date)", "Recipe: gitlab::users", "  * directory[/var/opt/gitlab] action create (up to date)", "  * account[GitLab user and group] action create", "    * group[GitLab user and group] action create (up to date)", "    * linux_user[GitLab user and group] action create (up to date)", "     (up to date)", "  * template[/var/opt/gitlab/.gitconfig] action create (up to date)", "  * directory[/var/opt/gitlab/.bundle] action create (up to date)", "Recipe: gitaly::git_data_dirs", "  * storage_directory[/var/opt/gitlab/git-data/repositories] action create", "    * ruby_block[directory resource: /var/opt/gitlab/git-data/repositories] action run (skipped due to not_if)", "     (up to date)", "Recipe: gitlab::rails_pages_shared_path", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/pages] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/pages] action run (skipped due to not_if)", "     (up to date)", "Recipe: gitlab::gitlab-rails", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/artifacts] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/artifacts] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/external-diffs] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/external-diffs] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/lfs-objects] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/lfs-objects] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/packages] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/packages] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/dependency_proxy] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/dependency_proxy] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/terraform_state] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/terraform_state] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/ci_secure_files] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/ci_secure_files] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/encrypted_settings] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/encrypted_settings] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/uploads] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/uploads] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-ci/builds] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-ci/builds] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/cache] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/cache] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/tmp] action create", "    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/tmp] action run (skipped due to not_if)", "     (up to date)", "  * storage_directory[/opt/gitlab/embedded/service/gitlab-rails/public] action create (skipped due to only_if)", "  * directory[create /var/opt/gitlab/gitlab-rails/etc] action create (up to date)", "  * directory[create /opt/gitlab/etc/gitlab-rails] action create (up to date)", "  * directory[create /var/opt/gitlab/gitlab-rails/working] action create (up to date)", "  * directory[create /var/opt/gitlab/gitlab-rails/tmp] action create (up to date)", "  * directory[create /var/opt/gitlab/gitlab-rails/upgrade-status] action create (up to date)", "  * directory[/var/log/gitlab/gitlab-rails] action create (up to date)", "  * storage_directory[/var/opt/gitlab/backups] action create", "    * ruby_block[directory resource: /var/opt/gitlab/backups] action run (skipped due to not_if)", "     (up to date)", "  * directory[/var/opt/gitlab/gitlab-rails] action create (up to date)", "  * directory[/var/opt/gitlab/gitlab-ci] action create (up to date)", "  * file[/var/opt/gitlab/gitlab-rails/etc/gitlab-registry.key] action create (skipped due to only_if)", "  * template[/opt/gitlab/etc/gitlab-rails-rc] action create[2025-08-04T10:22:55+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/opt/gitlab/etc/gitlab-rails-rc.chef-20250804102255.461108", "[2025-08-04T10:22:55+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] updated file contents /opt/gitlab/etc/gitlab-rails-rc", "", "    - update content in file /opt/gitlab/etc/gitlab-rails-rc from 000a09 to 7b16c8", "    --- /opt/gitlab/etc/gitlab-rails-rc\\t2025-08-04 10:15:49.951521260 +0000", "    +++ /opt/gitlab/etc/.chef-gitlab-rails-rc20250804-32489-gruns2\\t2025-08-04 10:22:55.423275159 +0000", "    @@ -1,6 +1,6 @@", "     gitlab_user='git'", "     gitlab_group='git'", "    -registry_dir='/var/opt/gitlab/gitlab-rails/shared/registry'", "    +registry_dir=''", "     registry_user='registry'", "     registry_group='registry'", "    - restore selinux security context", "  * file[/opt/gitlab/embedded/service/gitlab-rails/.secret] action delete (up to date)", "  * file[/var/opt/gitlab/gitlab-rails/etc/secret] action delete (up to date)", "  * templatesymlink[Create a database.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/database.yml to /var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a clickhouse.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/click_house.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/click_house.yml to /var/opt/gitlab/gitlab-rails/etc/click_house.yml] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a secrets.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml to /var/opt/gitlab/gitlab-rails/etc/secrets.yml] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a resque.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/resque.yml to /var/opt/gitlab/gitlab-rails/etc/resque.yml] action create (up to date)", "     (up to date)", "  * templatesymlink[Create an override redis.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/redis.yml to /var/opt/gitlab/gitlab-rails/etc/redis.yml] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a cable.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/cable.yml to /var/opt/gitlab/gitlab-rails/etc/cable.yml] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.cache.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.cache.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.cache.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.queues.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.queues.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.queues.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.shared_state.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.shared_state.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.shared_state.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.trace_chunks.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.trace_chunks.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.trace_chunks.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.rate_limiting.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.rate_limiting.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.rate_limiting.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.sessions.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.sessions.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.sessions.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.repository_cache.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.repository_cache.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.repository_cache.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.cluster_rate_limiting.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.cluster_rate_limiting.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.cluster_rate_limiting.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a redis.workhorse.yml and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/redis.workhorse.yml] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.workhorse.yml] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a session_store.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/session_store.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/session_store.yml to /var/opt/gitlab/gitlab-rails/etc/session_store.yml] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a smtp_settings.rb and create a symlink to Rails root] action delete", "    * file[/var/opt/gitlab/gitlab-rails/etc/smtp_settings.rb] action delete (up to date)", "    * link[/opt/gitlab/embedded/service/gitlab-rails/config/initializers/smtp_settings.rb] action delete (up to date)", "     (up to date)", "  * templatesymlink[Create a gitlab.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] action create[2025-08-04T10:22:55+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/gitlab-rails/etc/gitlab.yml.chef-20250804102255.882514", "[2025-08-04T10:22:55+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab.yml", "", "      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab.yml from 24fdaa to 797266", "      - suppressed sensitive resource", "      - restore selinux security context", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml to /var/opt/gitlab/gitlab-rails/etc/gitlab.yml] action create (up to date)", "  ", "  * templatesymlink[Create a gitlab_workhorse_secret and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_workhorse_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a gitlab_shell_secret and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_shell_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a gitlab_incoming_email_secret and create a symlink to Rails root] action create (skipped due to only_if)", "  * templatesymlink[Create a gitlab_service_desk_email_secret and create a symlink to Rails root] action create (skipped due to only_if)", "  * templatesymlink[Create a gitlab_pages_secret and create a symlink to Rails root] action create[2025-08-04T10:22:55+00:00] WARN: only_if block for templatesymlink[Create a gitlab_pages_secret and create a symlink to Rails root] returned a string, did you mean to run a command?", "", "    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_pages_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] action create (up to date)", "     (up to date)", "  * templatesymlink[Create a gitlab_kas_secret and create a symlink to Rails root] action create[2025-08-04T10:22:55+00:00] WARN: only_if block for templatesymlink[Create a gitlab_kas_secret and create a symlink to Rails root] returned a string, did you mean to run a command?", "", "    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_kas_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] action create (up to date)", "     (up to date)", "  * link[/opt/gitlab/embedded/service/gitlab-rails/config/initializers/relative_url.rb] action delete (up to date)", "  * file[/var/opt/gitlab/gitlab-rails/etc/relative_url.rb] action delete (up to date)", "  * env_dir[/opt/gitlab/etc/gitlab-rails/env] action create", "    * directory[/opt/gitlab/etc/gitlab-rails/env] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/HOME] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/RAILS_ENV] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/PATH] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/ICU_DATA] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/PYTHONPATH] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/TZ] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE] action create (up to date)", "     (up to date)", "  * link[/opt/gitlab/embedded/service/gitlab-rails/tmp] action create (up to date)", "  * link[/opt/gitlab/embedded/service/gitlab-rails/public/uploads] action create (up to date)", "  * link[/opt/gitlab/embedded/service/gitlab-rails/log] action create (up to date)", "  * link[/var/log/gitlab/gitlab-rails/sidekiq.log] action delete (skipped due to only_if)", "  * file[/opt/gitlab/embedded/service/gitlab-rails/db/structure.sql] action create (up to date)", "  * remote_file[/var/opt/gitlab/gitlab-rails/VERSION] action create (up to date)", "  * remote_file[/var/opt/gitlab/gitlab-rails/REVISION] action create (up to date)", "  * version_file[Create version file for Rails] action create", "    * file[/var/opt/gitlab/gitlab-rails/RUBY_VERSION] action create (up to date)", "     (up to date)", "  * execute[clear the gitlab-rails cache] action nothing (skipped due to action :nothing)", "  * file[/var/opt/gitlab/gitlab-rails/config.ru] action delete (up to date)", "Recipe: gitlab::selinux", "  * execute[semodule -i /opt/gitlab/embedded/selinux/gitlab-7.2.0-ssh-keygen.pp] action run[2025-08-04T10:22:56+00:00] INFO: execute[Guard resource] ran successfully", " (skipped due to not_if)", "  * execute[semodule -i /opt/gitlab/embedded/selinux/gitlab-10.5.0-ssh-authorized-keys.pp] action run[2025-08-04T10:22:56+00:00] INFO: execute[Guard resource] ran successfully", " (skipped due to not_if)", "  * execute[semodule -i /opt/gitlab/embedded/selinux/gitlab-13.5.0-gitlab-shell.pp] action run[2025-08-04T10:22:56+00:00] INFO: execute[Guard resource] ran successfully", " (skipped due to not_if)", "  * execute[semodule -r gitlab] action run (skipped due to only_if)", "  * bash[Set proper security context on ssh files for selinux] action nothing (skipped due to action :nothing)", "Recipe: gitlab::add_trusted_certs", "  * directory[/etc/gitlab/trusted-certs] action create (up to date)", "  * directory[/opt/gitlab/embedded/ssl/certs] action create (up to date)", "  * file[/opt/gitlab/embedded/ssl/certs/README] action create (up to date)", "  * ruby_block[Move existing certs and link to /opt/gitlab/embedded/ssl/certs] action run (skipped due to only_if)", "Recipe: gitlab::default", "  * service[create a temporary puma service] action nothing (skipped due to action :nothing)", "  * service[create a temporary sidekiq service] action nothing (skipped due to action :nothing)", "  * service[create a temporary mailroom service] action nothing (skipped due to action :nothing)", "Recipe: package::runit_systemd", "  * directory[/usr/lib/systemd/system] action create (up to date)", "  * template[/usr/lib/systemd/system/gitlab-runsvdir.service] action create (up to date)", "  * file[/etc/systemd/system/default.target.wants/gitlab-runsvdir.service] action delete (up to date)", "  * file[/etc/systemd/system/basic.target.wants/gitlab-runsvdir.service] action delete (up to date)", "  * execute[systemctl daemon-reload] action nothing (skipped due to action :nothing)", "  * execute[systemctl enable gitlab-runsvdir] action nothing (skipped due to action :nothing)", "  * execute[systemctl start gitlab-runsvdir] action nothing (skipped due to action :nothing)", "Recipe: gitlab::gitlab-shell", "  * storage_directory[/var/opt/gitlab/.ssh] action create", "    * ruby_block[directory resource: /var/opt/gitlab/.ssh] action run (skipped due to not_if)", "     (up to date)", "  * directory[/var/opt/gitlab/gitlab-shell] action create (up to date)", "  * directory[/var/log/gitlab/gitlab-shell] action create (up to date)", "  * bash[generate gitlab-sshd host keys] action run (skipped due to only_if)", "  * templatesymlink[Create a config.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-shell/config.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-shell/config.yml to /var/opt/gitlab/gitlab-shell/config.yml] action create (up to date)", "     (up to date)", "  * link[/opt/gitlab/embedded/service/gitlab-shell/.gitlab_shell_secret] action create (up to date)", "  * file[/var/opt/gitlab/.ssh/authorized_keys] action create_if_missing (up to date)", "  * env_dir[/opt/gitlab/etc/gitlab-sshd/env] action nothing (skipped due to action :nothing)", "  * service[gitlab-sshd] action nothing (skipped due to action :nothing)", "  * runit_service[gitlab-sshd] action disable", "    * ruby_block[disable gitlab-sshd] action run (skipped due to only_if)", "     (up to date)", "Recipe: package::sysctl", "  * execute[reload all sysctl conf] action nothing (skipped due to action :nothing)", "Recipe: logrotate::folders_and_configs", "  * directory[/var/opt/gitlab/logrotate] action create (up to date)", "  * directory[/var/opt/gitlab/logrotate/logrotate.d] action create (up to date)", "  * directory[/var/log/gitlab/logrotate] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.conf] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/nginx] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/puma] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-rails] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-shell] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-pages] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-kas] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/gitaly] action create (up to date)", "  * template[/var/opt/gitlab/logrotate/logrotate.d/mailroom] action create (up to date)", "Recipe: logrotate::enable", "  * service[logrotate] action nothing (skipped due to action :nothing)", "  * runit_service[logrotate] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/logrotate] action create (up to date)", "    * template[/opt/gitlab/sv/logrotate/run] action create (up to date)", "    * directory[/opt/gitlab/sv/logrotate/log] action create (up to date)", "    * directory[/opt/gitlab/sv/logrotate/log/main] action create (up to date)", "    * template[/opt/gitlab/sv/logrotate/log/config] action create (up to date)", "    * ruby_block[verify_chown_persisted_on_logrotate] action nothing (skipped due to action :nothing)", "    * link[/var/log/gitlab/logrotate/config] action create (up to date)", "    * template[/opt/gitlab/sv/logrotate/log/run] action create (up to date)", "    * directory[/opt/gitlab/sv/logrotate/env] action create (up to date)", "    * ruby_block[Delete unmanaged env files for logrotate service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/logrotate/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/logrotate/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/logrotate/control] action create (up to date)", "    * template[/opt/gitlab/sv/logrotate/control/t] action create (up to date)", "    * link[/opt/gitlab/init/logrotate] action create (up to date)", "    * file[/opt/gitlab/sv/logrotate/down] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/logrotate] action create (up to date)", "    * ruby_block[wait for logrotate service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/logrotate/current] action touch (skipped due to only_if)", "     (up to date)", "Recipe: redis::enable", "  * redis_service[redis] action create[2025-08-04T10:22:56+00:00] WARN: redis does not have a log_group or default logdir mode defined. Setting to 0700.", "", "    * account[user and group for redis] action create", "      * group[user and group for redis] action create (up to date)", "      * linux_user[user and group for redis] action create (up to date)", "       (up to date)", "    * group[Socket group] action create (up to date)", "    * directory[/var/opt/gitlab/redis] action create (up to date)", "    * directory[/var/log/gitlab/redis] action create (up to date)", "    * template[/var/opt/gitlab/redis/redis.conf] action create (up to date)", "    * service[redis] action nothing (skipped due to action :nothing)", "    * runit_service[redis] action enable", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/redis] action create (up to date)", "      * template[/opt/gitlab/sv/redis/run] action create (up to date)", "      * directory[/opt/gitlab/sv/redis/log] action create (up to date)", "      * directory[/opt/gitlab/sv/redis/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/redis/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_redis] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/redis/config] action create (up to date)", "      * template[/opt/gitlab/sv/redis/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/redis/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for redis service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/redis/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/redis/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/redis/control] action create (up to date)", "      * link[/opt/gitlab/init/redis] action create (up to date)", "      * file[/opt/gitlab/sv/redis/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/redis] action create (up to date)", "      * ruby_block[wait for redis service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/redis/current] action touch (skipped due to only_if)", "       (up to date)", "    * ruby_block[warn pending redis restart] action run (skipped due to only_if)", "     (up to date)", "  * template[/opt/gitlab/etc/gitlab-redis-cli-rc] action create (up to date)", "Recipe: gitaly::enable", "  * directory[/var/opt/gitlab/gitaly] action create (up to date)", "  * directory[/var/opt/gitlab/gitaly/run] action create (up to date)", "  * directory[/var/log/gitlab/gitaly] action create (up to date)", "  * directory[/var/opt/gitlab/gitaly/internal_sockets] action delete (up to date)", "  * env_dir[/opt/gitlab/etc/gitaly/env] action create", "    * directory[/opt/gitlab/etc/gitaly/env] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/HOME] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/PATH] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/TZ] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/PYTHONPATH] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/ICU_DATA] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/SSL_CERT_DIR] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/GITALY_PID_FILE] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING] action create (up to date)", "    * file[/opt/gitlab/etc/gitaly/env/GODEBUG] action create (up to date)", "     (up to date)", "  * file[/var/opt/gitlab/gitaly/.gitlab_secret] action create (up to date)", "  * template[Create Gitaly config.toml] action create (up to date)", "  * service[gitaly] action nothing (skipped due to action :nothing)", "  * runit_service[gitaly] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/gitaly] action create (up to date)", "    * template[/opt/gitlab/sv/gitaly/run] action create (up to date)", "    * directory[/opt/gitlab/sv/gitaly/log] action create (up to date)", "    * directory[/opt/gitlab/sv/gitaly/log/main] action create (up to date)", "    * template[/opt/gitlab/sv/gitaly/log/config] action create (up to date)", "    * ruby_block[verify_chown_persisted_on_gitaly] action nothing (skipped due to action :nothing)", "    * link[/var/log/gitlab/gitaly/config] action create (up to date)", "    * template[/opt/gitlab/sv/gitaly/log/run] action create (up to date)", "    * directory[/opt/gitlab/sv/gitaly/env] action create (up to date)", "    * ruby_block[Delete unmanaged env files for gitaly service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitaly/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitaly/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/gitaly/control] action create (up to date)", "    * link[/opt/gitlab/init/gitaly] action create (up to date)", "    * file[/opt/gitlab/sv/gitaly/down] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/gitaly] action create (up to date)", "    * ruby_block[wait for gitaly service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/gitaly/current] action touch (skipped due to only_if)", "     (up to date)", "  * version_file[Create version file for Gitaly] action create", "    * file[/var/opt/gitlab/gitaly/VERSION] action create (up to date)", "     (up to date)", "  * consul_service[gitaly] action delete", "    * file[/var/opt/gitlab/consul/config.d/gitaly-service.json] action delete (up to date)", "     (up to date)", "Recipe: postgresql::bin", "  * ruby_block[check_postgresql_version] action run (skipped due to not_if)", "  * ruby_block[check_postgresql_version_is_deprecated] action run (skipped due to not_if)", "  * ruby_block[Link postgresql bin files to the correct version] action run (skipped due to only_if)", "  * template[/opt/gitlab/etc/gitlab-psql-rc] action create (up to date)", "Recipe: postgresql::user", "  * account[Postgresql user and group] action create", "    * group[Postgresql user and group] action create (up to date)", "    * linux_user[Postgresql user and group] action create (up to date)", "     (up to date)", "  * directory[/var/opt/gitlab/postgresql] action create (up to date)", "  * file[/var/opt/gitlab/postgresql/.profile] action create (up to date)", "Recipe: postgresql::sysctl", "  * gitlab_sysctl[kernel.shmmax] action create", "    * directory[create /etc/sysctl.d for kernel.shmmax] action create (up to date)", "    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.shmmax.conf kernel.shmmax] action create (up to date)", "    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.shmmax.conf] action create (up to date)", "    * execute[load sysctl conf kernel.shmmax] action nothing (skipped due to action :nothing)", "     (up to date)", "  * gitlab_sysctl[kernel.shmall] action create", "    * directory[create /etc/sysctl.d for kernel.shmall] action create (up to date)", "    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.shmall.conf kernel.shmall] action create (up to date)", "    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.shmall.conf] action create (up to date)", "    * execute[load sysctl conf kernel.shmall] action nothing (skipped due to action :nothing)", "     (up to date)", "  * gitlab_sysctl[kernel.sem] action create", "    * directory[create /etc/sysctl.d for kernel.sem] action create (up to date)", "    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.sem.conf kernel.sem] action create (up to date)", "    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.sem.conf] action create (up to date)", "    * execute[load sysctl conf kernel.sem] action nothing (skipped due to action :nothing)", "     (up to date)", "Recipe: postgresql::enable", "  * directory[/var/opt/gitlab/postgresql] action create (up to date)", "  * directory[/var/opt/gitlab/postgresql/data] action create (up to date)", "  * directory[/var/opt/gitlab/postgresql/data] action create (up to date)", "  * directory[/var/log/gitlab/postgresql] action create (up to date)", "  * execute[/opt/gitlab/embedded/bin/initdb -D /var/opt/gitlab/postgresql/data -E UTF8] action run (skipped due to not_if)", "  * file[/var/opt/gitlab/postgresql/data/server.crt] action create (up to date)", "  * file[/var/opt/gitlab/postgresql/data/server.key] action create (up to date)", "  * postgresql_config[gitlab] action create", "    * template[/var/opt/gitlab/postgresql/data/postgresql.conf] action create (up to date)", "    * template[/var/opt/gitlab/postgresql/data/runtime.conf] action create (up to date)", "    * template[/var/opt/gitlab/postgresql/data/pg_hba.conf] action create (up to date)", "    * template[/var/opt/gitlab/postgresql/data/pg_ident.conf] action create (up to date)", "     (up to date)", "Recipe: postgresql::standalone", "  * service[postgresql] action nothing (skipped due to action :nothing)", "  * runit_service[postgresql] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/postgresql] action create (up to date)", "    * template[/opt/gitlab/sv/postgresql/run] action create (up to date)", "    * directory[/opt/gitlab/sv/postgresql/log] action create (up to date)", "    * directory[/opt/gitlab/sv/postgresql/log/main] action create (up to date)", "    * template[/opt/gitlab/sv/postgresql/log/config] action create (up to date)", "    * ruby_block[verify_chown_persisted_on_postgresql] action nothing (skipped due to action :nothing)", "    * link[/var/log/gitlab/postgresql/config] action create (up to date)", "    * template[/opt/gitlab/sv/postgresql/log/run] action create (up to date)", "    * directory[/opt/gitlab/sv/postgresql/env] action create (up to date)", "    * ruby_block[Delete unmanaged env files for postgresql service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/postgresql/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/postgresql/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/postgresql/control] action create (up to date)", "    * template[/opt/gitlab/sv/postgresql/control/t] action create (up to date)", "    * link[/opt/gitlab/init/postgresql] action create (up to date)", "    * file[/opt/gitlab/sv/postgresql/down] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/postgresql] action create (up to date)", "    * ruby_block[wait for postgresql service socket] action run (skipped due to not_if)", "    * directory[/opt/gitlab/service/postgresql/supervise] action create (up to date)", "    * directory[/opt/gitlab/service/postgresql/log/supervise] action create (up to date)", "    * file[/opt/gitlab/service/postgresql/supervise/ok] action touch (skipped due to only_if)", "    * file[/opt/gitlab/service/postgresql/log/supervise/ok] action touch (skipped due to only_if)", "    * file[/opt/gitlab/service/postgresql/supervise/status] action touch (skipped due to only_if)", "    * file[/opt/gitlab/service/postgresql/log/supervise/status] action touch[2025-08-04T10:23:01+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] owner changed to 992", "[2025-08-04T10:23:01+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] group changed to 987", "", "      - change owner from 'root' to 'gitlab-psql'", "      - change group from 'root' to 'gitlab-psql'", "      - restore selinux security context[2025-08-04T10:23:01+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] updated atime and mtime to 2025-08-04 10:23:01 +0000", "", "      - update utime on file /opt/gitlab/service/postgresql/log/supervise/status", "    * file[/opt/gitlab/service/postgresql/supervise/control] action touch (skipped due to only_if)", "    * file[/opt/gitlab/service/postgresql/log/supervise/control] action touch (skipped due to only_if)", "    * file[/var/log/gitlab/postgresql/current] action touch (skipped due to only_if)", "  ", "  * database_objects[postgresql] action create", "    * postgresql_user[gitlab] action create", "      * execute[create gitlab postgresql user] action run (skipped due to not_if)", "       (up to date)", "    * postgresql_user[gitlab_replicator] action create", "      * execute[create gitlab_replicator postgresql user] action run (skipped due to not_if)", "      * execute[set options for gitlab_replicator postgresql user] action run (skipped due to not_if)", "       (up to date)", "    * postgresql_database[gitlabhq_production] action create", "      * execute[create database gitlabhq_production] action run (skipped due to not_if)", "       (up to date)", "    * postgresql_extension[pg_trgm] action enable", "      * postgresql_query[enable pg_trgm extension] action run (skipped due to only_if)", "       (up to date)", "    * postgresql_extension[btree_gist] action enable", "      * postgresql_query[enable btree_gist extension] action run (skipped due to only_if)", "       (up to date)", "    * postgresql_database[gitlabhq_production] action create", "      * execute[create database gitlabhq_production] action run (skipped due to not_if)", "       (up to date)", "    * postgresql_extension[pg_trgm] action enable", "      * postgresql_query[enable pg_trgm extension] action run (skipped due to only_if)", "       (up to date)", "    * postgresql_extension[btree_gist] action enable", "      * postgresql_query[enable btree_gist extension] action run (skipped due to only_if)", "       (up to date)", "     (up to date)", "  * version_file[Create version file for PostgreSQL] action create", "    * file[/var/opt/gitlab/postgresql/VERSION] action create (up to date)", "     (up to date)", "  * ruby_block[warn pending postgresql restart] action run (skipped due to only_if)", "  * execute[reload postgresql] action nothing (skipped due to action :nothing)", "  * execute[start postgresql] action nothing (skipped due to action :nothing)", "Recipe: praefect::disable", "  * service[praefect] action nothing (skipped due to action :nothing)", "  * runit_service[praefect] action disable", "    * ruby_block[disable praefect] action run (skipped due to only_if)", "     (up to date)", "  * consul_service[praefect] action delete", "    * file[/var/opt/gitlab/consul/config.d/praefect-service.json] action delete (up to date)", "     (up to date)", "Recipe: gitlab-kas::enable", "  * directory[/var/opt/gitlab/gitlab-kas] action create (up to date)", "  * directory[/opt/gitlab/etc/gitlab-kas] action create (up to date)", "  * directory[/var/log/gitlab/gitlab-kas] action create (up to date)", "  * version_file[Create version file for Gitlab KAS] action create", "    * file[/var/opt/gitlab/gitlab-kas/VERSION] action create (up to date)", "     (up to date)", "  * file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] action create (up to date)", "  * file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] action create (up to date)", "  * file[/var/opt/gitlab/gitlab-kas/websocket_token_secret_file] action create (up to date)", "  * file[/var/opt/gitlab/gitlab-kas/redis_password_file] action create (skipped due to only_if)", "  * file[/var/opt/gitlab/gitlab-kas/redis_sentinels_password_file] action create (skipped due to only_if)", "  * template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] action create (up to date)", "  * env_dir[/opt/gitlab/etc/gitlab-kas/env] action create", "    * directory[/opt/gitlab/etc/gitlab-kas/env] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-kas/env/GODEBUG] action create (up to date)", "     (up to date)", "  * service[gitlab-kas] action nothing (skipped due to action :nothing)", "  * runit_service[gitlab-kas] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/gitlab-kas] action create (up to date)", "    * template[/opt/gitlab/sv/gitlab-kas/run] action create (up to date)", "    * directory[/opt/gitlab/sv/gitlab-kas/log] action create (up to date)", "    * directory[/opt/gitlab/sv/gitlab-kas/log/main] action create (up to date)", "    * template[/opt/gitlab/sv/gitlab-kas/log/config] action create (up to date)", "    * ruby_block[verify_chown_persisted_on_gitlab-kas] action nothing (skipped due to action :nothing)", "    * link[/var/log/gitlab/gitlab-kas/config] action create (up to date)", "    * template[/opt/gitlab/sv/gitlab-kas/log/run] action create (up to date)", "    * directory[/opt/gitlab/sv/gitlab-kas/env] action create (up to date)", "    * ruby_block[Delete unmanaged env files for gitlab-kas service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitlab-kas/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitlab-kas/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/gitlab-kas/control] action create (up to date)", "    * link[/opt/gitlab/init/gitlab-kas] action create (up to date)", "    * file[/opt/gitlab/sv/gitlab-kas/down] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/gitlab-kas] action create (up to date)", "    * ruby_block[wait for gitlab-kas service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/gitlab-kas/current] action touch (skipped due to only_if)", "     (up to date)", "Recipe: gitlab::database_migrations", "  * ruby_block[check remote PG version] action nothing (skipped due to action :nothing)", "  * rails_migration[gitlab-rails] action run[2025-08-04T10:23:02+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.", "", "    * bash_hide_env[migrate gitlab-rails database] action run (skipped due to not_if)", "     (up to date)", "Recipe: crond::disable", "  * service[crond] action nothing (skipped due to action :nothing)", "  * runit_service[crond] action disable", "    * ruby_block[disable crond] action run[2025-08-04T10:23:08+00:00] INFO: ruby_block[disable crond] called", "", "      - execute the ruby block disable crond", "  ", "Recipe: gitlab::puma", "  * directory[/opt/gitlab/var/puma] action create (up to date)", "  * directory[/var/log/gitlab/puma] action create (up to date)", "  * directory[/var/opt/gitlab/gitlab-rails/sockets] action create (up to date)", "  * puma_config[/var/opt/gitlab/gitlab-rails/etc/puma.rb] action create", "    * directory[/var/opt/gitlab/gitlab-rails/etc] action create (up to date)", "    * template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] action create (up to date)", "     (up to date)", "  * service[puma] action nothing (skipped due to action :nothing)", "  * runit_service[puma] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/puma] action create (up to date)", "    * template[/opt/gitlab/sv/puma/run] action create (up to date)", "    * directory[/opt/gitlab/sv/puma/log] action create (up to date)", "    * directory[/opt/gitlab/sv/puma/log/main] action create (up to date)", "    * template[/opt/gitlab/sv/puma/log/config] action create (up to date)", "    * ruby_block[verify_chown_persisted_on_puma] action nothing (skipped due to action :nothing)", "    * link[/var/log/gitlab/puma/config] action create (up to date)", "    * template[/opt/gitlab/sv/puma/log/run] action create (up to date)", "    * directory[/opt/gitlab/sv/puma/env] action create (up to date)", "    * ruby_block[Delete unmanaged env files for puma service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/puma/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/puma/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/puma/control] action create (up to date)", "    * template[/opt/gitlab/sv/puma/control/t] action create (up to date)", "    * template[/opt/gitlab/sv/puma/control/h] action create (up to date)", "    * link[/opt/gitlab/init/puma] action create (up to date)", "    * file[/opt/gitlab/sv/puma/down] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/puma] action create (up to date)", "    * ruby_block[wait for puma service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/puma/current] action touch (skipped due to only_if)", "     (up to date)", "  * consul_service[rails] action delete", "    * file[/var/opt/gitlab/consul/config.d/rails-service.json] action delete (up to date)", "     (up to date)", "  * gitlab_sysctl[net.core.somaxconn] action create", "    * directory[create /etc/sysctl.d for net.core.somaxconn] action create (up to date)", "    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-net.core.somaxconn.conf net.core.somaxconn] action create (up to date)", "    * link[/etc/sysctl.d/90-omnibus-gitlab-net.core.somaxconn.conf] action create (up to date)", "    * execute[load sysctl conf net.core.somaxconn] action nothing (skipped due to action :nothing)", "     (up to date)", "Recipe: gitlab::sidekiq", "  * sidekiq_service[sidekiq] action enable[2025-08-04T10:23:08+00:00] WARN: sidekiq does not have a log_group or default logdir mode defined. Setting to 0700.", "", "    * directory[/var/log/gitlab/sidekiq] action create (up to date)", "    * service[sidekiq] action nothing (skipped due to action :nothing)", "    * runit_service[sidekiq] action enable", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/sidekiq] action create (up to date)", "      * template[/opt/gitlab/sv/sidekiq/run] action create (up to date)", "      * directory[/opt/gitlab/sv/sidekiq/log] action create (up to date)", "      * directory[/opt/gitlab/sv/sidekiq/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/sidekiq/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_sidekiq] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/sidekiq/config] action create (up to date)", "      * template[/opt/gitlab/sv/sidekiq/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/sidekiq/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for sidekiq service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/sidekiq/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/sidekiq/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/sidekiq/control] action create (up to date)", "      * link[/opt/gitlab/init/sidekiq] action create (up to date)", "      * file[/opt/gitlab/sv/sidekiq/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/sidekiq] action create (up to date)", "      * ruby_block[wait for sidekiq service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/sidekiq/current] action touch (skipped due to only_if)", "       (up to date)", "     (up to date)", "  * consul_service[sidekiq] action delete", "    * file[/var/opt/gitlab/consul/config.d/sidekiq-service.json] action delete (up to date)", "     (up to date)", "Recipe: gitlab::gitlab-workhorse", "  * directory[/var/opt/gitlab/gitlab-workhorse] action create (up to date)", "  * directory[/var/opt/gitlab/gitlab-workhorse/sockets] action create (up to date)", "  * directory[/var/log/gitlab/gitlab-workhorse] action create (up to date)", "  * directory[/opt/gitlab/etc/gitlab-workhorse] action create (up to date)", "  * env_dir[/opt/gitlab/etc/gitlab-workhorse/env] action create", "    * directory[/opt/gitlab/etc/gitlab-workhorse/env] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-workhorse/env/PATH] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-workhorse/env/HOME] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR] action create (up to date)", "    * file[/opt/gitlab/etc/gitlab-workhorse/env/GODEBUG] action create (up to date)", "     (up to date)", "  * service[gitlab-workhorse] action nothing (skipped due to action :nothing)", "  * runit_service[gitlab-workhorse] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/gitlab-workhorse] action create (up to date)", "    * template[/opt/gitlab/sv/gitlab-workhorse/run] action create (up to date)", "    * directory[/opt/gitlab/sv/gitlab-workhorse/log] action create (up to date)", "    * directory[/opt/gitlab/sv/gitlab-workhorse/log/main] action create (up to date)", "    * template[/opt/gitlab/sv/gitlab-workhorse/log/config] action create (up to date)", "    * ruby_block[verify_chown_persisted_on_gitlab-workhorse] action nothing (skipped due to action :nothing)", "    * link[/var/log/gitlab/gitlab-workhorse/config] action create (up to date)", "    * template[/opt/gitlab/sv/gitlab-workhorse/log/run] action create (up to date)", "    * directory[/opt/gitlab/sv/gitlab-workhorse/env] action create (up to date)", "    * ruby_block[Delete unmanaged env files for gitlab-workhorse service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitlab-workhorse/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitlab-workhorse/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/gitlab-workhorse/control] action create (up to date)", "    * link[/opt/gitlab/init/gitlab-workhorse] action create (up to date)", "    * file[/opt/gitlab/sv/gitlab-workhorse/down] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/gitlab-workhorse] action create (up to date)", "    * ruby_block[wait for gitlab-workhorse service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/gitlab-workhorse/current] action touch (skipped due to only_if)", "     (up to date)", "  * consul_service[workhorse] action delete", "    * file[/var/opt/gitlab/consul/config.d/workhorse-service.json] action delete (up to date)", "     (up to date)", "  * version_file[Create version file for Workhorse] action create", "    * file[/var/opt/gitlab/gitlab-workhorse/VERSION] action create (up to date)", "     (up to date)", "  * template[/var/opt/gitlab/gitlab-workhorse/config.toml] action create (up to date)", "Recipe: gitlab::mailroom_disable", "  * service[mailroom] action nothing (skipped due to action :nothing)", "  * runit_service[mailroom] action disable", "    * ruby_block[disable mailroom] action run (skipped due to only_if)", "     (up to date)", "Recipe: gitlab::nginx", "  * directory[/var/opt/gitlab/nginx] action create (up to date)", "  * directory[/var/opt/gitlab/nginx/conf] action create (up to date)", "  * directory[/var/log/gitlab/nginx] action create (up to date)", "  * link[/var/opt/gitlab/nginx/logs] action create (up to date)", "  * template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] action create[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/nginx/conf/gitlab-http.conf.chef-20250804102309.238788", "[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] updated file contents /var/opt/gitlab/nginx/conf/gitlab-http.conf", "", "    - update content in file /var/opt/gitlab/nginx/conf/gitlab-http.conf from d30136 to b8b24d", "    --- /var/opt/gitlab/nginx/conf/gitlab-http.conf\\t2025-08-04 10:19:58.061533795 +0000", "    +++ /var/opt/gitlab/nginx/conf/.chef-gitlab-http20250804-32489-iippqd.conf\\t2025-08-04 10:23:09.232330842 +0000", "    @@ -30,38 +30,7 @@", "     ##         configuration         ##", "     ###################################", "     ", "    -## Redirects all HTTP traffic to the HTTPS host", "    -server { ## HTTPS redirect server", "    -  listen *:80;", "     ", "    -  server_name server.example.com;", "    -  server_tokens off; ## Don't show the nginx version number, a security best practice", "    -", "    -  location /.well-known/acme-challenge/ {", "    -    root /var/opt/gitlab/nginx/www/;", "    -  }", "    -", "    -  location / {", "    -    return 301 https://server.example.com:443$request_uri;", "    -  }", "    -", "    -  # Pass headers because we are serving monitoring endpoints directly without", "    -  # redirection", "    -  proxy_set_header Host $http_host_with_default;", "    -  proxy_set_header X-Real-IP $remote_addr;", "    -  proxy_set_header X-Forwarded-For $remote_addr;", "    -  proxy_set_header Upgrade $http_upgrade;", "    -  proxy_set_header Connection $connection_upgrade;", "    -  proxy_set_header X-Forwarded-Ssl on;", "    -  proxy_set_header X-Forwarded-Proto https;", "    -", "    -  # health checks configuration", "    -  include /var/opt/gitlab/nginx/conf/gitlab-health.conf;", "    -", "    -  access_log  /var/log/gitlab/nginx/gitlab_access.log gitlab_access;", "    -  error_log   /var/log/gitlab/nginx/gitlab_error.log error;", "    -} ## end HTTPS redirect server", "    -", "     server { ## HTTPS server", "       listen *:443 ssl;", "     ", "    @@ -164,9 +133,6 @@", "       # health checks configuration", "       include /var/opt/gitlab/nginx/conf/gitlab-health.conf;", "     ", "    -  location /.well-known/acme-challenge/ {", "    -    root /var/opt/gitlab/nginx/www/;", "    -  }", "     ", "       location / {", "         proxy_cache off;", "    - restore selinux security context", "  * template[/var/opt/gitlab/nginx/conf/gitlab-smartcard-http.conf] action delete (up to date)", "  * template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] action create (up to date)", "  * template[/var/opt/gitlab/nginx/conf/gitlab-pages.conf] action delete (up to date)", "  * template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] action delete[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/nginx/conf/gitlab-registry.conf.chef-20250804102309.286718", "[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] deleted file at /var/opt/gitlab/nginx/conf/gitlab-registry.conf", "", "    - delete file /var/opt/gitlab/nginx/conf/gitlab-registry.conf", "[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] not queuing delayed action restart on runit_service[nginx] (delayed), as it's already been queued", "  * template[/var/opt/gitlab/nginx/conf/gitlab-mattermost-http.conf] action delete (up to date)", "  * template[/var/opt/gitlab/nginx/conf/gitlab-kas.conf] action delete (up to date)", "  * template[/var/opt/gitlab/nginx/conf/nginx-status.conf] action create (up to date)", "  * consul_service[nginx] action delete", "    * file[/var/opt/gitlab/consul/config.d/nginx-service.json] action delete (up to date)", "     (up to date)", "  * template[/var/opt/gitlab/nginx/conf/nginx.conf] action create[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/nginx/conf/nginx.conf.chef-20250804102309.307476", "[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] updated file contents /var/opt/gitlab/nginx/conf/nginx.conf", "", "    - update content in file /var/opt/gitlab/nginx/conf/nginx.conf from 3d8674 to 39503d", "    --- /var/opt/gitlab/nginx/conf/nginx.conf\\t2025-08-04 10:19:58.408535205 +0000", "    +++ /var/opt/gitlab/nginx/conf/.chef-nginx20250804-32489-qc9uhi.conf\\t2025-08-04 10:23:09.304331144 +0000", "    @@ -94,7 +94,6 @@", "     ", "     ", "     ", "    -  include /var/opt/gitlab/nginx/conf/gitlab-registry.conf;", "     ", "     ", "       include /var/opt/gitlab/nginx/conf/nginx-status.conf;", "    - restore selinux security context", "[2025-08-04T10:23:09+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] not queuing delayed action restart on runit_service[nginx] (delayed), as it's already been queued", "Recipe: nginx::enable", "  * service[nginx] action nothing (skipped due to action :nothing)", "  * runit_service[nginx] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/nginx] action create (up to date)", "    * template[/opt/gitlab/sv/nginx/run] action create (up to date)", "    * directory[/opt/gitlab/sv/nginx/log] action create (up to date)", "    * directory[/opt/gitlab/sv/nginx/log/main] action create (up to date)", "    * template[/opt/gitlab/sv/nginx/log/config] action create (up to date)", "    * ruby_block[verify_chown_persisted_on_nginx] action nothing (skipped due to action :nothing)", "    * link[/var/log/gitlab/nginx/config] action create (up to date)", "    * template[/opt/gitlab/sv/nginx/log/run] action create (up to date)", "    * directory[/opt/gitlab/sv/nginx/env] action create (up to date)", "    * ruby_block[Delete unmanaged env files for nginx service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/nginx/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/nginx/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/nginx/control] action create (up to date)", "    * link[/opt/gitlab/init/nginx] action create (up to date)", "    * file[/opt/gitlab/sv/nginx/down] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/nginx] action create (up to date)", "    * ruby_block[wait for nginx service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/nginx/current] action touch (skipped due to only_if)", "     (up to date)", "  * version_file[Create version file for NGINX] action create", "    * file[/var/opt/gitlab/nginx/VERSION] action create (up to date)", "     (up to date)", "  * execute[reload nginx] action nothing (skipped due to action :nothing)", "Recipe: gitlab::remote-syslog_disable", "  * service[remote-syslog] action nothing (skipped due to action :nothing)", "  * runit_service[remote-syslog] action disable", "    * ruby_block[disable remote-syslog] action run (skipped due to only_if)", "     (up to date)", "Recipe: gitlab::storage-check_disable", "  * service[storage-check] action nothing (skipped due to action :nothing)", "  * runit_service[storage-check] action disable", "    * ruby_block[disable storage-check] action run (skipped due to only_if)", "     (up to date)", "Recipe: gitlab-pages::disable", "  * service[gitlab-pages] action nothing (skipped due to action :nothing)", "  * runit_service[gitlab-pages] action disable", "    * ruby_block[disable gitlab-pages] action run (skipped due to only_if)", "     (up to date)", "Recipe: registry::disable", "  * service[registry] action nothing (skipped due to action :nothing)", "  * runit_service[registry] action disable", "    * ruby_block[disable registry] action run[2025-08-04T10:23:15+00:00] INFO: ruby_block[disable registry] called", "", "      - execute the ruby block disable registry", "  ", "Recipe: mattermost::disable", "  * service[mattermost] action nothing (skipped due to action :nothing)", "  * runit_service[mattermost] action disable", "    * ruby_block[disable mattermost] action run (skipped due to only_if)", "     (up to date)", "Recipe: letsencrypt::disable", "  * crond_job[letsencrypt-renew] action delete", "    * file[/var/opt/gitlab/crond/letsencrypt-renew] action delete (up to date)", "     (up to date)", "Recipe: gitlab::gitlab-healthcheck", "  * template[/opt/gitlab/etc/gitlab-healthcheck-rc] action create[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] created file /opt/gitlab/etc/gitlab-healthcheck-rc", "", "    - create new file /opt/gitlab/etc/gitlab-healthcheck-rc[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] updated file contents /opt/gitlab/etc/gitlab-healthcheck-rc", "", "    - update content in file /opt/gitlab/etc/gitlab-healthcheck-rc from none to 39c4ee", "    --- /opt/gitlab/etc/gitlab-healthcheck-rc\\t2025-08-04 10:23:15.619357587 +0000", "    +++ /opt/gitlab/etc/.chef-gitlab-healthcheck-rc20250804-32489-hr6a9e\\t2025-08-04 10:23:15.618357583 +0000", "    @@ -1,2 +1,4 @@", "    +url='https://localhost:443/help'", "    +flags=(--insecure)[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] owner changed to 0", "[2025-08-04T10:23:15+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] group changed to 0", "", "    - change owner from '' to 'root'", "    - change group from '' to 'root'", "    - restore selinux security context", "Recipe: monitoring::pgbouncer-exporter_disable", "  * service[pgbouncer-exporter] action nothing (skipped due to action :nothing)", "  * runit_service[pgbouncer-exporter] action disable", "    * ruby_block[disable pgbouncer-exporter] action run (skipped due to only_if)", "     (up to date)", "Recipe: monitoring::user", "  * account[Prometheus user and group] action create", "    * group[Prometheus user and group] action create[2025-08-04T10:23:15+00:00] INFO: group[Prometheus user and group] created", "", "      - create group gitlab-prometheus", "    * linux_user[Prometheus user and group] action create[2025-08-04T10:23:16+00:00] INFO: linux_user[Prometheus user and group] created", "", "      - create user gitlab-prometheus", "  ", "Recipe: monitoring::node-exporter", "  * directory[/var/log/gitlab/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: directory[/var/log/gitlab/node-exporter] created directory /var/log/gitlab/node-exporter", "", "    - create new directory /var/log/gitlab/node-exporter[2025-08-04T10:23:16+00:00] INFO: directory[/var/log/gitlab/node-exporter] owner changed to 990", "[2025-08-04T10:23:16+00:00] INFO: directory[/var/log/gitlab/node-exporter] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * directory[/opt/gitlab/etc/node-exporter/env] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/etc/node-exporter/env] created directory /opt/gitlab/etc/node-exporter/env", "", "    - create new directory /opt/gitlab/etc/node-exporter/env[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/etc/node-exporter/env] owner changed to 990", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/etc/node-exporter/env] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * env_dir[/opt/gitlab/etc/node-exporter/env] action create", "    * directory[/opt/gitlab/etc/node-exporter/env] action create (up to date)", "    * file[/opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR", "", "      - create new file /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR", "", "      - update content in file /opt/gitlab/etc/node-exporter/env/SSL_CERT_DIR from none to 4f45cf", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/node-exporter/env/GODEBUG] action create[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/GODEBUG] created file /opt/gitlab/etc/node-exporter/env/GODEBUG", "", "      - create new file /opt/gitlab/etc/node-exporter/env/GODEBUG[2025-08-04T10:23:16+00:00] INFO: file[/opt/gitlab/etc/node-exporter/env/GODEBUG] updated file contents /opt/gitlab/etc/node-exporter/env/GODEBUG", "", "      - update content in file /opt/gitlab/etc/node-exporter/env/GODEBUG from none to e6ab3f", "      - suppressed sensitive resource", "      - restore selinux security context", "  ", "  * directory[/var/opt/gitlab/node-exporter/textfile_collector] action create[2025-08-04T10:23:16+00:00] INFO: directory[/var/opt/gitlab/node-exporter/textfile_collector] created directory /var/opt/gitlab/node-exporter/textfile_collector", "", "    - create new directory /var/opt/gitlab/node-exporter/textfile_collector[2025-08-04T10:23:16+00:00] INFO: directory[/var/opt/gitlab/node-exporter/textfile_collector] owner changed to 990", "[2025-08-04T10:23:16+00:00] INFO: directory[/var/opt/gitlab/node-exporter/textfile_collector] mode changed to 755", "", "    - change mode from '' to '0755'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * service[node-exporter] action nothing (skipped due to action :nothing)", "  * runit_service[node-exporter] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] created directory /opt/gitlab/sv/node-exporter", "", "      - create new directory /opt/gitlab/sv/node-exporter[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/node-exporter/run] action create[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] created file /opt/gitlab/sv/node-exporter/run", "", "      - create new file /opt/gitlab/sv/node-exporter/run[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] updated file contents /opt/gitlab/sv/node-exporter/run", "", "      - update content in file /opt/gitlab/sv/node-exporter/run from none to 744544", "      --- /opt/gitlab/sv/node-exporter/run\\t2025-08-04 10:23:16.327360551 +0000", "      +++ /opt/gitlab/sv/node-exporter/.chef-run20250804-32489-g6s8s6\\t2025-08-04 10:23:16.326360547 +0000", "      @@ -1,8 +1,16 @@", "      +#!/bin/sh", "      +exec 2>&1", "      +", "      +umask 077", "      +exec chpst  /opt/gitlab/etc/node-exporter/env \\\\", "      +  -U gitlab-prometheus:gitlab-prometheus \\\\", "      +  -u gitlab-prometheus:gitlab-prometheus \\\\", "      +  /opt/gitlab/embedded/bin/node_exporter --web.listen-address=localhost:9100 --collector.mountstats --collector.runit --collector.runit.servicedir=/opt/gitlab/sv --collector.textfile.directory=/var/opt/gitlab/node-exporter/textfile_collector[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/node-exporter/log] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] created directory /opt/gitlab/sv/node-exporter/log", "", "      - create new directory /opt/gitlab/sv/node-exporter/log[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/node-exporter/log/main] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] created directory /opt/gitlab/sv/node-exporter/log/main", "", "      - create new directory /opt/gitlab/sv/node-exporter/log/main[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/log/main] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/node-exporter/log/config] action create[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] created file /opt/gitlab/sv/node-exporter/log/config", "", "      - create new file /opt/gitlab/sv/node-exporter/log/config[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] updated file contents /opt/gitlab/sv/node-exporter/log/config", "", "      - update content in file /opt/gitlab/sv/node-exporter/log/config from none to 623c00", "      --- /opt/gitlab/sv/node-exporter/log/config\\t2025-08-04 10:23:16.420360941 +0000", "      +++ /opt/gitlab/sv/node-exporter/log/.chef-config20250804-32489-wvfage\\t2025-08-04 10:23:16.420360941 +0000", "      @@ -1,6 +1,12 @@", "      +s209715200", "      +n30", "      +t86400", "      +!gzip", "      +", "      +[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] mode changed to 644", "", "      - change mode from '' to '0644'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[verify_chown_persisted_on_node-exporter] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:16+00:00] INFO: ruby_block[verify_chown_persisted_on_node-exporter] sent create action to ruby_block[verify_chown_persisted_on_node-exporter] (immediate at declaration time)", "    * ruby_block[verify_chown_persisted_on_node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: ruby_block[verify_chown_persisted_on_node-exporter] called", "", "      - execute the ruby block verify_chown_persisted_on_node-exporter", "    * link[/var/log/gitlab/node-exporter/config] action create[2025-08-04T10:23:16+00:00] INFO: link[/var/log/gitlab/node-exporter/config] created", "", "      - create symlink at /var/log/gitlab/node-exporter/config to /opt/gitlab/sv/node-exporter/log/config", "    * template[/opt/gitlab/sv/node-exporter/log/run] action create[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] created file /opt/gitlab/sv/node-exporter/log/run", "", "      - create new file /opt/gitlab/sv/node-exporter/log/run[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] updated file contents /opt/gitlab/sv/node-exporter/log/run", "", "      - update content in file /opt/gitlab/sv/node-exporter/log/run from none to ed81f2", "      --- /opt/gitlab/sv/node-exporter/log/run\\t2025-08-04 10:23:16.458361100 +0000", "      +++ /opt/gitlab/sv/node-exporter/log/.chef-run20250804-32489-214c5o\\t2025-08-04 10:23:16.458361100 +0000", "      @@ -1,5 +1,10 @@", "      +#!/bin/sh", "      +exec chpst  "      +  -U root:root \\\\", "      +  -u root:root \\\\", "      +  svlogd -tt /var/log/gitlab/node-exporter[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/node-exporter/env] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] created directory /opt/gitlab/sv/node-exporter/env", "", "      - create new directory /opt/gitlab/sv/node-exporter/env[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/env] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[Delete unmanaged env files for node-exporter service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/node-exporter/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/node-exporter/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/node-exporter/control] action create[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] created directory /opt/gitlab/sv/node-exporter/control", "", "      - create new directory /opt/gitlab/sv/node-exporter/control[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] owner changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] group changed to 0", "[2025-08-04T10:23:16+00:00] INFO: directory[/opt/gitlab/sv/node-exporter/control] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * link[/opt/gitlab/init/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: link[/opt/gitlab/init/node-exporter] created", "", "      - create symlink at /opt/gitlab/init/node-exporter to /opt/gitlab/embedded/bin/sv", "    * file[/opt/gitlab/sv/node-exporter/down] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/run] sending run action to ruby_block[restart_service] (delayed)", "    * ruby_block[restart_service] action run (skipped due to only_if)", "[2025-08-04T10:23:16+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)", "    * ruby_block[reload_log_service] action create", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/node-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/node-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/node-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/node-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/node-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_node-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/node-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/node-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/node-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for node-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/node-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/node-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/node-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/node-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/node-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/node-exporter] action create[2025-08-04T10:23:16+00:00] INFO: link[/opt/gitlab/service/node-exporter] created", "", "        - create symlink at /opt/gitlab/service/node-exporter to /opt/gitlab/sv/node-exporter", "      * ruby_block[wait for node-exporter service socket] action run[2025-08-04T10:23:17+00:00] INFO: ruby_block[wait for node-exporter service socket] called", "", "        - execute the ruby block wait for node-exporter service socket", "      * file[/var/log/gitlab/node-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:17+00:00] INFO: ruby_block[reload_log_service] called", "      - execute the ruby block reload_log_service", "[2025-08-04T10:23:17+00:00] INFO: template[/opt/gitlab/sv/node-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)", "    * ruby_block[restart_log_service] action run", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/node-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/node-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/node-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/node-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/node-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_node-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/node-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/node-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/node-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for node-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/node-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/node-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/node-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/node-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/node-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/node-exporter] action create (up to date)", "      * ruby_block[wait for node-exporter service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/node-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:19+00:00] INFO: ruby_block[restart_log_service] called", "      - execute the ruby block restart_log_service", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/node-exporter] action create (up to date)", "    * ruby_block[wait for node-exporter service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/node-exporter/current] action touch (skipped due to only_if)", "  ", "  * consul_service[node-exporter] action delete", "    * file[/var/opt/gitlab/consul/config.d/node-exporter-service.json] action delete (up to date)", "     (up to date)", "Recipe: monitoring::gitlab-exporter", "  * directory[/var/opt/gitlab/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] created directory /var/opt/gitlab/gitlab-exporter", "", "    - create new directory /var/opt/gitlab/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] owner changed to 994", "[2025-08-04T10:23:19+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] mode changed to 755", "", "    - change mode from '' to '0755'", "    - change owner from '' to 'git'", "    - restore selinux security context", "  * directory[/var/log/gitlab/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] created directory /var/log/gitlab/gitlab-exporter", "", "    - create new directory /var/log/gitlab/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] owner changed to 994", "[2025-08-04T10:23:19+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'git'", "    - restore selinux security context", "  * env_dir[/opt/gitlab/etc/gitlab-exporter/env] action create", "    * directory[/opt/gitlab/etc/gitlab-exporter/env] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/etc/gitlab-exporter/env] created directory /opt/gitlab/etc/gitlab-exporter/env", "", "      - create new directory /opt/gitlab/etc/gitlab-exporter/env", "      - restore selinux security context", "    * file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] created file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF", "", "      - create new file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] updated file contents /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF", "", "      - update content in file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF from none to 2ea29b", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS", "", "      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS", "", "      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS from none to 47b250", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO", "", "      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO", "", "      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO from none to c945fb", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO", "", "      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO", "", "      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO from none to 8a60e9", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR", "", "      - create new file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR", "", "      - update content in file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR from none to 4f45cf", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] action create[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] created file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE", "", "      - create new file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE[2025-08-04T10:23:19+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] updated file contents /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE", "", "      - update content in file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE from none to f7ce84", "      - suppressed sensitive resource", "      - restore selinux security context", "  ", "  * template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] action create[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] created file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml", "", "    - create new file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] updated file contents /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml", "", "    - update content in file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml from none to 167fe6", "    - suppressed sensitive resource[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] owner changed to 994", "[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] mode changed to 600", "", "    - change mode from '' to '0600'", "    - change owner from '' to 'git'", "    - restore selinux security context", "[2025-08-04T10:23:19+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] not queuing delayed action restart on runit_service[gitlab-exporter] (delayed), as it's already been queued", "  * version_file[Create version file for GitLab-Exporter] action create", "    * file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] action create[2025-08-04T10:23:19+00:00] INFO: file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] created file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION", "", "      - create new file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION[2025-08-04T10:23:19+00:00] INFO: file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] updated file contents /var/opt/gitlab/gitlab-exporter/RUBY_VERSION", "", "      - update content in file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION from none to a57ad3", "      --- /var/opt/gitlab/gitlab-exporter/RUBY_VERSION\\t2025-08-04 10:23:19.520373922 +0000", "      +++ /var/opt/gitlab/gitlab-exporter/.chef-RUBY_VERSION20250804-32489-7mrydf\\t2025-08-04 10:23:19.520373922 +0000", "      @@ -1 +1,2 @@", "      +ruby 3.2.5 (2024-07-26 revision 31d0f1a2e7) [x86_64-linux]", "      - restore selinux security context", "  ", "[2025-08-04T10:23:19+00:00] INFO: version_file[Create version file for GitLab-Exporter] not queuing delayed action restart on runit_service[gitlab-exporter] (delayed), as it's already been queued", "  * service[gitlab-exporter] action nothing (skipped due to action :nothing)", "  * runit_service[gitlab-exporter] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] created directory /opt/gitlab/sv/gitlab-exporter", "", "      - create new directory /opt/gitlab/sv/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/gitlab-exporter/run] action create[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] created file /opt/gitlab/sv/gitlab-exporter/run", "", "      - create new file /opt/gitlab/sv/gitlab-exporter/run[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] updated file contents /opt/gitlab/sv/gitlab-exporter/run", "", "      - update content in file /opt/gitlab/sv/gitlab-exporter/run from none to d78ca8", "      --- /opt/gitlab/sv/gitlab-exporter/run\\t2025-08-04 10:23:19.593374228 +0000", "      +++ /opt/gitlab/sv/gitlab-exporter/.chef-run20250804-32489-gn0fns\\t2025-08-04 10:23:19.592374224 +0000", "      @@ -1,9 +1,18 @@", "      +#!/bin/sh", "      +exec 2>&1", "      +", "      +umask 077", "      +exec chpst  /opt/gitlab/etc/gitlab-exporter/env \\\\", "      +  -U git:git \\\\", "      +  -u git:git \\\\", "      +  /opt/gitlab/embedded/bin/gitlab-exporter web \\\\", "      +  -c /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/gitlab-exporter/log] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] created directory /opt/gitlab/sv/gitlab-exporter/log", "", "      - create new directory /opt/gitlab/sv/gitlab-exporter/log[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] created directory /opt/gitlab/sv/gitlab-exporter/log/main", "", "      - create new directory /opt/gitlab/sv/gitlab-exporter/log/main[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] created file /opt/gitlab/sv/gitlab-exporter/log/config", "", "      - create new file /opt/gitlab/sv/gitlab-exporter/log/config[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] updated file contents /opt/gitlab/sv/gitlab-exporter/log/config", "", "      - update content in file /opt/gitlab/sv/gitlab-exporter/log/config from none to 623c00", "      --- /opt/gitlab/sv/gitlab-exporter/log/config\\t2025-08-04 10:23:19.689374630 +0000", "      +++ /opt/gitlab/sv/gitlab-exporter/log/.chef-config20250804-32489-fc6b11\\t2025-08-04 10:23:19.688374626 +0000", "      @@ -1,6 +1,12 @@", "      +s209715200", "      +n30", "      +t86400", "      +!gzip", "      +", "      +[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] mode changed to 644", "", "      - change mode from '' to '0644'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:19+00:00] INFO: ruby_block[verify_chown_persisted_on_gitlab-exporter] sent create action to ruby_block[verify_chown_persisted_on_gitlab-exporter] (immediate at declaration time)", "    * ruby_block[verify_chown_persisted_on_gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: ruby_block[verify_chown_persisted_on_gitlab-exporter] called", "", "      - execute the ruby block verify_chown_persisted_on_gitlab-exporter", "    * link[/var/log/gitlab/gitlab-exporter/config] action create[2025-08-04T10:23:19+00:00] INFO: link[/var/log/gitlab/gitlab-exporter/config] created", "", "      - create symlink at /var/log/gitlab/gitlab-exporter/config to /opt/gitlab/sv/gitlab-exporter/log/config", "    * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] created file /opt/gitlab/sv/gitlab-exporter/log/run", "", "      - create new file /opt/gitlab/sv/gitlab-exporter/log/run[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] updated file contents /opt/gitlab/sv/gitlab-exporter/log/run", "", "      - update content in file /opt/gitlab/sv/gitlab-exporter/log/run from none to 0b0a31", "      --- /opt/gitlab/sv/gitlab-exporter/log/run\\t2025-08-04 10:23:19.728374793 +0000", "      +++ /opt/gitlab/sv/gitlab-exporter/log/.chef-run20250804-32489-ss11ak\\t2025-08-04 10:23:19.728374793 +0000", "      @@ -1,5 +1,10 @@", "      +#!/bin/sh", "      +exec chpst  "      +  -U root:root \\\\", "      +  -u root:root \\\\", "      +  svlogd -tt /var/log/gitlab/gitlab-exporter[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/gitlab-exporter/env] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] created directory /opt/gitlab/sv/gitlab-exporter/env", "", "      - create new directory /opt/gitlab/sv/gitlab-exporter/env[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/gitlab-exporter/control] action create[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] created directory /opt/gitlab/sv/gitlab-exporter/control", "", "      - create new directory /opt/gitlab/sv/gitlab-exporter/control[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] owner changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] group changed to 0", "[2025-08-04T10:23:19+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * link[/opt/gitlab/init/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: link[/opt/gitlab/init/gitlab-exporter] created", "", "      - create symlink at /opt/gitlab/init/gitlab-exporter to /opt/gitlab/embedded/bin/sv", "    * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] sending run action to ruby_block[restart_service] (delayed)", "    * ruby_block[restart_service] action run (skipped due to only_if)", "[2025-08-04T10:23:19+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)", "    * ruby_block[reload_log_service] action create", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/gitlab-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/gitlab-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/gitlab-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/gitlab-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/gitlab-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/gitlab-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/gitlab-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/gitlab-exporter] action create[2025-08-04T10:23:19+00:00] INFO: link[/opt/gitlab/service/gitlab-exporter] created", "", "        - create symlink at /opt/gitlab/service/gitlab-exporter to /opt/gitlab/sv/gitlab-exporter", "      * ruby_block[wait for gitlab-exporter service socket] action run[2025-08-04T10:23:23+00:00] INFO: ruby_block[wait for gitlab-exporter service socket] called", "", "        - execute the ruby block wait for gitlab-exporter service socket", "      * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:23+00:00] INFO: ruby_block[reload_log_service] called", "      - execute the ruby block reload_log_service", "[2025-08-04T10:23:23+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)", "    * ruby_block[restart_log_service] action run", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/gitlab-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/gitlab-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/gitlab-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/gitlab-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/gitlab-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/gitlab-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/gitlab-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/gitlab-exporter] action create (up to date)", "      * ruby_block[wait for gitlab-exporter service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:25+00:00] INFO: ruby_block[restart_log_service] called", "      - execute the ruby block restart_log_service", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/gitlab-exporter] action create (up to date)", "    * ruby_block[wait for gitlab-exporter service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)", "  ", "  * consul_service[gitlab-exporter] action delete", "    * file[/var/opt/gitlab/consul/config.d/gitlab-exporter-service.json] action delete (up to date)", "     (up to date)", "Recipe: monitoring::redis-exporter", "  * directory[/var/log/gitlab/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: directory[/var/log/gitlab/redis-exporter] created directory /var/log/gitlab/redis-exporter", "", "    - create new directory /var/log/gitlab/redis-exporter[2025-08-04T10:23:25+00:00] INFO: directory[/var/log/gitlab/redis-exporter] owner changed to 993", "[2025-08-04T10:23:25+00:00] INFO: directory[/var/log/gitlab/redis-exporter] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-redis'", "    - restore selinux security context", "  * directory[/opt/gitlab/etc/redis-exporter/env] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] created directory /opt/gitlab/etc/redis-exporter/env", "", "    - create new directory /opt/gitlab/etc/redis-exporter/env[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] owner changed to 993", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-redis'", "    - restore selinux security context", "  * env_dir[/opt/gitlab/etc/redis-exporter/env] action create", "    * directory[/opt/gitlab/etc/redis-exporter/env] action create (up to date)", "    * file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR", "", "      - create new file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR", "", "      - update content in file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR from none to 4f45cf", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/redis-exporter/env/GODEBUG] action create[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/GODEBUG] created file /opt/gitlab/etc/redis-exporter/env/GODEBUG", "", "      - create new file /opt/gitlab/etc/redis-exporter/env/GODEBUG[2025-08-04T10:23:25+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/GODEBUG] updated file contents /opt/gitlab/etc/redis-exporter/env/GODEBUG", "", "      - update content in file /opt/gitlab/etc/redis-exporter/env/GODEBUG from none to e6ab3f", "      - suppressed sensitive resource", "      - restore selinux security context", "  ", "  * service[redis-exporter] action nothing (skipped due to action :nothing)", "  * runit_service[redis-exporter] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] created directory /opt/gitlab/sv/redis-exporter", "", "      - create new directory /opt/gitlab/sv/redis-exporter[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/redis-exporter/run] action create[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] created file /opt/gitlab/sv/redis-exporter/run", "", "      - create new file /opt/gitlab/sv/redis-exporter/run[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] updated file contents /opt/gitlab/sv/redis-exporter/run", "", "      - update content in file /opt/gitlab/sv/redis-exporter/run from none to a21d3f", "      --- /opt/gitlab/sv/redis-exporter/run\\t2025-08-04 10:23:25.554400255 +0000", "      +++ /opt/gitlab/sv/redis-exporter/.chef-run20250804-32489-46zoyf\\t2025-08-04 10:23:25.553400250 +0000", "      @@ -1,8 +1,16 @@", "      +#!/bin/sh", "      +exec 2>&1", "      +", "      +umask 077", "      +exec chpst  /opt/gitlab/etc/redis-exporter/env \\\\", "      +  -U gitlab-redis:git \\\\", "      +  -u gitlab-redis:git \\\\", "      +  /opt/gitlab/embedded/bin/redis_exporter --web.listen-address=localhost:9121 --redis.addr=unix:///var/opt/gitlab/redis/redis.socket[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/redis-exporter/log] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] created directory /opt/gitlab/sv/redis-exporter/log", "", "      - create new directory /opt/gitlab/sv/redis-exporter/log[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/redis-exporter/log/main] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] created directory /opt/gitlab/sv/redis-exporter/log/main", "", "      - create new directory /opt/gitlab/sv/redis-exporter/log/main[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/redis-exporter/log/config] action create[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] created file /opt/gitlab/sv/redis-exporter/log/config", "", "      - create new file /opt/gitlab/sv/redis-exporter/log/config[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] updated file contents /opt/gitlab/sv/redis-exporter/log/config", "", "      - update content in file /opt/gitlab/sv/redis-exporter/log/config from none to 623c00", "      --- /opt/gitlab/sv/redis-exporter/log/config\\t2025-08-04 10:23:25.651400683 +0000", "      +++ /opt/gitlab/sv/redis-exporter/log/.chef-config20250804-32489-jmycua\\t2025-08-04 10:23:25.650400679 +0000", "      @@ -1,6 +1,12 @@", "      +s209715200", "      +n30", "      +t86400", "      +!gzip", "      +", "      +[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] mode changed to 644", "", "      - change mode from '' to '0644'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:25+00:00] INFO: ruby_block[verify_chown_persisted_on_redis-exporter] sent create action to ruby_block[verify_chown_persisted_on_redis-exporter] (immediate at declaration time)", "    * ruby_block[verify_chown_persisted_on_redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: ruby_block[verify_chown_persisted_on_redis-exporter] called", "", "      - execute the ruby block verify_chown_persisted_on_redis-exporter", "    * link[/var/log/gitlab/redis-exporter/config] action create[2025-08-04T10:23:25+00:00] INFO: link[/var/log/gitlab/redis-exporter/config] created", "", "      - create symlink at /var/log/gitlab/redis-exporter/config to /opt/gitlab/sv/redis-exporter/log/config", "    * template[/opt/gitlab/sv/redis-exporter/log/run] action create[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] created file /opt/gitlab/sv/redis-exporter/log/run", "", "      - create new file /opt/gitlab/sv/redis-exporter/log/run[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] updated file contents /opt/gitlab/sv/redis-exporter/log/run", "", "      - update content in file /opt/gitlab/sv/redis-exporter/log/run from none to 2dc23f", "      --- /opt/gitlab/sv/redis-exporter/log/run\\t2025-08-04 10:23:25.690400856 +0000", "      +++ /opt/gitlab/sv/redis-exporter/log/.chef-run20250804-32489-lehtsz\\t2025-08-04 10:23:25.689400851 +0000", "      @@ -1,5 +1,10 @@", "      +#!/bin/sh", "      +exec chpst  "      +  -U root:root \\\\", "      +  -u root:root \\\\", "      +  svlogd -tt /var/log/gitlab/redis-exporter[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/redis-exporter/env] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] created directory /opt/gitlab/sv/redis-exporter/env", "", "      - create new directory /opt/gitlab/sv/redis-exporter/env[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/redis-exporter/control] action create[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] created directory /opt/gitlab/sv/redis-exporter/control", "", "      - create new directory /opt/gitlab/sv/redis-exporter/control[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] owner changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] group changed to 0", "[2025-08-04T10:23:25+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * link[/opt/gitlab/init/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: link[/opt/gitlab/init/redis-exporter] created", "", "      - create symlink at /opt/gitlab/init/redis-exporter to /opt/gitlab/embedded/bin/sv", "    * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] sending run action to ruby_block[restart_service] (delayed)", "    * ruby_block[restart_service] action run (skipped due to only_if)", "[2025-08-04T10:23:25+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)", "    * ruby_block[reload_log_service] action create", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/redis-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/redis-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/redis-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/redis-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/redis-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/redis-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/redis-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/redis-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/redis-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/redis-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/redis-exporter] action create[2025-08-04T10:23:25+00:00] INFO: link[/opt/gitlab/service/redis-exporter] created", "", "        - create symlink at /opt/gitlab/service/redis-exporter to /opt/gitlab/sv/redis-exporter", "      * ruby_block[wait for redis-exporter service socket] action run[2025-08-04T10:23:29+00:00] INFO: ruby_block[wait for redis-exporter service socket] called", "", "        - execute the ruby block wait for redis-exporter service socket", "      * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:29+00:00] INFO: ruby_block[reload_log_service] called", "      - execute the ruby block reload_log_service", "[2025-08-04T10:23:29+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)", "    * ruby_block[restart_log_service] action run", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/redis-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/redis-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/redis-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/redis-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/redis-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/redis-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/redis-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/redis-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/redis-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/redis-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/redis-exporter] action create (up to date)", "      * ruby_block[wait for redis-exporter service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:31+00:00] INFO: ruby_block[restart_log_service] called", "      - execute the ruby block restart_log_service", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/redis-exporter] action create (up to date)", "    * ruby_block[wait for redis-exporter service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)", "  ", "  * consul_service[redis-exporter] action delete", "    * file[/var/opt/gitlab/consul/config.d/redis-exporter-service.json] action delete (up to date)", "     (up to date)", "Recipe: monitoring::prometheus", "  * directory[/var/opt/gitlab/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus] created directory /var/opt/gitlab/prometheus", "", "    - create new directory /var/opt/gitlab/prometheus[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus] owner changed to 990", "[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus] mode changed to 750", "", "    - change mode from '' to '0750'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * directory[/var/opt/gitlab/prometheus/rules] action create[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] created directory /var/opt/gitlab/prometheus/rules", "", "    - create new directory /var/opt/gitlab/prometheus/rules[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] owner changed to 990", "[2025-08-04T10:23:31+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] mode changed to 750", "", "    - change mode from '' to '0750'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * directory[/var/log/gitlab/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: directory[/var/log/gitlab/prometheus] created directory /var/log/gitlab/prometheus", "", "    - create new directory /var/log/gitlab/prometheus[2025-08-04T10:23:31+00:00] INFO: directory[/var/log/gitlab/prometheus] owner changed to 990", "[2025-08-04T10:23:31+00:00] INFO: directory[/var/log/gitlab/prometheus] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * directory[/opt/gitlab/etc/prometheus/env] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] created directory /opt/gitlab/etc/prometheus/env", "", "    - create new directory /opt/gitlab/etc/prometheus/env[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] owner changed to 990", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * env_dir[/opt/gitlab/etc/prometheus/env] action create", "    * directory[/opt/gitlab/etc/prometheus/env] action create (up to date)", "    * file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] action create[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] created file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR", "", "      - create new file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR", "", "      - update content in file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR from none to 4f45cf", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/prometheus/env/GODEBUG] action create[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/GODEBUG] created file /opt/gitlab/etc/prometheus/env/GODEBUG", "", "      - create new file /opt/gitlab/etc/prometheus/env/GODEBUG[2025-08-04T10:23:31+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/GODEBUG] updated file contents /opt/gitlab/etc/prometheus/env/GODEBUG", "", "      - update content in file /opt/gitlab/etc/prometheus/env/GODEBUG from none to e6ab3f", "      - suppressed sensitive resource", "      - restore selinux security context", "  ", "  * execute[reload prometheus] action nothing (skipped due to action :nothing)", "  * file[Prometheus config] action create[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] created file /var/opt/gitlab/prometheus/prometheus.yml", "", "    - create new file /var/opt/gitlab/prometheus/prometheus.yml[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] updated file contents /var/opt/gitlab/prometheus/prometheus.yml", "", "    - update content in file /var/opt/gitlab/prometheus/prometheus.yml from none to 0fbf9e", "    --- /var/opt/gitlab/prometheus/prometheus.yml\\t2025-08-04 10:23:31.504426537 +0000", "    +++ /var/opt/gitlab/prometheus/.chef-prometheus20250804-32489-vpjgps.yml\\t2025-08-04 10:23:31.504426537 +0000", "    @@ -1,171 +1,342 @@", "    +---", "    +global:", "    +  scrape_interval: 15s", "    +  scrape_timeout: 15s", "    +  external_labels: {}", "    +remote_read: []", "    +remote_write: []", "    +rule_files:", "    +- \\"/var/opt/gitlab/prometheus/rules/*.rules\\"", "    +scrape_configs:", "    +- job_name: prometheus", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9090", "    +- job_name: nginx", "    +  static_configs:", "    +  - targets:", "    +    - localhost:8060", "    +- job_name: redis", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9121", "    +- job_name: postgres", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9187", "    +- job_name: node", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9100", "    +- job_name: gitlab-workhorse", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9229", "    +- job_name: gitlab-rails", "    +  metrics_path: \\"/-/metrics\\"", "    +  static_configs:", "    +  - targets:", "    +    - 127.0.0.1:8080", "    +  relabel_configs:", "    +  - source_labels:", "    +    - __address__", "    +    regex: 127.0.0.1:(.*)", "    +    replacement: localhost:$1", "    +    target_label: instance", "    +- job_name: gitlab-sidekiq", "    +  static_configs:", "    +  - targets:", "    +    - 127.0.0.1:8082", "    +  relabel_configs:", "    +  - source_labels:", "    +    - __address__", "    +    regex: 127.0.0.1:(.*)", "    +    replacement: localhost:$1", "    +    target_label: instance", "    +- job_name: gitlab_exporter_database", "    +  metrics_path: \\"/database\\"", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9168", "    +- job_name: gitlab_exporter_sidekiq", "    +  metrics_path: \\"/sidekiq\\"", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9168", "    +- job_name: gitlab_exporter_ruby", "    +  metrics_path: \\"/ruby\\"", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9168", "    +- job_name: gitaly", "    +  static_configs:", "    +  - targets:", "    +    - localhost:9236", "    +- job_name: kubernetes-cadvisor", "    +  scheme: https", "    +  tls_config:", "    +    ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"", "    +    insecure_skip_verify: true", "    +  bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"", "    +  kubernetes_sd_configs:", "    +  - role: node", "    +    api_server: https://kubernetes.default.svc:443", "    +    tls_config:", "    +      ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"", "    +    bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"", "    +  relabel_configs:", "    +  - action: labelmap", "    +    regex: __meta_kubernetes_node_label_(.+)", "    +  - target_label: __address__", "    +    replacement: kubernetes.default.svc:443", "    +  - source_labels:", "    +    - __meta_kubernetes_node_name", "    +    regex: \\"(.+)\\"", "    +    target_label: __metrics_path__", "    +    replacement: \\"/api/v1/nodes/${1}/proxy/metrics/cadvisor\\"", "    +  metric_relabel_configs:", "    +  - source_labels:", "    +    - pod_name", "    +    target_label: environment", "    +    regex: \\"(.+)-.+-.+\\"", "    +- job_name: kubernetes-nodes", "    +  scheme: https", "    +  tls_config:", "    +    ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"", "    +    insecure_skip_verify: true", "    +  bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"", "    +  kubernetes_sd_configs:", "    +  - role: node", "    +    api_server: https://kubernetes.default.svc:443", "    +    tls_config:", "    +      ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"", "    +    bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"", "    +  relabel_configs:", "    +  - action: labelmap", "    +    regex: __meta_kubernetes_node_label_(.+)", "    +  - target_label: __address__", "    +    replacement: kubernetes.default.svc:443", "    +  - source_labels:", "    +    - __meta_kubernetes_node_name", "    +    regex: \\"(.+)\\"", "    +    target_label: __metrics_path__", "    +    replacement: \\"/api/v1/nodes/${1}/proxy/metrics\\"", "    +  metric_relabel_configs:", "    +  - source_labels:", "    +    - pod_name", "    +    target_label: environment", "    +    regex: \\"(.+)-.+-.+\\"", "    +- job_name: kubernetes-pods", "    +  tls_config:", "    +    ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"", "    +    insecure_skip_verify: true", "    +  bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"", "    +  kubernetes_sd_configs:", "    +  - role: pod", "    +    api_server: https://kubernetes.default.svc:443", "    +    tls_config:", "    +      ca_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\"", "    +    bearer_token_file: \\"/var/run/secrets/kubernetes.io/serviceaccount/token\\"", "    +  relabel_configs:", "    +  - source_labels:", "    +    - __meta_kubernetes_pod_annotation_prometheus_io_scrape", "    +    action: keep", "    +    regex: 'true'", "    +  - source_labels:", "    +    - __meta_kubernetes_pod_annotation_prometheus_io_path", "    +    action: replace", "    +    target_label: __metrics_path__", "    +    regex: \\"(.+)\\"", "    +  - source_labels:", "    +    - __address__", "    +    - __meta_kubernetes_pod_annotation_prometheus_io_port", "    +    action: replace", "    +    regex: \\"([^:]+)(?::[0-9]+)?;([0-9]+)\\"", "    +    replacement: \\"$1:$2\\"", "    +    target_label: __address__", "    +  - action: labelmap", "    +    regex: __meta_kubernetes_pod_label_(.+)", "    +  - source_labels:", "    +    - __meta_kubernetes_namespace", "    +    action: replace", "    +    target_label: kubernetes_namespace", "    +  - source_labels:", "    +    - __meta_kubernetes_pod_name", "    +    action: replace", "    +    target_label: kubernetes_pod_name", "    +alerting:", "    +  alertmanagers:", "    +  - static_configs:", "    +    - targets:", "    +      - localhost:9093[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] owner changed to 990", "[2025-08-04T10:23:31+00:00] INFO: file[Prometheus config] mode changed to 644", "", "    - change mode from '' to '0644'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * service[prometheus] action nothing (skipped due to action :nothing)", "  * runit_service[prometheus] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] created directory /opt/gitlab/sv/prometheus", "", "      - create new directory /opt/gitlab/sv/prometheus[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/prometheus/run] action create[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] created file /opt/gitlab/sv/prometheus/run", "", "      - create new file /opt/gitlab/sv/prometheus/run[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] updated file contents /opt/gitlab/sv/prometheus/run", "", "      - update content in file /opt/gitlab/sv/prometheus/run from none to 60f91b", "      --- /opt/gitlab/sv/prometheus/run\\t2025-08-04 10:23:31.582426882 +0000", "      +++ /opt/gitlab/sv/prometheus/.chef-run20250804-32489-gukat7\\t2025-08-04 10:23:31.582426882 +0000", "      @@ -1,8 +1,16 @@", "      +#!/bin/sh", "      +exec 2>&1", "      +", "      +umask 077", "      +exec chpst  /opt/gitlab/etc/prometheus/env \\\\", "      +  -U gitlab-prometheus:gitlab-prometheus \\\\", "      +  -u gitlab-prometheus:gitlab-prometheus \\\\", "      +  /opt/gitlab/embedded/bin/prometheus --web.listen-address=localhost:9090 --storage.tsdb.path=/var/opt/gitlab/prometheus/data --config.file=/var/opt/gitlab/prometheus/prometheus.yml[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/prometheus/log] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] created directory /opt/gitlab/sv/prometheus/log", "", "      - create new directory /opt/gitlab/sv/prometheus/log[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/prometheus/log/main] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] created directory /opt/gitlab/sv/prometheus/log/main", "", "      - create new directory /opt/gitlab/sv/prometheus/log/main[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/prometheus/log/config] action create[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] created file /opt/gitlab/sv/prometheus/log/config", "", "      - create new file /opt/gitlab/sv/prometheus/log/config[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] updated file contents /opt/gitlab/sv/prometheus/log/config", "", "      - update content in file /opt/gitlab/sv/prometheus/log/config from none to 623c00", "      --- /opt/gitlab/sv/prometheus/log/config\\t2025-08-04 10:23:31.677427301 +0000", "      +++ /opt/gitlab/sv/prometheus/log/.chef-config20250804-32489-nv28cb\\t2025-08-04 10:23:31.676427297 +0000", "      @@ -1,6 +1,12 @@", "      +s209715200", "      +n30", "      +t86400", "      +!gzip", "      +", "      +[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] mode changed to 644", "", "      - change mode from '' to '0644'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:31+00:00] INFO: ruby_block[verify_chown_persisted_on_prometheus] sent create action to ruby_block[verify_chown_persisted_on_prometheus] (immediate at declaration time)", "    * ruby_block[verify_chown_persisted_on_prometheus] action create[2025-08-04T10:23:31+00:00] INFO: ruby_block[verify_chown_persisted_on_prometheus] called", "", "      - execute the ruby block verify_chown_persisted_on_prometheus", "    * link[/var/log/gitlab/prometheus/config] action create[2025-08-04T10:23:31+00:00] INFO: link[/var/log/gitlab/prometheus/config] created", "", "      - create symlink at /var/log/gitlab/prometheus/config to /opt/gitlab/sv/prometheus/log/config", "    * template[/opt/gitlab/sv/prometheus/log/run] action create[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] created file /opt/gitlab/sv/prometheus/log/run", "", "      - create new file /opt/gitlab/sv/prometheus/log/run[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] updated file contents /opt/gitlab/sv/prometheus/log/run", "", "      - update content in file /opt/gitlab/sv/prometheus/log/run from none to 8afdb7", "      --- /opt/gitlab/sv/prometheus/log/run\\t2025-08-04 10:23:31.715427469 +0000", "      +++ /opt/gitlab/sv/prometheus/log/.chef-run20250804-32489-dlluuf\\t2025-08-04 10:23:31.715427469 +0000", "      @@ -1,5 +1,10 @@", "      +#!/bin/sh", "      +exec chpst  "      +  -U root:root \\\\", "      +  -u root:root \\\\", "      +  svlogd -tt /var/log/gitlab/prometheus[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/prometheus/env] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] created directory /opt/gitlab/sv/prometheus/env", "", "      - create new directory /opt/gitlab/sv/prometheus/env[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/prometheus/control] action create[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] created directory /opt/gitlab/sv/prometheus/control", "", "      - create new directory /opt/gitlab/sv/prometheus/control[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] owner changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] group changed to 0", "[2025-08-04T10:23:31+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * link[/opt/gitlab/init/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: link[/opt/gitlab/init/prometheus] created", "", "      - create symlink at /opt/gitlab/init/prometheus to /opt/gitlab/embedded/bin/sv", "    * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] sending run action to ruby_block[restart_service] (delayed)", "    * ruby_block[restart_service] action run (skipped due to only_if)", "[2025-08-04T10:23:31+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] sending create action to ruby_block[reload_log_service] (delayed)", "    * ruby_block[reload_log_service] action create", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/prometheus] action create (up to date)", "      * template[/opt/gitlab/sv/prometheus/run] action create (up to date)", "      * directory[/opt/gitlab/sv/prometheus/log] action create (up to date)", "      * directory[/opt/gitlab/sv/prometheus/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/prometheus/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/prometheus/config] action create (up to date)", "      * template[/opt/gitlab/sv/prometheus/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/prometheus/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/prometheus/control] action create (up to date)", "      * link[/opt/gitlab/init/prometheus] action create (up to date)", "      * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/prometheus] action create[2025-08-04T10:23:31+00:00] INFO: link[/opt/gitlab/service/prometheus] created", "", "        - create symlink at /opt/gitlab/service/prometheus to /opt/gitlab/sv/prometheus", "      * ruby_block[wait for prometheus service socket] action run[2025-08-04T10:23:35+00:00] INFO: ruby_block[wait for prometheus service socket] called", "", "        - execute the ruby block wait for prometheus service socket", "      * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:35+00:00] INFO: ruby_block[reload_log_service] called", "      - execute the ruby block reload_log_service", "[2025-08-04T10:23:35+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] sending run action to ruby_block[restart_log_service] (delayed)", "    * ruby_block[restart_log_service] action run", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/prometheus] action create (up to date)", "      * template[/opt/gitlab/sv/prometheus/run] action create (up to date)", "      * directory[/opt/gitlab/sv/prometheus/log] action create (up to date)", "      * directory[/opt/gitlab/sv/prometheus/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/prometheus/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/prometheus/config] action create (up to date)", "      * template[/opt/gitlab/sv/prometheus/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/prometheus/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/prometheus/control] action create (up to date)", "      * link[/opt/gitlab/init/prometheus] action create (up to date)", "      * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/prometheus] action create (up to date)", "      * ruby_block[wait for prometheus service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:37+00:00] INFO: ruby_block[restart_log_service] called", "      - execute the ruby block restart_log_service", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/prometheus] action create (up to date)", "    * ruby_block[wait for prometheus service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)", "  ", "  * consul_service[prometheus] action delete", "    * file[/var/opt/gitlab/consul/config.d/prometheus-service.json] action delete (up to date)", "     (up to date)", "  * template[/var/opt/gitlab/prometheus/rules/gitlab.rules] action create[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] created file /var/opt/gitlab/prometheus/rules/gitlab.rules", "", "    - create new file /var/opt/gitlab/prometheus/rules/gitlab.rules[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] updated file contents /var/opt/gitlab/prometheus/rules/gitlab.rules", "", "    - update content in file /var/opt/gitlab/prometheus/rules/gitlab.rules from none to a55956", "    --- /var/opt/gitlab/prometheus/rules/gitlab.rules\\t2025-08-04 10:23:37.289452011 +0000", "    +++ /var/opt/gitlab/prometheus/rules/.chef-gitlab20250804-32489-xolssl.rules\\t2025-08-04 10:23:37.288452007 +0000", "    @@ -1,492 +1,984 @@", "    +---", "    +groups:", "    +- name: GitLab", "    +  rules:", "    +  - record: instance:puma_utilization:ratio", "    +    expr: >", "    +      sum by (instance) (", "    +        puma_active_connections", "    +      ) /", "    +      sum by (instance) (", "    +        puma_max_threads", "    +      )", "    +  - record: job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m", "    +    expr: >", "    +      sum by (job, route, method, code) (", "    +        rate(gitlab_workhorse_http_request_duration_seconds_count[5m])", "    +      )", "    +", "    +  - alert: ServiceDown", "    +    expr: avg_over_time(up[5m]) * 100 < 50", "    +    annotations:", "    +      description: The service {{ $labels.job }} instance {{ $labels.instance }} is", "    +        not responding for more than 50% of the time for 5 minutes.", "    +      summary: The service {{ $labels.job }} is not responding", "    +  - alert: RedisDown", "    +    expr: avg_over_time(redis_up[5m]) * 100 < 50", "    +    annotations:", "    +      description: The Redis service {{ $labels.job }} instance {{ $labels.instance", "    +        }} is not responding for more than 50% of the time for 5 minutes.", "    +      summary: The Redis service {{ $labels.job }} is not responding", "    +  - alert: PostgresDown", "    +    expr: avg_over_time(pg_up[5m]) * 100 < 50", "    +    annotations:", "    +      description: The Postgres service {{ $labels.job }} instance {{ $labels.instance", "    +        }} is not responding for more than 50% of the time for 5 minutes.", "    +      summary: The Postgres service {{ $labels.job }} is not responding", "    +  - alert: PumaQueueing", "    +    expr: avg_over_time(puma_queued_connections[30m]) > 1", "    +    annotations:", "    +      description: Puma instance {{ $labels.instance }} is queueing requests with", "    +        an average of {{ $value | printf \\"%.1f\\" }} over the last 30 minutes.", "    +      summary: Puma is queueing requests", "    +  - alert: HighPumaUtilization", "    +    expr: instance:puma_utilization:ratio * 100 > 90", "    +    for: 60m", "    +    annotations:", "    +      description: Puma instance {{ $labels.instance }} has more than 90% thread utilization ({{ $value | printf \\"%.1f\\" }}%) over the last 60 minutes.", "    +      summary: Puma is has high utilization", "    +  - alert: SidekiqJobsQueuing", "    +    expr: sum by (name) (sidekiq_queue_size) > 0", "    +    for: 60m", "    +    annotations:", "    +      summary: Sidekiq has jobs queued", "    +      description: Sidekiq queue {{ $labels.name }} has {{ $value }} jobs queued for 60 minutes.", "    +  - alert: HighgRPCResourceExhaustedRate", "    +    expr: >", "    +      sum without (grpc_code, grpc_method, grpc_service, grpc_type) (", "    +        rate(grpc_server_handled_total{grpc_code=\\"ResourceExhausted\\"}[5m])", "    +      ) /", "    +      sum without (grpc_code, grpc_method, grpc_service, grpc_type) (", "    +        rate(grpc_server_handled_total[5m])", "    +      ) * 100 > 1", "    +    for: 60m", "    +    annotations:", "    +      summary: High gRPC ResourceExhausted error rate", "    +      description: Job {{ $labels.job }} instance {{ $labels.instance }} gRPC is returning more than 1% ({{ $value | printf \\"%.1f\\" }}%) ResourceExhausted errors over the last 60 minutes.", "    +  - alert: PostgresDatabaseDeadlocks", "    +    expr: increase(pg_stat_database_deadlocks[5m]) > 0", "    +    annotations:", "    +      summary: Postgres database has deadlocks", "    +      description: Postgres database {{ $labels.instance }} had {{ $value | printf \\"%d\\" }} deadlocks in the last 5 minutes.", "    +  - alert: PostgresDatabaseDeadlockCancels", "    +    expr: increase(pg_stat_database_deadlocks[5m]) > 0", "    +    annotations:", "    +      summary: Postgres database has queries canceled due to deadlocks", "    +      description: Postgres database {{ $labels.instance }} had {{ $value | printf \\"%d\\" }} queries canceled due to deadlocks in the last 5 minutes.", "    +  # Low-traffic - < 10 QPS (600 RPM)", "    +  - alert: WorkhorseHighErrorRate", "    +    expr: >", "    +      (", "    +        sum without (job, code) (", "    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m{code=~\\"5..\\"}", "    +        ) /", "    +        sum without (job,code) (", "    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m", "    +        ) < 10", "    +      ) * 100 > 50", "    +    annotations:", "    +      summary: Workhorse has high error rates", "    +      description: Workhorse route {{ $labels.route }} method {{ $labels.method }} has more than 50% errors ({{ $value | printf \\"%.1f\\" }}%) for the last 60 minutes.", "    +  # High-traffic - >= 10 QPS (600 RPM)", "    +  - alert: WorkhorseHighErrorRate", "    +    expr: >", "    +      (", "    +        sum without (job, code) (", "    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m{code=~\\"5..\\"}", "    +        ) /", "    +        sum without (job,code) (", "    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m", "    +        ) > 10", "    +      ) * 100 > 10", "    +    annotations:", "    +      summary: Workhorse has high error rates", "    +      description: Workhorse route {{ $labels.route }} method {{ $labels.method }} has more than 10% errors ({{ $value | printf \\"%.1f\\" }}%) for the last 60 minutes.", "    +", "    +###", "    +# These metrics are top-level GitLab Service Level Indicators (SLIs). They can", "    +# be used to monitor the overall health of a GitLab instance.", "    +- name: Service Level Indicators", "    +  interval: 30s", "    +  rules:", "    +  # Service availability.", "    +  - record: gitlab_sli:job:availability:ratio", "    +    expr: >", "    +      avg by (job) (", "    +        avg_over_time(up[30s])", "    +      )", "    +  # Rails worker/thread capacity.", "    +  - record: gitlab_sli:rails_active_connections:avg30s", "    +    expr: >", "    +      sum(avg_over_time(puma_active_connections[30s]))", "    +  - record: gitlab_sli:rails_queued_connections:avg30s", "    +    expr: >", "    +      sum(avg_over_time(puma_queued_connections[30s]))", "    +  - record: gitlab_sli:rails_active_connections:max30s", "    +    expr: >", "    +      sum(max_over_time(puma_active_connections[30s]))", "    +  - record: gitlab_sli:rails_queued_connections:max30s", "    +    expr: >", "    +      sum(max_over_time(puma_queued_connections[30s]))", "    +  - record: gitlab_sli:rails_workers:avg30s", "    +    expr: >", "    +      count(avg_over_time(ruby_memory_bytes[30s])) or", "    +      sum(avg_over_time(puma_max_threads[30s]))", "    +  # Redis CPU use.", "    +  - record: gitlab_sli:redis_cpu_seconds:rate1m", "    +    expr: >", "    +      (sum(rate(redis_used_cpu_sys[1m])) + sum(rate(redis_used_cpu_user[1m]))) or", "    +      (sum(rate(redis_cpu_sys_seconds_total[1m])) + sum(rate(redis_cpu_user_seconds_total[1m])))", "    +  # Workhorse traffic.", "    +  - record: gitlab_sli:code_method_route:workhorse_http_request_count:rate1m", "    +    expr: >", "    +      sum by (code,method,route) (", "    +        rate(gitlab_workhorse_http_request_duration_seconds_count[1m])", "    +      )", "    +  - record: gitlab_sli:code_method_route:workhorse_http_request_duration_seconds:rate1m", "    +    expr: >", "    +      sum by (code,method,route) (", "    +        rate(gitlab_workhorse_http_request_duration_seconds_sum[1m])", "    +      )", "    +# SLI - Apdex", "    +- name: Service Level Indicators - Apdex", "    +  interval: 1m", "    +  rules:", "    +  # Gitaly goserver", "    +  # Satisfied -> 0.5 seconds", "    +  # Acceptable -> 1 seconds", "    +  - record: gitlab_sli:gitlab_component_apdex:ratio", "    +    labels:", "    +      job: gitaly", "    +    expr: >", "    +      (", "    +        sum(rate(grpc_server_handling_seconds_bucket{job=\\"gitaly\\",grpc_type=\\"unary\\",le=\\"0.5\\",grpc_method!~\\"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef\\"}[1m]))", "    +        +", "    +        sum(rate(grpc_server_handling_seconds_bucket{job=\\"gitaly\\",grpc_type=\\"unary\\",le=\\"1\\",grpc_method!~\\"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef\\"}[1m]))", "    +      )", "    +      /", "    +      2 / sum(rate(grpc_server_handling_seconds_count{job=\\"gitaly\\",grpc_type=\\"unary\\",grpc_method!~\\"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef\\"}[1m]))", "    +  # Sidekiq TODO: https://gitlab.com/gitlab-org/gitlab-foss/issues/56752", "    +  # - record: gitlab_sli:gitlab_component_apdex:ratio", "    +  #   labels:", "    +  #     job: gitlab-sidekiq", "    +  #   expr: >", "    +  #     (", "    +  #       sum(rate(sidekiq_jobs_completion_time_seconds_bucket{le=\\"25\\"}[1m]))", "    +  #       +", "    +  #       sum(rate(sidekiq_jobs_completion_time_seconds_bucket{le=\\"50\\"}[1m]))", "    +  #     )", "    +  #     / 2", "    +  #     /", "    +  #     sum(rate(sidekiq_jobs_completion_time_seconds_count[1m]))", "    +", "    +  # Workhorse", "    +  # Satisfied -> 1 seconds", "    +  # Acceptable -> 10 seconds", "    +  - record: gitlab_sli:gitlab_component_apdex:ratio", "    +    labels:", "    +      job: gitlab-workhorse", "    +    expr: >", "    +      (", "    +        sum(rate(gitlab_workhorse_http_request_duration_seconds_bucket{le=\\"1\\",route!=\\"^/([^/]+/){1,}[^/]+/uploads\\\\\\\\z\\",route!=\\"^/api/v4/jobs/request\\\\\\\\z\\"}[1m]))", "    +      +", "    +        sum(rate(gitlab_workhorse_http_request_duration_seconds_bucket{le=\\"10\\",route!=\\"^/([^/]+/){1,}[^/]+/uploads\\\\\\\\z\\",route!=\\"^/api/v4/jobs/request\\\\\\\\z\\"}[1m]))", "    +      )", "    +      /", "    +      2 / sum(rate(gitlab_workhorse_http_request_duration_seconds_count{route!=\\"^/([^/]+/){1,}[^/]+/uploads\\\\\\\\z\\",route!=\\"^/api/v4/jobs/request\\\\\\\\z\\"}[1m]))", "    +", "    +# SLI - Errors", "    +- name: Service Level Indicators - Errors", "    +  interval: 1m", "    +  rules:", "    +  # PostgreSQL", "    +  - record: gitlab_sli:gitlab_component_ops:rate", "    +    labels:", "    +      job: postgres", "    +    expr: >", "    +      sum(rate(pg_stat_database_xact_commit[1m])) +", "    +      sum(rate(pg_stat_database_xact_rollback[1m]))", "    +  - record: gitlab_sli:gitlab_component_errors:rate", "    +    labels:", "    +      job: postgres", "    +    expr: sum(rate(pg_stat_database_xact_rollback[1m]))", "    +  # Rails (Puma)", "    +  - record: gitlab_sli:gitlab_component_ops:rate", "    +    labels:", "    +      job: gitlab-rails", "    +    expr: >", "    +      sum(", "    +        rate(http_request_duration_seconds_count{job=\\"gitlab-rails\\"}[1m])", "    +      )", "    +  - record: gitlab_sli:gitlab_component_errors:rate", "    +    labels:", "    +      job: gitlab-rails", "    +    expr: >", "    +      sum(", "    +        rate(http_request_duration_seconds_count{job=\\"gitlab-rails\\",status=~\\"5..\\"}[1m])", "    +      )", "    +  # Sidekiq TODO: https://gitlab.com/gitlab-org/gitlab-foss/issues/56752", "    +  # - record: gitlab_sli:gitlab_component_ops:rate", "    +  #   labels:", "    +  #     job: gitlab-sidekiq", "    +  #   expr: >", "    +  #     sum (", "    +  #       rate(sidekiq_jobs_started_total{job=\\"gitlab-sidekiq\\"}[1m])", "    +  #     )", "    +  # - record: gitlab_sli:gitlab_component_errors:rate", "    +  #   labels:", "    +  #     job: gitlab-sidekiq", "    +  #   expr: >", "    +  #     sum (", "    +  #       rate(sidekiq_jobs_failed_total{job=\\"gitlab-sidekiq\\"}[1m])", "    +  #     )", "    +  # Workhorse", "    +  - record: gitlab_sli:gitlab_component_ops:rate", "    +    labels:", "    +      job: gitlab-workhorse", "    +    expr: >", "    +      sum(", "    +        rate(gitlab_workhorse_http_requests_total{job=\\"gitlab-workhorse\\"}[1m])", "    +      )", "    +  - record: gitlab_sli:gitlab_component_errors:rate", "    +    labels:", "    +      job: gitlab-workhorse", "    +    expr: >", "    +      sum(", "    +        rate(gitlab_workhorse_http_requests_total{job=\\"gitlab-workhorse\\",code=~\\"5..\\"}[1m])", "    +      )", "    +  ###", "    +  # Calculate service error ratios", "    +  - record: gitlab_sli:gitlab_component_errors:ratio", "    +    expr: >", "    +      gitlab_sli:gitlab_component_errors:rate /", "    +      gitlab_sli:gitlab_component_ops:rate", "    +", "    +- name: GitLab Saturation Ratios", "    +  interval: 1m", "    +  rules:", "    +  # type: *, component: cpu", "    +  # this measures average CPU across all the cores for the entire fleet for the given service", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'cpu'", "    +    expr: >", "    +      avg(1 - rate(node_cpu_seconds_total{mode=\\"idle\\"}[1m]))", "    +", "    +  # type: *, component: single_node_cpu", "    +  # this measures the maximum cpu availability across all the codes on a single server", "    +  # this can be helpful if CPU is not even distributed across the fleet.", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'single_node_cpu'", "    +    expr: >", "    +      max(", "    +        avg(1 - rate(node_cpu_seconds_total{mode=\\"idle\\"}[1m]))", "    +      )", "    +", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'disk_space'", "    +    expr: >", "    +      max(", "    +        (", "    +          (", "    +            node_filesystem_size_bytes{fstype=~\\"ext.|xfs|nfs.?\\"}", "    +            -", "    +            node_filesystem_free_bytes{fstype=~\\"ext.|xfs|nfs.?\\"}", "    +          )", "    +          /", "    +          node_filesystem_size_bytes{fstype=~\\"ext.|xfs|nfs.?\\"}", "    +        )", "    +      )", "    +", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'memory'", "    +    expr: max (instance:node_memory_utilization:ratio)", "    +", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'single_threaded_cpu'", "    +    expr: >", "    +      clamp_max(", "    +        max (", "    +         (rate(redis_cpu_user_seconds_total[1m]) + rate(redis_cpu_sys_seconds_total[1m])) or", "    +         (rate(redis_used_cpu_user[1m]) + rate(redis_used_cpu_sys[1m]))", "    +        ),", "    +        1", "    +      )", "    +", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'connection_pool'", "    +    expr: >", "    +      clamp_max(", "    +        max(", "    +          max_over_time(pgbouncer_pools_server_active_connections{user=\\"gitlab\\"}[1m]) /", "    +          (", "    +            (", "    +              pgbouncer_pools_server_idle_connections{user=\\"gitlab\\"} +", "    +              pgbouncer_pools_server_active_connections{user=\\"gitlab\\"} +", "    +              pgbouncer_pools_server_testing_connections{user=\\"gitlab\\"} +", "    +              pgbouncer_pools_server_used_connections{user=\\"gitlab\\"} +", "    +              pgbouncer_pools_server_login_connections{user=\\"gitlab\\"}", "    +            )", "    +            > 0", "    +          )", "    +      ), 1)", "    +", "    +  # type: postgres-delayed, postgres-archive, patroni", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'active_db_connections'", "    +    expr: >", "    +      clamp_max(", "    +        max(", "    +          sum without(state) (pg_stat_activity_count{datname=\\"gitlabhq_production\\", state!=\\"idle\\"})", "    +          /", "    +          (sum without(state) (pg_stat_activity_count{datname=\\"gitlabhq_production\\"}) > 0)", "    +      ), 1)", "    +", "    +  # type: redis, redis-cache, component: redis_clients", "    +  # Records the saturation of redis client connections against a redis fleet", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'redis_clients'", "    +    expr: >", "    +      max(", "    +        max_over_time(redis_connected_clients[1m])", "    +        /", "    +        redis_config_maxclients", "    +      )", "    +", "    +  # Aggregate over all components within a service using max", "    +  - record: gitlab_sli:gitlab_service_saturation:ratio", "    +    expr: >", "    +      max by (component) (gitlab_sli:gitlab_component_saturation:ratio)", "    +", "    +  # Calculate the \\"sapdex\\" - the saturation apdex for the metric. 1 < less then soft limit, 0.5 < hard limit, else 0", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex", "    +    expr: >", "    +      clamp_min(gitlab_sli:gitlab_component_saturation:ratio <= on(component) group_left slo:max:soft:gitlab_sli:gitlab_component_saturation:ratio, 1)", "    +      or", "    +      clamp_min(clamp_max(gitlab_sli:gitlab_component_saturation:ratio > on(component) group_left slo:max:soft:gitlab_sli:gitlab_component_saturation:ratio, 0.5), 0.5)", "    +      or", "    +      clamp_max(gitlab_sli:gitlab_component_saturation:ratio > on(component) group_left slo:max:hard:gitlab_sli:gitlab_component_saturation:ratio, 0)", "    +", "    +  # Open file descriptors", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'open_fds'", "    +    expr: >", "    +      max(", "    +        max_over_time(process_open_fds[1m])", "    +        /", "    +        max_over_time(process_max_fds[1m])", "    +      )", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio", "    +    labels:", "    +      component: 'open_ruby_fds'", "    +    expr: >", "    +      max(", "    +        max_over_time(ruby_file_descriptors[1m])", "    +        /", "    +        max_over_time(ruby_process_max_fds[1m])", "    +      )", "    +", "    +# Unlike other service metrics, we record the stats for each component independently", "    +- name: GitLab Saturation Ratios Stats", "    +  interval: 5m", "    +  rules:", "    +  # Average values for each service, over a week", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w", "    +    expr: >", "    +      avg_over_time(gitlab_sli:gitlab_component_saturation:ratio[1w])", "    +", "    +  # Using linear week-on-week growth, what prediction to we have for 2w from now?", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio:predict_linear_2w", "    +    expr: >", "    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w[1w], 86400 * 14)", "    +", "    +  # Using linear week-on-week growth, what prediction to we have for 30d from now?", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio:predict_linear_30d", "    +    expr: >", "    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w[1w], 86400 * 30)", "    +", "    +  # Sapdex, average for week", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w", "    +    expr: >", "    +      avg_over_time(gitlab_sli:gitlab_component_saturation:ratio:sapdex[1w])", "    +", "    +  # Sapdex long term trend forecasting", "    +  # Using linear week-on-week growth, what prediction to we have for 30d from now?", "    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w:predict_linear_30d", "    +    expr: >", "    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w[1w], 86400 * 30)", "    +", "    +###", "    +# Metrics used by Usage Ping reports. These are primarily for self-managed installations.", "    +# See https://docs.gitlab.com/ee/development/telemetry/usage_ping.html#prometheus-queries", "    +#", "    +- name: GitLab Usage Ping", "    +  interval: 5m", "    +  rules:", "    +  ###", "    +  # Application wide metrics", "    +  #", "    +  - record: gitlab_usage_ping:ops:rate5m", "    +    labels:", "    +      service: workhorse", "    +      component: http_requests", "    +    expr: sum (rate (gitlab_workhorse_http_requests_total[5m]))", "    +", "    +  # Database Primary Performance Indicator: Query apdex", "    +  # Target -> 100ms", "    +  # Tolerable -> 250ms", "    +  - record: gitlab_usage_ping:sql_duration_apdex:ratio_rate5m", "    +    expr: >", "    +      (", "    +        sum(rate(gitlab_sql_duration_seconds_bucket{le=\\"0.1\\"}[5m]))", "    +        +", "    +        sum(rate(gitlab_sql_duration_seconds_bucket{le=\\"0.25\\"}[5m]))", "    +      )", "    +      /", "    +      2", "    +      /", "    +      (", "    +        sum(rate(gitlab_sql_duration_seconds_count[5m])) > 0", "    +      )", "    +", "    +  - record: gitlab_usage_ping:gitaly_apdex:ratio_avg_over_time_5m", "    +    expr: avg_over_time(gitlab_sli:gitlab_component_apdex:ratio{job=\\"gitaly\\"}[5m])", "    +", "    +  ###", "    +  # Node level metrics", "    +  #", "    +  - record: gitlab_usage_ping:node_cpus:count", "    +    expr: max (instance:node_cpus:count) by (instance)", "    +  - record: gitlab_usage_ping:node_memory_total_bytes:max", "    +    expr: max (node_memory_MemTotal_bytes) by (instance)", "    +  - record: gitlab_usage_ping:node_cpu_utilization:avg", "    +    expr: avg (instance:node_cpu_utilization:ratio) by (instance)", "    +  - record: gitlab_usage_ping:node_memory_utilization:avg", "    +    expr: avg (instance:node_memory_utilization:ratio) by (instance)", "    +", "    +  ###", "    +  # Service level metrics", "    +  #", "    +  - record: gitlab_usage_ping:node_service_process_resident_memory_bytes:avg", "    +    expr: avg by (instance, job) ({__name__ =~ \\"(ruby_){0,1}process_resident_memory_bytes\\", job != \\"gitlab_exporter_process\\"})", "    +  - record: gitlab_usage_ping:node_service_process_unique_memory_bytes:avg", "    +    expr: avg by (instance, job) ({__name__ =~ \\"(ruby_){0,1}process_unique_memory_bytes\\", job != \\"gitlab_exporter_process\\"})", "    +  - record: gitlab_usage_ping:node_service_process_proportional_memory_bytes:avg", "    +    expr: avg by (instance, job) ({__name__ =~ \\"(ruby_){0,1}process_proportional_memory_bytes\\", job != \\"gitlab_exporter_process\\"})", "    +  - record: gitlab_usage_ping:node_service_process:count", "    +    expr: >", "    +      count by (instance, job) (", "    +        {__name__ =~ \\"(ruby_){0,1}process_start_time_seconds\\", job != \\"gitlab_exporter_process\\"}", "    +      )", "    +  - record: gitlab_usage_ping:node_service_app_server_workers:sum", "    +    labels:", "    +      server: puma", "    +    expr: sum by (instance, job) (puma_workers)[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] owner changed to 990", "[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] mode changed to 644", "", "    - change mode from '' to '0644'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] not queuing delayed action run on execute[reload prometheus] (delayed), as it's already been queued", "  * template[/var/opt/gitlab/prometheus/rules/node.rules] action create[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] created file /var/opt/gitlab/prometheus/rules/node.rules", "", "    - create new file /var/opt/gitlab/prometheus/rules/node.rules[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] updated file contents /var/opt/gitlab/prometheus/rules/node.rules", "", "    - update content in file /var/opt/gitlab/prometheus/rules/node.rules from none to bea78d", "    --- /var/opt/gitlab/prometheus/rules/node.rules\\t2025-08-04 10:23:37.399452471 +0000", "    +++ /var/opt/gitlab/prometheus/rules/.chef-node20250804-32489-y3xjjw.rules\\t2025-08-04 10:23:37.399452471 +0000", "    @@ -1,42 +1,84 @@", "    +groups:", "    +- name: Node", "    +  rules:", "    +  - record: instance:node_cpus:count", "    +    expr: count without(cpu, mode) (node_cpu{mode=\\"idle\\"})", "    +  - record: instance:node_cpus:count", "    +    expr: count without(cpu, mode) (node_cpu_seconds_total{mode=\\"idle\\"})", "    +  - record: instance_cpu:node_cpu_seconds_not_idle:rate5m", "    +    expr: sum without(mode) (rate(node_cpu{mode!=\\"idle\\"}[5m]))", "    +  - record: instance_cpu:node_cpu_seconds_not_idle:rate5m", "    +    expr: sum without(mode) (rate(node_cpu_seconds_total{mode!=\\"idle\\"}[5m]))", "    +  - record: instance_mode:node_cpu_seconds:rate5m", "    +    expr: sum without(cpu) (rate(node_cpu[5m]))", "    +  - record: instance_mode:node_cpu_seconds:rate5m", "    +    expr: sum without(cpu) (rate(node_cpu_seconds_total[5m]))", "    +  - record: instance:node_cpu_utilization:ratio", "    +    expr: sum without(mode) (instance_mode:node_cpu_seconds:rate5m{mode!=\\"idle\\"})", "    +      / instance:node_cpus:count", "    +  - record: instance:node_memory_utilization:ratio", "    +    expr: >", "    +      1 - (", "    +        node_memory_MemAvailable_bytes or", "    +         (node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)", "    +      ) / node_memory_MemTotal_bytes", "    +  - record: instance:node_filesystem_avail:ratio", "    +    expr: node_filesystem_avail_bytes / (node_filesystem_size_bytes > 0)", "    +  - alert: FilesystemAlmostFull", "    +    expr: instance:node_filesystem_avail:ratio * 100 < 5 and node_filesystem_avail_bytes < 10 * 1024 * 1024 * 1024", "    +    for: 10m", "    +    annotations:", "    +      description: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} on", "    +        {{ $labels.instance }} has {{ $value | printf \\"%.2f\\" }}% space available.", "    +      summary: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} is almost", "    +        full", "    +  - alert: FilesystemFullIn1Day", "    +    expr: predict_linear(node_filesystem_avail_bytes[6h], 24 * 3600) < 0", "    +    for: 30m", "    +    annotations:", "    +      description: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} on", "    +        {{ $labels.instance }} will be full in the next 24 hours.", "    +      summary: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} will be", "    +        full within 24 hours[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] owner changed to 990", "[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] mode changed to 644", "", "    - change mode from '' to '0644'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "[2025-08-04T10:23:37+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] not queuing delayed action run on execute[reload prometheus] (delayed), as it's already been queued", "Recipe: monitoring::alertmanager", "  * directory[/var/opt/gitlab/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: directory[/var/opt/gitlab/alertmanager] created directory /var/opt/gitlab/alertmanager", "", "    - create new directory /var/opt/gitlab/alertmanager[2025-08-04T10:23:37+00:00] INFO: directory[/var/opt/gitlab/alertmanager] owner changed to 990", "[2025-08-04T10:23:37+00:00] INFO: directory[/var/opt/gitlab/alertmanager] mode changed to 750", "", "    - change mode from '' to '0750'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * directory[/var/log/gitlab/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: directory[/var/log/gitlab/alertmanager] created directory /var/log/gitlab/alertmanager", "", "    - create new directory /var/log/gitlab/alertmanager[2025-08-04T10:23:37+00:00] INFO: directory[/var/log/gitlab/alertmanager] owner changed to 990", "[2025-08-04T10:23:37+00:00] INFO: directory[/var/log/gitlab/alertmanager] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * directory[/opt/gitlab/etc/alertmanager/env] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] created directory /opt/gitlab/etc/alertmanager/env", "", "    - create new directory /opt/gitlab/etc/alertmanager/env[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] owner changed to 990", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "  * env_dir[/opt/gitlab/etc/alertmanager/env] action create", "    * directory[/opt/gitlab/etc/alertmanager/env] action create (up to date)", "    * file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] action create[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] created file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR", "", "      - create new file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR", "", "      - update content in file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR from none to 4f45cf", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/alertmanager/env/GODEBUG] action create[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/GODEBUG] created file /opt/gitlab/etc/alertmanager/env/GODEBUG", "", "      - create new file /opt/gitlab/etc/alertmanager/env/GODEBUG[2025-08-04T10:23:37+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/GODEBUG] updated file contents /opt/gitlab/etc/alertmanager/env/GODEBUG", "", "      - update content in file /opt/gitlab/etc/alertmanager/env/GODEBUG from none to e6ab3f", "      - suppressed sensitive resource", "      - restore selinux security context", "  ", "  * file[Alertmanager config] action create[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] created file /var/opt/gitlab/alertmanager/alertmanager.yml", "", "    - create new file /var/opt/gitlab/alertmanager/alertmanager.yml[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] updated file contents /var/opt/gitlab/alertmanager/alertmanager.yml", "", "    - update content in file /var/opt/gitlab/alertmanager/alertmanager.yml from none to 21b7be", "    - suppressed sensitive resource[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] owner changed to 990", "[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] mode changed to 644", "", "    - change mode from '' to '0644'", "    - change owner from '' to 'gitlab-prometheus'", "    - restore selinux security context", "[2025-08-04T10:23:37+00:00] INFO: file[Alertmanager config] not queuing delayed action restart on runit_service[alertmanager] (delayed), as it's already been queued", "  * service[alertmanager] action nothing (skipped due to action :nothing)", "  * runit_service[alertmanager] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] created directory /opt/gitlab/sv/alertmanager", "", "      - create new directory /opt/gitlab/sv/alertmanager[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/alertmanager/run] action create[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] created file /opt/gitlab/sv/alertmanager/run", "", "      - create new file /opt/gitlab/sv/alertmanager/run[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] updated file contents /opt/gitlab/sv/alertmanager/run", "", "      - update content in file /opt/gitlab/sv/alertmanager/run from none to 36da8b", "      --- /opt/gitlab/sv/alertmanager/run\\t2025-08-04 10:23:37.674453623 +0000", "      +++ /opt/gitlab/sv/alertmanager/.chef-run20250804-32489-tkn1h\\t2025-08-04 10:23:37.674453623 +0000", "      @@ -1,8 +1,16 @@", "      +#!/bin/sh", "      +exec 2>&1", "      +", "      +umask 077", "      +exec chpst  /opt/gitlab/etc/alertmanager/env \\\\", "      +  -U gitlab-prometheus:gitlab-prometheus \\\\", "      +  -u gitlab-prometheus:gitlab-prometheus \\\\", "      +  /opt/gitlab/embedded/bin/alertmanager --web.listen-address=localhost:9093 --storage.path=/var/opt/gitlab/alertmanager/data --config.file=/var/opt/gitlab/alertmanager/alertmanager.yml[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/alertmanager/log] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] created directory /opt/gitlab/sv/alertmanager/log", "", "      - create new directory /opt/gitlab/sv/alertmanager/log[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/alertmanager/log/main] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] created directory /opt/gitlab/sv/alertmanager/log/main", "", "      - create new directory /opt/gitlab/sv/alertmanager/log/main[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/alertmanager/log/config] action create[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] created file /opt/gitlab/sv/alertmanager/log/config", "", "      - create new file /opt/gitlab/sv/alertmanager/log/config[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] updated file contents /opt/gitlab/sv/alertmanager/log/config", "", "      - update content in file /opt/gitlab/sv/alertmanager/log/config from none to 623c00", "      --- /opt/gitlab/sv/alertmanager/log/config\\t2025-08-04 10:23:37.773454037 +0000", "      +++ /opt/gitlab/sv/alertmanager/log/.chef-config20250804-32489-hkke0c\\t2025-08-04 10:23:37.772454033 +0000", "      @@ -1,6 +1,12 @@", "      +s209715200", "      +n30", "      +t86400", "      +!gzip", "      +", "      +[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] mode changed to 644", "", "      - change mode from '' to '0644'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:37+00:00] INFO: ruby_block[verify_chown_persisted_on_alertmanager] sent create action to ruby_block[verify_chown_persisted_on_alertmanager] (immediate at declaration time)", "    * ruby_block[verify_chown_persisted_on_alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: ruby_block[verify_chown_persisted_on_alertmanager] called", "", "      - execute the ruby block verify_chown_persisted_on_alertmanager", "    * link[/var/log/gitlab/alertmanager/config] action create[2025-08-04T10:23:37+00:00] INFO: link[/var/log/gitlab/alertmanager/config] created", "", "      - create symlink at /var/log/gitlab/alertmanager/config to /opt/gitlab/sv/alertmanager/log/config", "    * template[/opt/gitlab/sv/alertmanager/log/run] action create[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] created file /opt/gitlab/sv/alertmanager/log/run", "", "      - create new file /opt/gitlab/sv/alertmanager/log/run[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] updated file contents /opt/gitlab/sv/alertmanager/log/run", "", "      - update content in file /opt/gitlab/sv/alertmanager/log/run from none to 9a4626", "      --- /opt/gitlab/sv/alertmanager/log/run\\t2025-08-04 10:23:37.802454159 +0000", "      +++ /opt/gitlab/sv/alertmanager/log/.chef-run20250804-32489-fwbbde\\t2025-08-04 10:23:37.801454155 +0000", "      @@ -1,5 +1,10 @@", "      +#!/bin/sh", "      +exec chpst  "      +  -U root:root \\\\", "      +  -u root:root \\\\", "      +  svlogd -tt /var/log/gitlab/alertmanager[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/alertmanager/env] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] created directory /opt/gitlab/sv/alertmanager/env", "", "      - create new directory /opt/gitlab/sv/alertmanager/env[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/alertmanager/control] action create[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] created directory /opt/gitlab/sv/alertmanager/control", "", "      - create new directory /opt/gitlab/sv/alertmanager/control[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] owner changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] group changed to 0", "[2025-08-04T10:23:37+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * link[/opt/gitlab/init/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: link[/opt/gitlab/init/alertmanager] created", "", "      - create symlink at /opt/gitlab/init/alertmanager to /opt/gitlab/embedded/bin/sv", "    * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] sending run action to ruby_block[restart_service] (delayed)", "    * ruby_block[restart_service] action run (skipped due to only_if)", "[2025-08-04T10:23:37+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] sending create action to ruby_block[reload_log_service] (delayed)", "    * ruby_block[reload_log_service] action create", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/alertmanager] action create (up to date)", "      * template[/opt/gitlab/sv/alertmanager/run] action create (up to date)", "      * directory[/opt/gitlab/sv/alertmanager/log] action create (up to date)", "      * directory[/opt/gitlab/sv/alertmanager/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/alertmanager/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/alertmanager/config] action create (up to date)", "      * template[/opt/gitlab/sv/alertmanager/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/alertmanager/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/alertmanager/control] action create (up to date)", "      * link[/opt/gitlab/init/alertmanager] action create (up to date)", "      * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/alertmanager] action create[2025-08-04T10:23:37+00:00] INFO: link[/opt/gitlab/service/alertmanager] created", "", "        - create symlink at /opt/gitlab/service/alertmanager to /opt/gitlab/sv/alertmanager", "      * ruby_block[wait for alertmanager service socket] action run[2025-08-04T10:23:41+00:00] INFO: ruby_block[wait for alertmanager service socket] called", "", "        - execute the ruby block wait for alertmanager service socket", "      * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:43+00:00] INFO: ruby_block[reload_log_service] called", "      - execute the ruby block reload_log_service", "[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] sending run action to ruby_block[restart_log_service] (delayed)", "    * ruby_block[restart_log_service] action run", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/alertmanager] action create (up to date)", "      * template[/opt/gitlab/sv/alertmanager/run] action create (up to date)", "      * directory[/opt/gitlab/sv/alertmanager/log] action create (up to date)", "      * directory[/opt/gitlab/sv/alertmanager/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/alertmanager/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/alertmanager/config] action create (up to date)", "      * template[/opt/gitlab/sv/alertmanager/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/alertmanager/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/alertmanager/control] action create (up to date)", "      * link[/opt/gitlab/init/alertmanager] action create (up to date)", "      * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/alertmanager] action create (up to date)", "      * ruby_block[wait for alertmanager service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:43+00:00] INFO: ruby_block[restart_log_service] called", "      - execute the ruby block restart_log_service", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/alertmanager] action create (up to date)", "    * ruby_block[wait for alertmanager service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)", "  ", "Recipe: monitoring::postgres-exporter", "  * directory[/var/log/gitlab/postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] created directory /var/log/gitlab/postgres-exporter", "", "    - create new directory /var/log/gitlab/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] owner changed to 992", "[2025-08-04T10:23:43+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-psql'", "    - restore selinux security context", "  * directory[/var/opt/gitlab/postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] created directory /var/opt/gitlab/postgres-exporter", "", "    - create new directory /var/opt/gitlab/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] owner changed to 992", "[2025-08-04T10:23:43+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] mode changed to 700", "", "    - change mode from '' to '0700'", "    - change owner from '' to 'gitlab-psql'", "    - restore selinux security context", "  * env_dir[/opt/gitlab/etc/postgres-exporter/env] action create", "    * directory[/opt/gitlab/etc/postgres-exporter/env] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/etc/postgres-exporter/env] created directory /opt/gitlab/etc/postgres-exporter/env", "", "      - create new directory /opt/gitlab/etc/postgres-exporter/env", "      - restore selinux security context", "    * file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] action create[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR", "", "      - create new file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR", "", "      - update content in file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR from none to 4f45cf", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/postgres-exporter/env/GODEBUG] action create[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/GODEBUG] created file /opt/gitlab/etc/postgres-exporter/env/GODEBUG", "", "      - create new file /opt/gitlab/etc/postgres-exporter/env/GODEBUG[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/GODEBUG] updated file contents /opt/gitlab/etc/postgres-exporter/env/GODEBUG", "", "      - update content in file /opt/gitlab/etc/postgres-exporter/env/GODEBUG from none to e6ab3f", "      - suppressed sensitive resource", "      - restore selinux security context", "    * file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] action create[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] created file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME", "", "      - create new file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME[2025-08-04T10:23:43+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] updated file contents /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME", "", "      - update content in file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME from none to af4c92", "      - suppressed sensitive resource", "      - restore selinux security context", "  ", "  * service[postgres-exporter] action nothing (skipped due to action :nothing)", "  * runit_service[postgres-exporter] action enable", "    * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "    * directory[/opt/gitlab/sv/postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] created directory /opt/gitlab/sv/postgres-exporter", "", "      - create new directory /opt/gitlab/sv/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] owner changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] group changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/postgres-exporter/run] action create[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] created file /opt/gitlab/sv/postgres-exporter/run", "", "      - create new file /opt/gitlab/sv/postgres-exporter/run[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] updated file contents /opt/gitlab/sv/postgres-exporter/run", "", "      - update content in file /opt/gitlab/sv/postgres-exporter/run from none to 6d0bb3", "      --- /opt/gitlab/sv/postgres-exporter/run\\t2025-08-04 10:23:43.821479361 +0000", "      +++ /opt/gitlab/sv/postgres-exporter/.chef-run20250804-32489-90lqb\\t2025-08-04 10:23:43.820479357 +0000", "      @@ -1,6 +1,12 @@", "      +#!/bin/sh", "      +exec 2>&1", "      +", "      +umask 077", "      +exec chpst -e /opt/gitlab/etc/postgres-exporter/env  gitlab-psql:git -u gitlab-psql:git /opt/gitlab/embedded/bin/postgres_exporter --no-collector.stat_user_tables --collector.postmaster --web.listen-address=localhost:9187 --extend.query-path=/var/opt/gitlab/postgres-exporter/queries.yaml", "      +[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] owner changed to 0", "[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] group changed to 0", "[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/postgres-exporter/log] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] created directory /opt/gitlab/sv/postgres-exporter/log", "", "      - create new directory /opt/gitlab/sv/postgres-exporter/log[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] owner changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] group changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] created directory /opt/gitlab/sv/postgres-exporter/log/main", "", "      - create new directory /opt/gitlab/sv/postgres-exporter/log/main[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] owner changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] group changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * template[/opt/gitlab/sv/postgres-exporter/log/config] action create[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] created file /opt/gitlab/sv/postgres-exporter/log/config", "", "      - create new file /opt/gitlab/sv/postgres-exporter/log/config[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] updated file contents /opt/gitlab/sv/postgres-exporter/log/config", "", "      - update content in file /opt/gitlab/sv/postgres-exporter/log/config from none to 623c00", "      --- /opt/gitlab/sv/postgres-exporter/log/config\\t2025-08-04 10:23:43.921479780 +0000", "      +++ /opt/gitlab/sv/postgres-exporter/log/.chef-config20250804-32489-nb0jg\\t2025-08-04 10:23:43.920479776 +0000", "      @@ -1,6 +1,12 @@", "      +s209715200", "      +n30", "      +t86400", "      +!gzip", "      +", "      +[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] owner changed to 0", "[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] group changed to 0", "[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] mode changed to 644", "", "      - change mode from '' to '0644'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:43+00:00] INFO: ruby_block[verify_chown_persisted_on_postgres-exporter] sent create action to ruby_block[verify_chown_persisted_on_postgres-exporter] (immediate at declaration time)", "    * ruby_block[verify_chown_persisted_on_postgres-exporter] action create[2025-08-04T10:23:43+00:00] INFO: ruby_block[verify_chown_persisted_on_postgres-exporter] called", "", "      - execute the ruby block verify_chown_persisted_on_postgres-exporter", "    * link[/var/log/gitlab/postgres-exporter/config] action create[2025-08-04T10:23:43+00:00] INFO: link[/var/log/gitlab/postgres-exporter/config] created", "", "      - create symlink at /var/log/gitlab/postgres-exporter/config to /opt/gitlab/sv/postgres-exporter/log/config", "    * template[/opt/gitlab/sv/postgres-exporter/log/run] action create[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] created file /opt/gitlab/sv/postgres-exporter/log/run", "", "      - create new file /opt/gitlab/sv/postgres-exporter/log/run[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] updated file contents /opt/gitlab/sv/postgres-exporter/log/run", "", "      - update content in file /opt/gitlab/sv/postgres-exporter/log/run from none to fd2977", "      --- /opt/gitlab/sv/postgres-exporter/log/run\\t2025-08-04 10:23:43.960479943 +0000", "      +++ /opt/gitlab/sv/postgres-exporter/log/.chef-run20250804-32489-povsfl\\t2025-08-04 10:23:43.960479943 +0000", "      @@ -1,5 +1,10 @@", "      +#!/bin/sh", "      +exec chpst  "      +  -U root:root \\\\", "      +  -u root:root \\\\", "      +  svlogd -tt /var/log/gitlab/postgres-exporter[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] owner changed to 0", "[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] group changed to 0", "[2025-08-04T10:23:43+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * directory[/opt/gitlab/sv/postgres-exporter/env] action create[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] created directory /opt/gitlab/sv/postgres-exporter/env", "", "      - create new directory /opt/gitlab/sv/postgres-exporter/env[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] owner changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] group changed to 0", "[2025-08-04T10:23:43+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)", "    * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)", "    * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)", "    * directory[/opt/gitlab/sv/postgres-exporter/control] action create[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] created directory /opt/gitlab/sv/postgres-exporter/control", "", "      - create new directory /opt/gitlab/sv/postgres-exporter/control[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] owner changed to 0", "[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] group changed to 0", "[2025-08-04T10:23:44+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] mode changed to 755", "", "      - change mode from '' to '0755'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * link[/opt/gitlab/init/postgres-exporter] action create[2025-08-04T10:23:44+00:00] INFO: link[/opt/gitlab/init/postgres-exporter] created", "", "      - create symlink at /opt/gitlab/init/postgres-exporter to /opt/gitlab/embedded/bin/sv", "    * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)", "[2025-08-04T10:23:44+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] sending run action to ruby_block[restart_service] (delayed)", "    * ruby_block[restart_service] action run (skipped due to only_if)", "[2025-08-04T10:23:44+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)", "    * ruby_block[reload_log_service] action create", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/postgres-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/postgres-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/postgres-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/postgres-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/postgres-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/postgres-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/postgres-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/postgres-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/postgres-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/postgres-exporter] action create[2025-08-04T10:23:44+00:00] INFO: link[/opt/gitlab/service/postgres-exporter] created", "", "        - create symlink at /opt/gitlab/service/postgres-exporter to /opt/gitlab/sv/postgres-exporter", "      * ruby_block[wait for postgres-exporter service socket] action run[2025-08-04T10:23:48+00:00] INFO: ruby_block[wait for postgres-exporter service socket] called", "", "        - execute the ruby block wait for postgres-exporter service socket", "      * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:49+00:00] INFO: ruby_block[reload_log_service] called", "      - execute the ruby block reload_log_service", "[2025-08-04T10:23:49+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)", "    * ruby_block[restart_log_service] action run", "      * ruby_block[restart_service] action nothing (skipped due to action :nothing)", "      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)", "      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/sv/postgres-exporter] action create (up to date)", "      * template[/opt/gitlab/sv/postgres-exporter/run] action create (up to date)", "      * directory[/opt/gitlab/sv/postgres-exporter/log] action create (up to date)", "      * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create (up to date)", "      * template[/opt/gitlab/sv/postgres-exporter/log/config] action create (up to date)", "      * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)", "      * link[/var/log/gitlab/postgres-exporter/config] action create (up to date)", "      * template[/opt/gitlab/sv/postgres-exporter/log/run] action create (up to date)", "      * directory[/opt/gitlab/sv/postgres-exporter/env] action create (up to date)", "      * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)", "      * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)", "      * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)", "      * directory[/opt/gitlab/sv/postgres-exporter/control] action create (up to date)", "      * link[/opt/gitlab/init/postgres-exporter] action create (up to date)", "      * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)", "      * directory[/opt/gitlab/service] action create (up to date)", "      * link[/opt/gitlab/service/postgres-exporter] action create (up to date)", "      * ruby_block[wait for postgres-exporter service socket] action run (skipped due to not_if)", "      * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)", "[2025-08-04T10:23:49+00:00] INFO: ruby_block[restart_log_service] called", "      - execute the ruby block restart_log_service", "    * directory[/opt/gitlab/service] action create (up to date)", "    * link[/opt/gitlab/service/postgres-exporter] action create (up to date)", "    * ruby_block[wait for postgres-exporter service socket] action run (skipped due to not_if)", "    * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)", "  ", "  * template[/var/opt/gitlab/postgres-exporter/queries.yaml] action create[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] created file /var/opt/gitlab/postgres-exporter/queries.yaml", "", "    - create new file /var/opt/gitlab/postgres-exporter/queries.yaml[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] updated file contents /var/opt/gitlab/postgres-exporter/queries.yaml", "", "    - update content in file /var/opt/gitlab/postgres-exporter/queries.yaml from none to 1fcf7b", "    --- /var/opt/gitlab/postgres-exporter/queries.yaml\\t2025-08-04 10:23:49.549503344 +0000", "    +++ /var/opt/gitlab/postgres-exporter/.chef-queries20250804-32489-7jcoxt.yaml\\t2025-08-04 10:23:49.548503340 +0000", "    @@ -1,387 +1,774 @@", "    +pg_total_relation_size:", "    +  query: |", "    +    SELECT relnamespace::regnamespace as schemaname,", "    +           relname as relname,", "    +           pg_total_relation_size(oid) bytes", "    +      FROM pg_class", "    +     WHERE relkind = 'r';", "    +  metrics:", "    +    - schemaname:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Name of the schema that this table is in\\"", "    +    - relname:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Name of this table\\"", "    +    - bytes:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"total disk space usage for the specified table and associated indexes\\"", "    +", "    +pg_blocked:", "    +  query: |", "    +    SELECT", "    +      count(blocked.transactionid) AS queries,", "    +      '__transaction__' AS table", "    +    FROM pg_catalog.pg_locks blocked", "    +    WHERE NOT blocked.granted AND locktype = 'transactionid'", "    +    GROUP BY locktype", "    +    UNION", "    +    SELECT", "    +      count(blocked.relation) AS queries,", "    +      blocked.relation::regclass::text AS table", "    +    FROM pg_catalog.pg_locks blocked", "    +    WHERE NOT blocked.granted AND locktype != 'transactionid'", "    +    GROUP BY relation", "    +  metrics:", "    +    - queries:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"The current number of blocked queries\\"", "    +    - table:", "    +        usage: \\"LABEL\\"", "    +        description: \\"The table on which a query is blocked\\"", "    +", "    +pg_oldest_blocked:", "    +  query: |", "    +    SELECT coalesce(extract('epoch' from max(clock_timestamp() - state_change)), 0) age_seconds", "    +      FROM pg_stat_activity", "    +     WHERE wait_event_type = 'Lock'", "    +       AND state='active'", "    +  metrics:", "    +    - age_seconds:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Largest number of seconds any transaction is currently waiting on a lock\\"", "    +", "    +pg_slow:", "    +  query: |", "    +    SELECT COUNT(*) AS queries", "    +    FROM pg_stat_activity", "    +    WHERE state = 'active' AND (now() - query_start) > '1 seconds'::interval", "    +  metrics:", "    +    - queries:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Current number of slow queries\\"", "    +", "    +pg_long_running_transactions:", "    +  query: |", "    +    SELECT COUNT(*) as transactions,", "    +    coalesce(MAX(EXTRACT(EPOCH FROM (clock_timestamp() - xact_start))), 0) AS age_in_seconds", "    +    FROM pg_stat_activity", "    +    WHERE state is distinct from 'idle' AND (now() - xact_start) > '1 minutes'::interval AND query not like 'autovacuum:%'", "    +  metrics:", "    +    - transactions:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Current number of long running transactions\\"", "    +    - age_in_seconds:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"The current maximum transaction age in seconds\\"", "    +", "    +pg_stuck_idle_in_transaction:", "    +  query: |", "    +    SELECT COUNT(*) AS queries", "    +    FROM pg_stat_activity", "    +    WHERE state = 'idle in transaction' AND (now() - query_start) > '10 minutes'::interval", "    +  metrics:", "    +    - queries:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Current number of queries that are stuck being idle in transactions\\"", "    +", "    +# All xid and lsn metrics here are reported mod 2^52 to ensure they", "    +# fit within a float for Prometheus :( Really annoying that counters", "    +# aren't stored in a 64-bit integer. Note that for queries that report", "    +# floats this only works because postgres_exporter does know to set", "    +# extra_float_digits (which it sets to 2). So they don't print in", "    +# exponential notation and precision is maintained up to 2^53-1.", "    +", "    +pg_vacuum:", "    +  query: |", "    +    SELECT", "    +      COUNT(*) AS queries,", "    +      MAX(EXTRACT(EPOCH FROM (clock_timestamp() - query_start))) AS age_in_seconds", "    +    FROM pg_catalog.pg_stat_activity", "    +    WHERE state = 'active' AND trim(query) ~* '\\\\AVACUUM (?!ANALYZE)'", "    +  metrics:", "    +    - queries:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"The current number of VACUUM queries\\"", "    +    - age_in_seconds:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"The current maximum VACUUM query age in seconds\\"", "    +", "    +pg_vacuum_analyze:", "    +  query: |", "    +    SELECT", "    +      COUNT(*) AS queries,", "    +      MAX(EXTRACT(EPOCH FROM (clock_timestamp() - query_start))) AS age_in_seconds", "    +    FROM pg_catalog.pg_stat_activity", "    +    WHERE state = 'active' AND trim(query) ~* '\\\\AVACUUM ANALYZE'", "    +  metrics:", "    +    - queries:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"The current number of VACUUM ANALYZE queries\\"", "    +    - age_in_seconds:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"The current maximum VACUUM ANALYZE query age in seconds\\"", "    +", "    +pg_stuck_idle_in_transaction:", "    +  query: |", "    +    SELECT COUNT(*) AS queries", "    +    FROM pg_stat_activity", "    +    WHERE state = 'idle in transaction' AND (now() - query_start) > '10 minutes'::interval", "    +  metrics:", "    +    - queries:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Current number of queries that are stuck being idle in transactions\\"", "    +", "    +pg_vacuum_queue:", "    +  #master: true ", "    +  # Until postgres_exporter is upgraded. See ", "    +  # https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4887", "    +  query: |", "    +    with table_opts_vs_statistic as (", "    +      select", "    +        pg_class.oid,", "    +        pg_class.relname,", "    +        coalesce(nspname, 'public') as schemaname,", "    +        pg_class.relpages,", "    +        pg_class.reltuples,", "    +        case", "    +          when array_to_string(reloptions, '') like '%autovacuum_vacuum_threshold%' then regexp_replace(array_to_string(reloptions, ''), '.*autovacuum_vacuum_threshold=([0-9.]+).*', E'\\\\\\\\1')::int8", "    +          else current_setting('autovacuum_vacuum_threshold')::int8", "    +        end as autovacuum_vacuum_threshold,", "    +        case", "    +          when array_to_string(reloptions, '') like '%autovacuum_vacuum_scale_factor%' then regexp_replace(array_to_string(reloptions, ''), '.*autovacuum_vacuum_scale_factor=([0-9.]+).*', E'\\\\\\\\1')::numeric", "    +          else current_setting('autovacuum_vacuum_scale_factor')::numeric", "    +        end as autovacuum_vacuum_scale_factor,", "    +        case when array_to_string(reloptions, '') ~ 'autovacuum_enabled=(false|off)' then false else true end as autovacuum_enabled,", "    +        n_dead_tup,", "    +        last_autovacuum,", "    +        last_vacuum", "    +      from pg_class", "    +      join pg_namespace ns on relnamespace = ns.oid ", "    +      join pg_stat_all_tables psat  on psat.relid  = pg_class.oid", "    +      where relkind in ('r','m') ", "    +    ), p as (", "    +      select pgspv.*,a.query,a.wait_event_type,a.wait_event,a.query_start", "    +      from pg_stat_progress_vacuum pgspv", "    +      left join pg_stat_activity a using (pid)", "    +    ) ", "    +    select", "    +      table_opts_vs_statistic.schemaname as schemaname,", "    +      table_opts_vs_statistic.relname as relname,", "    +      round((100 * table_opts_vs_statistic.n_dead_tup::numeric / nullif(table_opts_vs_statistic.reltuples, 0))::numeric, 2) as dead_tup_pct,", "    +      table_opts_vs_statistic.reltuples::numeric as reltuples,", "    +      table_opts_vs_statistic.n_dead_tup,", "    +      (relpages::bigint*8*1024) AS table_size_bytes,", "    +      'V. Threshold:' || table_opts_vs_statistic.autovacuum_vacuum_threshold", "    +        || ', V. Scale Factor: ' || (table_opts_vs_statistic.autovacuum_vacuum_scale_factor)::numeric *100 ||' %'", "    +        || case when not autovacuum_enabled then ', DISABLED' else ', enabled' end as \\"effective_settings\\",", "    +      case", "    +        when last_autovacuum > coalesce(last_vacuum, '0001-01-01') then last_autovacuum::timestamp(0)", "    +        when last_vacuum is not null then last_vacuum::timestamp(0)", "    +        else null", "    +      end as \\"last_vacuumed\\",", "    +      case", "    +        when last_autovacuum > coalesce(last_vacuum, '0001-01-01') then 'auto'", "    +        when last_vacuum is not null then 'manual'", "    +        else null", "    +      end as \\"type\\",", "    +      coalesce(p.phase, 'in queue') as status,", "    +      p.pid as pid,", "    +      coalesce  (p.query,'')as  action,", "    +      case when p.pid is null then null else coalesce(wait_event_type ||'.'|| wait_event, 'f') end as waiting,", "    +      round(100.0 * p.heap_blks_scanned / nullif(p.heap_blks_total, 0), 1) AS scanned_pct,", "    +      round(100.0 * p.heap_blks_vacuumed / nullif(p.heap_blks_total, 0), 1) AS vacuumed_pct,", "    +      extract ('epoch' from  now()-query_start) elapsed_time", "    +    from ", "    +    table_opts_vs_statistic", "    +    full outer join p on p.relid = table_opts_vs_statistic.oid and p.datname = current_database()", "    +    where", "    +      table_opts_vs_statistic.relpages >= 8", "    +      and  autovacuum_vacuum_threshold + (autovacuum_vacuum_scale_factor::numeric * table_opts_vs_statistic.reltuples) < table_opts_vs_statistic.n_dead_tup", "    +  metrics:", "    +    - schemaname:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Table Schema\\"", "    +    - relname:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Table name\\"", "    +    - dead_tup_pct:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Estimated dead tuples percent\\"", "    +    - reltuples:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Number of tuples in table\\"", "    +    - n_dead_tup:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Estimated number of dead tuples\\"", "    +    - table_size_bytes:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Estimated table size\\"", "    +    - effective_settings:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Autovacuums settings\\"", "    +    - last_vacuumed:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Last time at which this table was vacuumed\\"", "    +    - type:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Last vacuum type\\"", "    +    - status:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Vacuum actual status\\"", "    +    - pid:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Vacuum process id\\"", "    +    - action:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Type of vacuum executed\\"", "    +    - waiting:", "    +        usage: \\"LABEL\\"", "    +        description: \\"Vacuum queue status\\"", "    +    - scanned_pct:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Estimated rows scanned percent\\"", "    +    - vacuumed_pct:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Estimated vacuumed rows percent\\"", "    +    - elapsed_time:", "    +        usage: \\"GAUGE\\"", "    +        description: \\"Elapsed time vacuuming (in seconds)\\"", "    +", "    +#", "    +# This query extracts marginalia comments from pg_stat_activity and provides a sampled summary of the type of", "    +# endpoints that are actively making calls", "    +#", "    +pg_stat_activity_marginalia_sampler:", "    +  query: >", "    +    SELECT", "    +      usename AS usename,", "    +      a.matches[1] AS application,", "    +      a.matches[2] AS endpoint,", "    +      a.matches[3] AS command,", "    +      a.wait_event AS wait_event,", "    +      a.state AS state,", "    +      a.wait_event_type AS wait_event_type,", "    +      COUNT(*) active_count,", "    +     MAX(coalesce(age_in_seconds, 0)) AS max_tx_age_in_seconds", "    +    FROM (", "    +      SELECT", "    +        usename,", "    +        regexp_matches(query, '^\\\\s*(?:\\\\/\\\\*(?:application:(\\\\w+),?)?(?:correlation_id:\\\\w+,?)?(?:jid:\\\\w+,?)?(?:endpoint_id:([\\\\w/\\\\-\\\\.:\\\\#\\\\s]+),?)?.*?\\\\*\\\\/)?\\\\s*(\\\\w+)') AS matches,", "    +        state,", "    +        wait_event,", "    +        wait_event_type,", "    +        EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds", "    +      FROM", "    +        pg_stat_activity", "    +      ) a", "    +    GROUP BY usename, application, endpoint, command, state, wait_event, wait_event_type", "    +    ORDER BY active_count DESC", "    +  metrics:", "    +    - usename:", "    +        usage: LABEL", "    +        description: The user running the command", "    +    - application:", "    +        usage: LABEL", "    +        description: Name of the application as presented in marginalia comment", "    +    - endpoint:", "    +        usage: LABEL", "    +        description: Name of the web endpoint or sidekiq job as presented in marginalia comment", "    +    - command:", "    +        usage: LABEL", "    +        description: The first word for the running command", "    +    - wait_event:", "    +        usage: LABEL", "    +        description: Wait event  of the activity as presented by pg_stat_activity.wait_event", "    +    - state:", "    +        usage: LABEL", "    +        description: State of the activity as presented by pg_stat_activity.state", "    +    - wait_event_type:", "    +        usage: LABEL", "    +        description: Wait event type of the activity as presented by pg_stat_activity.wait_event_type", "    +    - active_count:", "    +        usage: GAUGE", "    +        description: Number of active queries at time of sample", "    +    - max_tx_age_in_seconds:", "    +        usage: GAUGE", "    +        description: Number of active queries at time of sample", "    +", "    +# This records long running autovacuum processes. The reason we limit to", "    +# long-running processes is to avoid cardinality problems in prometheus. Since", "    +# we're only concerned about long running processes we limit the output only to", "    +# those that take longer than 5 minutes.", "    +pg_stat_activity_autovacuum:", "    +  query: >", "    +    SELECT", "    +      SPLIT_PART(query, '.', 2) AS relname,", "    +      EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds", "    +    FROM", "    +      pg_stat_activity", "    +    WHERE", "    +      query like 'autovacuum:%'", "    +    AND", "    +      EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) > 300", "    +  metrics:", "    +    - relname:", "    +        usage: LABEL", "    +        description: The table being vacuumed", "    +    - age_in_seconds:", "    +        usage: GAUGE", "    +        description: The age of the vacuum process in seconds", "    +", "    +# Keep track of the number of the total number of autovacuum workers", "    +# currently active", "    +pg_stat_activity_autovacuum_active:", "    +  query: >", "    +    SELECT v.phase,", "    +           CASE", "    +             when a.query ~ '^autovacuum.*to prevent wraparound' then 'wraparound'", "    +             when a.query ~* '^vacuum' then 'user'", "    +             when a.pid is null then null", "    +             ELSE 'regular'", "    +           END as mode,", "    +           count(1) as workers_count", "    +      FROM pg_stat_progress_vacuum v", "    +      LEFT JOIN pg_stat_activity a using (pid)", "    +     GROUP BY 1,2", "    +  metrics:", "    +    - phase:", "    +        usage: LABEL", "    +        description: Vacuum phase", "    +    - mode:", "    +        usage: LABEL", "    +        description: Vacuum mode", "    +    - workers_count:", "    +        usage: GAUGE", "    +        description: The number of active autovacuum workers in this state", "    +", "    +#", "    +# This query extracts marginalia metadata from pg_stat_activity and provides a sampled summary about the long running transactions.", "    +#", "    +pg_long_running_transactions_marginalia:", "    +  query: >", "    +    SELECT", "    +      activity.matches[1] AS application,", "    +      activity.matches[2] AS endpoint,", "    +      MAX(age_in_seconds) AS max_age_in_seconds", "    +    FROM (", "    +      SELECT", "    +        regexp_matches(query, '^\\\\s*(?:\\\\/\\\\*(?:application:(\\\\w+),?)?(?:correlation_id:\\\\w+,?)?(?:jid:\\\\w+,?)?(?:endpoint_id:([\\\\w/\\\\-\\\\.:\\\\#\\\\s]+),?)?.*?\\\\*\\\\/)?\\\\s*(\\\\w+)') AS matches,", "    +        EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds", "    +      FROM", "    +        pg_stat_activity", "    +      WHERE state <> 'idle'", "    +        AND (clock_timestamp() - xact_start) > '30 seconds'::interval", "    +        AND query NOT LIKE 'autovacuum:%'", "    +      ) activity", "    +    GROUP BY application, endpoint", "    +    ORDER BY max_age_in_seconds DESC", "    +  metrics:", "    +    - application:", "    +        usage: LABEL", "    +        description: Name of the application as presented in marginalia comment", "    +    - endpoint:", "    +        usage: LABEL", "    +        description: Name of the web endpoint or sidekiq job as presented in marginalia comment", "    +    - max_age_in_seconds:", "    +        usage: GAUGE", "    +        description: The current maximum transaction age in seconds[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] owner changed to 992", "[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] mode changed to 644", "", "    - change mode from '' to '0644'", "    - change owner from '' to 'gitlab-psql'", "    - restore selinux security context", "[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] not queuing delayed action restart on runit_service[postgres-exporter] (delayed), as it's already been queued", "  * consul_service[postgres-exporter] action delete", "    * file[/var/opt/gitlab/consul/config.d/postgres-exporter-service.json] action delete (up to date)", "     (up to date)", "Recipe: gitlab::gitlab-backup-cli_disable", "  * template[/opt/gitlab/etc/gitlab-backup-cli-config.yml] action delete (up to date)", "  * account[GitLab Backup User] action remove", "    * linux_user[gitlab-backup] action remove (up to date)", "     (up to date)", "  * group[git] action manage (up to date)", "  * group[gitlab-psql] action manage (up to date)", "  * group[registry] action manage (up to date)", "Recipe: gitlab::database_reindexing_disable", "  * crond_job[database-reindexing] action delete", "    * file[/var/opt/gitlab/crond/database-reindexing] action delete (up to date)", "     (up to date)", "Recipe: gitlab-ee::sentinel_disable", "  * sentinel_service[redis] action disable", "    * service[sentinel] action nothing (skipped due to action :nothing)", "    * runit_service[sentinel] action disable", "      * ruby_block[disable sentinel] action run (skipped due to only_if)", "       (up to date)", "    * file[/var/opt/gitlab/sentinel/sentinel.conf] action delete (up to date)", "    * directory[/var/opt/gitlab/sentinel] action delete (up to date)", "     (up to date)", "Recipe: gitlab-ee::geo-postgresql_disable", "  * service[geo-postgresql] action nothing (skipped due to action :nothing)", "  * runit_service[geo-postgresql] action disable", "    * ruby_block[disable geo-postgresql] action run (skipped due to only_if)", "     (up to date)", "Recipe: gitlab-ee::geo-logcursor_disable", "  * service[geo-logcursor] action nothing (skipped due to action :nothing)", "  * runit_service[geo-logcursor] action disable", "    * ruby_block[disable geo-logcursor] action run (skipped due to only_if)", "     (up to date)", "Recipe: consul::disable_daemon", "  * service[consul] action nothing (skipped due to action :nothing)", "  * runit_service[consul] action disable", "    * ruby_block[disable consul] action run (skipped due to only_if)", "     (up to date)", "Recipe: pgbouncer::disable", "  * service[pgbouncer] action nothing (skipped due to action :nothing)", "  * runit_service[pgbouncer] action disable", "    * ruby_block[disable pgbouncer] action run (skipped due to only_if)", "     (up to date)", "Recipe: patroni::disable", "  * service[patroni] action nothing (skipped due to action :nothing)", "  * runit_service[patroni] action disable", "    * ruby_block[disable patroni] action run (skipped due to only_if)", "     (up to date)", "Recipe: spamcheck::disable", "  * service[spamcheck] action nothing (skipped due to action :nothing)", "  * runit_service[spamcheck] action disable", "    * ruby_block[disable spamcheck] action run (skipped due to only_if)", "     (up to date)", "  * service[spam-classifier] action nothing (skipped due to action :nothing)", "  * runit_service[spam-classifier] action disable", "    * ruby_block[disable spam-classifier] action run (skipped due to only_if)", "     (up to date)", "Recipe: gitlab-ee::geo-secondary_disable", "  * templatesymlink[Removes the geo database settings from database.yml and create a symlink to Rails root] action create", "    * template[/var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/database.yml to /var/opt/gitlab/gitlab-rails/etc/database.yml] action create (up to date)", "     (up to date)", "Recipe: gitlab-ee::suggested_reviewers", "  * templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] action create[2025-08-04T10:23:49+00:00] WARN: only_if block for templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] returned a string, did you mean to run a command?", "", "    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] action create[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] created file /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret", "", "      - create new file /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret", "", "      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret from none to 2362fb", "      - suppressed sensitive resource[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] owner changed to 0", "[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] group changed to 0", "[2025-08-04T10:23:49+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] mode changed to 644", "", "      - change mode from '' to '0644'", "      - change owner from '' to 'root'", "      - change group from '' to 'root'", "      - restore selinux security context", "    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_suggested_reviewers_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] action create[2025-08-04T10:23:49+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_suggested_reviewers_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret] created", "", "      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/.gitlab_suggested_reviewers_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_suggested_reviewers_secret", "  ", "[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] not queuing delayed action restart on runit_service[puma] (delayed), as it's already been queued", "[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab_suggested_reviewers_secret and create a symlink to Rails root] not queuing delayed action restart on sidekiq_service[sidekiq] (delayed), as it's already been queued", "[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending restart action to runit_service[puma] (delayed)", "Recipe: gitlab::puma", "  * runit_service[puma] action restart (up to date)", "[2025-08-04T10:23:49+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending restart action to sidekiq_service[sidekiq] (delayed)", "Recipe: gitlab::sidekiq", "  * sidekiq_service[sidekiq] action restart", "    * service[sidekiq] action nothing (skipped due to action :nothing)", "    * runit_service[sidekiq] action restart", "      ", "      ================================================================================", "      Error executing action `restart` on resource 'runit_service[sidekiq]'", "      ================================================================================", "      ", "      Mixlib::ShellOut::ShellCommandFailed", "      ------------------------------------", "      Expected process to exit with [0], but received '1'", "      ---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "      STDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM", "      STDERR: ", "      ---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "      Ran /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1", "      ", "      Cookbook Trace: (most recent call first)", "      ----------------------------------------", "      /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:136:in `safe_sv_shellout!'", "      /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:164:in `restart_service'", "      /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/provider_runit_service.rb:368:in `block in <class:RunitService>'", "      /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb:67:in `block in class_from_file'", "      ", "      Resource Declaration:", "      ---------------------", "      # In /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb", "      ", "       67:   runit_service new_resource.name do", "       68:     action :restart", "       69:   end", "       70: end", "      ", "      Compiled Resource:", "      ------------------", "      # Declared in /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb:67:in `block in class_from_file'", "      ", "      runit_service(\\"sidekiq\\") do", "        action [:restart]", "        default_guard_interpreter :default", "        declared_type :runit_service", "        cookbook_name \\"gitlab\\"", "        recipe_name \\"sidekiq\\"", "        service_name \\"sidekiq\\"", "        owner \\"root\\"", "        group \\"root\\"", "        supports {:restart=>nil, :reload=>nil, :status=>nil}", "        start_command_name \\"start\\"", "        stop_command_name \\"stop\\"", "        restart_command_name \\"restart\\"", "        status_command_name \\"status\\"", "      end", "      ", "      System Info:", "      ------------", "      chef_version=18.3.0", "      platform=redhat", "      platform_version=9.5", "      ruby=ruby 3.2.5 (2024-07-26 revision 31d0f1a2e7) [x86_64-linux]", "      program_name=/opt/gitlab/embedded/bin/cinc-client", "      executable=/opt/gitlab/embedded/bin/cinc-client", "      ", "    ", "    ================================================================================", "    Error executing action `restart` on resource 'sidekiq_service[sidekiq]'", "    ================================================================================", "    ", "    Mixlib::ShellOut::ShellCommandFailed", "    ------------------------------------", "    runit_service[sidekiq] (gitlab::sidekiq line 67) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'", "    ---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "    STDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM", "    STDERR: ", "    ---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "    Ran /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1", "    ", "    Cookbook Trace: (most recent call first)", "    ----------------------------------------", "    /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:136:in `safe_sv_shellout!'", "    /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/helpers.rb:164:in `restart_service'", "    /opt/gitlab/embedded/cookbooks/cache/cookbooks/runit/libraries/provider_runit_service.rb:368:in `block in <class:RunitService>'", "    /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/resources/sidekiq_service.rb:67:in `block in class_from_file'", "    ", "    Resource Declaration:", "    ---------------------", "    # In /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/recipes/sidekiq.rb", "    ", "     23: sidekiq_service 'sidekiq' do", "     24:   user account_helper.gitlab_user", "     25:   group account_helper.gitlab_group", "     26:   log_directory logging_settings[:log_directory]", "     27:   log_directory_mode logging_settings[:log_directory_mode]", "     28:   log_directory_owner logging_settings[:log_directory_owner]", "     29:   log_directory_group logging_settings[:log_directory_group]", "     30:   log_user logging_settings[:runit_owner]", "     31:   log_group logging_settings[:runit_group]", "     32: end", "     33: ", "    ", "    Compiled Resource:", "    ------------------", "    # Declared in /opt/gitlab/embedded/cookbooks/cache/cookbooks/gitlab/recipes/sidekiq.rb:23:in `from_file'", "    ", "    sidekiq_service(\\"sidekiq\\") do", "      action [:enable]", "      default_guard_interpreter :default", "      declared_type :sidekiq_service", "      cookbook_name \\"gitlab\\"", "      recipe_name \\"sidekiq\\"", "      user \\"git\\"", "      group \\"git\\"", "      log_directory \\"/var/log/gitlab/sidekiq\\"", "      log_directory_mode \\"0700\\"", "      log_directory_owner \\"git\\"", "      log_user \\"root\\"", "      logfiles_helper \\"*sensitive value suppressed*\\"", "      template_name \\"sidekiq\\"", "    end", "    ", "    System Info:", "    ------------", "    chef_version=18.3.0", "    platform=redhat", "    platform_version=9.5", "    ruby=ruby 3.2.5 (2024-07-26 revision 31d0f1a2e7) [x86_64-linux]", "    program_name=/opt/gitlab/embedded/bin/cinc-client", "    executable=/opt/gitlab/embedded/bin/cinc-client", "    ", "[2025-08-04T10:24:20+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending run action to execute[clear the gitlab-rails cache] (delayed)", "Recipe: gitlab::gitlab-rails", "  * execute[clear the gitlab-rails cache] action run[2025-08-04T10:25:35+00:00] INFO: execute[clear the gitlab-rails cache] ran successfully", "", "    - execute /opt/gitlab/bin/gitlab-rake cache:clear", "[2025-08-04T10:25:35+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] sending restart action to runit_service[nginx] (delayed)", "Recipe: nginx::enable", "  * runit_service[nginx] action restart (up to date)", "[2025-08-04T10:25:35+00:00] INFO: env_dir[/opt/gitlab/etc/node-exporter/env] sending restart action to runit_service[node-exporter] (delayed)", "Recipe: monitoring::node-exporter", "  * runit_service[node-exporter] action restart (up to date)", "[2025-08-04T10:25:35+00:00] INFO: env_dir[/opt/gitlab/etc/gitlab-exporter/env] sending restart action to runit_service[gitlab-exporter] (delayed)", "Recipe: monitoring::gitlab-exporter", "  * runit_service[gitlab-exporter] action restart (up to date)", "[2025-08-04T10:25:36+00:00] INFO: env_dir[/opt/gitlab/etc/redis-exporter/env] sending restart action to runit_service[redis-exporter] (delayed)", "Recipe: monitoring::redis-exporter", "  * runit_service[redis-exporter] action restart (up to date)", "[2025-08-04T10:25:36+00:00] INFO: env_dir[/opt/gitlab/etc/prometheus/env] sending restart action to runit_service[prometheus] (delayed)", "Recipe: monitoring::prometheus", "  * runit_service[prometheus] action restart (up to date)", "[2025-08-04T10:25:37+00:00] INFO: file[Prometheus config] sending run action to execute[reload prometheus] (delayed)", "  * execute[reload prometheus] action run[2025-08-04T10:25:40+00:00] INFO: execute[reload prometheus] ran successfully", "", "    - execute /opt/gitlab/bin/gitlab-ctl hup prometheus", "[2025-08-04T10:25:40+00:00] INFO: env_dir[/opt/gitlab/etc/alertmanager/env] sending restart action to runit_service[alertmanager] (delayed)", "Recipe: monitoring::alertmanager", "  * runit_service[alertmanager] action restart (up to date)", "[2025-08-04T10:25:40+00:00] INFO: env_dir[/opt/gitlab/etc/postgres-exporter/env] sending restart action to runit_service[postgres-exporter] (delayed)", "Recipe: monitoring::postgres-exporter", "  * runit_service[postgres-exporter] action restart (up to date)", "", "Running handlers:", "[2025-08-04T10:25:41+00:00] ERROR: Running exception handlers", "Running handlers complete", "[2025-08-04T10:25:41+00:00] ERROR: Exception handlers complete", "Infra Phase failed. 166 resources updated in 03 minutes 02 seconds", "[2025-08-04T10:25:41+00:00] FATAL: Stacktrace dumped to /opt/gitlab/embedded/cookbooks/cache/cinc-stacktrace.out", "[2025-08-04T10:25:41+00:00] FATAL: ---------------------------------------------------------------------------------------", "[2025-08-04T10:25:41+00:00] FATAL: PLEASE PROVIDE THE CONTENTS OF THE stacktrace.out FILE (above) IF YOU FILE A BUG REPORT", "[2025-08-04T10:25:41+00:00] FATAL: ---------------------------------------------------------------------------------------", "[2025-08-04T10:25:41+00:00] FATAL: Mixlib::ShellOut::ShellCommandFailed: sidekiq_service[sidekiq] (gitlab::sidekiq line 23) had an error: Mixlib::ShellOut::ShellCommandFailed: runit_service[sidekiq] (gitlab::sidekiq line 67) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'", "---- Begin output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "STDOUT: timeout: run: /opt/gitlab/service/sidekiq: (pid 31765) 271s, got TERM", "STDERR: ", "---- End output of /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq ----", "Ran /opt/gitlab/embedded/bin/sv restart /opt/gitlab/service/sidekiq returned 1"]}
...ignoring

TASK [server_customization : Disable port 80] **********************************
Monday 04 August 2025  10:25:48 +0000 (0:03:17.218)       0:26:00.521 ********* 
changed: [server.example.com]

TASK [server_customization : Run shell reset password] *************************
Monday 04 August 2025  10:25:49 +0000 (0:00:01.641)       0:26:02.163 ********* 
changed: [server.example.com]

TASK [server_customization : Install repositorio zabbix] ***********************
Monday 04 August 2025  10:27:06 +0000 (0:01:16.737)       0:27:18.900 ********* 
changed: [server.example.com]

TASK [server_customization : Install one specific version of zabbix-server] ****
Monday 04 August 2025  10:27:16 +0000 (0:00:10.278)       0:27:29.179 ********* 
changed: [server.example.com]

TASK [server_customization : Enable service mysql-server, and not touch the state] ***
Monday 04 August 2025  10:28:16 +0000 (0:00:59.888)       0:28:29.067 ********* 
changed: [server.example.com]

TASK [server_customization : Start service mysql-server, if not started] *******
Monday 04 August 2025  10:28:18 +0000 (0:00:01.810)       0:28:30.877 ********* 
changed: [server.example.com]

TASK [server_customization : Run shell mysql configuration] ********************
Monday 04 August 2025  10:28:29 +0000 (0:00:11.233)       0:28:42.110 ********* 
changed: [server.example.com]

TASK [server_customization : Run shell mysql configuration] ********************
Monday 04 August 2025  10:28:30 +0000 (0:00:00.704)       0:28:42.815 ********* 
changed: [server.example.com]

TASK [server_customization : Copy file with owner and permissions] *************
Monday 04 August 2025  10:30:05 +0000 (0:01:35.444)       0:30:18.259 ********* 
changed: [server.example.com]

TASK [server_customization : Add a line to a file if the file does not exist, without passing regexp] ***
Monday 04 August 2025  10:30:07 +0000 (0:00:01.811)       0:30:20.070 ********* 
changed: [server.example.com]

TASK [server_customization : Enable service, and not touch the state] **********
Monday 04 August 2025  10:30:08 +0000 (0:00:01.145)       0:30:21.216 ********* 
changed: [server.example.com] => (item=zabbix-server)
changed: [server.example.com] => (item=zabbix-agent)
changed: [server.example.com] => (item=httpd)
changed: [server.example.com] => (item=php-fpm)

TASK [server_customization : Enable service, and not touch the state] **********
Monday 04 August 2025  10:30:16 +0000 (0:00:07.770)       0:30:28.986 ********* 
changed: [server.example.com] => (item=zabbix-server)
changed: [server.example.com] => (item=zabbix-agent)
changed: [server.example.com] => (item=php-fpm)

TASK [server_customization : Reload httpd service] *****************************
Monday 04 August 2025  10:30:20 +0000 (0:00:04.151)       0:30:33.138 ********* 
changed: [server.example.com]

TASK [server_customization : Selinux permission] *******************************
Monday 04 August 2025  10:30:22 +0000 (0:00:01.335)       0:30:34.474 ********* 
changed: [server.example.com]

PLAY [Install Software workloads for rhelai nodes] *****************************
skipping: no hosts matched

PLAY [Install Software workloads for network] **********************************
skipping: no hosts matched

PLAY [Software flight-check] ***************************************************

TASK [debug] *******************************************************************
Monday 04 August 2025  10:30:24 +0000 (0:00:01.874)       0:30:36.348 ********* 
ok: [localhost] => {
    "msg": "Software checks completed successfully"
}

PLAY [Software Playbook NONE] **************************************************

TASK [Print Software (none) message] *******************************************
Monday 04 August 2025  10:30:24 +0000 (0:00:00.027)       0:30:36.376 ********* 
ok: [localhost] => {
    "msg": "Included software playbook for: none [dummy only]"
}

TASK [Check for hosts_template file] *******************************************
Monday 04 August 2025  10:30:24 +0000 (0:00:00.013)       0:30:36.389 ********* 
ok: [localhost]

TASK [Generate ansible hosts file] *********************************************
Monday 04 August 2025  10:30:24 +0000 (0:00:00.165)       0:30:36.555 ********* 
changed: [localhost]

PLAY [Step 00xxxxx bastion preparation for deployment] *************************

TASK [Ensure directory /etc/ansible exists] ************************************
Monday 04 August 2025  10:30:24 +0000 (0:00:00.337)       0:30:36.893 ********* 
changed: [bastion.example.com]

TASK [Copy over ansible hosts file] ********************************************
Monday 04 August 2025  10:30:25 +0000 (0:00:00.725)       0:30:37.618 ********* 
changed: [bastion.example.com]

PLAY [Step 005 post software] **************************************************

TASK [debug] *******************************************************************
Monday 04 August 2025  10:30:26 +0000 (0:00:01.104)       0:30:38.723 ********* 
ok: [localhost] => {
    "msg": "Post-Software tasks Started"
}

PLAY [Install Post Software  workloads on localhost] ***************************

TASK [Deploying Post Software workloads  on localhost] *************************
Monday 04 August 2025  10:30:26 +0000 (0:00:00.026)       0:30:38.749 ********* 
skipping: [localhost]

PLAY [Install Post Software workloads on  all hosts] ***************************

TASK [Deploying Post Software workloads on all hosts] **************************
Monday 04 August 2025  10:30:26 +0000 (0:00:00.074)       0:30:38.824 ********* 
skipping: [node1.example.com]
skipping: [controller.example.com]
skipping: [server.example.com]
skipping: [bastion.example.com]

PLAY [Install Post Software workloads on bastion] ******************************

TASK [Deploying Post Software workloads on bastion] ****************************
Monday 04 August 2025  10:30:26 +0000 (0:00:00.117)       0:30:38.941 ********* 
skipping: [bastion.example.com]

PLAY [Install Post Software workloads for windows] *****************************
skipping: no hosts matched

PLAY [Install Post Software workloads for gitlab] ******************************
skipping: no hosts matched

PLAY [Install Post Software workloads for Automation Controller] ***************

TASK [Deploying Post Software workloads on Automation Controller] **************
Monday 04 August 2025  10:30:26 +0000 (0:00:00.050)       0:30:38.992 ********* 
skipping: [controller.example.com]

PLAY [Install Post Software workloads for Satelliltes] *************************
skipping: no hosts matched

PLAY [Install Post Software workloads for Satelllite Capsules] *****************
skipping: no hosts matched

PLAY [Install Post Software workloads for Automation Server] *******************
skipping: no hosts matched

PLAY [Install Post Software workloads for nodes] *******************************

TASK [Deploying Post Software workloads on nodes] ******************************
Monday 04 August 2025  10:30:26 +0000 (0:00:00.062)       0:30:39.054 ********* 

TASK [node1_customization : Install httpd] *************************************
Monday 04 August 2025  10:30:26 +0000 (0:00:00.063)       0:30:39.118 ********* 
changed: [node1.example.com]

TASK [node1_customization : Ensure the default Apache port is 80] **************
Monday 04 August 2025  10:30:34 +0000 (0:00:07.543)       0:30:46.662 ********* 
ok: [node1.example.com]

TASK [node1_customization : Enable service httpd, and not touch the state] *****
Monday 04 August 2025  10:30:35 +0000 (0:00:00.653)       0:30:47.316 ********* 
changed: [node1.example.com]

TASK [node1_customization : Start service httpd, if not started] ***************
Monday 04 August 2025  10:30:36 +0000 (0:00:01.286)       0:30:48.602 ********* 
changed: [node1.example.com]

TASK [node1_customization : Install repositorio zabbix] ************************
Monday 04 August 2025  10:30:37 +0000 (0:00:00.988)       0:30:49.590 ********* 
changed: [node1.example.com]

TASK [node1_customization : Install one specific version of Apache] ************
Monday 04 August 2025  10:30:43 +0000 (0:00:06.003)       0:30:55.593 ********* 
changed: [node1.example.com]

TASK [node1_customization : Template a file to /etc/zabbix/zabbix_agentd.conf] ***
Monday 04 August 2025  10:30:53 +0000 (0:00:09.823)       0:31:05.417 ********* 
changed: [node1.example.com]

TASK [node1_customization : Enable service zabbix-agent, and not touch the state] ***
Monday 04 August 2025  10:30:54 +0000 (0:00:01.338)       0:31:06.755 ********* 
changed: [node1.example.com]

TASK [node1_customization : Start service zabbix-agent, if not started] ********
Monday 04 August 2025  10:30:55 +0000 (0:00:01.296)       0:31:08.051 ********* 
changed: [node1.example.com]

TASK [node1_customization : Template a file to /etc/zabbix/zabbix_agentd.conf] ***
Monday 04 August 2025  10:30:56 +0000 (0:00:00.994)       0:31:09.046 ********* 
changed: [node1.example.com]

TASK [node1_customization : Template a file to /etc/zabbix/zabbix_agentd.conf] ***
Monday 04 August 2025  10:30:57 +0000 (0:00:01.137)       0:31:10.184 ********* 
changed: [node1.example.com]

TASK [node1_customization : Template a file to /etc/zabbix/zabbix_agentd.conf] ***
Monday 04 August 2025  10:30:58 +0000 (0:00:01.091)       0:31:11.275 ********* 
changed: [node1.example.com]

TASK [node1_customization : Template a file to /etc/zabbix/zabbix_agentd.conf] ***
Monday 04 August 2025  10:31:00 +0000 (0:00:01.148)       0:31:12.423 ********* 
changed: [node1.example.com]

TASK [node1_customization : Install packages] **********************************
Monday 04 August 2025  10:31:01 +0000 (0:00:01.131)       0:31:13.555 ********* 
fatal: [node1.example.com]: FAILED! => {"changed": false, "failures": [], "msg": "Depsolve Error occurred: \\n Problem: package ansible-rulebook-1.0.8-2.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms requires python3.9dist(ansible-runner), but none of the providers can be installed\\n  - package python3.11-ansible-runner-2.4.0-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.0-1.el9ap provided by python3-ansible-runner-2.3.4-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - package python3.11-ansible-runner-2.4.0-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.0-1.el9ap provided by python3-ansible-runner-2.3.2-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - package python3.11-ansible-runner-2.4.0-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.0-1.el9ap provided by python3-ansible-runner-2.3.5-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - package python3.11-ansible-runner-2.4.0-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.0-1.el9ap provided by python3-ansible-runner-2.3.6-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - package ansible-navigator-25.5.0-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms requires (python3.11dist(ansible-runner) < 3 with python3.11dist(ansible-runner) >= 2.3.1), but none of the providers can be installed\\n  - package python3.11-ansible-runner-2.4.1-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.1-1.el9ap provided by python3-ansible-runner-2.3.4-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - package python3.11-ansible-runner-2.4.1-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.1-1.el9ap provided by python3-ansible-runner-2.3.2-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - package python3.11-ansible-runner-2.4.1-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.1-1.el9ap provided by python3-ansible-runner-2.3.5-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - package python3.11-ansible-runner-2.4.1-1.el9ap.noarch from ansible-developer-1.2-for-rhel-9-x86_64-rpms obsoletes python3-ansible-runner < 2.4.1-1.el9ap provided by python3-ansible-runner-2.3.6-1.el9ap.noarch from ansible-automation-platform-2.4-for-rhel-9-x86_64-rpms\\n  - cannot install the best candidate for the job", "rc": 1, "results": []}

NO MORE HOSTS LEFT *************************************************************

PLAY RECAP *********************************************************************
bastion.example.com        : ok=69   changed=45   unreachable=0    failed=0    skipped=56   rescued=0    ignored=0   
controller.example.com     : ok=63   changed=28   unreachable=0    failed=0    skipped=52   rescued=0    ignored=0   
localhost                  : ok=130  changed=23   unreachable=0    failed=0    skipped=78   rescued=0    ignored=0   
node1.example.com          : ok=46   changed=32   unreachable=0    failed=1    skipped=40   rescued=0    ignored=0   
server.example.com         : ok=54   changed=41   unreachable=0    failed=0    skipped=39   rescued=0    ignored=1   

TASKS RECAP ********************************************************************
Monday 04 August 2025  10:31:05 +0000 (0:00:04.381)       0:31:17.937 ********* 
=============================================================================== 
server_customization : Run shell dnf install -y gitlab-ee ------------- 618.97s
server_customization : Run shell gitlab-ctl reconfigure --------------- 197.22s
infra-ec2-template-create : Launch CloudFormation template (local) ---- 179.00s
common : install common packages for RHEL 9 --------------------------- 177.30s
server_customization : Run shell mysql configuration ------------------- 95.44s
nginx_with_cert : nginx/RedHat9 | install nginx and certbot packages --- 81.29s
server_customization : Run shell reset password ------------------------ 76.74s
server_customization : Install one specific version of zabbix-server --- 59.89s
server_customization : Install EDA server packages and utilities ------- 57.38s
ssh_authorized_keys : Add all authorized keys -------------------------- 20.79s
server_customization : Run shell curl configuration -------------------- 13.86s
nginx_with_cert : Nginx | generate certbot certificate ----------------- 13.17s
server_customization : Start service mysql-server, if not started ------ 11.23s
set-repositories : sat | Install Satellite CA certificate package ------ 10.52s
server_customization : Install repositorio zabbix ---------------------- 10.28s
node1_customization : Install one specific version of Apache ------------ 9.82s
set-repositories : sat | Register with activation-key with HA ----------- 8.82s
infra-ec2-wait_for_linux_hosts : wait for linux host to be available ---- 8.44s
server_customization : Enable service, and not touch the state ---------- 7.77s
set-repositories : sat | Enable repos ----------------------------------- 7.64s
